<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>CloudStack Administrator's Guide</title><link rel="stylesheet" type="text/css" href="CloudStack%20Administrator%27s%20Guide_files/default.css"><link rel="stylesheet" media="print" href="CloudStack%20Administrator%27s%20Guide_files/print.css" type="text/css"><meta name="generator" content="publican 2.8"><meta name="package" content="Apache_CloudStack-Admin_Guide-4.1.1-zh-CN-1-"><meta name="description" content="CloudStack管​理​指​南​"><script type="text/javascript" src="CloudStack%20Administrator%27s%20Guide_files/toc.js"></script><script type="text/javascript">
              addID('Apache_CloudStack');
              
	      addID('Apache_CloudStack.4.1.1');
              
              addID('Apache_CloudStack.4.1.1.books');
	      addID('Apache_CloudStack.4.1.1.Admin_Guide');
              </script></head><body class="notoc"><div id="tocdiv" class="toc"><iframe id="tocframe" class="notoc" src="CloudStack%20Administrator%27s%20Guide_files/toc.htm">This is an iframe, to view it upgrade your browser or enable iframe display.</iframe></div><p id="title"><a class="left" href="http://cloudstack.apache.org/"><img src="CloudStack%20Administrator%27s%20Guide_files/image_left.png" alt="Product Site"></a><a class="right" href="http://cloudstack.apache.org/docs"><img src="CloudStack%20Administrator%27s%20Guide_files/image_right.png" alt="Documentation Site"></a></p><div xml:lang="zh-CN" class="book" id="idp9031632" lang="zh-CN"><div class="titlepage"><div><div class="producttitle"><span class="productname">Apache CloudStack</span> <span class="productnumber">4.1.1</span></div><div><h1 id="idp9031632" class="title">CloudStack Administrator's Guide</h1></div><p class="edition">版 1</p><div><h3 class="corpauthor">
			<span class="inlinemediaobject"><object data="CloudStack%20Administrator%27s%20Guide_files/title_logo.svg" type="image/svg+xml"> </object></span>

		</h3></div><div><div xml:lang="zh-CN" class="authorgroup" lang="zh-CN"><div class="author"><h3 class="author"><span class="firstname">Apache</span> <span class="surname">CloudStack</span></h3></div></div></div><hr><div><div id="idp15011168" class="legalnotice"><h1 class="legalnotice">法律通告</h1><div class="para">
		Licensed to the Apache Software Foundation (ASF) under one or more 
contributor license agreements. See the NOTICE file distributed with 
this work for additional information regarding copyright ownership. The 
ASF licenses this file to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance with the 
License. You may obtain a copy of the License at
	</div><div class="para">
		http://www.apache.org/licenses/LICENSE-2.0
	</div><div class="para">
		Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and 
limitations under the License.
	</div></div></div><div><div class="abstract"><h6>摘要</h6><div class="para">
				CloudStack管​理​指​南​
			</div></div></div></div><hr></div><div class="toc"><dl class="toc"><dt><span class="chapter"><a href="#concepts">1. 概​念​</a></span></dt><dd><dl><dt><span class="section"><a href="#whatis">1.1. What Is CloudStack?</a></span></dt><dt><span class="section"><a href="#feature-overview">1.2. CloudStack能​做​什​么​?</a></span></dt><dt><span class="section"><a href="#deployment-architecture-overview">1.3. Deployment Architecture Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#management-server-overview">1.3.1. 管​理​服​务​器​概​述​</a></span></dt><dt><span class="section"><a href="#cloud-infrastructure-overview">1.3.2. Cloud Infrastructure Overview</a></span></dt><dt><span class="section"><a href="#networking-overview">1.3.3. 网​络​概​述​</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#cloud-infrastructure-concepts">2. 云​基​础​设​施​概​念​</a></span></dt><dd><dl><dt><span class="section"><a href="#about-regions">2.1. About Regions</a></span></dt><dt><span class="section"><a href="#about-zones">2.2. 关​于​资​源​域​</a></span></dt><dt><span class="section"><a href="#about-pods">2.3. 关​于​POD</a></span></dt><dt><span class="section"><a href="#about-clusters">2.4. 关​于​集​群​</a></span></dt><dt><span class="section"><a href="#about-hosts">2.5. 关​于​宿​主​机​</a></span></dt><dt><span class="section"><a href="#about-primary-storage">2.6. 关​于​主​存​储​</a></span></dt><dt><span class="section"><a href="#about-secondary-storage">2.7. 关​与​辅​助​存​储​</a></span></dt><dt><span class="section"><a href="#about-physical-networks">2.8. 关​于​物​理​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-network-traffic-types">2.8.1. 基​本​区​域​网​络​流​量​类​型​</a></span></dt><dt><span class="section"><a href="#basic-zone-guest-ip-addresses">2.8.2. 基​本​区​域​宾​客​ IP 地​址​</a></span></dt><dt><span class="section"><a href="#advanced-zone-network-traffic-types">2.8.3. 高​级​区​域​网​络​流​量​类​型​</a></span></dt><dt><span class="section"><a href="#advanced-zone-guest-ip-addresses">2.8.4. 高​级​区​域​宾​客​的​IP地​址​</a></span></dt><dt><span class="section"><a href="#advanced-zone-public-ip-addresses">2.8.5. Advanced Zone Public IP Addresses</a></span></dt><dt><span class="section"><a href="#system-reserved-ip-addresses">2.8.6. System Reserved IP Addresses</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#accounts">3. 帐​号​</a></span></dt><dd><dl><dt><span class="section"><a href="#accounts-users-domains">3.1. 账​户​，用​户​，域​</a></span></dt><dt><span class="section"><a href="#LDAPserver-for-user-authentication">3.2. Using an LDAP Server for User Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#example-LDAP-configuration-commands">3.2.1. LDAP配​置​命​令​样​例​</a></span></dt><dt><span class="section"><a href="#search-base">3.2.2. Search Base</a></span></dt><dt><span class="section"><a href="#query-filter">3.2.3. 查​询​过​滤​器​</a></span></dt><dt><span class="section"><a href="#search-user-bind-dn">3.2.4. Search User Bind DN</a></span></dt><dt><span class="section"><a href="#SSL-keystore-path-and-password">3.2.5. SSL Keystore路​径​和​密​码​</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#user-services-overview">4. User Services Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#offerings-and-templates">4.1. Service Offerings, Disk Offerings, Network Offerings, and Templates</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ui">5. 用​户​界​面​</a></span></dt><dd><dl><dt><span class="section"><a href="#log-in">5.1. 登​陆​到​用​户​界​面​</a></span></dt><dd><dl><dt><span class="section"><a href="#end-user-ui-overview">5.1.1. 最​终​用​户​界​面​概​览​</a></span></dt><dt><span class="section"><a href="#root-admin-ui-overview">5.1.2. 根​管​理​员​界​面​的​概​述​</a></span></dt><dt><span class="section"><a href="#log-in-root-admin">5.1.3. 作​为​根​管​理​员​登​录​</a></span></dt><dt><span class="section"><a href="#changing-root-password">5.1.4. 修​改​Root口​令​</a></span></dt></dl></dd><dt><span class="section"><a href="#using-sshkeys">5.2. Using SSH Keys for Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#create-ssh-template">5.2.1.  Creating an Instance Template that Supports SSH Keys</a></span></dt><dt><span class="section"><a href="#create-ssh-keypair">5.2.2. Creating the SSH Keypair</a></span></dt><dt><span class="section"><a href="#creating-ssh-instance">5.2.3. Creating an Instance</a></span></dt><dt><span class="section"><a href="#logging-in-ssh">5.2.4. Logging In Using the SSH Keypair</a></span></dt><dt><span class="section"><a href="#reset-ssh">5.2.5. Resetting SSH Keys</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#projects">6. 使​用​项​目​来​管​理​用​户​和​资​源​。​</a></span></dt><dd><dl><dt><span class="section"><a href="#projects-overview">6.1. Overview of Projects</a></span></dt><dt><span class="section"><a href="#configuring-projects">6.2. 配​置​项​目​</a></span></dt><dd><dl><dt><span class="section"><a href="#set-up-invitations">6.2.1. Setting Up Invitations</a></span></dt><dt><span class="section"><a href="#set-resource-limits-for-projects">6.2.2. 设​置​项​目​的​资​源​限​制​</a></span></dt><dt><span class="section"><a href="#set-projects-creator-permissions">6.2.3. Setting Project Creator Permissions</a></span></dt></dl></dd><dt><span class="section"><a href="#create-new-projects">6.3. 创​建​一​个​新​项​目​</a></span></dt><dt><span class="section"><a href="#add-members-to-projects">6.4. 添​加​成​员​到​一​个​项​目​</a></span></dt><dd><dl><dt><span class="section"><a href="#send-projects-membership-invitation">6.4.1. Sending Project Membership Invitations</a></span></dt><dt><span class="section"><a href="#add-projects-members-from-ui">6.4.2. Adding Project Members From the UI</a></span></dt></dl></dd><dt><span class="section"><a href="#accept-membership-invite">6.5. 接​受​成​员​身​份​的​邀​请​</a></span></dt><dt><span class="section"><a href="#suspend-project">6.6. Suspending or Deleting a Project</a></span></dt><dt><span class="section"><a href="#use-project-view">6.7. Using the Project View</a></span></dt></dl></dd><dt><span class="chapter"><a href="#provisioning-steps">7. 准​备​你​的​云​基​础​设​施​的​步​骤​</a></span></dt><dd><dl><dt><span class="section"><a href="#provisioning-steps-overview">7.1. 设​置​步​骤​概​览​</a></span></dt><dt><span class="section"><a href="#region-add">7.2. Adding Regions (optional)</a></span></dt><dd><dl><dt><span class="section"><a href="#region-first">7.2.1. The First Region: The Default Region</a></span></dt><dt><span class="section"><a href="#region-add-2">7.2.2. Adding a Region</a></span></dt><dt><span class="section"><a href="#region-add-n">7.2.3. Adding Third and Subsequent Regions</a></span></dt><dt><span class="section"><a href="#region-delete">7.2.4. Deleting a Region</a></span></dt></dl></dd><dt><span class="section"><a href="#zone-add">7.3. 创​建​Zone</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-configuration">7.3.1. 基​础​区​域​配​置​</a></span></dt><dt><span class="section"><a href="#advanced-zone-configuration">7.3.2. 高​级​资​源​域​配​置​</a></span></dt></dl></dd><dt><span class="section"><a href="#pod-add">7.4. 添​加​一​个​机​架​</a></span></dt><dt><span class="section"><a href="#cluster-add">7.5. 添​加​集​群​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-clusters-kvm-xenserver">7.5.1. Add Cluster: KVM or XenServer</a></span></dt><dt><span class="section"><a href="#add-clusters-vsphere">7.5.2. Add Cluster: vSphere</a></span></dt></dl></dd><dt><span class="section"><a href="#host-add">7.6. Adding a Host</a></span></dt><dd><dl><dt><span class="section"><a href="#host-add-xenserver-kvm-ovm">7.6.1. Adding a Host (XenServer or KVM)</a></span></dt><dt><span class="section"><a href="#host-add-vsphere">7.6.2. 增​加​一​台​主​机​(vSphere)</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-add">7.7. æ·»å&nbsp;ä¸»å­å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-primary-storage">7.7.1. System Requirements for Primary Storage</a></span></dt><dt><span class="section"><a href="#adding-primary-storage">7.7.2. Adding Primary Stroage</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-add">7.8. æ·»å&nbsp;è¾å©å­å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-secondary-storage">7.8.1. System Requirements for Secondary Storage</a></span></dt><dt><span class="section"><a href="#adding-secondary-storage">7.8.2. 增​加​二​级​存​储​</a></span></dt></dl></dd><dt><span class="section"><a href="#initialize-and-test">7.9. 初​始​化​和​测​试​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#offerings">8. 服​务​提​供​</a></span></dt><dd><dl><dt><span class="section"><a href="#compute-disk-service-offerings">8.1. 计​算​和​磁​盘​服​务​提​供​方​案​</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-compute-offerings">8.1.1. 创​建​计​算​资​源​提​供​方​案​</a></span></dt><dt><span class="section"><a href="#creating-disk-offerings">8.1.2. 创​建​一​个​新​的​磁​盘​方​案​</a></span></dt><dt><span class="section"><a href="#modify-delete-service-offerings">8.1.3. 修​改​或​删​除​服​务​提​供​</a></span></dt></dl></dd><dt><span class="section"><a href="#system-service-offerings">8.2. 系​统​服​务​方​案​</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-system-service-offerings">8.2.1. Creating a New System Service Offering</a></span></dt></dl></dd><dt><span class="section"><a href="#network-rate">8.3. Network Throttling</a></span></dt><dt><span class="section"><a href="#sys-offering-sysvm">8.4. Changing the Default System Offering for System VMs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#set-up-network-for-users">9. Setting Up Networking for Users</a></span></dt><dd><dl><dt><span class="section"><a href="#networks-for-users-overview">9.1. Overview of Setting Up Networking for Users</a></span></dt><dt><span class="section"><a href="#about-virtual-networks">9.2. 关​于​虚​拟​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#isolated-networks">9.2.1. 隔​离​的​网​络​</a></span></dt><dt><span class="section"><a href="#shared-networks">9.2.2. 共​享​网​络​</a></span></dt><dt><span class="section"><a href="#runtime-allocation-virtual-network-resources">9.2.3. 虚​拟​网​络​资​源​的​运​行​时​分​配​</a></span></dt></dl></dd><dt><span class="section"><a href="#network-service-providers">9.3. 网​络​服​务​提​供​方​案​</a></span></dt><dt><span class="section"><a href="#network-offerings">9.4. ç½ç»æ¹æ¡</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-network-offerings">9.4.1. Creating a New Network Offering</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#virtual-machines">10. 使​用​虚​拟​机​</a></span></dt><dd><dl><dt><span class="section"><a href="#about-working-with-vms">10.1. 关​于​虚​拟​机​的​使​用​</a></span></dt><dt><span class="section"><a href="#best-practices-vm">10.2. 虚​拟​机​最​佳​实​践​</a></span></dt><dt><span class="section"><a href="#vm-lifecycle">10.3. VM Lifecycle</a></span></dt><dt><span class="section"><a href="#creating-vms">10.4. 创​建​虚​拟​机​实​例​</a></span></dt><dt><span class="section"><a href="#accessing-vms">10.5. Accessing VMs</a></span></dt><dt><span class="section"><a href="#stopping-and-starting-vms">10.6. 停​止​和​启​动​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#changing-vm-name-os-group">10.7. Changing the VM Name, OS, or Group</a></span></dt><dt><span class="section"><a href="#changing-service-offering-for-vm">10.8. Changing the Service Offering for a VM</a></span></dt><dt><span class="section"><a href="#manual-live-migration">10.9. Moving VMs Between Hosts (Manual Live Migration)</a></span></dt><dt><span class="section"><a href="#deleting-vms">10.10. Deleting VMs</a></span></dt><dt><span class="section"><a href="#working-with-iso">10.11. 使​用​iso文​件​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-iso">10.11.1. 添​加​一​个​ISO</a></span></dt><dt><span class="section"><a href="#attach-iso-to-vm">10.11.2. 附​加​ISO到​虚​拟​机​</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#working-with-hosts">11. Working With Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#adding-hosts">11.1. Adding Hosts</a></span></dt><dt><span class="section"><a href="#scheduled-maintenance-maintenance-mode-hosts">11.2. 主​机​定​期​维​护​和​维​护​模​式​</a></span></dt><dd><dl><dt><span class="section"><a href="#vcenter-maintenance-mode">11.2.1. vCenter and Maintenance Mode</a></span></dt><dt><span class="section"><a href="#xenserver-maintenance-mode">11.2.2. XenServer和​维​护​模​式​</a></span></dt></dl></dd><dt><span class="section"><a href="#disable-enable-zones-pods-clusters">11.3. Disabling and Enabling Zones, Pods, and Clusters</a></span></dt><dt><span class="section"><a href="#removing-hosts">11.4. 移​除​主​机​</a></span></dt><dd><dl><dt><span class="section"><a href="#removing-xenserver-kvm-hosts">11.4.1. 移​除​XenServer和​KVM宿​主​机​</a></span></dt><dt><span class="section"><a href="#removing-vsphere-hosts">11.4.2. 移​除​vSphere 主​机​</a></span></dt></dl></dd><dt><span class="section"><a href="#re-install-hosts">11.5. 重​新​安​装​主​机​</a></span></dt><dt><span class="section"><a href="#maintain-hypervisors-on-hosts">11.6. 维​护​主​机​上​的​虚​拟​机​管​理​器​</a></span></dt><dt><span class="section"><a href="#change-host-password">11.7. 更​改​主​机​密​码​</a></span></dt><dt><span class="section"><a href="#host-allocation">11.8. 主​机​分​配​</a></span></dt><dd><dl><dt><span class="section"><a href="#over-provisioning-service-offering-limits">11.8.1. 超​配​和​服​务​提​供​方​案​的​限​制​</a></span></dt></dl></dd><dt><span class="section"><a href="#vlan-provisioning">11.9. vlan 配​置​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#working-with-templates">12. 使​用​模​板​</a></span></dt><dd><dl><dt><span class="section"><a href="#create-templates-overview">12.1. 创​建​模​板​概​览​</a></span></dt><dt><span class="section"><a href="#requirements-templates">12.2. 针​对​模​板​的​需​求​</a></span></dt><dt><span class="section"><a href="#best-practices-templates">12.3. 模​板​最​佳​实​践​</a></span></dt><dt><span class="section"><a href="#default-template">12.4. 默​认​模​版​</a></span></dt><dt><span class="section"><a href="#private-public-template">12.5. 私​有​模​板​和​公​共​模​板​</a></span></dt><dt><span class="section"><a href="#create-template-from-existing-vm">12.6. 通​过​已​存​在​的​虚​拟​机​创​建​模​板​</a></span></dt><dt><span class="section"><a href="#create-template-from-snapshot">12.7. 从​一​个​快​照​创​建​一​个​模​板​</a></span></dt><dt><span class="section"><a href="#upload-template">12.8. Uploading Templates</a></span></dt><dt><span class="section"><a href="#export-template">12.9. 导​出​模​板​</a></span></dt><dt><span class="section"><a href="#create-windows-template">12.10. 创​建​WINdows 模​板​</a></span></dt><dd><dl><dt><span class="section"><a href="#sysprep-windows-server-2008R2">12.10.1. System Preparation for Windows Server 2008 R2</a></span></dt><dt><span class="section"><a href="#sysprep-for-windows-server-2003R2">12.10.2. System Preparation for Windows Server 2003 R2</a></span></dt></dl></dd><dt><span class="section"><a href="#import-ami">12.11. Importing Amazon Machine Images</a></span></dt><dt><span class="section"><a href="#convert-hyperv-vm-to-template">12.12. 转​换​Hyper-v 虚​拟​机​为​模​板​</a></span></dt><dt><span class="section"><a href="#add-password-management-to-templates">12.13. Adding Password Management to Your Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#linux-installation">12.13.1. Linux系​统​安​装​</a></span></dt><dt><span class="section"><a href="#windows-installation">12.13.2. Windows OS 安​装​</a></span></dt></dl></dd><dt><span class="section"><a href="#delete-templates">12.14. 删​除​模​板​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#storage">13. 使​用​存​储​</a></span></dt><dd><dl><dt><span class="section"><a href="#storage-overview">13.1. Storage Overview</a></span></dt><dt><span class="section"><a href="#primary-storage">13.2. 主​存​储​</a></span></dt><dd><dl><dt><span class="section"><a href="#best-practices-primary-storage">13.2.1. 对​于​主​存​储​最​好​的​实​践​</a></span></dt><dt><span class="section"><a href="#runtime-behavior-of-primary-storage">13.2.2. Runtime Behavior of Primary Storage</a></span></dt><dt><span class="section"><a href="#hypervisor-support-for-primarystorage">13.2.3. 虚​拟​机​平​台​对​主​存​储​的​支​持​</a></span></dt><dt><span class="section"><a href="#storage-tags">13.2.4. å­å¨æ&nbsp;ç­¾</a></span></dt><dt><span class="section"><a href="#maintenance-mode-for-primary-storage.xml">13.2.5. 主​存​储​的​维​护​模​式​</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage">13.3. 二​级​存​储​</a></span></dt><dt><span class="section"><a href="#working-with-volumes">13.4. Working With Volumes</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-new-volumes">13.4.1. 创​建​新​卷​</a></span></dt><dt><span class="section"><a href="#upload-existing-volume-to-vm">13.4.2. Uploading an Existing Volume to a Virtual Machine</a></span></dt><dt><span class="section"><a href="#attaching-volume">13.4.3. 附​加​卷​</a></span></dt><dt><span class="section"><a href="#detach-move-volumes">13.4.4. Detaching and Moving Volumes</a></span></dt><dt><span class="section"><a href="#vm-storage-migration">13.4.5. 虚​拟​机​存​储​迁​移​</a></span></dt><dt><span class="section"><a href="#resizing-volumes">13.4.6. 调​整​卷​大​小​</a></span></dt><dt><span class="section"><a href="#volume-deletion-garbage-collection">13.4.7. Volume Deletion and Garbage Collection</a></span></dt></dl></dd><dt><span class="section"><a href="#working-with-snapshots">13.5. 使​用​快​照​</a></span></dt><dd><dl><dt><span class="section"><a href="#snapshot-throttling">13.5.1. Snapshot Job Throttling</a></span></dt><dt><span class="section"><a href="#automatic-snapshot-creation-retention">13.5.2. Automatic Snapshot Creation and Retention</a></span></dt><dt><span class="section"><a href="#incremental-snapshots-backup">13.5.3. Incremental Snapshots and Backup </a></span></dt><dt><span class="section"><a href="#volume-status">13.5.4. 卷​状​态​</a></span></dt><dt><span class="section"><a href="#snapshot-restore">13.5.5. 快​照​恢​复​</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#work-with-usage">14. Working with Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-usage-server">14.1. 配​置​使​用​服​务​器​</a></span></dt><dt><span class="section"><a href="#set-usage-limit">14.2. Setting Usage Limits</a></span></dt><dt><span class="section"><a href="#globally-configured-limits">14.3. Globally Configured Limits</a></span></dt><dt><span class="section"><a href="#default-account-resource-limit">14.4. Default Account Resource Limits</a></span></dt><dt><span class="section"><a href="#per-domain-limits">14.5. Per-Domain Limits</a></span></dt></dl></dd><dt><span class="chapter"><a href="#networks">15. 管​理​网​络​和​流​量​</a></span></dt><dd><dl><dt><span class="section"><a href="#guest-traffic">15.1. æ¥å®¾æµé</a></span></dt><dt><span class="section"><a href="#networking-in-a-pod">15.2. 一​个​POD内​的​网​络​</a></span></dt><dt><span class="section"><a href="#networking-in-a-zone">15.3. 在​区​域​内​的​联​网​</a></span></dt><dt><span class="section"><a href="#basic-zone-physical-network-configuration">15.4. 基​本​区​域​物​理​网​络​配​置​</a></span></dt><dt><span class="section"><a href="#advanced-zone-physical-network-configuration">15.5. 高​级​区​物​理​网​络​配​置​</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-guest-traffic-in-advanced-zone">15.5.1. 在​高​级​资​源​域​中​设​置​来​宾​流​量​</a></span></dt><dt><span class="section"><a href="#configure-public-traffic-in-an-advanced-zone">15.5.2. 在​高​级​区​中​配​置​公​用​通​信​</a></span></dt></dl></dd><dt><span class="section"><a href="#using-multiple-guest-networks">15.6. 使​用​多​个​来​宾​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-additional-guest-network">15.6.1. 添​加​另​一​个​虚​拟​机​的​网​络​</a></span></dt><dt><span class="section"><a href="#change-network-offering-on-guest-network">15.6.2. Changing the Network Offering on a Guest Network</a></span></dt></dl></dd><dt><span class="section"><a href="#security-groups">15.7. 安​全​分​组​</a></span></dt><dd><dl><dt><span class="section"><a href="#about-security-groups">15.7.1. About Security Groups</a></span></dt><dt><span class="section"><a href="#add-security-group">15.7.2. Adding a Security Group</a></span></dt><dt><span class="section"><a href="#security-groups-advanced-zones">15.7.3. Security Groups in Advanced Zones (KVM Only)</a></span></dt><dt><span class="section"><a href="#enable-security-groups">15.7.4. 启​用​安​全​组​</a></span></dt><dt><span class="section"><a href="#add-ingress-egress-rules">15.7.5. Adding Ingress and Egress Rules to a Security Group</a></span></dt></dl></dd><dt><span class="section"><a href="#external-firewalls-and-load-balancers">15.8. 外​部​防​火​墙​和​负​载​均​衡​器​</a></span></dt><dd><dl><dt><span class="section"><a href="#using-netscaler-load-balancers">15.8.1. About Using a NetScaler Load Balancer</a></span></dt><dt><span class="section"><a href="#configure-snmp-rhel">15.8.2. 配​置​RHEL服​务​器​上​的​snmp通​信​组​</a></span></dt><dt><span class="section"><a href="#initial-setup-of-external-firewalls-loadbalancer">15.8.3. Initial Setup of External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#ongoing-config-of-external-firewalls-ld">15.8.4. Ongoing Configuration of External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#autoscale">15.8.5. Configuring AutoScale</a></span></dt></dl></dd><dt><span class="section"><a href="#load-balancer-rules">15.9. 负​载​均​衡​规​则​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-load-balancer-rule">15.9.1. Adding a Load Balancer Rule</a></span></dt><dt><span class="section"><a href="#sticky-session-policies-for-lb-rules">15.9.2. Sticky Session Policies for Load Balancer Rules</a></span></dt></dl></dd><dt><span class="section"><a href="#guest-ip-ranges">15.10. 宾​客​IP范​围​</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-address">15.11. 获​得​一​个​新​的​IP地​址​</a></span></dt><dt><span class="section"><a href="#release-ip-address">15.12. Releasing an IP Address</a></span></dt><dt><span class="section"><a href="#static-nat">15.13. 静​态​ NAT</a></span></dt><dd><dl><dt><span class="section"><a href="#enable-disable-static-nat">15.13.1. Enabling or Disabling Static NAT</a></span></dt></dl></dd><dt><span class="section"><a href="#ip-forwarding-firewalling">15.14. IP转​发​及​防​火​墙​</a></span></dt><dd><dl><dt><span class="section"><a href="#egress-firewall-rule">15.14.1. Creating Egress Firewall Rules in an Advanced Zone</a></span></dt><dt><span class="section"><a href="#firewall-rules">15.14.2. 防​火​墙​规​则​</a></span></dt><dt><span class="section"><a href="#port-forwarding">15.14.3. ç«¯å£è½¬å</a></span></dt></dl></dd><dt><span class="section"><a href="#ip-load-balancing">15.15. IP负​载​均​衡​</a></span></dt><dt><span class="section"><a href="#dns-dhcp">15.16. DNS和​DHCP</a></span></dt><dt><span class="section"><a href="#vpn">15.17. VPN 虚​拟​专​用​网​</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-vpn">15.17.1. Configuring VPN</a></span></dt><dt><span class="section"><a href="#using-vpn-with-windows">15.17.2. Using VPN with Windows</a></span></dt><dt><span class="section"><a href="#using-vpn-with-mac">15.17.3. 在​Mac OS X上​使​用​VPN</a></span></dt><dt><span class="section"><a href="#site-to-site-vpn">15.17.4. 配​置​站​点​到​站​点​的​VPN连​接​</a></span></dt></dl></dd><dt><span class="section"><a href="#inter-vlan-routing">15.18. About Inter-VLAN Routing</a></span></dt><dt><span class="section"><a href="#configure-vpc">15.19. Configuring a Virtual Private Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#vpc">15.19.1. About Virtual Private Clouds</a></span></dt><dt><span class="section"><a href="#add-vpc">15.19.2. Adding a Virtual Private Cloud</a></span></dt><dt><span class="section"><a href="#add-tier">15.19.3. Adding Tiers</a></span></dt><dt><span class="section"><a href="#configure-acl">15.19.4. Configuring Access Control List</a></span></dt><dt><span class="section"><a href="#add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</a></span></dt><dt><span class="section"><a href="#add-vm-to-tier">15.19.6. Deploying VMs to the Tier</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</a></span></dt><dt><span class="section"><a href="#release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</a></span></dt><dt><span class="section"><a href="#enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</a></span></dt><dt><span class="section"><a href="#add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</a></span></dt><dt><span class="section"><a href="#add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</a></span></dt><dt><span class="section"><a href="#remove-tier">15.19.12. Removing Tiers</a></span></dt><dt><span class="section"><a href="#remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</a></span></dt></dl></dd><dt><span class="section"><a href="#persistent-network">15.20. Persistent Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#persistent-network-consideration">15.20.1. Persistent Network Considerations</a></span></dt><dt><span class="section"><a href="#set-up-persistent-network">15.20.2. Creating a Persistent Guest Network</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#working-with-system-vm">16. Working with System Virtual Machines</a></span></dt><dd><dl><dt><span class="section"><a href="#system-vm-template">16.1. 系​统​VM模​板​</a></span></dt><dt><span class="section"><a href="#multiple-system-vm-vmware">16.2. 支​持​VMware的​多​种​系​统​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#console-proxy">16.3. 控​制​台​代​理​（控​制​台​虚​拟​机​）</a></span></dt><dd><dl><dt><span class="section"><a href="#use-cert">16.3.1. Using a SSL Certificate for the Console Proxy</a></span></dt><dt><span class="section"><a href="#change-console-proxy-ssl-certificate-domain">16.3.2. Changing the Console Proxy SSL Certificate and Domain</a></span></dt></dl></dd><dt><span class="section"><a href="#virtual-router">16.4. èæè·¯ç±å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-virtual-router">16.4.1. 配​置​虚​拟​路​由​器​</a></span></dt><dt><span class="section"><a href="#upgrade-virtual-router-with-service-offering">16.4.2. 使​用​系​统​计​算​服​务​方​案​升​级​虚​拟​路​由​器​</a></span></dt><dt><span class="section"><a href="#best-practices-virtual-router">16.4.3. 虚​拟​路​由​器​的​最​佳​实​践​</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-vm">16.5. 二​级​存​储​虚​拟​机​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#sys-reliability-and-ha">17. System Reliability and High Availability</a></span></dt><dd><dl><dt><span class="section"><a href="#ha-management-server">17.1. HA for Management Server</a></span></dt><dt><span class="section"><a href="#management-server-lb">17.2. Management Server Load Balancing</a></span></dt><dt><span class="section"><a href="#ha-enabled-vm">17.3. 开​启​了​高​可​用​特​性​的​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#ha-for-hosts">17.4. HA for Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#dedicated-ha-hosts">17.4.1. Dedicated HA Hosts</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-outage-and-data-loss">17.5. 主​存​储​故​障​和​数​据​丢​失​</a></span></dt><dt><span class="section"><a href="#secondary-storage-outage-and-data-loss">17.6. 二​级​存​储​的​中​断​和​数​据​丢​失​</a></span></dt><dt><span class="section"><a href="#api-throttling">17.7. Limiting the Rate of API Requests</a></span></dt><dd><dl><dt><span class="section"><a href="#api-throttling-configure">17.7.1. Configuring the API Request Rate</a></span></dt><dt><span class="section"><a href="#api-throttling-limitations">17.7.2. Limitations on API Throttling</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#manage-cloud">18. 管​理​云​</a></span></dt><dd><dl><dt><span class="section"><a href="#tagging-resources">18.1. Using Tags to Organize Resources in the Cloud</a></span></dt><dt><span class="section"><a href="#change-database-config">18.2. 改​变​数​据​库​配​置​</a></span></dt><dt><span class="section"><a href="#change-database-password">18.3. Changing the Database Password</a></span></dt><dt><span class="section"><a href="#admin-alerts">18.4. 管​理​员​告​警​</a></span></dt><dt><span class="section"><a href="#customizing-dns">18.5. 自​定​义​网​络​域​名​</a></span></dt><dt><span class="section"><a href="#stop-restart-management-server">18.6. 停​止​重​启​管​理​服​务​器​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#global-config">19. Global Configuration Parameters</a></span></dt><dd><dl><dt><span class="section"><a href="#setting-global-config-parameters">19.1. 设​置​全​局​配​置​参​数​</a></span></dt><dt><span class="section"><a href="#about-global-config-parameters">19.2. About Global Configuration Parameters</a></span></dt></dl></dd><dt><span class="chapter"><a href="#api-overview">20. CloudStack API</a></span></dt><dd><dl><dt><span class="section"><a href="#provisioning-auth-api">20.1. 自​服​务​和​验​证​API</a></span></dt><dt><span class="section"><a href="#allocators">20.2. 分​配​器​</a></span></dt><dt><span class="section"><a href="#user-data-and-meta-data">20.3. User Data and Meta Data</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tuning">21. 性​能​调​优​</a></span></dt><dd><dl><dt><span class="section"><a href="#performance-monitoring">21.1. 性​能​监​控​</a></span></dt><dt><span class="section"><a href="#increase-management-server-max-memory">21.2. Increase Management Server Maximum Memory</a></span></dt><dt><span class="section"><a href="#set-database-buffer-pool-size">21.3. Set Database Buffer Pool Size</a></span></dt><dt><span class="section"><a href="#set-monitor-total-vm-limits-per-host">21.4. Set and Monitor Total VM Limits per Host</a></span></dt><dt><span class="section"><a href="#configure-xenserver-dom0-memory">21.5. 配​置​XenServer的​dom0的​内​存​</a></span></dt></dl></dd><dt><span class="chapter"><a href="#troubleshooting">22. 故​障​排​查​</a></span></dt><dd><dl><dt><span class="section"><a href="#events">22.1. 事​件​</a></span></dt><dd><dl><dt><span class="section"><a href="#events-log">22.1.1. Event Logs</a></span></dt><dt><span class="section"><a href="#event-framework">22.1.2. Event Notification</a></span></dt><dt><span class="section"><a href="#standard-events">22.1.3. Standard Events</a></span></dt><dt><span class="section"><a href="#long-running-job-events">22.1.4. 长​时​间​运​行​的​任​务​事​件​</a></span></dt><dt><span class="section"><a href="#event-log-queries">22.1.5. 事​件​日​志​查​询​</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting-working-with-server-logs">22.2. Working with Server Logs</a></span></dt><dt><span class="section"><a href="#troubleshooting-dataloss-on-exported-primary-storage">22.3. Data Loss on Exported Primary Storage</a></span></dt><dt><span class="section"><a href="#troubleshooting-recover-lost-virtual-router">22.4. Recovering a Lost Virtual Router </a></span></dt><dt><span class="section"><a href="#troubleshooting-maintenance-mode-not-working-on-vCenter">22.5. Maintenance mode not working on vCenter</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-deploy-vms">22.6. 无​法​从​上​传​的​vSphere模​板​部​署​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-power-on-vm">22.7. Unable to power on virtual machine on VMware</a></span></dt><dt><span class="section"><a href="#troubleshooting-lb-rules-fails">22.8. Load balancer rules fail after changing network offering</a></span></dt></dl></dd><dt><span class="appendix"><a href="#time-zones">A. 时​区​</a></span></dt><dt><span class="appendix"><a href="#event-types">B. Event Types</a></span></dt><dt><span class="appendix"><a href="#alerts">C. Alerts</a></span></dt><dt><span class="appendix"><a href="#appe-cloudstack-Revision_History">D. 更​新​记​录​</a></span></dt></dl></div><div xml:lang="zh-CN" class="chapter" id="concepts" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;1&nbsp;章&nbsp;概​念​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#whatis">1.1. What Is CloudStack?</a></span></dt><dt><span class="section"><a href="#feature-overview">1.2. CloudStack能​做​什​么​?</a></span></dt><dt><span class="section"><a href="#deployment-architecture-overview">1.3. Deployment Architecture Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#management-server-overview">1.3.1. 管​理​服​务​器​概​述​</a></span></dt><dt><span class="section"><a href="#cloud-infrastructure-overview">1.3.2. Cloud Infrastructure Overview</a></span></dt><dt><span class="section"><a href="#networking-overview">1.3.3. 网​络​概​述​</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="whatis" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">1.1.&nbsp;What Is CloudStack?</h2></div></div></div><div class="para">
		CloudStack is an open source software platform that pools computing 
resources to build public, private, and hybrid Infrastructure as a 
Service (IaaS) clouds. CloudStack manages the network, storage, and 
compute nodes that make up a cloud infrastructure. Use CloudStack to 
deploy, manage, and configure cloud computing environments.
	</div><div class="para">
		Typical users are service providers and enterprises. With CloudStack, you can:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Set up an on-demand, elastic cloud computing service. Service 
providers can sell self service virtual machine instances, storage 
volumes, and networking configurations over the Internet.
			</div></li><li class="listitem"><div class="para">
				Set up an on-premise private cloud for use by employees. Rather than
 managing virtual machines in the same way as physical machines, with 
CloudStack an enterprise can offer self-service virtual machines to 
users without involving IT departments.
			</div></li></ul></div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/1000-foot-view.png" alt="1000-foot-view.png: Overview of CloudStack" width="444"></div></div><div xml:lang="zh-CN" class="section" id="feature-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">1.2.&nbsp;CloudStack能​做​什​么​?</h2></div></div></div><div class="para">
		<span class="bold bold"><strong>多​种​Hypervisor支​持​</strong></span>
	</div><div class="para">
		CloudStack works with a variety of hypervisors, and a single cloud 
deployment can contain multiple hypervisor implementations. The current 
release of CloudStack supports pre-packaged enterprise solutions like 
Citrix XenServer and VMware vSphere, as well as KVM or Xen running on 
Ubuntu or CentOS.
	</div><div class="para">
		<span class="bold bold"><strong>大​规​模​可​扩​展​的​管​理​架​构​</strong></span>
	</div><div class="para">
		CloudStack可​以​管​理​数​万​台​服​务​器​; 
这​些​服​务​器​可​以​部​署​在​不​同​地​域​的​数​据​中​心​里​. 
处​于​中​心​位​置​的​管​理​服​务​器​可​以​线​性​扩​展​, 
这​样​就​消​除​了​对​中​间​层​集​群​级​别​管​理​服​务​器​的​依​赖​. 
任​何​一​个​组​件​失​效​不​会​导​致​云​平​台​的​服​务​暂​停​.对​于​管​理​服​务​器​的​定​期​维​护​不​会​对​云
​平​台​中​正​在​运​行​的​虚​拟​机​造​成​影​响​.
	</div><div class="para">
		<span class="bold bold"><strong>自​动​化​配​置​管​理​</strong></span>
	</div><div class="para">
		CloudStack会​对​客​户​虚​拟​机​的​网​络​和​存​储​进​行​自​动​化​配​置​.
	</div><div class="para">
		CloudStack内​部​提​供​的​虚​拟​设​备​池​用​来​支​持​云​平​台​自​身​功​能​. 
这​些​虚​拟​设​备​可​以​提​供​的​服​务​有​防​火​墙​, 路​由​, DHCP, VPN访​问​, 控​制​台​代​理​, 
存​储​访​问​以​及​存​储​备​份​等​. 虚​拟​设​备​的​大​量​使​用​简​化​了​安​装​, 
配​置​和​持​续​的​云​平​台​部​署​管​理​流​程​.
	</div><div class="para">
		<span class="bold bold"><strong>图​形​用​户​界​面​</strong></span>
	</div><div class="para">
		CloudStack提​供​了​管​理​员​Web接​口​, 用​来​供​应​和​管​理​整​个​云​平​台​; 
同​时​也​提​供​了​类​似​最​终​用​户​的​Web接​口​,用​来​管​理​运​行​中​的​虚​机​和​模​板​. 
UI可​以​根​据​服​务​提​供​商​的​需​求​或​企​业​的​Web风​格​进​行​定​制​化​.
	</div><div class="para">
		<span class="bold bold"><strong>API及​其​扩​展​性​</strong></span>
	</div><div class="para">
		CloudStack provides an API that gives programmatic access to all the 
management features available in the UI. The API is maintained and 
documented. This API enables the creation of command line tools and new 
user interfaces to suit particular needs. See the Developer’​s Guide and
 API Reference, both available at <a href="http://cloudstack.apache.org/docs/en-US/index.html">Apache CloudStack Guides</a> and <a href="http://cloudstack.apache.org/docs/api/index.html">Apache CloudStack API Reference</a> respectively.
	</div><div class="para">
		CloudStack 可​插​拨​的​allocation架​构​允​许​对​选​择​的​存​储​和​主​机​创​建​新​的​allocator类​型​. 参​见​Allocator实​现​指​导​ (<a href="http://docs.cloudstack.org/CloudStack_Documentation/Allocator_Implementation_Guide">http://docs.cloudstack.org/CloudStack_Documentation/Allocator_Implementation_Guide</a>).
	</div><div class="para">
		<span class="bold bold"><strong>高​可​用​性​</strong></span>
	</div><div class="para">
		CloudStack平​台​有​很​多​功​能​来​增​加​系​统​的​可​用​性​. 
管​理​服​务​器​自​身​可​以​在​前​端​负​载​均​衡​的​前​提​下​部​署​在​多​个​节​点​上​. 
MySQL可​以​配​置​使​用​备​份​来​提​供​在​数​据​库​丢​失​情​况​下​的​手​工​故​障​恢​复​. 对​于​主​机​, 
CloudStack平​台​提​供​网​卡​绑​定​及​为​存​储​使​用​单​独​网​络​,这​类​似​于​iSCSI的​多​路​径​.
	</div></div><div xml:lang="zh-CN" class="section" id="deployment-architecture-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">1.3.&nbsp;Deployment Architecture Overview</h2></div></div></div><div class="para">
		A CloudStack installation consists of two parts: the Management Server
 and the cloud infrastructure that it manages. When you set up and 
manage a CloudStack cloud, you provision resources such as hosts, 
storage devices, and IP addresses into the Management Server, and the 
Management Server manages those resources.
	</div><div class="para">
		The minimum production installation consists of one machine running 
the CloudStack Management Server and another machine to act as the cloud
 infrastructure (in this case, a very simple infrastructure consisting 
of one host running hypervisor software). In its smallest deployment, a 
single machine can act as both the Management Server and the hypervisor 
host (using the KVM hypervisor).
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/basic-deployment.png" alt="basic-deployment.png: Basic two-machine deployment"></div><div class="para">
		A more full-featured installation consists of a highly-available 
multi-node Management Server installation and up to tens of thousands of
 hosts using any of several advanced networking setups. For information 
about deployment options, see the "Choosing a Deployment Architecture" 
section of the $PRODUCT; Installation Guide.
	</div><div xml:lang="zh-CN" class="section" id="management-server-overview" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">1.3.1.&nbsp;管​理​服​务​器​概​述​</h3></div></div></div><div class="para">
		管​理​服​务​器​是​CloudStack软​件​用​来​管​理​云​环​境​的​所​有​资​源​. 通​过​UI或​API与​管​理​服​务​器​交​互​, 你​就​可​以​配​置​并​管​理​你​的​云​基​础​架​构​.
	</div><div class="para">
		一​个​管​理​服​务​器​运​行​在​专​属​的​服​务​器​或​虚​机​里​. 它​控​制​虚​拟​机​在​主​机​上​的​分​配​, 
并​且​分​配​存​储​和​IP地​址​到​虚​拟​机​实​例​. 
管​理​服​务​器​运​行​在​一​个​Tomcat容​器​里​并​通​过​MySQL数​据​库​进​行​持​久​化​.
	</div><div class="para">
		机​器​必​须​符​合​系​统​需​求​, 在​系​统​需​求​里​有​相​关​描​述​.
	</div><div class="para">
		管​理​服​务​器​:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				为​管​理​员​提​供​一​个​Web用​户​接​口​并​且​为​最​终​用​户​提​供​一​个​引​用​的​用​户​接​口​.
			</div></li><li class="listitem"><div class="para">
				为​CloudStack提​供​API.
			</div></li><li class="listitem"><div class="para">
				管​理​客​户​虚​拟​机​到​特​定​的​主​机​分​配​.
			</div></li><li class="listitem"><div class="para">
				管​理​公​共​IP及​私​有​IP地​址​到​账​号​的​分​配​.
			</div></li><li class="listitem"><div class="para">
				管​理​客​户​的​存​储​作​为​虚​拟​磁​盘​的​分​配​.
			</div></li><li class="listitem"><div class="para">
				管​理​快​照​, 模​板​, 和​ISO映​像​, 并​且​可​以​在​多​个​数​据​中​心​复​制​.
			</div></li><li class="listitem"><div class="para">
				提​供​整​个​云​环​境​的​集​中​式​配​置​.
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="cloud-infrastructure-overview" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">1.3.2.&nbsp;Cloud Infrastructure Overview</h3></div></div></div><div class="para">
		The Management Server manages one or more zones (typically, 
datacenters) containing host computers where guest virtual machines will
 run. The cloud infrastructure is organized as follows:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Zone: Typically, a zone is equivalent to a single datacenter. A zone consists of one or more pods and secondary storage.
			</div></li><li class="listitem"><div class="para">
				Pod: A pod is usually one rack of hardware that includes a layer-2 switch and one or more clusters.
			</div></li><li class="listitem"><div class="para">
				Cluster: A cluster consists of one or more hosts and primary storage.
			</div></li><li class="listitem"><div class="para">
				Host: A single compute node within a cluster. The hosts are where 
the actual cloud services run in the form of guest virtual machines.
			</div></li><li class="listitem"><div class="para">
				Primary storage is associated with a cluster, and it stores the disk
 volumes for all the VMs running on hosts in that cluster.
			</div></li><li class="listitem"><div class="para">
				Secondary storage is associated with a zone, and it stores templates, ISO images, and disk volume snapshots.
			</div></li></ul></div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/infrastructure-overview.png" alt="infrastructure_overview.png: Nested organization of a zone" width="444"></div><div class="para">
		<span class="bold bold"><strong>More Information</strong></span>
	</div><div class="para">
		For more information, see documentation on cloud infrastructure concepts.
	</div></div><div xml:lang="zh-CN" class="section" id="networking-overview" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">1.3.3.&nbsp;网​络​概​述​</h3></div></div></div><div class="para">
		CloudStack提​供​两​种​类​型​的​网​络​应​用​场​景​:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				基​本​网​络​. 类​似​于​AWS类​型​的​网​络​. 提​供​一​个​单​一​网​络​, 在​这​个​网​络​里​客​户​通​过​提​供​的​三​层​方​式​进​行​隔​离​,比​如​借​安​全​组​方​式​(源​IP地​址​过​滤​).
			</div></li><li class="listitem"><div class="para">
				高​级​网​络​. 为​更​复​杂​的​网​络​拓​扑​设​计​. 网​络​模​型​提​供​了​更​为​灵​活​的​客​户​网​络​定​义​.
			</div></li></ul></div><div class="para">
		更​详​细​的​信​息​, 请​参​数​网​络​设​置​.
	</div></div></div></div><div xml:lang="zh-CN" class="chapter" id="cloud-infrastructure-concepts" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;2&nbsp;章&nbsp;云​基​础​设​施​概​念​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#about-regions">2.1. About Regions</a></span></dt><dt><span class="section"><a href="#about-zones">2.2. 关​于​资​源​域​</a></span></dt><dt><span class="section"><a href="#about-pods">2.3. 关​于​POD</a></span></dt><dt><span class="section"><a href="#about-clusters">2.4. 关​于​集​群​</a></span></dt><dt><span class="section"><a href="#about-hosts">2.5. 关​于​宿​主​机​</a></span></dt><dt><span class="section"><a href="#about-primary-storage">2.6. 关​于​主​存​储​</a></span></dt><dt><span class="section"><a href="#about-secondary-storage">2.7. 关​与​辅​助​存​储​</a></span></dt><dt><span class="section"><a href="#about-physical-networks">2.8. 关​于​物​理​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-network-traffic-types">2.8.1. 基​本​区​域​网​络​流​量​类​型​</a></span></dt><dt><span class="section"><a href="#basic-zone-guest-ip-addresses">2.8.2. 基​本​区​域​宾​客​ IP 地​址​</a></span></dt><dt><span class="section"><a href="#advanced-zone-network-traffic-types">2.8.3. 高​级​区​域​网​络​流​量​类​型​</a></span></dt><dt><span class="section"><a href="#advanced-zone-guest-ip-addresses">2.8.4. 高​级​区​域​宾​客​的​IP地​址​</a></span></dt><dt><span class="section"><a href="#advanced-zone-public-ip-addresses">2.8.5. Advanced Zone Public IP Addresses</a></span></dt><dt><span class="section"><a href="#system-reserved-ip-addresses">2.8.6. System Reserved IP Addresses</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="about-regions" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.1.&nbsp;About Regions</h2></div></div></div><div class="para">
		To increase reliability of the cloud, you can optionally group 
resources into multiple geographic regions. A region is the largest 
available organizational unit within a CloudStack deployment. A region 
is made up of several availability zones, where each zone is roughly 
equivalent to a datacenter. Each region is controlled by its own cluster
 of Management Servers, running in one of the zones. The zones in a 
region are typically located in close geographical proximity. Regions 
are a useful technique for providing fault tolerance and disaster 
recovery.
	</div><div class="para">
		By grouping zones into regions, the cloud can achieve higher 
availability and scalability. User accounts can span regions, so that 
users can deploy VMs in multiple, widely-dispersed regions. Even if one 
of the regions becomes unavailable, the services are still available to 
the end-user through VMs deployed in another region. And by grouping 
communities of zones under their own nearby Management Servers, the 
latency of communications within the cloud is reduced compared to 
managing widely-dispersed zones from a single central Management Server.
	</div><div class="para">
		Usage records can also be consolidated and tracked at the region 
level, creating reports or invoices for each geographic region.
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/region-overview.png" alt="region-overview.png: Nested structure of a region." width="444"></div><div class="para">
		Regions are visible to the end user. When a user starts a guest VM, 
the user must select a region for their guest. Users might also be 
required to copy their private templates to additional regions to enable
 creation of guest VMs using their templates in those regions.
	</div></div><div xml:lang="zh-CN" class="section" id="about-zones" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.2.&nbsp;关​于​资​源​域​</h2></div></div></div><div class="para">
		A zone is the second largest organizational unit within a CloudStack 
deployment. A zone typically corresponds to a single datacenter, 
although it is permissible to have multiple zones in a datacenter. The 
benefit of organizing infrastructure into zones is to provide physical 
isolation and redundancy. For example, each zone can have its own power 
supply and network uplink, and the zones can be widely separated 
geographically (though this is not required).
	</div><div class="para">
		一​个​资​源​域​包​括​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				一​个​或​多​个​提​供​点​。​每​个​提​供​点​包​含​一​个​或​多​个​宿​主​机​集​群​和​iygehuoduoge主​存​储​服​务​器​。​
			</div></li><li class="listitem"><div class="para">
				二​级​存​储​是​在​资​源​域​下​的​所​有​提​供​点​共​享​的​。​
			</div></li></ul></div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/zone-overview.png" alt="zone-overview.png: Nested structure of a simple zone." width="444"></div><div class="para">
		
资​源​与​对​用​户​使​可​见​的​。​当​用​户​运​行​一​个​来​宾​虚​拟​机​，他​必​须​选​择​该​虚​拟​机​运​行​在​哪
​个​资​源​域​上​。​当​来​宾​虚​拟​机​需​要​运​行​在​额​外​的​资​源​域​时​，用​户​可​能​需​要​拷​贝​私​有​模​
板​向​这​些​资​源​域​拷​贝​私​有​模​板​。​
	</div><div class="para">
		
资​源​域​可​以​是​公​有​也​可​以​是​私​有​的​。​公​共​资​源​与​对​所​有​用​户​可​见​。​这​意​味​着​所​用​用​
户​都​可​以​在​上​面​创​建​来​宾​虚​拟​机​。​私​有​资​源​域​只​对​特​定​的​鱼​保​留​。​只​有​在​这​个​域​或​
其​子​域​的​用​户​才​能​创​建​来​宾​虚​拟​机​。​
	</div><div class="para">
		同​一​个​资​源​域​下​的​宿​主​机​是​不​需​要​穿​过​防​火​墙​的​互​连​的​机​器​。​不​同​资​源​域​的​宿​主​机​可​以​通​过​静​态​配​置​的​vpn通​道​互​相​访​问​。​
	</div><div class="para">
		管​理​员​必​须​决​定​每​个​资​源​域​以​下​内​容​。​
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				资​源​与​中​有​多​少​提​供​点​。​
			</div></li><li class="listitem"><div class="para">
				每​个​提​供​点​中​有​多​少​集​群​。​
			</div></li><li class="listitem"><div class="para">
				每​个​集​群​中​有​几​台​宿​主​机​。​
			</div></li><li class="listitem"><div class="para">
				每​个​集​群​中​有​几​个​主​存​储​，且​总​的​存​储​量​要​多​大​。​
			</div></li><li class="listitem"><div class="para">
				每​个​资​源​域​下​要​有​多​少​二​级​存​储​。​
			</div></li></ul></div><div class="para">
		当​您​添​加​一​个​新​的​区​域​时​，系​统​会​提​示​您​配​置​区​域​的​物​理​网​络​，并​添​加​提​供​点​，集​群​，主​机​，主​存​储​和​二​级​存​储​。​
	</div></div><div xml:lang="zh-CN" class="section" id="about-pods" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.3.&nbsp;关​于​POD</h2></div></div></div><div class="para">
		A pod often represents a single rack. Hosts in the same pod are in the
 same subnet. A pod is the second-largest organizational unit within a 
CloudStack deployment. Pods are contained within zones. Each zone can 
contain one or more pods. A pod consists of one or more clusters of 
hosts and one or more primary storage servers. Pods are not visible to 
the end user.
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/pod-overview.png" alt="pod-overview.png: Nested structure of a simple pod"></div></div><div xml:lang="zh-CN" class="section" id="about-clusters" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.4.&nbsp;关​于​集​群​</h2></div></div></div><div class="para">
		A cluster provides a way to group hosts. To be precise, a cluster is a
 XenServer server pool, a set of KVM servers, , or a VMware cluster 
preconfigured in vCenter. The hosts in a cluster all have identical 
hardware, run the same hypervisor, are on the same subnet, and access 
the same shared primary storage. Virtual machine instances (VMs) can be 
live-migrated from one host to another within the same cluster, without 
interrupting service to the user.
	</div><div class="para">
		
集​群​在​本​产​品​中​是​第​三​大​组​织​单​位​；\n部​署​\n集​群​隶​属​于​pod之​下​，而​pod隶​属​于​zone
之​下​。​集​群​的​大​小​取​决​于​下​层​虚​拟​机​软​件​。​大​多​数​情​况​下​基​本​无​建​议​；详​见​最​佳​实​践
​
	</div><div class="para">
		集​群​由​一​个​或​多​个​宿​主​机​和​一​个​或​多​个​主​要​存​储​服​务​器​构​成​。​
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/cluster-overview.png" alt="cluster-overview.png: Structure of a simple cluster"></div><div class="para">
		本​产​品​允​许​在​云​部​署​中​有​多​个​集​群​
	</div><div class="para">
		Even when local storage is used exclusively, clusters are still 
required organizationally, even if there is just one host per cluster.
	</div><div class="para">
		当​使​用​VMware时​，每​个​VMware集​群​都​被​vCenter 
服​务​器​管​理​。​管​理​员​必​须​在​本​产​品​中​登​记​vCenter。​每​个​zone下​可​以​有​多​个​vCenter
服​务​器​。​每​个​vCenter服​务​器​可​能​管​理​多​个​VMware集​群​。​
	</div></div><div xml:lang="zh-CN" class="section" id="about-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.5.&nbsp;关​于​宿​主​机​</h2></div></div></div><div class="para">
		
宿​主​机​就​是​个​独​立​的​计​算​机​。​宿​主​机​运​行​来​宾​虚​拟​机​并​提​供​其​相​应​的​计​算​资​源​。​每​
个​宿​主​机​都​装​有​虚​拟​机​软​件​来​运​行​来​宾​虚​拟​机​。​比​如​一​个​开​启​了​kvm支​持​的​服​务​器​，
一​个​思​杰​XenServer服​务​器​，或​者​一​个​ESXi服​务​器​都​可​以​作​为​宿​主​机​。​
	</div><div class="para">
		
宿​主​机​在​CloudStack部​署​中​属​于​最​小​的​组​织​单​元​。​宿​主​机​包​含​于​集​群​中​，集​群​有​属​于
​提​供​点​，而​区​域​中​包​含​提​供​点​（就​是​在​逻​辑​概​念​上​
zone&gt;pod&gt;cluster&gt;host）。​
	</div><div class="para">
		CloudStack部​署​中​的​宿​主​机​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Provide the CPU, memory, storage, and networking resources needed to host the virtual machines
			</div></li><li class="listitem"><div class="para">
				通​过​高​带​宽​TCP/IP网​络​并​连​接​到​因​特​网​
			</div></li><li class="listitem"><div class="para">
				可​能​在​不​同​地​理​位​置​有​多​个​数​据​中​中​心​。​
			</div></li><li class="listitem"><div class="para">
				虽​说​包​含​在​集​群​中​的​宿​主​机​必​须​是​同​质​的​（使​用​相​同​的​虚​拟​机​软​件​）但​是​他​们​可​以​具​有​不​同​的​计​算​能​力​（不​同​的​CPU速​度​，不​同​的​内​存​数​量​等​等​）
			</div></li></ul></div><div class="para">
		新​增​的​宿​主​机​可​以​随​时​添​加​以​提​供​更​多​资​源​给​来​宾​虚​拟​机​
	</div><div class="para">
		CloudStack自​动​探​测​宿​主​机​的​cpu数​量​和​内​存​资​源​。​
	</div><div class="para">
		宿​主​机​对​终​端​用​户​不​可​见​。​终​端​用​户​不​能​决​定​他​们​的​虚​拟​机​被​分​配​到​哪​台​宿​主​机​。​
	</div><div class="para">
		如​果​您​想​让​宿​主​机​在​CloudStack上​正​常​运​行​，你​必​须​作​如​下​步​骤​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				在​宿​主​机​上​安​装​虚​拟​机​软​件​
			</div></li><li class="listitem"><div class="para">
				为​宿​主​机​分​配​IP（固​定​IP）
			</div></li><li class="listitem"><div class="para">
				确​定​宿​主​机​已​经​连​接​到​CloudStack的​管​理​服​务​器​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="about-primary-storage" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.6.&nbsp;关​于​主​存​储​</h2></div></div></div><div class="para">
		
主​存​储​是​和​群​集​有​关​联​的​，它​为​所​有​在​那​个​群​集​里​运​行​在​主​机​上​的​虚​拟​机​储​存​磁​盘​卷
​。​你​能​添​加​多​个​主​存​储​服​务​器​给​群​集​。​至​少​一​个​是​必​须​的​。​为​了​提​高​性​能​它​的​位​置
​最​好​是​接​近​主​机​放​置​。​
	</div><div class="para">
		CloudStack被​设​计​和​标​准​iSCSI或​者​NFS 服​务​器​一​起​工​作​，这​些​被​底​层​的​虚​拟​机​平​台​支​持​，包​括​，例​如​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Dell EqualLogic™​ for iSCSI
			</div></li><li class="listitem"><div class="para">
				Network Appliances filers for NFS and iSCSI
			</div></li><li class="listitem"><div class="para">
				Scale Computing for NFS
			</div></li></ul></div><div class="para">
		如​果​你​打​算​使​用​本​地​磁​盘​当​你​安​装​的​时​候​，你​可​以​跳​过​去​安​装​辅​助​存​储​。​
	</div></div><div xml:lang="zh-CN" class="section" id="about-secondary-storage" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.7.&nbsp;关​与​辅​助​存​储​</h2></div></div></div><div class="para">
		辅​助​存​储​是​和​区​域​关​联​，它​存​储​如​下​事​物​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				模​板​— 操​作​系​统​镜​像​能​够​用​来​启​动​虚​拟​机​并​且​可​一​包​含​额​外​配​置​信​息​，例​如​被​按​装​的​应​用​程​序​。​
			</div></li><li class="listitem"><div class="para">
				ISO 镜​像​—磁​盘​镜​像​包​含​数​据​或​者​操​作​系​统​引​导​媒​体​。​
			</div></li><li class="listitem"><div class="para">
				磁​盘​卷​快​照​—被​保​存​的​虚​拟​机​数​据​复​制​品​能​够​被​用​来​做​数​据​恢​复​或​者​建​立​新​的​模​板​。​
			</div></li></ul></div><div class="para">
		这​些​在​基​于​区​域​的​NFS辅​助​存​储​中​的​数​据​是​对​所​有​在​这​个​区​域​内​的​主​机​有​效​的​。​
	</div><div class="para">
		为​了​让​这​些​在​辅​助​存​储​中​的​数​据​对​所​有​在​云​中​的​主​机​有​效​，你​可​以​另​外​添​加​OpenStack对​象​存​储​(Swift,<a href="http://swift.openstack.org/">swift.openstack.org</a>)
 
给​基​于​区​域​的​NFS辅​助​存​储​。​当​使​用​Swift时​，你​配​置​Swift存​储​给​整​个​CloudStack，然
​后​照​常​设​置​NFS 
辅​助​存​储​给​每​个​区​域​。​在​每​个​区​域​的​NFS存​储​扮​演​了​一​个​代​转​区​，所​有​的​模​板​和​其​他​
辅​助​存​储​的​数​据​在​转​向​Swift前​将​通​过​它​。​Swift 
存​储​扮​演​了​一​个​广​泛​云​的​资​源​,使​得​模​板​和​其​它​数​据​是​有​效​的​对​任​何​在​云​中​的​区​域​。
​Swift 
存​储​中​没​有​分​级​，每​个​存​储​对​象​只​有​一​个​Swift容​器​。​任​何​在​整​个​云​中​的​辅​助​存​储​能​
够​拖​一​个​容​器​从​Swift中​在​需​要​的​时​候​。​这​样​就​不​用​拷​贝​模​板​和​快​照​从​一​个​区​域​到​另
​外​一​个​区​域​了​，如​果​单​独​使​用​区​域​NFS的​话​，还​是​需​要​的​。​任​何​事​情​都​是​有​效​的​在​任​
何​地​方​。​
	</div></div><div xml:lang="zh-CN" class="section" id="about-physical-networks" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">2.8.&nbsp;关​于​物​理​网​络​</h2></div></div></div><div class="para">
		
设​置​物​理​网​络​是​添​加​区​域​步​骤​中​的​一​个​部​分​。​每​个​区​域​可​以​分​配​一​个​（极​限​与​高​级​资
​源​域​）或​者​多​个​物​理​网​络​。​这​个​网​络​对​应​宿​主​机​的​一​个​网​卡​。​每​个​物​理​网​络​可​以​承​
载​一​种​或​多​种​网​络​流​量​。​每​个​网​络​流​量​的​类​型​的​选​项​由​你​选​择​的​是​基​本​网​络​与​还​是​
高​级​网​络​与​而​不​同​。​
	</div><div class="para">
		物​理​网​络​是​连​接​到​资​源​与​的​真​实​网​络​硬​件​。​一​个​资​源​与​能​有​多​个​物​理​网​络​。​管​理​员​能​做​一​下​操​作​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				添​加​/删​除​/更​新​ 域​中​的​物​理​网​络​
			</div></li><li class="listitem"><div class="para">
				在​物​理​网​络​上​设​置​VLAN
			</div></li><li class="listitem"><div class="para">
				通​过​设​置​名​字​使​网​络​能​被​虚​拟​机​软​件​识​别​
			</div></li><li class="listitem"><div class="para">
				设​置​在​物​理​网​络​上​能​够​提​供​的​服​务​（防​火​墙​，负​载​均​衡​器​，等​等​）
			</div></li><li class="listitem"><div class="para">
				设​置​能​直​连​到​物​理​网​络​的​IP地​址​
			</div></li><li class="listitem"><div class="para">
				指​定​物​理​网​络​承​载​的​流​量​类​型​还​有​其​他​类​似​网​络​速​度​之​类​的​属​性​
			</div></li></ul></div><div xml:lang="zh-CN" class="section" id="basic-zone-network-traffic-types" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.1.&nbsp;基​本​区​域​网​络​流​量​类​型​</h3></div></div></div><div class="para">
		当​使​用​基​本​网​络​是​，这​里​只​有​一​个​物​理​网​卡​在​区​域​中​。​这​个​物​理​网​卡​承​载​以​下​类​型​流​量​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				
来​宾​。​当​终​端​用​户​运​行​虚​拟​，他​们​产​生​来​宾​流​量​。​来​宾​虚​拟​机​和​其​他​虚​拟​机​通​信​在​网
​络​上​的​流​量​，归​功​来​宾​网​络​。​每​一​个​pod中​的​基​本​区​域​就​是​一​个​广​播​域​，因​此​每​个​一​
个​pod中​的​来​宾​网​络​拥​有​不​同​的​ip范​围​。​管​理​员​必​须​为​每​一​个​pod配​置​ip范​围​。​
			</div></li><li class="listitem"><div class="para">
				Management. When CloudStack's internal resources communicate with 
each other, they generate management traffic. This includes 
communication between hosts, system VMs (VMs used by CloudStack to 
perform various tasks in the cloud), and any other component that 
communicates directly with the CloudStack Management Server. You must 
configure the IP range for the system VMs to use.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					我​们​强​烈​要​求​管​理​和​来​宾​流​量​使​用​独​立​的​网​卡​
				</div></div></div></li><li class="listitem"><div class="para">
				
公​共​。​云​中​的​虚​拟​机​访​问​internet时​产​生​公​共​流​量​，基​于​这​个​原​因​必​须​分​配​可​供​访​问
​的​ip地​址​。​终​端​用​户​可​以​使​用​CloudStack 
UI获​得​一​个​ip，用​来​构​建​来​宾​网​络​和​公​共​网​络​的​nat。​定​义​为​：获​取​新​的​ip地​址​。​
			</div></li><li class="listitem"><div class="para">
				Storage. While labeled "storage" this is specifically about 
secondary storage, and doesn't affect traffic for primary storage. This 
includes traffic such as VM templates and snapshots, which is sent 
between the secondary storage VM and secondary storage servers. 
CloudStack uses a separate Network Interface Controller (NIC) named 
storage NIC for storage network traffic. Use of a storage NIC that 
always operates on a high bandwidth network allows fast template and 
snapshot copying. You must configure the IP range to use for the storage
 network.
			</div></li></ul></div><div class="para">
		
在​基​本​区​域​中​，配​置​物​理​网​络​是​相​当​简​单​的​。​在​大​多​数​情​况​下​，你​只​需​要​配​置​一​个​来​
宾​网​络​承​载​所​有​来​宾​虚​拟​机​流​量​。​如​果​你​使​用​NetScaler负​载​平​衡​器​，开​启​弹​性​的​IP
和​弹​性​负​载​平​衡​(EIP和​ELB)的​功​能​，你​还​必​须​配​置​一​个​网​络​承​载​公​共​流​量​。​ 
当​你​通​过​UI添​加​一​个​新​的​区​域​， CloudStack负​责​提​出​必​要​的​网​络​配​置​的​步​骤​。​
	</div></div><div xml:lang="zh-CN" class="section" id="basic-zone-guest-ip-addresses" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.2.&nbsp;基​本​区​域​宾​客​ IP 地​址​</h3></div></div></div><div class="para">
		当​基​本​联​网​方​式​被​使​用​， CloudStack 将​在​POD CIDR的​IP 
地​址​分​配​给​该​POD中​的​宾​客​。​ 管​理​员​必​须​在​此​POD增​加​一​个​直​接​IP 
范​围​用​于​此​目​的​。​ 这​些​IP 和​主​机​位​于​同​样​的​VLAN。​
	</div></div><div xml:lang="zh-CN" class="section" id="advanced-zone-network-traffic-types" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.3.&nbsp;高​级​区​域​网​络​流​量​类​型​</h3></div></div></div><div class="para">
		
当​使​用​高​级​网​路​时​，在​区​域​包​含​多​种​物​理​网​络​。​每​一​个​物​理​网​络​能​够​承​载​一​种​或​者​多
​种​类​型​的​流​量​。​要​让​ CloudStack 
知​道​每​种​网​络​承​载​那​种​类​型​的​流​量​。​高​级​区​域​包​含​的​流​量​类​型​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				
来​宾​。​当​用​户​允​许​VM时​，他​们​产​生​来​宾​流​量​。​来​宾​VM通​过​来​宾​网​络​进​相​关​通​讯​。​这​个
​网​络​可​以​是​隔​离​或​者​共​享​的​；在​隔​离​的​来​宾​网​络​中​，管​理​员​需​要​为​每​一​个​ 
CloudStack 中​隔​离​网​络​分​配​ VLAN 
范​围​；帐​户​的​网​络​(潜​在​的​大​量​的​VLAN)。​在​一​个​共​享​来​宾​网​络​中​，所​有​来​宾​VM共​享​一​
个​网​络​。​
			</div></li><li class="listitem"><div class="para">
				管​理​。​当​ 
CloudStack最​为​内​部​资​源​和​其​他​通​信​时​，他​们​产​生​管​理​流​量​。​包​括​主​机​，系​统​vm(在​云
​中​，被​用​于​CloudStack 执​行​大​量​任​务​的​虚​拟​机​)之​间​的​通​信​， 
其​他​组​件​和​CloudStack 
管​理​服​务​器​的​直​接​通​信​。​你​必​须​为​系​统​vm配​置​一​个​ip范​围​。​
			</div></li><li class="listitem"><div class="para">
				Public. Public traffic is generated when VMs in the cloud access the
 Internet. Publicly accessible IPs must be allocated for this purpose. 
End users can use the CloudStack UI to acquire these IPs to implement 
NAT between their guest network and the public network, as described in 
“​Acquiring a New IP Address”​ in the Administration Guide.
			</div></li><li class="listitem"><div class="para">
				Storage. While labeled "storage" this is specifically about 
secondary storage, and doesn't affect traffic for primary storage. This 
includes traffic such as VM templates and snapshots, which is sent 
between the secondary storage VM and secondary storage servers. 
CloudStack uses a separate Network Interface Controller (NIC) named 
storage NIC for storage network traffic. Use of a storage NIC that 
always operates on a high bandwidth network allows fast template and 
snapshot copying. You must configure the IP range to use for the storage
 network.
			</div></li></ul></div><div class="para">
		These traffic types can each be on a separate physical network, or 
they can be combined with certain restrictions. When you use the Add 
Zone wizard in the UI to create a new zone, you are guided into making 
only valid choices.
	</div></div><div xml:lang="zh-CN" class="section" id="advanced-zone-guest-ip-addresses" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.4.&nbsp;高​级​区​域​宾​客​的​IP地​址​</h3></div></div></div><div class="para">
		
使​用​高​级​的​网​络​时​，管​理​员​可​以​创​建​额​外​的​网​络​供​客​人​使​用​。​这​些​网​络​可​以​跨​越​区​域
​，并​提​供​给​所​有​帐​户​，或​者​他​们​可​以​到​一​个​单​一​的​帐​户​范​围​内​，在​这​种​情​况​下​，只​有​指
​定​的​帐​户​可​以​创​建​连​接​到​这​些​网​络​的​宾​客​。​网​络​被​定​义​为​一​个​VLAN 
ID，IP范​围​和​网​关​。​如​果​需​要​的​话​，系​统​管​理​员​可​能​会​提​供​成​千​上​万​的​网​络​。​
	</div></div><div xml:lang="zh-CN" class="section" id="advanced-zone-public-ip-addresses" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.5.&nbsp;Advanced Zone Public IP Addresses</h3></div></div></div><div class="para">
		
使​用​高​级​的​网​络​时​，管​理​员​可​以​创​建​额​外​的​网​络​供​客​人​使​用​。​这​些​网​络​可​以​跨​越​区​域
​，并​提​供​给​所​有​帐​户​，或​者​他​们​可​以​到​一​个​单​一​的​帐​户​范​围​内​，在​这​种​情​况​下​，只​有​指
​定​的​帐​户​可​以​创​建​连​接​到​这​些​网​络​的​宾​客​。​网​络​被​定​义​为​一​个​VLAN 
ID，IP范​围​和​网​关​。​如​果​需​要​的​话​，系​统​管​理​员​可​能​会​提​供​成​千​上​万​的​网​络​。​
	</div></div><div xml:lang="zh-CN" class="section" id="system-reserved-ip-addresses" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">2.8.6.&nbsp;System Reserved IP Addresses</h3></div></div></div><div class="para">
		In each zone, you need to configure a range of reserved IP addresses 
for the management network. This network carries communication between 
the CloudStack Management Server and various system VMs, such as 
Secondary Storage VMs, Console Proxy VMs, and DHCP.
	</div><div class="para">
		The reserved IP addresses must be unique across the cloud. You cannot,
 for example, have a host in one zone which has the same private IP 
address as a host in another zone.
	</div><div class="para">
		The hosts in a pod are assigned private IP addresses. These are 
typically RFC1918 addresses. The Console Proxy and Secondary Storage 
system VMs are also allocated private IP addresses in the CIDR of the 
pod that they are created in.
	</div><div class="para">
		Make sure computing servers and Management Servers use IP addresses 
outside of the System Reserved IP range. For example, suppose the System
 Reserved IP range starts at 192.168.154.2 and ends at 192.168.154.7. 
CloudStack can use .2 to .7 for System VMs. This leaves the rest of the 
pod CIDR, from .8 to .254, for the Management Server and hypervisor 
hosts.
	</div><div class="para">
		<span class="bold bold"><strong>In all zones:</strong></span>
	</div><div class="para">
		Provide private IPs for the system in each pod and provision them in CloudStack.
	</div><div class="para">
		For KVM and XenServer, the recommended number of private IPs per pod 
is one per host. If you expect a pod to grow, add enough private IPs now
 to accommodate the growth.
	</div><div class="para">
		<span class="bold bold"><strong>In a zone that uses advanced networking:</strong></span>
	</div><div class="para">
		For zones with advanced networking, we recommend provisioning enough 
private IPs for your total number of customers, plus enough for the 
required CloudStack System VMs. Typically, about 10 additional IPs are 
required for the System VMs. For more information about System VMs, see 
Working with System Virtual Machines in the Administrator's Guide.
	</div><div class="para">
		When advanced networking is being used, the number of private IP 
addresses available in each pod varies depending on which hypervisor is 
running on the nodes in that pod. Citrix XenServer and KVM use 
link-local addresses, which in theory provide more than 65,000 private 
IP addresses within the address block. As the pod grows over time, this 
should be more than enough for any reasonable number of hosts as well as
 IP addresses for guest virtual routers. VMWare ESXi, by contrast uses 
any administrator-specified subnetting scheme, and the typical 
administrator provides only 255 IPs per pod. Since these are shared by 
physical machines, the guest virtual router, and other entities, it is 
possible to run out of private IPs when scaling up a pod whose nodes are
 running ESXi.
	</div><div class="para">
		To ensure adequate headroom to scale private IP space in an ESXi pod 
that uses advanced networking, use one or both of the following 
techniques:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Specify a larger CIDR block for the subnet. A subnet mask with a /20 suffix will provide more than 4,000 IP addresses.
			</div></li><li class="listitem"><div class="para">
				Create multiple pods, each with its own subnet. For example, if you 
create 10 pods and each pod has 255 IPs, this will provide 2,550 IP 
addresses.
			</div></li></ul></div></div></div></div><div xml:lang="zh-CN" class="chapter" id="accounts" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;3&nbsp;章&nbsp;帐​号​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#accounts-users-domains">3.1. 账​户​，用​户​，域​</a></span></dt><dt><span class="section"><a href="#LDAPserver-for-user-authentication">3.2. Using an LDAP Server for User Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#example-LDAP-configuration-commands">3.2.1. LDAP配​置​命​令​样​例​</a></span></dt><dt><span class="section"><a href="#search-base">3.2.2. Search Base</a></span></dt><dt><span class="section"><a href="#query-filter">3.2.3. 查​询​过​滤​器​</a></span></dt><dt><span class="section"><a href="#search-user-bind-dn">3.2.4. Search User Bind DN</a></span></dt><dt><span class="section"><a href="#SSL-keystore-path-and-password">3.2.5. SSL Keystore路​径​和​密​码​</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="accounts-users-domains" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">3.1.&nbsp;账​户​，用​户​，域​</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm17717760">å¸æ·</h5>
			一​个​账​号​通​常​代​表​一​个​客​户​的​服​务​提​供​者​或​一​个​大​组​织​中​的​一​个​部​门​。​一​个​账​户​下​可​有​多​个​用​户​。​
		</div><div class="formalpara"><h5 class="formalpara" id="idm917728">å</h5>
			
域​通​常​包​含​多​个​账​户​。​域​中​经​常​包​含​多​个​账​户​，这​些​账​户​间​存​在​一​些​逻​辑​上​关​系​和​一
​系​列​该​域​和​其​子​域​下​的​委​派​的​管​理​员​（这​段​的​意​思​就​是​说​在​逻​辑​上​域​下​可​以​有​管​理​
员​，子​域​下​也​可​以​有​管​理​员​）。​比​如​，一​个​服​务​提​供​商​可​有​多​个​分​销​商​这​样​的​服​务​提​供
​商​就​能​为​每​一​个​分​销​商​创​建​一​个​域​
		</div><div class="para">
		对​于​每​个​账​户​的​创​建​，CloudStack 创​建​了​三​种​不​同​类​型​的​用​户​账​户​：根​管​理​员​，域​管​理​员​，普​通​用​户​。​
	</div><div class="formalpara"><h5 class="formalpara" id="idm1339104">普​通​用​户​</h5>
			
用​户​就​像​是​账​户​的​别​名​。​在​同​一​账​户​下​的​用​户​彼​此​之​间​并​非​隔​离​的​。​但​是​他​们​与​不​
同​账​户​下​的​用​户​是​相​互​隔​离​的​。​大​多​数​安​装​不​需​要​表​面​的​用​户​的​概​念​；他​们​只​是​每​一
​个​帐​户​的​用​户​。​相​同​的​用​户​不​能​属​于​多​个​帐​户​。​
		</div><div class="para">
		
多​个​账​户​中​的​用​户​名​在​域​中​应​该​是​唯​一​的​。​相​同​的​用​户​名​能​在​其​他​的​域​中​存​在​，包​括
​子​域​。​域​名​只​有​在​全​路​径​名​唯​一​的​时​候​才​能​重​复​。​比​如​，你​能​创​建​一​个​root/d1，也​
可​以​创​建​root/foo/d1和​root/sales/d1。​
	</div><div class="para">
		管​理​员​在​系​统​中​是​拥​有​特​权​的​账​户​。​可​能​有​多​个​管​理​员​在​系​统​中​，管​理​员​能​创​建​删​除​其​他​管​理​员​，并​且​修​改​系​统​中​任​意​用​户​的​密​码​。​
	</div><div class="formalpara"><h5 class="formalpara" id="idm1823088">域​管​理​员​</h5>
			域​管​理​员​能​在​它​所​属​域​中​执​行​和​管​理​员​相​同​的​操​作​。​域​管​理​员​在​物​理​服​务​器​或​其​他​域​中​不​可​见​。​
		</div><div class="formalpara"><h5 class="formalpara" id="idm7104624">根​管​理​员​</h5>
			根​管​理​员​拥​有​系​统​完​全​访​问​权​限​，包​括​管​理​模​板​，服​务​方​案​，客​户​服​务​管​理​员​和​域​。​
		</div><div class="para">
		
资​源​属​于​帐​户​而​不​是​个​人​用​户​。​例​如​,帐​单​、​资​源​限​制​,等​等​都​是​由​该​帐​户​维​护​,而​不
​是​用​户​维​护​。​一​个​用​户​可​以​操​作​任​何​资​源​帐​户​提​供​了​用​户​权​限​的​操​作​。​特​权​由​角​色
​决​定​。​
	</div></div><div xml:lang="zh-CN" class="section" id="LDAPserver-for-user-authentication" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">3.2.&nbsp;Using an LDAP Server for User Authentication</h2></div></div></div><div class="para">
		You can use an external LDAP server such as Microsoft Active Directory
 or ApacheDS to authenticate CloudStack end-users. Just map CloudStack 
accounts to the corresponding LDAP accounts using a query filter. The 
query filter is written using the query syntax of the particular LDAP 
server, and can include special wildcard characters provided by 
CloudStack for matching common values such as the user’​s email address 
and name. CloudStack will search the external LDAP directory tree 
starting at a specified base directory and return the distinguished name
 (DN) and password of the matching user. This information along with the
 given password is used to authenticate the user..
	</div><div class="para">
		To set up LDAP authentication in CloudStack, call the CloudStack API command ldapConfig and provide the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Hostname or IP address and listening port of the LDAP server
			</div></li><li class="listitem"><div class="para">
				Base directory and query filter
			</div></li><li class="listitem"><div class="para">
				Search user DN credentials, which give CloudStack permission to search on the LDAP server
			</div></li><li class="listitem"><div class="para">
				SSL keystore and password, if SSL is used
			</div></li></ul></div><div xml:lang="zh-CN" class="section" id="example-LDAP-configuration-commands" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">3.2.1.&nbsp;LDAP配​置​命​令​样​例​</h3></div></div></div><div class="para">
		为​了​明​白​本​章​节​的​样​例​, 你​需​要​知​道​调​用​CloudStack API的​基​本​概​念​, 这​在​开​发​者​文​档​中​有​讲​解​.
	</div><div class="para">
		以​下​展​示​了​通​过​ApacheDS LDAP服​务​器​调​用​ ldapConfig命​令​的​样​例​
	</div><pre class="programlisting">http://127.0.0.1:8080/client/api?command=ldapConfig&amp;hostname=127.0.0.1&amp;searchbase=ou%3Dtesting%2Co%3Dproject&amp;queryfilter=%28%26%28uid%3D%25u%29%29&amp;binddn=cn%3DJohn+Singh%2Cou%3Dtesting%2Co%project&amp;bindpass=secret&amp;port=10389&amp;ssl=true&amp;truststore=C%3A%2Fcompany%2Finfo%2Ftrusted.ks&amp;truststorepass=secret&amp;response=json&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash</pre><div class="para">
		命​令​调​用​的​URL必​须​进​行​编​码​. 这​里​是​一​个​例​子​没​有​进​行​URL编​码​:
	</div><pre class="programlisting">http://127.0.0.1:8080/client/api?command=ldapConfig
&amp;hostname=127.0.0.1
&amp;searchbase=ou=testing,o=project
&amp;queryfilter=(&amp;(%uid=%u))
&amp;binddn=cn=John+Singh,ou=testing,o=project
&amp;bindpass=secret
&amp;port=10389
&amp;ssl=true
&amp;truststore=C:/company/info/trusted.ks
&amp;truststorepass=secret
&amp;response=json
&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash
</pre><div class="para">
		以​下​展​示​了​与​活​动​目​录​类​似​的​命​令​. 这​里​, 搜​索​是​基​于​一​个​公​司​的​测​试​组​, 用​户​是​基​于​邮​件​地​址​进​行​匹​配​查​找​.
	</div><pre class="programlisting">http://10.147.29.101:8080/client/api?command=ldapConfig&amp;hostname=10.147.28.250&amp;searchbase=OU%3Dtesting%2CDC%3Dcompany&amp;queryfilter=%28%26%28mail%3D%25e%29%29 &amp;binddn=CN%3DAdministrator%2COU%3Dtesting%2CDC%3Dcompany&amp;bindpass=1111_aaaa&amp;port=389&amp;response=json&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash</pre><div class="para">
		接​下​来​的​几​个​章​节​解​释​了​你​需​要​知​道​的​通​过​ldapConfig参​数​进​行​过​滤​的​一​些​概​念​.
	</div></div><div xml:lang="zh-CN" class="section" id="search-base" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">3.2.2.&nbsp;Search Base</h3></div></div></div><div class="para">
		An LDAP query is relative to a given node of the LDAP directory tree, 
called the search base. The search base is the distinguished name (DN) 
of a level of the directory tree below which all users can be found. The
 users can be in the immediate base directory or in some subdirectory. 
The search base may be equivalent to the organization, group, or domain 
name. The syntax for writing a DN varies depending on which LDAP server 
you are using. A full discussion of distinguished names is outside the 
scope of our documentation. The following table shows some examples of 
search bases to find users in the testing department..
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							LDAP Server
						</div>
					</th><th class="" align="left">
						<div class="para">
							Example Search Base DN
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							ApacheDS
						</div>
					</td><td class="" align="left">
						<div class="para">
							ou=testing,o=project
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Active Directory
						</div>
					</td><td class="" align="left">
						<div class="para">
							OU=testing, DC=company
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="section" id="query-filter" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">3.2.3.&nbsp;查​询​过​滤​器​</h3></div></div></div><div class="para">
		The query filter is used to find a mapped user in the external LDAP 
server. The query filter should uniquely map the CloudStack user to LDAP
 user for a meaningful authentication. For more information about query 
filter syntax, consult the documentation for your LDAP server.
	</div><div class="para">
		The CloudStack query filter wildcards are:
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							查​询​过​滤​器​通​配​符​
						</div>
					</th><th class="" align="left">
						<div class="para">
							è¯´æ
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							%u
						</div>
					</td><td class="" align="left">
						<div class="para">
							用​户​名​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							%e
						</div>
					</td><td class="" align="left">
						<div class="para">
							邮​件​地​址​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							%n
						</div>
					</td><td class="" align="left">
						<div class="para">
							姓​名​
						</div>
					</td></tr></tbody></table></div><div class="para">
		下​面​的​例​子​假​定​你​使​用​活​动​目​录​, 并​从​活​动​目​录​的​概​要​里​获​得​用​户​属​性​.
	</div><div class="para">
		If the CloudStack user name is the same as the LDAP user ID:
	</div><pre class="programlisting">(uid=%u)</pre><div class="para">
		If the CloudStack user name is the LDAP display name:
	</div><pre class="programlisting">(displayName=%u)</pre><div class="para">
		利​用​邮​件​地​址​来​查​找​一​个​用​户​:
	</div><pre class="programlisting">(mail=%e)</pre></div><div xml:lang="zh-CN" class="section" id="search-user-bind-dn" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">3.2.4.&nbsp;Search User Bind DN</h3></div></div></div><div class="para">
		The bind DN is the user on the external LDAP server permitted to 
search the LDAP directory within the defined search base. When the DN is
 returned, the DN and passed password are used to authenticate the 
CloudStack user with an LDAP bind. A full discussion of bind DNs is 
outside the scope of our documentation. The following table shows some 
examples of bind DNs.
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							LDAP Server
						</div>
					</th><th class="" align="left">
						<div class="para">
							Example Bind DN
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							ApacheDS
						</div>
					</td><td class="" align="left">
						<div class="para">
							cn=Administrator,dc=testing,ou=project,ou=org
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Active Directory
						</div>
					</td><td class="" align="left">
						<div class="para">
							CN=Administrator, OU=testing, DC=company, DC=com
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="section" id="SSL-keystore-path-and-password" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">3.2.5.&nbsp;SSL Keystore路​径​和​密​码​</h3></div></div></div><div class="para">
		如​果​LDAP 服​务​器​要​求​SSL， 你​需​要​在​ldapConfig命​令​中​通​过​设​置​参​数​ssl, 
truststore和​truststorepass使​其​生​效​。​在​使​SSL 对​ldapConfig 
生​效​之​前​，你​需​要​得​到​LDAP服​务​器​在​使​用​的​证​书​并​把​它​加​到​被​信​任​的​键​存​储​中​。​你​将
​需​要​知​道​到​键​存​储​和​密​码​的​路​径​。​
	</div></div></div></div><div xml:lang="zh-CN" class="chapter" id="user-services-overview" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;4&nbsp;章&nbsp;User Services Overview</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#offerings-and-templates">4.1. Service Offerings, Disk Offerings, Network Offerings, and Templates</a></span></dt></dl></div><div class="para">
		In addition to the physical and logical infrastructure of your cloud, 
and the CloudStack software and servers, you also need a layer of user 
services so that people can actually make use of the cloud. This means 
not just a user UI, but a set of options and resources that users can 
choose from, such as templates for creating virtual machines, disk 
storage, and more. If you are running a commercial service, you will be 
keeping track of what services and resources users are consuming and 
charging them for that usage. Even if you do not charge anything for 
people to use your cloud –​ say, if the users are strictly internal to 
your organization, or just friends who are sharing your cloud –​ you can
 still keep track of what services they use and how much of them.
	</div><div class="section" id="offerings-and-templates"><div class="titlepage"><div><div><h2 class="title">4.1.&nbsp;Service Offerings, Disk Offerings, Network Offerings, and Templates</h2></div></div></div><div class="para">
			A user creating a new instance can make a variety of choices about 
its characteristics and capabilities. CloudStack provides several ways 
to present users with choices when creating a new instance:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Service Offerings, defined by the CloudStack administrator, provide
 a choice of CPU speed, number of CPUs, RAM size, tags on the root disk,
 and other choices. See Creating a New Compute Offering.
				</div></li><li class="listitem"><div class="para">
					Disk Offerings, defined by the CloudStack administrator, provide a 
choice of disk size for primary data storage. See Creating a New Disk 
Offering.
				</div></li><li class="listitem"><div class="para">
					Network Offerings, defined by the CloudStack administrator, 
describe the feature set that is available to end users from the virtual
 router or external networking devices on a given guest network. See 
Network Offerings.
				</div></li><li class="listitem"><div class="para">
					Templates, defined by the CloudStack administrator or by any 
CloudStack user, are the base OS images that the user can choose from 
when creating a new instance. For example, CloudStack includes CentOS as
 a template. See Working with Templates.
				</div></li></ul></div><div class="para">
			In addition to these choices that are provided for users, there is 
another type of service offering which is available only to the 
CloudStack root administrator, and is used for configuring virtual 
infrastructure resources. For more information, see Upgrading a Virtual 
Router with System Service Offerings.
		</div></div></div><div xml:lang="zh-CN" class="chapter" id="ui" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;5&nbsp;章&nbsp;用​户​界​面​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#log-in">5.1. 登​陆​到​用​户​界​面​</a></span></dt><dd><dl><dt><span class="section"><a href="#end-user-ui-overview">5.1.1. 最​终​用​户​界​面​概​览​</a></span></dt><dt><span class="section"><a href="#root-admin-ui-overview">5.1.2. 根​管​理​员​界​面​的​概​述​</a></span></dt><dt><span class="section"><a href="#log-in-root-admin">5.1.3. 作​为​根​管​理​员​登​录​</a></span></dt><dt><span class="section"><a href="#changing-root-password">5.1.4. 修​改​Root口​令​</a></span></dt></dl></dd><dt><span class="section"><a href="#using-sshkeys">5.2. Using SSH Keys for Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#create-ssh-template">5.2.1.  Creating an Instance Template that Supports SSH Keys</a></span></dt><dt><span class="section"><a href="#create-ssh-keypair">5.2.2. Creating the SSH Keypair</a></span></dt><dt><span class="section"><a href="#creating-ssh-instance">5.2.3. Creating an Instance</a></span></dt><dt><span class="section"><a href="#logging-in-ssh">5.2.4. Logging In Using the SSH Keypair</a></span></dt><dt><span class="section"><a href="#reset-ssh">5.2.5. Resetting SSH Keys</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="log-in" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">5.1.&nbsp;登​陆​到​用​户​界​面​</h2></div></div></div><div class="para">
		
CloudStack提​供​一​个​基​于​web的​用​户​界​面​能​够​被​管​理​员​和​终​端​用​户​使​用​。​适​当​的​用​户
​界​面​版​本​被​展​现​依​赖​于​登​陆​时​使​用​的​凭​证​。​用​户​界​面​是​适​用​于​大​多​数​流​行​的​浏​览​器
​包​括​IE7,IE8,IE9,Firefox3.5+,Firefox4,Safari4,和​Safari5。​URL是​:(用​你​自​己​
的​管​理​控​制​服​务​器​IP地​址​代​替​)
	</div><pre class="programlisting">http://&lt;管理控制-服务器-ip-地址&gt;:8080/client</pre><div class="para">
		初​次​登​陆​管​理​控​制​服​务​器​时​，一​个​向​导​启​动​画​面​会​显​现​。​你​将​看​到​登​陆​界​面​当​你​执​行​下​面​的​过​程​在​你​的​控​制​面​板​上​:
	</div><div class="formalpara"><h5 class="formalpara" id="idp33417984">用​户​名​</h5>
			你​的​帐​户​的​用​户​标​识​。​默​认​的​用​户​名​是​admin。​
		</div><div class="formalpara"><h5 class="formalpara" id="idp6402144">密​码​</h5>
			相​关​用​户​标​识​的​密​码​。​默​认​用​户​（admin）的​密​码​是​password。​
		</div><div class="formalpara"><h5 class="formalpara" id="idp412896">域​</h5>
			如​果​你​是​一​个​root用​户​，不​用​填​写​域​这​个​字​段​。​
		</div><div class="para">
		如​果​你​是​一​个​子​域​的​用​户​，输​入​完​全​路​径​在​域​字​段​，不​包​括​根​域​。​
	</div><div class="para">
		例​如​，假​设​多​个​层​级​被​建​立​在​根​域​下​，像​Comp1/hr，在​Comp1域​的​用​户​应​该​输​入​Comp1在​域​字​段​，在​Comp1/sales域​的​用​户​应​该​输​入​Comp1/sales。​
	</div><div class="para">
		更​多​关​于​当​你​登​陆​这​个​界​面​时​选​项​的​指​导​，参​照​作​为​根​管​理​员​登​陆​。​
	</div><div xml:lang="zh-CN" class="section" id="end-user-ui-overview" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">5.1.1.&nbsp;最​终​用​户​界​面​概​览​</h3></div></div></div><div class="para">
		CloudStack 
用​户​界​面​帮​助​云​基​础​设​施​的​用​户​查​看​和​使​用​他​们​的​云​资​源​，包​括​虚​拟​机​、​模​板​和​
ISO、​数​据​卷​和​快​照​、​宾​客​网​络​，以​及​IP 地​址​。​如​果​用​户​是​一​个​或​多​个​CloudStack 
项​目​的​成​员​或​管​理​员​，用​户​界​面​能​提​供​一​个​面​向​项​目​的​视​图​。​
	</div></div><div xml:lang="zh-CN" class="section" id="root-admin-ui-overview" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">5.1.2.&nbsp;根​管​理​员​界​面​的​概​述​</h3></div></div></div><div class="para">
		CloudStack 界​面​帮​助​ CloudStack 
管​理​员​配​置​，查​看​和​管​理​云​的​基​础​设​施​，用​户​域​，账​号​，项​目​，参​数​设​置​。​当​一​个​全​新​的
​管​理​服​务​器​安​装​完​成​后​，第​一​次​启​动​界​面​的​时​候​，可​以​选​择​根​随​引​导​步​骤​配​置​云​的​基
​础​设​施​。​当​再​次​登​录​时​，会​显​示​当​前​登​录​用​户​的​仪​表​板​。​在​这​个​页​面​有​很​多​的​连​接​
，可​以​通​过​左​边​的​导​航​栏​访​问​各​种​管​理​功​能​。​根​管​理​员​也​可​以​使​用​界​面​像​最​终​用​户​一
​样​来​执​行​所​有​的​功​能​。​
	</div></div><div xml:lang="zh-CN" class="section" id="log-in-root-admin" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">5.1.3.&nbsp;作​为​根​管​理​员​登​录​</h3></div></div></div><div class="para">
		在​管​理​服​务​器​软​件​安​装​并​且​运​行​后​, 你​可​以​运​行​ CloudStack 的​用​户​界​面​. 在​这​里​通​过​UI,可​以​供​给​, 查​看​并​管​理​你​的​云​基​础​架​构​.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				打​开​你​自​己​喜​欢​的​浏​览​器​并​访​问​这​个​URL. 请​把​IP地​址​替​换​成​你​自​己​的​管​理​服​务​器​的​IP.
			</div><pre class="programlisting">http://&lt;management-server-ip-address&gt;:8080/client</pre><div class="para">
				After logging into a fresh Management Server installation, a guided 
tour splash screen appears. On later visits, you’​ll be taken directly 
into the Dashboard.
			</div></li><li class="listitem"><div class="para">
				如​果​你​看​到​第​一​次​的​向​导​屏​幕​, 可​以​选​择​下​面​步​骤​之​一​进​行​.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>继​续​简​单​设​置​.</strong></span> 
如​果​你​只​是​简​单​试​用​CloudStack,并​且​你​想​通​过​一​个​配​置​向​导​尽​可​能​简​单​快​速​的​开​始
​, 请​选​择​这​项​. 我​们​将​帮​助​你​建​立​一​个​有​下​列​功​能​的​云​环​境​: 
一​个​单​独​的​机​器​运​行​CloudStack 并​通​过​NFS提​供​存​储​; 
一​个​单​独​的​机​器​提​供​在​XenServer或​KVM上​运​行​虚​拟​机​; 以​及​一​个​共​享​的​公​共​网​络​.
					</div><div class="para">
						安​装​向​导​的​提​示​应​该​给​你​需​要​的​所​有​信​息​. 但​如​果​你​需​要​更​多​的​详​细​信​息​, 你​可​以​按​照​试​用​安​装​向​导​进​行​.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>I have used CloudStack before.</strong></span>
 Choose this if you have already gone through a design phase and planned
 a more sophisticated deployment, or you are ready to start scaling up a
 trial cloud that you set up earlier with the basic setup screens. In 
the Administrator UI, you can start using the more powerful features of 
CloudStack, such as advanced VLAN networking, high availability, 
additional network elements such as load balancers and firewalls, and 
support for multiple hypervisors including Citrix XenServer, KVM, and 
VMware vSphere.
					</div><div class="para">
						根​管​理​员​的​仪​表​盘​出​现​了​.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				你​应​该​为​根​管​理​员​设​置​一​个​新​的​密​码​. 如​果​你​选​择​简​单​设​置​, 将​会​提​示​你​立​即​创​建​一​个​新​的​密​码​. 如​果​你​选​择​有​经​验​的​用​户​, 请​选​择​<a class="xref" href="#changing-root-password">第&nbsp;5.1.4&nbsp;节 “修​改​Root口​令​”</a>里​的​步​骤​.
			</div></li></ol></div><div class="warning"><div class="admonition_header"><h2>警告</h2></div><div class="admonition"><div class="para">
			你​正​作​为​根​管​理​员​登​入​. 这​个​账​号​管​理​@PRODUCT;的​部​署​, 包​括​物​理​架​构​. 
根​管​理​员​可​以​更​改​配​置​以​更​改​基​本​的​功​能​, 创​建​或​删​除​用​户​账​号​, 
以​及​其​它​许​多​只​有​被​鉴​权​的​用​户​执​行​的​操​作​. 
请​更​改​默​认​的​密​码​,确​保​其​唯​一​性​和​安​全​性​.
		</div></div></div><div class="para">
	</div></div><div xml:lang="zh-CN" class="section" id="changing-root-password" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">5.1.4.&nbsp;修​改​Root口​令​</h3></div></div></div><div class="para">
		During installation and ongoing cloud administration, you will need to
 log in to the UI as the root administrator. The root administrator 
account manages the CloudStack deployment, including physical 
infrastructure. The root administrator can modify configuration settings
 to change basic functionality, create or delete user accounts, and take
 many actions that should be performed only by an authorized person. 
When first installing CloudStack, be sure to change the default password
 to a new, unique value.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				打​开​你​自​己​喜​欢​的​浏​览​器​并​访​问​这​个​URL. 请​把​IP地​址​替​换​成​你​自​己​的​管​理​服​务​器​的​IP.
			</div><pre class="programlisting">http://&lt;management-server-ip-address&gt;:8080/client</pre></li><li class="listitem"><div class="para">
				使​用​当​前​root用​户​的​ID和​口​令​登​录​UI。​缺​省​为​admin/pawword。​
			</div></li><li class="listitem"><div class="para">
				点​击​账​户​
			</div></li><li class="listitem"><div class="para">
				点​击​管​理​员​账​户​名​
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​用​户​
			</div></li><li class="listitem"><div class="para">
				点​击​管​理​员​用​户​名​
			</div></li><li class="listitem"><div class="para">
				Click the Change Password button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/change-password.png" alt="change-password.png: button to change a user's password"></span>
			</div></li><li class="listitem"><div class="para">
				键​入​新​密​码​，然​后​点​击​确​认​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="using-sshkeys" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">5.2.&nbsp;Using SSH Keys for Authentication</h2></div></div></div><div class="para">
		In addition to the username and password authentication, CloudStack 
supports using SSH keys to log in to the cloud infrastructure for 
additional security. You can use the createSSHKeyPair API to generate 
the SSH keys.
	</div><div class="para">
		Because each cloud user has their own SSH key, one cloud user cannot 
log in to another cloud user's instances unless they share their SSH key
 files. Using a single SSH key pair, you can manage multiple instances.
	</div><div class="section" id="create-ssh-template"><div class="titlepage"><div><div><h3 class="title">5.2.1.&nbsp; Creating an Instance Template that Supports SSH Keys</h3></div></div></div><div class="para">
			Create a instance template that supports SSH Keys.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Create a new instance by using the template provided by cloudstack.
				</div><div class="para">
					For more information on creating a new instance, see
				</div></li><li class="listitem"><div class="para">
					Download the cloudstack script from <a href="http://sourceforge.net/projects/cloudstack/files/SSH%20Key%20Gen%20Script/">The SSH Key Gen Script</a>to the instance you have created.
				</div><pre class="programlisting">wget http://downloads.sourceforge.net/project/cloudstack/SSH%20Key%20Gen%20Script/cloud-set-guest-sshkey.in?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fcloudstack%2Ffiles%2FSSH%2520Key%2520Gen%2520Script%2F&amp;ts=1331225219&amp;use_mirror=iweb</pre></li><li class="listitem"><div class="para">
					Copy the file to /etc/init.d.
				</div><pre class="programlisting">cp cloud-set-guest-sshkey.in /etc/init.d/</pre></li><li class="listitem"><div class="para">
					Give the necessary permissions on the script:
				</div><pre class="programlisting">chmod +x /etc/init.d/cloud-set-guest-sshkey.in</pre></li><li class="listitem"><div class="para">
					Run the script while starting up the operating system:
				</div><pre class="programlisting">chkconfig --add cloud-set-guest-sshkey.in</pre></li><li class="listitem"><div class="para">
					Stop the instance.
				</div></li></ol></div></div><div class="section" id="create-ssh-keypair"><div class="titlepage"><div><div><h3 class="title">5.2.2.&nbsp;Creating the SSH Keypair</h3></div></div></div><div class="para">
			You must make a call to the createSSHKeyPair api method. You can 
either use the CloudStack Python API library or the curl commands to 
make the call to the cloudstack api.
		</div><div class="para">
			For example, make a call from the cloudstack server to create a SSH 
keypair called "keypair-doc" for the admin account in the root domain:
		</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
				Ensure that you adjust these values to meet your needs. If you are 
making the API call from a different server, your URL/PORT will be 
different, and you will need to use the API keys.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Run the following curl command:
				</div><pre class="programlisting">curl --globoff "http://localhost:8096/?command=createSSHKeyPair&amp;name=keypair-doc&amp;account=admin&amp;domainid=5163440e-c44b-42b5-9109-ad75cae8e8a2"</pre><div class="para">
					The output is something similar to what is given below:
				</div><pre class="programlisting">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;createsshkeypairresponse cloud-stack-version="3.0.0.20120228045507"&gt;&lt;keypair&gt;&lt;name&gt;keypair-doc&lt;/name&gt;&lt;fingerprint&gt;f6:77:39:d5:5e:77:02:22:6a:d8:7f:ce:ab:cd:b3:56&lt;/fingerprint&gt;&lt;privatekey&gt;-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQCSydmnQ67jP6lNoXdX3noZjQdrMAWNQZ7y5SrEu4wDxplvhYci
dXYBeZVwakDVsU2MLGl/K+wefwefwefwefwefJyKJaogMKn7BperPD6n1wIDAQAB
AoGAdXaJ7uyZKeRDoy6wA0UmF0kSPbMZCR+UTIHNkS/E0/4U+6lhMokmFSHtu
mfDZ1kGGDYhMsdytjDBztljawfawfeawefawfawfawQQDCjEsoRdgkduTy
QpbSGDIa11Jsc+XNDx2fgRinDsxXI/zJYXTKRhSl/LIPHBw/brW8vzxhOlSOrwm7
VvemkkgpAkEAwSeEw394LYZiEVv395ar9MLRVTVLwpo54jC4tsOxQCBlloocK
lYaocpk0yBqqOUSBawfIiDCuLXSdvBo1Xz5ICTM19vgvEp/+kMuECQBzm
nVo8b2Gvyagqt/KEQo8wzH2THghZ1qQ1QRhIeJG2aissEacF6bGB2oZ7Igim5L14
4KR7OeEToyCLC2k+02UCQQCrniSnWKtDVoVqeK/zbB32JhW3Wullv5p5zUEcd
KfEEuzcCUIxtJYTahJ1pvlFkQ8anpuxjSEDp8x/18bq3
-----END RSA PRIVATE KEY-----
&lt;/privatekey&gt;&lt;/keypair&gt;&lt;/createsshkeypairresponse&gt;</pre></li><li class="listitem"><div class="para">
					Copy the key data into a file. The file looks like this:
				</div><pre class="programlisting">-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQCSydmnQ67jP6lNoXdX3noZjQdrMAWNQZ7y5SrEu4wDxplvhYci
dXYBeZVwakDVsU2MLGl/K+wefwefwefwefwefJyKJaogMKn7BperPD6n1wIDAQAB
AoGAdXaJ7uyZKeRDoy6wA0UmF0kSPbMZCR+UTIHNkS/E0/4U+6lhMokmFSHtu
mfDZ1kGGDYhMsdytjDBztljawfawfeawefawfawfawQQDCjEsoRdgkduTy
QpbSGDIa11Jsc+XNDx2fgRinDsxXI/zJYXTKRhSl/LIPHBw/brW8vzxhOlSOrwm7
VvemkkgpAkEAwSeEw394LYZiEVv395ar9MLRVTVLwpo54jC4tsOxQCBlloocK
lYaocpk0yBqqOUSBawfIiDCuLXSdvBo1Xz5ICTM19vgvEp/+kMuECQBzm
nVo8b2Gvyagqt/KEQo8wzH2THghZ1qQ1QRhIeJG2aissEacF6bGB2oZ7Igim5L14
4KR7OeEToyCLC2k+02UCQQCrniSnWKtDVoVqeK/zbB32JhW3Wullv5p5zUEcd
KfEEuzcCUIxtJYTahJ1pvlFkQ8anpuxjSEDp8x/18bq3
-----END RSA PRIVATE KEY-----</pre></li><li class="listitem"><div class="para">
					Save the file.
				</div></li></ol></div></div><div class="section" id="creating-ssh-instance"><div class="titlepage"><div><div><h3 class="title">5.2.3.&nbsp;Creating an Instance</h3></div></div></div><div class="para">
			After you save the SSH keypair file, you must create an instance by using the template that you created at <a class="xref" href="#create-ssh-template">第&nbsp;5.2.1&nbsp;节 “ Creating an Instance Template that Supports SSH Keys”</a>. Ensure that you use the same SSH key name that you created at <a class="xref" href="#create-ssh-keypair">第&nbsp;5.2.2&nbsp;节 “Creating the SSH Keypair”</a>.
		</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
				You cannot create the instance by using the GUI at this time and associate the instance with the newly created SSH keypair.
			</div></div></div><div class="para">
			A sample curl command to create a new instance is:
		</div><pre class="programlisting">curl --globoff http://localhost:&lt;port number&gt;/?command=deployVirtualMachine\&amp;zoneId=1\&amp;serviceOfferingId=18727021-7556-4110-9322-d625b52e0813\&amp;templateId=e899c18a-ce13-4bbf-98a9-625c5026e0b5\&amp;securitygroupids=ff03f02f-9e3b-48f8-834d-91b822da40c5\&amp;account=admin\&amp;domainid=1\&amp;keypair=keypair-doc</pre><div class="para">
			Substitute the template, service offering and security group IDs (if 
you are using the security group feature) that are in your cloud 
environment.
		</div></div><div class="section" id="logging-in-ssh"><div class="titlepage"><div><div><h3 class="title">5.2.4.&nbsp;Logging In Using the SSH Keypair</h3></div></div></div><div class="para">
			To test your SSH key generation is successful, check whether you can log in to the cloud setup.
		</div><div class="para">
			For exaple, from a Linux OS, run:
		</div><pre class="programlisting">ssh -i ~/.ssh/keypair-doc &lt;ip address&gt;</pre><div class="para">
			The -i parameter tells the ssh client to use a ssh key found at ~/.ssh/keypair-doc.
		</div></div><div class="section" id="reset-ssh"><div class="titlepage"><div><div><h3 class="title">5.2.5.&nbsp;Resetting SSH Keys</h3></div></div></div><div class="para">
			With the API command resetSSHKeyForVirtualMachine, a user can set or 
reset the SSH keypair assigned to a virtual machine. A lost or 
compromised SSH keypair can be changed, and the user can access the VM 
by using the new keypair. Just create or register a new keypair, then 
call resetSSHKeyForVirtualMachine.
		</div></div></div></div><div xml:lang="zh-CN" class="chapter" id="projects" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;6&nbsp;章&nbsp;使​用​项​目​来​管​理​用​户​和​资​源​。​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#projects-overview">6.1. Overview of Projects</a></span></dt><dt><span class="section"><a href="#configuring-projects">6.2. 配​置​项​目​</a></span></dt><dd><dl><dt><span class="section"><a href="#set-up-invitations">6.2.1. Setting Up Invitations</a></span></dt><dt><span class="section"><a href="#set-resource-limits-for-projects">6.2.2. 设​置​项​目​的​资​源​限​制​</a></span></dt><dt><span class="section"><a href="#set-projects-creator-permissions">6.2.3. Setting Project Creator Permissions</a></span></dt></dl></dd><dt><span class="section"><a href="#create-new-projects">6.3. 创​建​一​个​新​项​目​</a></span></dt><dt><span class="section"><a href="#add-members-to-projects">6.4. 添​加​成​员​到​一​个​项​目​</a></span></dt><dd><dl><dt><span class="section"><a href="#send-projects-membership-invitation">6.4.1. Sending Project Membership Invitations</a></span></dt><dt><span class="section"><a href="#add-projects-members-from-ui">6.4.2. Adding Project Members From the UI</a></span></dt></dl></dd><dt><span class="section"><a href="#accept-membership-invite">6.5. 接​受​成​员​身​份​的​邀​请​</a></span></dt><dt><span class="section"><a href="#suspend-project">6.6. Suspending or Deleting a Project</a></span></dt><dt><span class="section"><a href="#use-project-view">6.7. Using the Project View</a></span></dt></dl></div><div xml:lang="zh-CN" class="section" id="projects-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.1.&nbsp;Overview of Projects</h2></div></div></div><div class="para">
		Projects are used to organize people and resources. CloudStack users 
within a single domain can group themselves into project teams so they 
can collaborate and share virtual resources such as VMs, snapshots, 
templates, data disks, and IP addresses. CloudStack tracks resource 
usage per project as well as per user, so the usage can be billed to 
either a user account or a project. For example, a private cloud within a
 software company might have all members of the QA department assigned 
to one project, so the company can track the resources used in testing 
while the project members can more easily isolate their efforts from 
other users of the same cloud
	</div><div class="para">
		You can configure CloudStack to allow any user to create a new 
project, or you can restrict that ability to just CloudStack 
administrators. Once you have created a project, you become that 
project’​s administrator, and you can add others within your domain to 
the project. CloudStack can be set up either so that you can add people 
directly to a project, or so that you have to send an invitation which 
the recipient must accept. Project members can view and manage all 
virtual resources created by anyone in the project (for example, share 
VMs). A user can be a member of any number of projects and can switch 
views in the CloudStack UI to show only project-related information, 
such as project VMs, fellow project members, project-related alerts, and
 so on.
	</div><div class="para">
		The project administrator can pass on the role to another project 
member. The project administrator can also add more members, remove 
members from the project, set new resource limits (as long as they are 
below the global defaults set by the CloudStack administrator), and 
delete the project. When the administrator removes a member from the 
project, resources created by that user, such as VM instances, remain 
with the project. This brings us to the subject of resource ownership 
and which resources can be used by a project.
	</div><div class="para">
		Resources created within a project are owned by the project, not by 
any particular CloudStack account, and they can be used only within the 
project. A user who belongs to one or more projects can still create 
resources outside of those projects, and those resources belong to the 
user’​s account; they will not be counted against the project’​s usage 
or resource limits. You can create project-level networks to isolate 
traffic within the project and provide network services such as port 
forwarding, load balancing, VPN, and static NAT. A project can also make
 use of certain types of resources from outside the project, if those 
resources are shared. For example, a shared network or public template 
is available to any project in the domain. A project can get access to a
 private template if the template’​s owner will grant permission. A 
project can use any service offering or disk offering available in its 
domain; however, you can not create private service and disk offerings 
at the project level..
	</div></div><div xml:lang="zh-CN" class="section" id="configuring-projects" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.2.&nbsp;配​置​项​目​</h2></div></div></div><div class="para">
		Before CloudStack users start using projects, the CloudStack 
administrator must set up various systems to support them, including 
membership invitations, limits on project resources, and controls on who
 can create projects.
	</div><div xml:lang="zh-CN" class="section" id="set-up-invitations" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">6.2.1.&nbsp;Setting Up Invitations</h3></div></div></div><div class="para">
		CloudStack can be set up either so that project administrators can add
 people directly to a project, or so that it is necessary to send an 
invitation which the recipient must accept. The invitation can be sent 
by email or through the user’​s CloudStack account. If you want 
administrators to use invitations to add members to projects, turn on 
and set up the invitations feature in CloudStack.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 界​面​
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type project and click the search button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/search-button.png" alt="searchbutton.png: Searches projects"></span>
			</div></li><li class="listitem"><div class="para">
				In the search results, you can see a few other parameters you need 
to set to control how invitations behave. The table below shows global 
configuration parameters related to project invitations. Click the edit 
button to set each parameter.
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
								<div class="para">
									Configuration Parameters
								</div>
							</th><th class="" align="left">
								<div class="para">
									è¯´æ
								</div>
							</th></tr></thead><tbody><tr><td class="" align="left">
								<div class="para">
									project.invite.required
								</div>
							</td><td class="" align="left">
								<div class="para">
									Set to true to turn on the invitations feature.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.email.sender
								</div>
							</td><td class="" align="left">
								<div class="para">
									The email address to show in the From field of invitation emails.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.invite.timeout
								</div>
							</td><td class="" align="left">
								<div class="para">
									Amount of time to allow for a new member to respond to the invitation.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.smtp.host
								</div>
							</td><td class="" align="left">
								<div class="para">
									Name of the host that acts as an email server to handle invitations.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.smtp.password
								</div>
							</td><td class="" align="left">
								<div class="para">
									(Optional) Password required by the SMTP server. You must also 
set project.smtp.username and set project.smtp.useAuth to true.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.smtp.port
								</div>
							</td><td class="" align="left">
								<div class="para">
									SMTP server’​s listening port.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.smtp.useAuth
								</div>
							</td><td class="" align="left">
								<div class="para">
									Set to true if the SMTP server requires a username and password.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									project.smtp.username
								</div>
							</td><td class="" align="left">
								<div class="para">
									(Optional) User name required by the SMTP server for 
authentication. You must also set project.smtp.password and set 
project.smtp.useAuth to true..
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				Restart the Management Server:
			</div><pre class="programlisting">service cloudstack-management restart</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="set-resource-limits-for-projects" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">6.2.2.&nbsp;设​置​项​目​的​资​源​限​制​</h3></div></div></div><div class="para">
		
CloudStack管​理​员​可​以​设​置​全​局​默​认​的​限​制​，控​制​在​云​中​的​每​个​项​目​可​以​拥​有​的​资​源
​量​。​这​是​为​了​防​止​不​受​控​制​的​资​源​使​用​，如​快​照​，IP地​址​和​虚​拟​机​实​例​。​域​管​理​员​可
​以​取​代​他​们​域​中​个​别​项​目​的​资​源​限​制​，只​要​新​的​限​制​是​低​于​CloudStack根​管​理​员​设​
置​的​默​认​全​局​限​制​。​根​管​理​员​还​可​以​为​云​中​的​任​何​项​目​设​置​较​低​的​资​源​限​制​。​
	</div><div xml:lang="zh-CN" class="section" id="set-per-project-resource-limits" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">6.2.2.1.&nbsp;Setting Per-Project Resource Limits</h4></div></div></div><div class="para">
		The CloudStack root administrator or the domain administrator of the 
domain where the project resides can set new resource limits for an 
individual project. The project owner can set resource limits only if 
the owner is also a domain or root administrator.
	</div><div class="para">
		The new limits must be below the global default limits set by the CloudStack administrator (as described in <a class="xref" href="#set-resource-limits-for-projects">第&nbsp;6.2.2&nbsp;节 “设​置​项​目​的​资​源​限​制​”</a>).
 If the project already owns more of a given type of resource than the 
new maximum, the resources are not affected; however, the project can 
not add any new resources of that type until the total drops below the 
new limit.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 界​面​
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​项​目​.
			</div></li><li class="listitem"><div class="para">
				在​下​拉​列​表​框​选​择​项​目​
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Resources tab. This tab lists the current maximum amount 
that the project is allowed to own for each type of resource.
			</div></li><li class="listitem"><div class="para">
				Type new values for one or more resources.
			</div></li><li class="listitem"><div class="para">
				Click Apply.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="set-global-project-resource-limits" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">6.2.2.2.&nbsp;Setting the Global Project Resource Limits</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 界​面​
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type max.projects and click the search button.
			</div></li><li class="listitem"><div class="para">
				In the search results, you will see the parameters you can use to 
set per-project maximum resource amounts that apply to all projects in 
the cloud. No project can have more resources, but an individual project
 can have lower limits. Click the edit button to set each parameter. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="editbutton.png: Edits parameters"></span>
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><tbody><tr><td class="" align="left">
								<div class="para">
									max.project.public.ips
								</div>
							</td><td class="" align="left">
								<div class="para">
									Maximum number of public IP addresses that can be owned by any project in the cloud. See About Public IP Addresses.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									max.project.snapshots
								</div>
							</td><td class="" align="left">
								<div class="para">
									Maximum number of snapshots that can be owned by any project in the cloud. See Working with Snapshots.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									max.project.templates
								</div>
							</td><td class="" align="left">
								<div class="para">
									Maximum number of templates that can be owned by any project in the cloud. See Working with Templates.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									max.project.uservms
								</div>
							</td><td class="" align="left">
								<div class="para">
									Maximum number of guest virtual machines that can be owned by 
any project in the cloud. See Working With Virtual Machines.
								</div>
							</td></tr><tr><td class="" align="left">
								<div class="para">
									max.project.volumes
								</div>
							</td><td class="" align="left">
								<div class="para">
									Maximum number of data volumes that can be owned by any project in the cloud. See Working with Volumes.
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				重​启​管​理​服​务​器​.
			</div><pre class="programlisting"># service cloudstack-management restart</pre></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="set-projects-creator-permissions" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">6.2.3.&nbsp;Setting Project Creator Permissions</h3></div></div></div><div class="para">
		You can configure CloudStack to allow any user to create a new 
project, or you can restrict that ability to just CloudStack 
administrators.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 界​面​
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type allow.user.create.projects.
			</div></li><li class="listitem"><div class="para">
				Click the edit button to set the parameter.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="editbutton.png: Edits parameters"></span>
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><tbody><tr><td class="" align="left">
								<div class="para">
									allow.user.create.projects
								</div>
							</td><td class="" align="left">
								<div class="para">
									Set to true to allow end users to create projects. Set to false
 if you want only the CloudStack root administrator and domain 
administrators to create projects.
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				重​启​管​理​服​务​器​.
			</div><pre class="programlisting"># service cloudstack-management restart</pre></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="create-new-projects" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.3.&nbsp;创​建​一​个​新​项​目​</h2></div></div></div><div class="para">
		CloudStack （默​认​）系​统​管​理​员​和​与​管​理​员​能​创​建​项​目​。​如​果​全​局​变​量​allow.user.create.projects设​置​为​true，终​端​用​户​也​能​创​建​项​目​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 界​面​
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​点​击​项​目​。​
			</div></li><li class="listitem"><div class="para">
				在​选​择​视​图​点​击​项​目​。​
			</div></li><li class="listitem"><div class="para">
				点​击​新​建​项​目​。​
			</div></li><li class="listitem"><div class="para">
				为​项​目​命​名​并​添​加​描​述​，然​后​点​击​创​建​项​目​。​
			</div></li><li class="listitem"><div class="para">
				会​出​现​一​个​界​面​，你​可​以​很​快​的​添​加​更​多​成​员​到​项​目​中​，此​步​可​选​。​当​你​准​备​好​继​续​，点​击​下​一​步​。​
			</div></li><li class="listitem"><div class="para">
				点​击​保​存​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-members-to-projects" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.4.&nbsp;添​加​成​员​到​一​个​项​目​</h2></div></div></div><div class="para">
		
新​的​成​员​可​以​由​，项​目​所​在​的​域​或​任​何​父​域​的​域​管​理​员​，或​CloudStack的​root管​理​员​
，项​目​的​管​理​员​添​加​到​项​目​中​。​在​CloudStack 
中​，有​两​种​添​加​成​员​的​方​式​，但​在​一​个​时​刻​只​有​一​种​可​用​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				如​果​邀​请​被​设​置​，你​可​以​给​新​成​员​发​送​邀​请​。​
			</div></li><li class="listitem"><div class="para">
				如​果​邀​请​没​有​被​设​置​，你​可​以​通​过​UI直​接​添​加​成​员​。​
			</div></li></ul></div><div xml:lang="zh-CN" class="section" id="send-projects-membership-invitation" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">6.4.1.&nbsp;Sending Project Membership Invitations</h3></div></div></div><div class="para">
		Use these steps to add a new member to a project if the invitations feature is enabled in the cloud as described in <a class="xref" href="#set-up-invitations">第&nbsp;6.2.1&nbsp;节 “Setting Up Invitations”</a>. If the invitations feature is not turned on, use the procedure in Adding Project Members From the UI.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​项​目​.
			</div></li><li class="listitem"><div class="para">
				在​下​拉​列​表​框​选​择​项​目​
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Invitations tab.
			</div></li><li class="listitem"><div class="para">
				In Add by, select one of the following:
			</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						Account –​ The invitation will appear in the user’​s Invitations tab in the Project View. See Using the Project View.
					</div></li><li class="listitem"><div class="para">
						Email –​ The invitation will be sent to the user’​s email address.
 Each emailed invitation includes a unique code called a token which the
 recipient will provide back to CloudStack when accepting the 
invitation. Email invitations will work only if the global parameters 
related to the SMTP server have been set. See <a class="xref" href="#set-up-invitations">第&nbsp;6.2.1&nbsp;节 “Setting Up Invitations”</a>.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Type the user name or email address of the new member you want to 
add, and click Invite. Type the CloudStack user name if you chose 
Account in the previous step. If you chose Email, type the email 
address. You can invite only people who have an account in this cloud 
within the same domain as the project. However, you can send the 
invitation to any email address.
			</div></li><li class="listitem"><div class="para">
				To view and manage the invitations you have sent, return to this 
tab. When an invitation is accepted, the new member will appear in the 
project’​s Accounts tab.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-projects-members-from-ui" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">6.4.2.&nbsp;Adding Project Members From the UI</h3></div></div></div><div class="para">
		The steps below tell how to add a new member to a project if the 
invitations feature is not enabled in the cloud. If the invitations 
feature is enabled cloud,as described in <a class="xref" href="#set-up-invitations">第&nbsp;6.2.1&nbsp;节 “Setting Up Invitations”</a>, use the procedure in <a class="xref" href="#send-projects-membership-invitation">第&nbsp;6.4.1&nbsp;节 “Sending Project Membership Invitations”</a>.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​项​目​.
			</div></li><li class="listitem"><div class="para">
				在​下​拉​列​表​框​选​择​项​目​
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Accounts tab. The current members of the project are listed.
			</div></li><li class="listitem"><div class="para">
				Type the account name of the new member you want to add, and click 
Add Account. You can add only people who have an account in this cloud 
and within the same domain as the project.
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="accept-membership-invite" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.5.&nbsp;接​受​成​员​身​份​的​邀​请​</h2></div></div></div><div class="para">
		如​果​你​收​到​一​个​加​入​CloudStack项​目​的​邀​请​, 并​且​你​想​接​受​这​个​邀​请​, 参​照​下​面​的​步​骤​:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​项​目​.
			</div></li><li class="listitem"><div class="para">
				在​选​择​视​图​中​, 选​择​邀​请​
			</div></li><li class="listitem"><div class="para">
				如​果​你​看​到​邀​请​列​在​屏​幕​上​, 点​击​接​受​按​钮​.
			</div><div class="para">
				屏​幕​上​列​出​的​邀​请​是​使​用​你​在​CloudStack账​号​名​称​发​给​你​的​.
			</div></li><li class="listitem"><div class="para">
				如​果​你​收​到​一​个​邮​件​邀​请​, 点​击​权​标​按​钮​, 然​后​提​供​从​邮​件​中​获​得​的​项​目​ID和​唯​一​识​别​码​(权​标​).
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="suspend-project" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.6.&nbsp;Suspending or Deleting a Project</h2></div></div></div><div class="para">
		When a project is suspended, it retains the resources it owns, but 
they can no longer be used. No new resources or members can be added to a
 suspended project.
	</div><div class="para">
		When a project is deleted, its resources are destroyed, and member 
accounts are removed from the project. The project’​s status is shown as
 Disabled pending final deletion.
	</div><div class="para">
		A project can be suspended or deleted by the project administrator, 
the domain administrator of the domain the project belongs to or of its 
parent domain, or the CloudStack root administrator.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​项​目​.
			</div></li><li class="listitem"><div class="para">
				在​下​拉​列​表​框​选​择​项​目​
			</div></li><li class="listitem"><div class="para">
				Click the name of the project.
			</div></li><li class="listitem"><div class="para">
				Click one of the buttons:
			</div><div class="para">
				To delete, use 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/delete-button.png" alt="deletebutton.png: Removes a project"></span>
			</div><div class="para">
				To suspend, use
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/suspend-icon.png" alt="deletebutton.png: suspends a project"></span>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="use-project-view" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">6.7.&nbsp;Using the Project View</h2></div></div></div><div class="para">
		If you are a member of a project, you can use CloudStack’​s project 
view to see project members, resources consumed, and more. The project 
view shows only information related to one project. It is a useful way 
to filter out other information so you can concentrate on a project 
status and resources.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				Click Project View.
			</div></li><li class="listitem"><div class="para">
				The project dashboard appears, showing the project’​s VMs, volumes, 
users, events, network settings, and more. From the dashboard, you can:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Click the Accounts tab to view and manage project members. If you 
are the project administrator, you can add new members, remove members, 
or change the role of a member from user to admin. Only one member at a 
time can have the admin role, so if you set another user’​s role to 
admin, your role will change to regular user.
					</div></li><li class="listitem"><div class="para">
						(If invitations are enabled) Click the Invitations tab to view and
 manage invitations that have been sent to new project members but not 
yet accepted. Pending invitations will remain in this list until the new
 member accepts, the invitation timeout is reached, or you cancel the 
invitation.
					</div></li></ul></div></li></ol></div></div></div><div xml:lang="zh-CN" class="chapter" id="provisioning-steps" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;7&nbsp;章&nbsp;准​备​你​的​云​基​础​设​施​的​步​骤​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#provisioning-steps-overview">7.1. 设​置​步​骤​概​览​</a></span></dt><dt><span class="section"><a href="#region-add">7.2. Adding Regions (optional)</a></span></dt><dd><dl><dt><span class="section"><a href="#region-first">7.2.1. The First Region: The Default Region</a></span></dt><dt><span class="section"><a href="#region-add-2">7.2.2. Adding a Region</a></span></dt><dt><span class="section"><a href="#region-add-n">7.2.3. Adding Third and Subsequent Regions</a></span></dt><dt><span class="section"><a href="#region-delete">7.2.4. Deleting a Region</a></span></dt></dl></dd><dt><span class="section"><a href="#zone-add">7.3. 创​建​Zone</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-configuration">7.3.1. 基​础​区​域​配​置​</a></span></dt><dt><span class="section"><a href="#advanced-zone-configuration">7.3.2. 高​级​资​源​域​配​置​</a></span></dt></dl></dd><dt><span class="section"><a href="#pod-add">7.4. 添​加​一​个​机​架​</a></span></dt><dt><span class="section"><a href="#cluster-add">7.5. 添​加​集​群​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-clusters-kvm-xenserver">7.5.1. Add Cluster: KVM or XenServer</a></span></dt><dt><span class="section"><a href="#add-clusters-vsphere">7.5.2. Add Cluster: vSphere</a></span></dt></dl></dd><dt><span class="section"><a href="#host-add">7.6. Adding a Host</a></span></dt><dd><dl><dt><span class="section"><a href="#host-add-xenserver-kvm-ovm">7.6.1. Adding a Host (XenServer or KVM)</a></span></dt><dt><span class="section"><a href="#host-add-vsphere">7.6.2. 增​加​一​台​主​机​(vSphere)</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-add">7.7. æ·»å&nbsp;ä¸»å­å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-primary-storage">7.7.1. System Requirements for Primary Storage</a></span></dt><dt><span class="section"><a href="#adding-primary-storage">7.7.2. Adding Primary Stroage</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-add">7.8. æ·»å&nbsp;è¾å©å­å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-secondary-storage">7.8.1. System Requirements for Secondary Storage</a></span></dt><dt><span class="section"><a href="#adding-secondary-storage">7.8.2. 增​加​二​级​存​储​</a></span></dt></dl></dd><dt><span class="section"><a href="#initialize-and-test">7.9. 初​始​化​和​测​试​</a></span></dt></dl></div><div class="para">
		This section tells how to add regions, zones, pods, clusters, hosts, 
storage, and networks to your cloud. If you are unfamiliar with these 
entities, please begin by looking through <a class="xref" href="#cloud-infrastructure-concepts">第&nbsp;2&nbsp;章 <em>云​基​础​设​施​概​念​</em></a>.
	</div><div xml:lang="zh-CN" class="section" id="provisioning-steps-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.1.&nbsp;设​置​步​骤​概​览​</h2></div></div></div><div class="para">
		管​理​服​务​器​节​点​安​装​并​运​行​之​后​, 你​就​可​以​添​加​计​算​资​源​来​进​行​管​理​了​. 要​查​看​CloudStack云​架​构​整​体​上​是​如​何​组​织​的​, 请​参​考​ <a class="xref" href="#cloud-infrastructure-overview">第&nbsp;1.3.2&nbsp;节 “Cloud Infrastructure Overview”</a>.
	</div><div class="para">
		为​了​提​供​云​基​础​架​构​, 或​者​在​任​何​时​个​需​要​扩​展​过​规​模​, 请​按​照​下​面​的​步​骤​进​行​:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Define regions (optional). See <a class="xref" href="#region-add">第&nbsp;7.2&nbsp;节 “Adding Regions (optional)”</a>.
			</div></li><li class="listitem"><div class="para">
				Add a zone to the region. See <a class="xref" href="#zone-add">第&nbsp;7.3&nbsp;节 “创​建​Zone”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more pods to the zone (optional). See <a class="xref" href="#pod-add">第&nbsp;7.4&nbsp;节 “添​加​一​个​机​架​”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more clusters to the pod (optional). See <a class="xref" href="#cluster-add">第&nbsp;7.5&nbsp;节 “添​加​集​群​”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more hosts to the cluster (optional). See <a class="xref" href="#host-add">第&nbsp;7.6&nbsp;节 “Adding a Host”</a>.
			</div></li><li class="listitem"><div class="para">
				Add primary storage to the cluster. See <a class="xref" href="#primary-storage-add">第&nbsp;7.7&nbsp;节 “æ·»å&nbsp;ä¸»å­å¨”</a>.
			</div></li><li class="listitem"><div class="para">
				Add secondary storage to the zone. See <a class="xref" href="#secondary-storage-add">第&nbsp;7.8&nbsp;节 “æ·»å&nbsp;è¾å©å­å¨”</a>.
			</div></li><li class="listitem"><div class="para">
				初​始​化​并​测​试​新​的​云​环​境​. 参​照​<a class="xref" href="#initialize-and-test">第&nbsp;7.9&nbsp;节 “初​始​化​和​测​试​”</a>.
			</div></li></ol></div><div class="para">
		当​你​完​成​这​些​步​骤​以​后​, 你​将​部​署​如​下​的​一​个​基​本​结​构​:
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/provisioning-overview.png" alt="provisioning-overview.png: Conceptual overview of a basic deployment" width="444"></div></div><div xml:lang="zh-CN" class="section" id="region-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.2.&nbsp;Adding Regions (optional)</h2></div></div></div><div class="para">
		Grouping your cloud resources into geographic regions is an optional 
step when provisioning the cloud. For an overview of regions, see <a class="xref" href="#about-regions">第&nbsp;2.1&nbsp;节 “About Regions”</a>.
	</div><div class="section" id="region-first"><div class="titlepage"><div><div><h3 class="title">7.2.1.&nbsp;The First Region: The Default Region</h3></div></div></div><div class="para">
			If you do not take action to define regions, then all the zones in 
your cloud will be automatically grouped into a single default region. 
This region is assigned the region ID of 1.
		</div><div class="para">
			You can change the name or URL of the default region by using the API command updateRegion. For example:
		</div><pre class="programlisting">http://&lt;IP_of_Management_Server&gt;:8080/client/api?command=updateRegion&amp;id=1&amp;name=Northern&amp;endpoint=http://&lt;region_1_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></div><div class="section" id="region-add-2"><div class="titlepage"><div><div><h3 class="title">7.2.2.&nbsp;Adding a Region</h3></div></div></div><div class="para">
			Use these steps to add a second region in addition to the default region.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Each region has its own CloudStack instance. Therefore, the first 
step of creating a new region is to install the Management Server 
software, on one or more nodes, in the geographic area where you want to
 set up the new region. Use the steps in the Installation guide. When 
you come to the step where you set up the database, use the additional 
command-line flag <code class="code">-r &lt;region_id&gt;</code> to set a
 region ID for the new region. The default region is automatically 
assigned a region ID of 1, so your first additional region might be 
region 2.
				</div><pre class="programlisting">cloudstack-setup-databases cloud:&lt;dbpassword&gt;@localhost --deploy-as=root:&lt;password&gt; -e &lt;encryption_type&gt; -m &lt;management_server_key&gt; -k &lt;database_key&gt; -r &lt;region_id&gt;</pre></li><li class="listitem"><div class="para">
					By the end of the installation procedure, the Management Server 
should have been started. Be sure that the Management Server 
installation was successful and complete.
				</div></li><li class="listitem"><div class="para">
					Add region 2 to region 1. Use the API command addRegion. (For 
information about how to make an API call, see the Developer's Guide.)
				</div><pre class="programlisting">http://&lt;IP_of_region_1_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=2&amp;name=Western&amp;endpoint=http://&lt;region_2_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></li><li class="listitem"><div class="para">
					Now perform the same command in reverse, adding region 1 to region 2.
				</div><pre class="programlisting">http://&lt;IP_of_region_2_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=1&amp;name=Northern&amp;endpoint=http://&lt;region_1_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></li><li class="listitem"><div class="para">
					Copy the account, user, and domain tables from the region 1 database to the region 2 database.
				</div><div class="para">
					In the following commands, it is assumed that you have set the root
 password on the database, which is a CloudStack recommended best 
practice. Substitute your own MySQL root password.
				</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
							First, run this command to copy the contents of the database:
						</div><pre class="programlisting"># mysqldump -u root -p&lt;mysql_password&gt; -h &lt;region1_db_host&gt; cloud account user domain &gt; region1.sql</pre></li><li class="listitem"><div class="para">
							Then run this command to put the data onto the region 2 database:
						</div><pre class="programlisting"># mysql -u root -p&lt;mysql_password&gt; -h &lt;region2_db_host&gt; cloud &lt; region1.sql</pre></li></ol></div></li><li class="listitem"><div class="para">
					Remove project accounts. Run these commands on the region 2 database:
				</div><pre class="programlisting">mysql&gt; delete from account where type = 5;</pre></li><li class="listitem"><div class="para">
					Set the default zone as null:
				</div><pre class="programlisting">mysql&gt; update account set default_zone_id = null;</pre></li><li class="listitem"><div class="para">
					Restart the Management Servers in region 2.
				</div></li></ol></div></div><div class="section" id="region-add-n"><div class="titlepage"><div><div><h3 class="title">7.2.3.&nbsp;Adding Third and Subsequent Regions</h3></div></div></div><div class="para">
			To add the third region, and subsequent additional regions, the steps
 are similar to those for adding the second region. However, you must 
repeat certain steps additional times for each additional region:
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Install CloudStack in each additional region. Set the region ID for each region during the database setup step.
				</div><pre class="programlisting">cloudstack-setup-databases cloud:&lt;dbpassword&gt;@localhost --deploy-as=root:&lt;password&gt; -e &lt;encryption_type&gt; -m &lt;management_server_key&gt; -k &lt;database_key&gt; -r &lt;region_id&gt;</pre></li><li class="listitem"><div class="para">
					Once the Management Server is running, add your new region to all 
existing regions by repeatedly calling the API command addRegion. For 
example, if you were adding region 3:
				</div><pre class="programlisting">http://&lt;IP_of_region_1_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=3&amp;name=Eastern&amp;endpoint=http://&lt;region_3_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D

http://&lt;IP_of_region_2_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=3&amp;name=Eastern&amp;endpoint=http://&lt;region_3_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></li><li class="listitem"><div class="para">
					Repeat the procedure in reverse to add all existing regions to the 
new region. For example, for the third region, add the other two 
existing regions:
				</div><pre class="programlisting">http://&lt;IP_of_region_3_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=1&amp;name=Northern&amp;endpoint=http://&lt;region_1_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D

http://&lt;IP_of_region_3_Management_Server&gt;:8080/client/api?command=addRegion&amp;id=2&amp;name=Western&amp;endpoint=http://&lt;region_2_IP_address_here&gt;:8080/client&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></li><li class="listitem"><div class="para">
					Copy the account, user, and domain tables from any existing region's database to the new region's database.
				</div><div class="para">
					In the following commands, it is assumed that you have set the root
 password on the database, which is a CloudStack recommended best 
practice. Substitute your own MySQL root password.
				</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
							First, run this command to copy the contents of the database:
						</div><pre class="programlisting"># mysqldump -u root -p&lt;mysql_password&gt; -h &lt;region1_db_host&gt; cloud account user domain &gt; region1.sql</pre></li><li class="listitem"><div class="para">
							Then run this command to put the data onto the new region's database. For example, for region 3:
						</div><pre class="programlisting"># mysql -u root -p&lt;mysql_password&gt; -h &lt;region3_db_host&gt; cloud &lt; region1.sql</pre></li></ol></div></li><li class="listitem"><div class="para">
					Remove project accounts. Run these commands on the region 2 database:
				</div><pre class="programlisting">mysql&gt; delete from account where type = 5;</pre></li><li class="listitem"><div class="para">
					Set the default zone as null:
				</div><pre class="programlisting">mysql&gt; update account set default_zone_id = null;</pre></li><li class="listitem"><div class="para">
					Restart the Management Servers in the new region.
				</div></li></ol></div></div><div class="section" id="region-delete"><div class="titlepage"><div><div><h3 class="title">7.2.4.&nbsp;Deleting a Region</h3></div></div></div><div class="para">
			To delete a region, use the API command removeRegion. Repeat the call
 to remove the region from all other regions. For example, to remove the
 3rd region in a three-region cloud:
		</div><pre class="programlisting">http://&lt;IP_of_region_1_Management_Server&gt;:8080/client/api?command=removeRegion&amp;id=3&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D

http://&lt;IP_of_region_2_Management_Server&gt;:8080/client/api?command=removeRegion&amp;id=3&amp;apiKey=miVr6X7u6bN_sdahOBpjNejPgEsT35eXq-jB8CG20YI3yaxXcgpyuaIRmFI_EJTVwZ0nUkkJbPmY3y2bciKwFQ&amp;signature=Lxx1DM40AjcXU%2FcaiK8RAP0O1hU%3D</pre></div></div><div xml:lang="zh-CN" class="section" id="zone-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.3.&nbsp;创​建​Zone</h2></div></div></div><div class="para">
		以​上​安​装​步​骤​如​果​全​部​完​成​，登​录​WEB UI
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				（可​选​）
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						以​管​理​员​身​份​登​录​进​入​CloudStack 用​户​界​面​。​
					</div></li><li class="listitem"><div class="para">
						If this is your first time visiting the UI, you will see the 
guided tour splash screen. Choose “​Experienced user.”​ The Dashboard 
appears.
					</div></li><li class="listitem"><div class="para">
						在​左​侧​导​航​栏​，点​击​ 全​局​设​置​
					</div></li><li class="listitem"><div class="para">
						In the search box, type swift.enable and click the search button.
					</div></li><li class="listitem"><div class="para">
						Click the edit button and set swift.enable to true. 
						<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="edit-icon.png: button to modify data"></span>

					</div></li><li class="listitem"><div class="para">
						重​启​管​理​服​务​器​.
					</div><pre class="programlisting"># service cloudstack-management restart</pre></li><li class="listitem"><div class="para">
						Refresh the CloudStack UI browser tab and log back in.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure.
			</div></li><li class="listitem"><div class="para">
				On Zones, click View More.
			</div></li><li class="listitem"><div class="para">
				(Optional) If you are using Swift storage, click Enable Swift. Provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>URL.</strong></span> The Swift URL.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account.</strong></span> The Swift account.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> The Swift account’​s username.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Key.</strong></span> The Swift key.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add Zone. The zone creation wizard will appear.
			</div></li><li class="listitem"><div class="para">
				Choose one of the following network types:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Basic.</strong></span> For 
AWS-style networking. Provides a single network where each VM instance 
is assigned an IP directly from the network. Guest isolation can be 
provided through layer-3 means such as security groups (IP address 
source filtering).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Advanced.</strong></span> For more
 sophisticated network topologies. This network model provides the most 
flexibility in defining guest networks and providing custom network 
offerings such as firewall, VPN, or load balancer support.
					</div></li></ul></div><div class="para">
				For more information about the network types, see <a class="xref" href="#about-physical-networks">第&nbsp;2.8&nbsp;节 “关​于​物​理​网​络​”</a>.
			</div></li><li class="listitem"><div class="para">
				The rest of the steps differ depending on whether you chose Basic or Advanced. Continue with the steps that apply to you:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<a class="xref" href="#basic-zone-configuration">第&nbsp;7.3.1&nbsp;节 “基​础​区​域​配​置​”</a>
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="#advanced-zone-configuration">第&nbsp;7.3.2&nbsp;节 “高​级​资​源​域​配​置​”</a>
					</div></li></ul></div></li></ol></div><div xml:lang="zh-CN" class="section" id="basic-zone-configuration" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.3.1.&nbsp;基​础​区​域​配​置​</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				你​在​添​加​区​域​向​导​中​选​择​ ”​基​础​ “​后​，点​击​下​一​步​，你​将​被​询​问​输​入​以​下​细​节​，接​着​点​击​ 下​一​步​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						名​字​，区​域​名​字​
					</div></li><li class="listitem"><div class="para">
						dns 1和​2 ， 
区​域​中​来​宾​虚​拟​机​的​dns服​务​器​，通​过​你​后​面​添​加​的​公​共​网​络​访​问​dns服​务​器​。​区​域​中
​的​公​共​ip地​址​必​须​有​通​向​已​定​义​dns服​务​器​的​路​由​。​
					</div></li><li class="listitem"><div class="para">
						内​部​dns1和​内​部​dns2. 这​些​dns是​被​区​域​中​系​统​vm(这​些​CloudStack 
虚​拟​机​主​机​：它​自​己​。​例​如​虚​拟​路​由​器​，console代​理​和​辅​助​存​储​虚​拟​机​)使​用​的​。​\n
系​统​虚​拟​机​通​过​管​理​流​量​网​络​接​口​访​问​这​些​dns服​务​器​。​pod私​有​地​址​必​须​有​通​向​已​
定​义​dns服​务​器​的​路​由​
					</div></li><li class="listitem"><div class="para">
						hypersior(3.0.1版​本​中​以​介​绍​).选​择​区​域​中​第​一​个​集​群​的​虚​拟​化​方​案​。​在​你​完​成​区​域​添​加​后​，你​可​以​添​加​使​用​不​同​虚​拟​化​方​案​的​集​群​。​
					</div></li><li class="listitem"><div class="para">
						网​络​方​案​。​ 你​的​选​择​决​定​了​来​宾​虚​拟​机​可​以​使​用​的​网​络​服​务​。​
					</div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="50%"><col class="c2" align="left" width="50%"></colgroup><thead><tr><th class="" align="left">
										<div class="para">
											ç½ç»æ¹æ¡
										</div>
									</th><th class="" align="left">
										<div class="para">
											è¯´æ
										</div>
									</th></tr></thead><tbody><tr><td class="" align="left">
										<div class="para">
											DefaultSharedNetworkOfferingWithSGService
										</div>
									</td><td class="" align="left">
										<div class="para">
											如​果​你​打​算​使​用​安​全​组​进​行​来​宾​流​量​隔​离​，选​择​：(参​考​ 使​用​安​全​组​控​制​虚​拟​机​流​量​)
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											DefaultSharedNetworkOffering
										</div>
									</td><td class="" align="left">
										<div class="para">
											如​果​你​不​需​要​安​全​组​，选​择​：
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											DefaultSharedNetscalerEIPandELBNetworkOffering
										</div>
									</td><td class="" align="left">
										<div class="para">
											你​如​果​在​你​区​域​网​络​中​安​装​了​ Citrix NetScaler appliance 
，你​打​算​使​用​它​的​弹​性​ip和​弹​性​负​载​特​性​，就​选​择​它​。​通​过​EIP and 
ELB特​性​，区​域​中​的​安​全​组​可​以​提​供​1:1静​态​NAT和​负​载​。​
										</div>
									</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
						网​络​域​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public.</strong></span> A public 
zone is available to all users. A zone that is not public will be 
assigned to a particular domain. Only users in that domain will be 
allowed to create guest VMs in this zone.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose which traffic types will be carried by the physical network.
			</div><div class="para">
				The traffic types are management, public, guest, and storage 
traffic. For more information about the types, roll over the icons to 
display their tool tips, or see Basic Zone Network Traffic Types. This 
screen starts out with some traffic types already assigned. To add more,
 drag and drop traffic types onto the network. You can also change the 
network name if desired.
			</div></li><li class="listitem"><div class="para">
				3. (Introduced in version 3.0.1) Assign a network traffic label to 
each traffic type on the physical network. These labels must match the 
labels you have already defined on the hypervisor host. To assign each 
label, click the Edit button under the traffic type icon. A popup dialog
 appears where you can type the label, then click OK.
			</div><div class="para">
				These traffic labels will be defined only for the hypervisor 
selected for the first cluster. For all other hypervisors, the labels 
can be configured after the zone is created.
			</div></li><li class="listitem"><div class="para">
				Click Next.
			</div></li><li class="listitem"><div class="para">
				(NetScaler only) If you chose the network offering for NetScaler, 
you have an additional screen to fill out. Provide the requested details
 to set up the NetScaler, then click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IP address.</strong></span> The NSIP (NetScaler IP) address of the NetScaler device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username/Password.</strong></span> The authentication credentials to access the device. CloudStack uses these credentials to access the device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Type.</strong></span> NetScaler 
device type that is being added. It could be NetScaler VPX, NetScaler 
MPX, or NetScaler SDX. For a comparison of the types, see About Using a 
NetScaler Load Balancer.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public interface.</strong></span> Interface of NetScaler that is configured to be part of the public network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private interface.</strong></span> Interface of NetScaler that is configured to be part of the private network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Number of retries.</strong></span> Number of times to attempt a command on the device before considering the operation failed. Default is 2.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Capacity.</strong></span> Number of guest networks/accounts that will share this NetScaler device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Dedicated.</strong></span> When 
marked as dedicated, this device will be dedicated to a single account. 
When Dedicated is checked, the value in the Capacity field has no 
significance –​ implicitly, its value is 1.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				(NetScaler only) Configure the IP range for public traffic. The IPs 
in this range will be used for the static NAT capability which you 
enabled by selecting the network offering for NetScaler with EIP and 
ELB. Enter the following details, then click Add. If desired, you can 
repeat this step to add more IP ranges. When done, click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway.</strong></span> The gateway in use for these IP addresses.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask.</strong></span> The netmask associated with this IP range.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN.</strong></span> The VLAN that will be used for public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start IP/End IP.</strong></span> A range of IP addresses that are assumed to be accessible from the Internet and will be allocated for access to guest VMs.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new zone, CloudStack adds the first pod for you. You can always
 add more pods later. For an overview of what a pod is, see <a class="xref" href="#about-pods">第&nbsp;2.3&nbsp;节 “关​于​POD”</a>.
			</div><div class="para">
				To configure the first pod, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Pod Name.</strong></span> A name for the pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system gateway.</strong></span> The gateway for the hosts in that pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system netmask.</strong></span> The network prefix that defines the pod's subnet. Use CIDR notation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start/End Reserved System IP.</strong></span>
 The IP range in the management network that CloudStack uses to manage 
various system VMs, such as Secondary Storage VMs, Console Proxy VMs, 
and DHCP. For more information, see System Reserved IP Addresses.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Configure the network for guest traffic. Provide the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest gateway.</strong></span> The gateway that the guests should use.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest netmask.</strong></span> The netmask in use on the subnet the guests will use.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest start IP/End IP.</strong></span> Enter the first and last IP addresses that define a range that CloudStack can assign to guests.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								We strongly recommend the use of multiple NICs. If multiple NICs are used, they may be in a different subnet.
							</div></li><li class="listitem"><div class="para">
								If one NIC is used, these IPs should be in the same CIDR as the pod CIDR.
							</div></li></ul></div></li></ul></div></li><li class="listitem"><div class="para">
				In a new pod, CloudStack adds the first cluster for you. You can 
always add more clusters later. For an overview of what a cluster is, 
see About Clusters.
			</div><div class="para">
				To configure the first cluster, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> 
(Version 3.0.0 only; in 3.0.1, this field is read only) Choose the type 
of hypervisor software that all hosts in this cluster will run. If you 
choose VMware, additional fields appear so you can give information 
about a vSphere cluster. For vSphere servers, we recommend creating the 
cluster of hosts in vCenter and then adding the entire cluster to 
CloudStack. See Add Cluster: vSphere.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Cluster name.</strong></span> Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first host for you. You can 
always add more hosts later. For an overview of what a host is, see 
About Hosts.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					When you add a hypervisor host to CloudStack, the host must not have any VMs already running.
				</div></div></div><div class="para">
				Before you can configure the host, you need to install the 
hypervisor software on the host. You will need to know which version of 
the hypervisor software version is supported by CloudStack and what 
additional configuration is required to ensure the host will work with 
CloudStack. To find these installation details, see:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Citrix XenServer Installation and Configuration
					</div></li><li class="listitem"><div class="para">
						VMware vSphere 安​装​和​配​置​
					</div></li><li class="listitem"><div class="para">
						KVM vSphere Installation and Configuration
					</div></li></ul></div><div class="para">
				To configure the first host, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Name.</strong></span> The DNS name or IP address of the host.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> The username is root.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password.</strong></span> This is the password for the user named above (from your XenServer or KVM install).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags.</strong></span> 
(Optional) Any labels that you use to categorize hosts for ease of 
maintenance. For example, you can set this to the cloud's HA tag (set in
 the ha.tag global configuration parameter) if you want this host to be 
used only for VMs with the "high availability" feature enabled. For more
 information, see HA-Enabled Virtual Machines as well as HA for Hosts.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first primary storage server 
for you. You can always add more servers later. For an overview of what 
primary storage is, see About Primary Storage.
			</div><div class="para">
				To configure the first primary storage server, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol.</strong></span> For 
XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS, 
SharedMountPoint,CLVM, or RBD. For vSphere choose either VMFS (iSCSI or 
FiberChannel) or NFS. The remaining fields in the screen vary depending 
on what you choose here.
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="advanced-zone-configuration" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.3.2.&nbsp;高​级​资​源​域​配​置​</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​添​加​域​向​导​中​选​择​了​高​级​并​且​点​击​下​一​步​之​后​，你​会​被​要​求​输​入​下​列​信​息​。​然​后​点​击​下​一​步​。​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>名​称​.</strong></span> 一​个​区​域​的​名​称​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS 1 和​ 2.</strong></span> 
这​些​DNS服​务​器​是​给​在​域​中​的​客​户​虚​拟​机​使​用​的​。​这​些​DNS服​务​器​可​以​通​过​稍​后​添​加​
的​公​共​网​络​访​问​。​这​个​域​的​公​共​IP 
地​址​必​须​有​一​个​路​由​到​在​这​里​指​定​的​DNS服​务​器​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>内​部​ DNS 1 and 内​部​ DNS 2.</strong></span>
 这​些​DNS 
服​务​器​给​域​中​的​系​统​虚​拟​机​使​用​。​(这​些​系​统​虚​拟​机​是​CloudStack自​己​使​用​的​，例​如​
虚​拟​路​由​，控​制​代​理​和​辅​助​存​储​虚​拟​机​。​)这​些​DNS服​务​器​可​以​通​过​系​统​虚​拟​机​管​理​网
​络​接​口​访​问​。​你​提​供​给​机​架​的​私​有​IP地​址​必​须​有​一​个​路​由​到​在​这​里​指​定​的​内​部​DNS
服​务​器​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Domain.</strong></span> (Optional) If you want to assign a special domain name to the guest VM network, specify the DNS suffix.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>来​宾​ CIDR.</strong></span> CIDR 
描​述​了​使​用​在​来​宾​虚​拟​网​络​的​IP地​址​在​这​个​区​域​中​。​例​如​，10.1.1.0/24。​作​为​一​个​
好​的​实​践​你​应​该​设​置​不​同​的​CIDR给​不​同​的​区​域​。​这​会​更​容​易​去​设​置​VPN在​不​同​的​区​域
​之​间​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> (Introduced in version 3.0.1) 选​择​hypervisor 给​区​域​的​第​一​个​集​群​。​ 之​后​你​可​以​添​加​集​群​用​不​同​的​hypervisors, 在​完​成​添​加​区​域​之​后​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>公​共​.</strong></span> 
一​个​公​共​的​区​域​是​对​所​有​用​户​有​效​的​。​一​个​不​公​开​的​区​域​会​被​安​排​给​一​个​特​别​的​域​
。​只​有​在​那​个​域​的​用​户​才​能​被​允​许​建​立​来​宾​虚​拟​机​在​这​个​区​域​里​。​
					</div></li></ul></div></li><li class="listitem"><div class="para">
				选​择​哪​种​通​信​类​型​
			</div><div class="para">
				通​信​类​型​是​管​理​，公​共​，来​宾​和​存​储​通​信​。​更​多​的​关​于​类​型​的​信​息​，覆​盖​到​相​应​的​图​标​会​显​示​他​们​的​工​具​提​示​，或​者​参​考​<a class="xref" href="#advanced-zone-network-traffic-types">第&nbsp;2.8.3&nbsp;节 “高​级​区​域​网​络​流​量​类​型​”</a>。
​这​个​界​面​初​始​时​一​个​网​络​已​经​被​配​置​了​。​如​果​你​有​多​个​物​理​网​络​，你​需​要​添​加​多​个​
。​拖​拽​或​者​删​除​通​信​类​型​对​一​个​灰​色​的​网​络​，它​会​被​激​活​。​你​可​以​移​动​通​信​图​标​从​一
​个​网​络​到​另​一​个​；例​如​，如​果​默​认​的​通​信​类​型​显​示​在​网​络​1的​不​匹​配​你​的​实​际​设​置​，你
​可​以​把​他​们​拉​下​来​。​你​也​可​以​改​变​网​络​名​按​照​你​期​望​的​。​
			</div></li><li class="listitem"><div class="para">
				(3.0.1 版​本​中​介​绍​) 
安​排​一​个​网​络​通​信​标​识​给​每​个​通​信​类​型​在​每​个​物​理​网​络​上​。​这​些​标​识​必​须​匹​配​你​已​
经​定​义​在​hypervisor主​机​上​的​标​识​。​安​排​每​个​标​识​，点​击​编​辑​按​钮​在​通​信​类​型​图​标​下
​，一​个​弹​出​的​对​话​框​显​示​出​来​，你​可​以​输​入​标​识​，然​后​点​击​确​定​。​
			</div><div class="para">
				这​些​通​信​标​识​被​定​义​只​有​hypervisor被​选​中​给​第​一​集​群​的​时​候​。​对​于​所​有​其​它​hypervisor,那​些​标​识​能​够​被​配​置​在​区​域​建​立​好​以​后​。​
			</div></li><li class="listitem"><div class="para">
				点​击​下​一​步​。​
			</div></li><li class="listitem"><div class="para">
				
配​置​IP地​址​段​给​公​共​的​Internet通​信​。​输​入​下​面​详​细​信​息​，然​后​点​击​添​加​。​如​果​有​需
​要​，你​可​以​重​复​这​步​添​加​更​多​的​公​共​Internet IP 段​。​完​成​后​，点​击​下​一​步​。​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>网​关​.</strong></span>网​关​使​用​为​这​些​IP地​址​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>子​网​掩​码​.</strong></span> 和​这​个​IP地​址​段​相​关​的​子​网​掩​码​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN.</strong></span> VLAN 会​被​用​到​公​共​通​信​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>开​始​ IP/结​束​ IP.</strong></span> 一​个​IP地​址​段​被​安​排​
					</div></li></ul></div></li><li class="listitem"><div class="para">
				在​新​的​区​域​中​，CloudStack添​加​第​一​个​机​架​。​你​可​以​添​加​更​多​的​机​架​在​以​后​。​关​于​什​么​是​机​架​，请​参​考​<a class="xref" href="#about-pods">第&nbsp;2.3&nbsp;节 “关​于​POD”</a>
			</div><div class="para">
				配​置​第​一​个​机​架​，输​入​下​面​信​息​，然​后​点​击​下​一​步​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>机​架​名​称​.</strong></span> 机​架​的​命​名​.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system gateway.</strong></span> 这​个​网​关​是​给​在​机​架​中​的​主​机​使​用​的​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>预​留​系​统​网​络​掩​码​.</strong></span> 定​义​给​机​架​的​子​网​前​缀​。​ 使​用​CIDR形​式​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>开​始​/结​束​ 预​留​系​统​IP.</strong></span> 管​理​网​络​中​的​IP地​址​段​，CloudStack 用​来​管​理​各​种​系​统​虚​拟​机​, 例​如​辅​助​存​储​系​统​虚​拟​机​,控​制​代​理​系​统​虚​拟​机​和​DHCP.更​多​信​息​请​参​考​ <a class="xref" href="#system-reserved-ip-addresses">第&nbsp;2.8.6&nbsp;节 “System Reserved IP Addresses”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Specify a range of VLAN IDs to carry guest traffic for each physical
 network (see VLAN Allocation Example ), then click Next.
			</div></li><li class="listitem"><div class="para">
				In a new pod, CloudStack adds the first cluster for you. You can 
always add more clusters later. For an overview of what a cluster is, 
see <a class="xref" href="#about-clusters">第&nbsp;2.4&nbsp;节 “关​于​集​群​”</a>.
			</div><div class="para">
				To configure the first cluster, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> 
(Version 3.0.0 only; in 3.0.1, this field is read only) Choose the type 
of hypervisor software that all hosts in this cluster will run. If you 
choose VMware, additional fields appear so you can give information 
about a vSphere cluster. For vSphere servers, we recommend creating the 
cluster of hosts in vCenter and then adding the entire cluster to 
CloudStack. See Add Cluster: vSphere .
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Cluster name.</strong></span> Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first host for you. You can 
always add more hosts later. For an overview of what a host is, see <a class="xref" href="#about-hosts">第&nbsp;2.5&nbsp;节 “关​于​宿​主​机​”</a>.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					When you deploy CloudStack, the hypervisor host must not have any VMs already running.
				</div></div></div><div class="para">
				
在​你​能​配​置​主​机​之​前​，你​需​要​安​装​虚​拟​机​管​理​软​件​在​主​机​上​。​你​需​要​知​道​哪​个​虚​拟​机
​管​理​软​件​版​本​被​支​持​，并​且​额​外​的​配​置​信​息​是​需​要​确​认​主​机​是​否​会​和​CloudStack好​
好​工​作​。​这​些​安​装​详​细​信​息​请​参​考​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Citrix XenServer 安​装​为​了​ CloudStack
					</div></li><li class="listitem"><div class="para">
						VMware vSphere 安​装​和​配​置​
					</div></li><li class="listitem"><div class="para">
						KVM 安​装​和​配​置​
					</div></li></ul></div><div class="para">
				配​置​第​一​个​主​机​，输​入​下​列​信​息​，然​后​点​击​下​一​步​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Name.</strong></span> The DNS name or IP address of the host.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> Usually root.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password.</strong></span> This is the password for the user named above (from your XenServer or KVM install).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags.</strong></span> 
(Optional) Any labels that you use to categorize hosts for ease of 
maintenance. For example, you can set to the cloud's HA tag (set in the 
ha.tag global configuration parameter) if you want this host to be used 
only for VMs with the "high availability" feature enabled. For more 
information, see HA-Enabled Virtual Machines as well as HA for Hosts, 
both in the Administration Guide.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first primary storage server 
for you. You can always add more servers later. For an overview of what 
primary storage is, see <a class="xref" href="#about-primary-storage">第&nbsp;2.6&nbsp;节 “关​于​主​存​储​”</a>.
			</div><div class="para">
				To configure the first primary storage server, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol.</strong></span> For 
XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS, 
SharedMountPoint, CLVM, and RBD. For vSphere choose either VMFS (iSCSI 
or FiberChannel) or NFS. The remaining fields in the screen vary 
depending on what you choose here.
					</div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="50%"><col class="c2" align="left" width="50%"></colgroup><tbody><tr><td class="" align="left">
										<div class="para">
											NFS
										</div>
									</td><td class="" align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Path.</strong></span> The exported path from the server.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span>
 The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
										</div>

									</td></tr><tr><td class="" align="left">
										<div class="para">
											iSCSI
										</div>
									</td><td class="" align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Target IQN.</strong></span> The IQN of the target. For example, iqn.1986-03.com.sun:02:01ec9bb549-1271378984.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Lun.</strong></span> The LUN number. For example, 3.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span>
 The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
										</div>

									</td></tr><tr><td class="" align="left">
										<div class="para">
											预​设​置​
										</div>
									</td><td class="" align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>SR Name-Label.</strong></span> 输​入​已​经​安​装​在​CloudStack之​外​的​SR名​称​标​识​。​
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span>
 The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
										</div>

									</td></tr><tr><td class="" align="left">
										<div class="para">
											SharedMountPoint
										</div>
									</td><td class="" align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>路​径​.</strong></span> 主​存​储​被​挂​载​到​每​个​主​机​上​的​路​径​。​例​如​, "/mnt/primary".
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span>
 The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
										</div>

									</td></tr><tr><td class="" align="left">
										<div class="para">
											VMFS
										</div>
									</td><td class="" align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>服​务​器​.</strong></span> vCenter服​务​器​的​IP地​址​或​者​是​DNS名​称​。​
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>路​径​.</strong></span> 一​个​数​据​中​心​和​数​据​存​储​合​并​的​名​称​。​格​式​是​ "/" 数​据​中​心​名​ "/" 数​据​存​储​名​。​例​如​, "/cloud.dc.VM/cluster1datastore".
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span>
 The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
										</div>

									</td></tr></tbody></table></div></li></ul></div></li><li class="listitem"><div class="para">
				在​这​个​新​区​域​中​，CloudStack添​加​第​一​个​辅​助​存​储​服​务​器​给​你​。​对​于​辅​助​存​储​概​览​，请​参​考​<a class="xref" href="#about-secondary-storage">第&nbsp;2.7&nbsp;节 “关​与​辅​助​存​储​”</a>。​
			</div><div class="para">
				在​你​填​写​这​个​界​面​之​前​，你​需​要​提​前​准​备​好​辅​助​存​储​通​过​设​置​NFS共​享​并​且​安​装​最​新​版​本​的​CloudStack系​统​虚​拟​机​模​板​。​参​考​添​加​辅​助​存​储​。​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>NFS Server.</strong></span> The IP address of the server or fully qualified domain name of the server.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Path.</strong></span> The exported path from the server.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​启​动​。​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="pod-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.4.&nbsp;添​加​一​个​机​架​</h2></div></div></div><div class="para">
		When you created a new zone, CloudStack adds the first pod for you. 
You can add more pods at any time using the procedure in this section.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI. See <a class="xref" href="#log-in">第&nbsp;5.1&nbsp;节 “登​陆​到​用​户​界​面​”</a>.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View 
More, then click the zone to which you want to add a pod.
			</div></li><li class="listitem"><div class="para">
				Click the Compute and Storage tab. In the Pods node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click Add Pod.
			</div></li><li class="listitem"><div class="para">
				Enter the following details in the dialog.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway.</strong></span> The gateway for the hosts in that pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask.</strong></span> The network prefix that defines the pod's subnet. Use CIDR notation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start/End Reserved System IP.</strong></span>
 The IP range in the management network that CloudStack uses to manage 
various system VMs, such as Secondary Storage VMs, Console Proxy VMs, 
and DHCP. For more information, see System Reserved IP Addresses.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="cluster-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.5.&nbsp;添​加​集​群​</h2></div></div></div><div class="para">
		你​需​要​告​诉​CloudStack 它​要​管​理​的​主​机​。​主​机​存​在​于​集​群​中​，所​以​在​你​开​始​加​入​主​机​到​云​中​之​前​，你​必​须​增​加​至​少​一​个​集​群​。​
	</div><div xml:lang="zh-CN" class="section" id="add-clusters-kvm-xenserver" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.5.1.&nbsp;Add Cluster: KVM or XenServer</h3></div></div></div><div class="para">
		These steps assume you have already installed the hypervisor on the hosts and logged in to the CloudStack UI.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View 
More, then click the zone in which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				点​击​计​算​标​签​。​
			</div></li><li class="listitem"><div class="para">
				In the Clusters node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click Add Cluster.
			</div></li><li class="listitem"><div class="para">
				Choose the hypervisor type for this cluster.
			</div></li><li class="listitem"><div class="para">
				Choose the pod in which you want to create the cluster.
			</div></li><li class="listitem"><div class="para">
				Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-clusters-vsphere" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.5.2.&nbsp;Add Cluster: vSphere</h3></div></div></div><div class="para">
		Host management for vSphere is done through a combination of vCenter 
and the CloudStack admin UI. CloudStack requires that all hosts be in a 
CloudStack cluster, but the cluster may consist of a single host. As an 
administrator you must decide if you would like to use clusters of one 
host or of multiple hosts. Clusters of multiple hosts allow for features
 like live migration. Clusters also require shared storage such as NFS 
or iSCSI.
	</div><div class="para">
		For vSphere servers, we recommend creating the cluster of hosts in 
vCenter and then adding the entire cluster to CloudStack. Follow these 
requirements:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Do not put more than 8 hosts in a vSphere cluster
			</div></li><li class="listitem"><div class="para">
				Make sure the hypervisor hosts do not have any VMs already running before you add them to CloudStack.
			</div></li></ul></div><div class="para">
		To add a vSphere cluster to CloudStack:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Create the cluster of hosts in vCenter. Follow the vCenter 
instructions to do this. You will create a cluster that looks something 
like this in vCenter.
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/vsphere-client.png" alt="vsphereclient.png: vSphere client" width="444"></div></li><li class="listitem"><div class="para">
				Log in to the UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View 
More, then click the zone in which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				Click the Compute tab, and click View All on Pods. Choose the pod to which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				Click View Clusters.
			</div></li><li class="listitem"><div class="para">
				Click Add Cluster.
			</div></li><li class="listitem"><div class="para">
				In Hypervisor, choose VMware.
			</div></li><li class="listitem"><div class="para">
				Provide the following information in the dialog. The fields below make reference to values from vCenter.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Cluster Name. Enter the name of the cluster you created in vCenter. For example, "cloud.cluster.2.2.1"
					</div></li><li class="listitem"><div class="para">
						vCenter Host. Enter the hostname or IP address of the vCenter server.
					</div></li><li class="listitem"><div class="para">
						vCenter Username. Enter the username that CloudStack should use to
 connect to vCenter. This user must have all administrative privileges.
					</div></li><li class="listitem"><div class="para">
						vCenter Password. Enter the password for the user named above
					</div></li><li class="listitem"><div class="para">
						vCenter Datacenter. Enter the vCenter datacenter that the cluster is in. For example, "cloud.dc.VM".
					</div></li><li class="listitem"><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-cluster.png" alt="addcluster.png: add cluster"></div><div class="para">
						There might be a slight delay while the cluster is provisioned. It will automatically display in the UI
					</div></li></ul></div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="host-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.6.&nbsp;Adding a Host</h2></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Before adding a host to the CloudStack configuration, you must first
 install your chosen hypervisor on the host. CloudStack can manage hosts
 running VMs under a variety of hypervisors.
			</div><div class="para">
				The CloudStack Installation Guide provides instructions on how to 
install each supported hypervisor and configure it for use with 
CloudStack. See the appropriate section in the Installation Guide for 
information about which version of your chosen hypervisor is supported, 
as well as crucial additional steps to configure the hypervisor hosts 
for use with CloudStack.
			</div><div class="warning"><div class="admonition_header"><h2>警告</h2></div><div class="admonition"><div class="para">
					Be sure you have performed the additional CloudStack-specific 
configuration steps described in the hypervisor installation section for
 your particular hypervisor.
				</div></div></div></li><li class="listitem"><div class="para">
				Now add the hypervisor host to CloudStack. The technique to use varies depending on the hypervisor.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<a class="xref" href="#host-add-xenserver-kvm-ovm">第&nbsp;7.6.1&nbsp;节 “Adding a Host (XenServer or KVM)”</a>
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="#host-add-vsphere">第&nbsp;7.6.2&nbsp;节 “增​加​一​台​主​机​(vSphere)”</a>
					</div></li></ul></div></li></ol></div><div xml:lang="zh-CN" class="section" id="host-add-xenserver-kvm-ovm" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.6.1.&nbsp;Adding a Host (XenServer or KVM)</h3></div></div></div><div class="para">
		XenServer and KVM hosts can be added to a cluster at any time.
	</div><div class="section" id="idm4231744"><div class="titlepage"><div><div><h4 class="title" id="idm4231744">7.6.1.1.&nbsp;Requirements for XenServer and KVM Hosts</h4></div></div></div><div class="warning"><div class="admonition_header"><h2>警告</h2></div><div class="admonition"><div class="para">
				Make sure the hypervisor host does not have any VMs already running before you add it to CloudStack.
			</div></div></div><div class="para">
			Configuration requirements:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Each cluster must contain only hosts with the identical hypervisor.
				</div></li><li class="listitem"><div class="para">
					For XenServer, do not put more than 8 hosts in a cluster.
				</div></li><li class="listitem"><div class="para">
					For KVM, do not put more than 16 hosts in a cluster.
				</div></li></ul></div><div class="para">
			For hardware requirements, see the installation section for your hypervisor in the CloudStack Installation Guide.
		</div><div class="section" id="idp11430560"><div class="titlepage"><div><div><h5 class="title" id="idp11430560">7.6.1.1.1.&nbsp;XenServer Host Additional Requirements</h5></div></div></div><div class="para">
				If network bonding is in use, the administrator must cable the new host identically to other hosts in the cluster.
			</div><div class="para">
				For all additional hosts to be added to the cluster, run the 
following command. This will cause the host to join the master in a 
XenServer pool.
			</div><pre class="programlisting"># xe pool-join master-address=[master IP] master-username=root master-password=[your password]</pre><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					当​拷​贝​粘​贴​一​条​命​令​, 确​保​在​运​行​前​粘​贴​的​命​令​在​一​行​上​. 一​些​文​档​查​看​器​可​能​会​在​拷​贝​时​引​入​不​希​望​的​换​行​符​.
				</div></div></div><div class="para">
				With all hosts added to the XenServer pool, run the cloud-setup-bond
 script. This script will complete the configuration and setup of the 
bonds on the new hosts in the cluster.
			</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						Copy the script from the Management Server in 
/usr/share/cloudstack-common/scripts/vm/hypervisor/xenserver/cloud-setup-bonding.sh
 to the master host and ensure it is executable.
					</div></li><li class="listitem"><div class="para">
						运​行​脚​本​。​
					</div><pre class="programlisting"># ./cloud-setup-bonding.sh</pre></li></ol></div></div><div class="section" id="idm5481776"><div class="titlepage"><div><div><h5 class="title" id="idm5481776">7.6.1.1.2.&nbsp;KVM Host Additional Requirements</h5></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						If shared mountpoint storage is in use, the administrator should 
ensure that the new host has all the same mountpoints (with storage 
mounted) as the other hosts in the cluster.
					</div></li><li class="listitem"><div class="para">
						Make sure the new host has the same network configuration (guest, 
private, and public network) as other hosts in the cluster.
					</div></li><li class="listitem"><div class="para">
						If you are using OpenVswitch bridges edit the file agent.properties on the KVM host and set the parameter <span class="italic italic">network.bridge.type</span> to <span class="italic italic">openvswitch</span> before adding the host to CloudStack
					</div></li></ul></div></div></div><div class="section" id="idp51054224"><div class="titlepage"><div><div><h4 class="title" id="idp51054224">7.6.1.2.&nbsp;Adding a XenServer or KVM Host</h4></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					If you have not already done so, install the hypervisor software on
 the host. You will need to know which version of the hypervisor 
software version is supported by CloudStack and what additional 
configuration is required to ensure the host will work with CloudStack. 
To find these installation details, see the appropriate section for your
 hypervisor in the CloudStack Installation Guide.
				</div></li><li class="listitem"><div class="para">
					以​管​理​员​身​份​登​录​进​入​CloudStack 用​户​界​面​。​
				</div></li><li class="listitem"><div class="para">
					In the left navigation, choose Infrastructure. In Zones, click View
 More, then click the zone in which you want to add the host.
				</div></li><li class="listitem"><div class="para">
					Click the Compute tab. In the Clusters node, click View All.
				</div></li><li class="listitem"><div class="para">
					Click the cluster where you want to add the host.
				</div></li><li class="listitem"><div class="para">
					Click View Hosts.
				</div></li><li class="listitem"><div class="para">
					Click Add Host.
				</div></li><li class="listitem"><div class="para">
					Provide the following information.
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Host Name. The DNS name or IP address of the host.
						</div></li><li class="listitem"><div class="para">
							Username. Usually root.
						</div></li><li class="listitem"><div class="para">
							Password. This is the password for the user from your XenServer or KVM install).
						</div></li><li class="listitem"><div class="para">
							Host Tags (Optional). Any labels that you use to categorize hosts
 for ease of maintenance. For example, you can set to the cloud's HA tag
 (set in the ha.tag global configuration parameter) if you want this 
host to be used only for VMs with the "high availability" feature 
enabled. For more information, see HA-Enabled Virtual Machines as well 
as HA for Hosts.
						</div></li></ul></div><div class="para">
					There may be a slight delay while the host is provisioned. It should automatically display in the UI.
				</div></li><li class="listitem"><div class="para">
					Repeat for additional hosts.
				</div></li></ul></div></div></div><div xml:lang="zh-CN" class="section" id="host-add-vsphere" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">7.6.2.&nbsp;增​加​一​台​主​机​(vSphere)</h3></div></div></div><div class="para">
		对​于​ vSphere 服​务​器​，我​们​建​议​在​vCenter 中​创​建​主​机​的​集​群​并​把​整​个​集​群​加​入​到​ CloudStack 中​。​见​ Add Cluster：vSphere。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="primary-storage-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.7.&nbsp;æ·»å&nbsp;ä¸»å­å¨</h2></div></div></div><div class="section" id="sys-require-primary-storage"><div class="titlepage"><div><div><h3 class="title">7.7.1.&nbsp;System Requirements for Primary Storage</h3></div></div></div><div class="para">
			Hardware requirements:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Any standards-compliant iSCSI or NFS server that is supported by the underlying hypervisor.
				</div></li><li class="listitem"><div class="para">
					The storage server should be a machine with a large number of 
disks. The disks should ideally be managed by a hardware RAID 
controller.
				</div></li><li class="listitem"><div class="para">
					Minimum required capacity depends on your needs.
				</div></li></ul></div><div class="para">
			When setting up primary storage, follow these restrictions:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Primary storage cannot be added until a host has been added to the cluster.
				</div></li><li class="listitem"><div class="para">
					If you do not provision shared primary storage, you must set the 
global configuration parameter system.vm.local.storage.required to true,
 or else you will not be able to start VMs.
				</div></li></ul></div></div><div class="section" id="adding-primary-storage"><div class="titlepage"><div><div><h3 class="title">7.7.2.&nbsp;Adding Primary Stroage</h3></div></div></div><div class="para">
			
当​你​建​立​一​个​新​的​区​域​的​时​候​，主​存​储​作​为​过​程​的​一​部​分​被​添​加​。​你​也​可​以​添​加​主​存
​储​在​任​何​时​候​，例​如​当​添​加​一​个​新​的​群​集​或​者​添​加​更​多​的​主​机​到​一​个​存​在​的​群​集​的​
时​候​。​
		</div><div class="warning"><div class="admonition_header"><h2>警告</h2></div><div class="admonition"><div class="para">
				Be sure there is nothing stored on the server. Adding the server to CloudStack will destroy any existing data.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Log in to the CloudStack UI (see <a class="xref" href="#log-in">第&nbsp;5.1&nbsp;节 “登​陆​到​用​户​界​面​”</a>).
				</div></li><li class="listitem"><div class="para">
					在​左​边​的​导​航​栏​，选​择​基​础​架​构​。​在​区​域​中​，点​击​查​看​全​部​，然​后​点​击​你​想​添​加​主​存​储​的​那​个​区​域​。​
				</div></li><li class="listitem"><div class="para">
					点​击​计​算​标​签​。​
				</div></li><li class="listitem"><div class="para">
					在​图​的​主​存​储​节​点​，点​击​查​看​所​有​。​
				</div></li><li class="listitem"><div class="para">
					点​击​添​加​主​存​储​。​
				</div></li><li class="listitem"><div class="para">
					在​对​话​框​中​提​供​下​面​的​信​息​。​
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Pod.</strong></span> The pod for the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Cluster.</strong></span> The cluster for the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Protocol.</strong></span> For 
XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS or
 SharedMountPoint. For vSphere choose either VMFS (iSCSI or 
FiberChannel) or NFS.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Server (for NFS, iSCSI, or PreSetup).</strong></span> The IP address or DNS name of the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Server (for VMFS).</strong></span> The IP address or DNS name of the vCenter server.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for NFS).</strong></span> In NFS this is the exported path from the server.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for VMFS).</strong></span> 
In vSphere this is a combination of the datacenter name and the 
datastore name. The format is "/" datacenter name "/" datastore name. 
For example, "/cloud.dc.VM/cluster1datastore".
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for SharedMountPoint).</strong></span> With KVM this is the path on each host that is where this primary storage is mounted. For example, "/mnt/primary".
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>SR Name-Label (for PreSetup).</strong></span> Enter the name-label of the SR that has been set up outside CloudStack.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Target IQN (for iSCSI).</strong></span> In iSCSI this is the IQN of the target. For example, iqn.1986-03.com.sun:02:01ec9bb549-1271378984.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Lun # (for iSCSI).</strong></span> In iSCSI this is the LUN number. For example, 3.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Tags (optional).</strong></span> 
The comma-separated list of tags for this storage device. It should be 
an equivalent set or superset of the tags on your disk offerings..
						</div></li></ul></div><div class="para">
					
在​一​个​区​（zone）内​的​多​个​集​群​所​拥​有​的​主​存​储​标​签​集​必​须​是​完​全​一​致​的​。​例​如​：如​果
​集​群​A提​供​主​存​储​有​标​签​T1和​T2，那​么​在​这​个​区​内​的​所​有​其​它​集​群​提​供​的​主​存​储​也​必
​须​有​标​签​T1和​T2。​
				</div></li><li class="listitem"><div class="para">
					点​击​ 确​定​。​
				</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="secondary-storage-add" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.8.&nbsp;æ·»å&nbsp;è¾å©å­å¨</h2></div></div></div><div class="section" id="sys-require-secondary-storage"><div class="titlepage"><div><div><h3 class="title">7.8.1.&nbsp;System Requirements for Secondary Storage</h3></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					NFS storage appliance or Linux NFS server
				</div></li><li class="listitem"><div class="para">
					(Optional) OpenStack Object Storage (Swift) (see http://swift.openstack.org)
				</div></li><li class="listitem"><div class="para">
					100GB minimum capacity
				</div></li><li class="listitem"><div class="para">
					A secondary storage device must be located in the same zone as the guest VMs it serves.
				</div></li><li class="listitem"><div class="para">
					Each Secondary Storage server must be available to all hosts in the zone.
				</div></li></ul></div></div><div class="section" id="adding-secondary-storage"><div class="titlepage"><div><div><h3 class="title">7.8.2.&nbsp;增​加​二​级​存​储​</h3></div></div></div><div class="para">
			When you create a new zone, the first secondary storage is added as 
part of that procedure. You can add secondary storage servers at any 
time to add more servers to an existing zone.
		</div><div class="warning"><div class="admonition_header"><h2>警告</h2></div><div class="admonition"><div class="para">
				Be sure there is nothing stored on the server. Adding the server to CloudStack will destroy any existing data.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					If you are going to use Swift for cloud-wide secondary storage, you
 must add the Swift storage to CloudStack before you add the local zone 
secondary storage servers. See <a class="xref" href="#zone-add">第&nbsp;7.3&nbsp;节 “创​建​Zone”</a>.
				</div></li><li class="listitem"><div class="para">
					To prepare for local zone secondary storage, you should have 
created and mounted an NFS share during Management Server installation. <span class="phrase">See Preparing NFS Shares in the Installation Guide.</span>
				</div></li><li class="listitem"><div class="para">
					Make sure you prepared the system VM template during Management Server installation. <span class="phrase">See Prepare the System VM Template in the Installation Guide.</span>
				</div></li><li class="listitem"><div class="para">
					Now that the secondary storage server for per-zone storage is 
prepared, add it to CloudStack. Secondary storage is added as part of 
the procedure for adding a new zone. See <a class="xref" href="#zone-add">第&nbsp;7.3&nbsp;节 “创​建​Zone”</a>.
				</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="initialize-and-test" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">7.9.&nbsp;初​始​化​和​测​试​</h2></div></div></div><div class="para">
		
所​有​内​容​配​置​好​之​后​，执​行​初​始​化​。​根​据​你​的​网​络​速​度​，大​概​花​费​30分​钟​或​更​长​时​间​
。​当​初​始​化​成​功​执​行​之​后​，管​理​面​板​会​在​CloudStack UI中​显​示​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				系​统​验​证​完​成​后​，在​左​边​的​导​航​栏​，选​择​模​版​，点​击​‘​ CentOS 5.5 (64bit) no Gui (KVM) template’​，在​下​载​完​成​前​不​要​做​下​一​步​操​作​。​
			</div></li><li class="listitem"><div class="para">
				进​入​‘​实​例​’​标​签​，查​看​我​的​实​例​。​
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​实​例​，进​入​导​航​。​
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						选​择​你​添​加​的​区​域​。​
					</div></li><li class="listitem"><div class="para">
						在​选​择​模​版​中​，选​择​要​在​虚​拟​机​中​使​用​的​模​版​，如​果​是​新​安​装​的​系​统​，只​有​CentOS模​版​供​选​择​。​
					</div></li><li class="listitem"><div class="para">
						选​择​计​算​方​案​，确​定​硬​件​环​境​允​许​启​动​你​选​择​的​计​算​方​案​。​
					</div></li><li class="listitem"><div class="para">
						
在​磁​盘​方​案​中​，如​果​需​要​，添​加​另​一​个​数​据​磁​盘​。​第​二​个​卷​可​能​不​会​挂​载​在​虚​拟​机​上​
。​例​如​：在​XenServer的​Linux下​重​启​后​你​会​看​到​/dev/xvdb。​如​果​使​用​PV-enabled 
的​操​作​系​统​内​核​，则​不​需​要​重​启​。​
					</div></li><li class="listitem"><div class="para">
						在​默​认​网​络​，为​客​户​虚​拟​机​选​择​主​要​网​络​。​在​试​用​安​装​中​，在​这​里​只​有​一​个​选​项​。​
					</div></li><li class="listitem"><div class="para">
						任​意​的​为​虚​拟​机​添​加​名​称​和​组​。​
					</div></li><li class="listitem"><div class="para">
						Click Launch VM. Your VM will be created and started. It might 
take some time to download the template and complete the VM startup. You
 can watch the VMâ€​™​s progress in the Instances screen.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				使​用​虚​拟​机​，点​击​查​看​按​钮​
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/console-icon.png" alt="ConsoleButton.png: button to launch a console"></span>
			</div><div class="para">
				For more information about using VMs, including instructions for how
 to allow incoming network traffic to the VM, start, stop, and delete 
VMs, and move a VM from one host to another, see Working With Virtual 
Machines in the Administratorâ€​™​s Guide.
			</div></li></ol></div><div class="para">
		恭​喜​你​，你​成​功​完​成​了​ CloudStack的​安​装​
	</div><div class="para">
		如​果​你​决​定​增​加​你​的​部​署​，你​可​以​增​加​更​多​的​主​机​，主​存​储​，区​域​，机​架​和​集​群​
	</div></div></div><div xml:lang="zh-CN" class="chapter" id="offerings" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;8&nbsp;章&nbsp;服​务​提​供​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#compute-disk-service-offerings">8.1. 计​算​和​磁​盘​服​务​提​供​方​案​</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-compute-offerings">8.1.1. 创​建​计​算​资​源​提​供​方​案​</a></span></dt><dt><span class="section"><a href="#creating-disk-offerings">8.1.2. 创​建​一​个​新​的​磁​盘​方​案​</a></span></dt><dt><span class="section"><a href="#modify-delete-service-offerings">8.1.3. 修​改​或​删​除​服​务​提​供​</a></span></dt></dl></dd><dt><span class="section"><a href="#system-service-offerings">8.2. 系​统​服​务​方​案​</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-system-service-offerings">8.2.1. Creating a New System Service Offering</a></span></dt></dl></dd><dt><span class="section"><a href="#network-rate">8.3. Network Throttling</a></span></dt><dt><span class="section"><a href="#sys-offering-sysvm">8.4. Changing the Default System Offering for System VMs</a></span></dt></dl></div><div class="para">
		In this chapter we discuss compute, disk, and system service 
offerings. Network offerings are discussed in the section on setting up 
networking for users.
	</div><div xml:lang="zh-CN" class="section" id="compute-disk-service-offerings" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">8.1.&nbsp;计​算​和​磁​盘​服​务​提​供​方​案​</h2></div></div></div><div class="para">
		A service offering is a set of virtual hardware features such as CPU 
core count and speed, memory, and disk size. The CloudStack 
administrator can set up various offerings, and then end users choose 
from the available offerings when they create a new VM. A service 
offering includes the following elements:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				CPU，内​存​和​网​络​资​源​保​障​
			</div></li><li class="listitem"><div class="para">
				资​源​是​如​何​计​费​的​
			</div></li><li class="listitem"><div class="para">
				资​源​使​用​是​如​何​收​费​的​
			</div></li><li class="listitem"><div class="para">
				计​费​信​息​多​久​更​新​一​次​
			</div></li></ul></div><div class="para">
		For example, one service offering might allow users to create a 
virtual machine instance that is equivalent to a 1 GHz Intel® Core™​ 2 
CPU, with 1 GB memory at $0.20/hour, with network traffic metered at 
$0.10/GB. Based on the user’​s selected offering, CloudStack emits usage
 records that can be integrated with billing systems. CloudStack 
separates service offerings into compute offerings and disk offerings. 
The computing service offering specifies:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				来​宾​CPU
			</div></li><li class="listitem"><div class="para">
				来​宾​内​存​
			</div></li><li class="listitem"><div class="para">
				来​宾​网​络​类​型​（虚​拟​网​络​还​是​直​连​网​络​）
			</div></li><li class="listitem"><div class="para">
				根​磁​盘​的​标​签​
			</div></li></ul></div><div class="para">
		磁​盘​提​供​方​案​包​括​的​内​容​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				磁​盘​大​小​（可​选​）。​未​指​定​批​判​大​小​的​磁​盘​提​供​方​案​将​允​许​用​户​自​定​义​磁​盘​大​小​
			</div></li><li class="listitem"><div class="para">
				数​据​盘​标​签​
			</div></li></ul></div><div xml:lang="zh-CN" class="section" id="creating-compute-offerings" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">8.1.1.&nbsp;创​建​计​算​资​源​提​供​方​案​</h3></div></div></div><div class="para">
		创​建​计​算​资​源​提​供​方​案​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​权​限​登​录​CloudStack 用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​导​航​栏​点​击​ 服​务​提​供​方​案​。​
			</div></li><li class="listitem"><div class="para">
				在​下​拉​列​表​中​选​择​ 计​算​资​源​提​供​方​案​。​
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​计​算​资​源​提​供​方​案​。​
			</div></li><li class="listitem"><div class="para">
				在​对​话​框​中​填​选​以​下​内​容​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: Any desired name for the service offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: A short description of the offering that can be displayed to users
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Storage type</strong></span>: The 
type of disk that should be allocated. Local allocates from storage 
attached directly to the host where the system VM is running. Shared 
allocates from storage accessible via NFS.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong># of CPU cores</strong></span>: The number of cores which should be allocated to a system VM with this offering
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CPU (in MHz)</strong></span>: The CPU speed of the cores that the system VM is allocated. For example, “​2000”​ would provide for a 2 GHz clock.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Memory (in MB)</strong></span>: 
The amount of memory in megabytes that the system VM should be 
allocated. For example, “​2048”​ would provide for a 2 GB RAM 
allocation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Rate</strong></span>: Allowed data transfer rate in MB per second.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Offer HA</strong></span>: If yes, the administrator can choose to have the system VM be monitored and as highly available as possible.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Storage Tags</strong></span>: The tags that should be associated with the primary storage used by the system VM.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags</strong></span>: (Optional) Any tags that you use to organize your hosts
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CPU cap</strong></span>: Whether to limit the level of CPU usage even if spare capacity is available.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>: Indicate 
whether the service offering should be available all domains or only 
some domains. Choose Yes to make it available to all domains. Choose No 
to limit the scope to a subdomain; CloudStack will then prompt for the 
subdomain's name.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="creating-disk-offerings" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">8.1.2.&nbsp;创​建​一​个​新​的​磁​盘​方​案​</h3></div></div></div><div class="para">
		为​了​创​建​一​个​新​的​磁​盘​方​案​:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				使​用​管​理​员​权​限​登​入​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​服​务​方​案​.
			</div></li><li class="listitem"><div class="para">
				在​选​择​方​案​中​, 选​择​磁​盘​方​案​.
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​磁​盘​方​案​.
			</div></li><li class="listitem"><div class="para">
				在​对​话​框​中​, 做​出​如​下​选​择​:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						名​称​. 任​何​你​想​要​的​磁​盘​方​案​名​称​.
					</div></li><li class="listitem"><div class="para">
						描​述​. 一​个​简​单​的​描​述​, 将​会​显​示​给​最​终​用​户​
					</div></li><li class="listitem"><div class="para">
						自​定​义​磁​盘​大​小​. 如​果​勾​选​, 用​户​可​以​自​己​设​置​磁​盘​大​小​. 如​果​没​有​勾​选​, 根​管​理​员​必​须​定​义​一​个​磁​盘​大​小​的​数​值​.
					</div></li><li class="listitem"><div class="para">
						磁​盘​大​小​. 只​有​当​自​定​义​磁​盘​大​小​没​选​中​时​才​会​出​现​. 其​定​义​的​卷​大​小​以​GB为​单​位​.
					</div></li><li class="listitem"><div class="para">
						(可​选​)存​储​标​签​. 这​个​标​签​应​与​这​个​磁​盘​的​主​存​储​相​关​联​. 
标​签​以​逗​号​分​隔​存​储​的​属​性​列​表​. 比​如​ "ssd,blue". 标​签​所​被​添​加​在​主​存​储​上​. 
CloudStack 通​过​标​签​来​匹​配​存​储​和​磁​盘​方​案​. 如​果​一​个​标​签​出​现​在​磁​盘​方​案​里​, 
那​这​个​标​签​也​必​须​出​现​在​将​要​分​配​这​个​卷​的​主​存​储​上​. 如​果​这​样​的​主​存​储​不​存​在​, 
从​这​个​磁​盘​方​案​中​进​行​分​配​将​失​败​.
					</div></li><li class="listitem"><div class="para">
						公​有​. 显​示​这​个​磁​盘​方​案​对​所​有​的​域​都​可​见​还​是​部​分​域​可​见​. 
选​择​是​以​便​其​对​所​有​的​域​都​可​见​. 选​择​不​以​限​制​其​只​对​子​域​可​见​; 
CloudStack接​着​会​提​示​子​域​的​名​字​.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="modify-delete-service-offerings" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">8.1.3.&nbsp;修​改​或​删​除​服​务​提​供​</h3></div></div></div><div class="para">
		服​务​提​供​一​旦​被​创​建​，不​能​改​变​。​这​也​适​用​于​计​算​提​供​和​磁​盘​提​供​。​
	</div><div class="para">
		
一​个​服​务​提​供​可​以​被​删​除​。​如​果​不​再​使​用​时​，它​立​即​并​永​久​删​除​。​如​果​服​务​提​供​仍​然
​是​在​使​用​中​，它​会​保​留​在​数​据​库​中​，直​到​所​有​的​虚​拟​机​引​用​已​被​删​除​。​管​理​员​删​除​后
​，服​务​提​供​将​不​提​供​给​创​建​新​的​实​例​的​最​终​用​户​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="system-service-offerings" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">8.2.&nbsp;系​统​服​务​方​案​</h2></div></div></div><div class="para">
		
我​们​假​设​系​统​的​服​务​提​供​了​一​个​选​择​的​CPU速​度​，CPU的​数​量​，标​签​和​RAM大​小​，就​像​其​
他​的​服​务​一​样​。​但​系​统​提​供​的​服​务​，而​不​是​用​于​虚​拟​机​实​例​向​用​户​公​开​，系​统​服​务​器​
用​于​更​改​虚​拟​路​由​器​默​熟​悉​，主​机​代​理​，和​其​他​系​统​的​虚​拟​机​。​系​统​服​务​器​方​案​提​供​
的​服​务​是​可​见​的​CloudStackroot管​理​员​。​ CloudStack提​供​了​默​认​的​系​服​务​方​案​。​ 
，CloudStackroot管​理​员​可​以​创​建​额​外​的​自​定​义​系​统​服​务​方​案​
	</div><div class="para">
		
当​CloudStack为​来​宾​网​络​创​建​了​一​个​虚​拟​路​由​器​，它​使​用​在​系​统​方​案​中​和​网​络​方​案​关
​联​的​默​认​设​置​，你​可​以​使​用​包​含​不​同​网​络​方​案​的​系​统​方​案​来​升​级​你​虚​拟​路​由​器​的​性​
能​。​在​改​网​络​中​的​路​由​器​将​使​用​新​的​网​络​方​案​设​置​。​
	</div><div xml:lang="zh-CN" class="section" id="creating-system-service-offerings" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">8.2.1.&nbsp;Creating a New System Service Offering</h3></div></div></div><div class="para">
		为​了​创​建​一​个​新​的​磁​盘​方​案​:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				使​用​管​理​员​权​限​登​入​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​导​航​栏​, 点​击​服​务​方​案​.
			</div></li><li class="listitem"><div class="para">
				In Select Offering, choose System Offering.
			</div></li><li class="listitem"><div class="para">
				Click Add System Service Offering.
			</div></li><li class="listitem"><div class="para">
				在​对​话​框​中​, 做​出​如​下​选​择​:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						名​称​. 任​何​你​想​要​的​磁​盘​方​案​名​称​.
					</div></li><li class="listitem"><div class="para">
						描​述​. 一​个​简​单​的​描​述​, 将​会​显​示​给​最​终​用​户​
					</div></li><li class="listitem"><div class="para">
						System VM Type. Select the type of system virtual machine that this offering is intended to support.
					</div></li><li class="listitem"><div class="para">
						Storage type. The type of disk that should be allocated. Local 
allocates from storage attached directly to the host where the system VM
 is running. Shared allocates from storage accessible via NFS.
					</div></li><li class="listitem"><div class="para">
						# of CPU cores. The number of cores which should be allocated to a system VM with this offering
					</div></li><li class="listitem"><div class="para">
						CPU (in MHz). The CPU speed of the cores that the system VM is 
allocated. For example, "2000" would provide for a 2 GHz clock.
					</div></li><li class="listitem"><div class="para">
						Memory (in MB). The amount of memory in megabytes that the system 
VM should be allocated. For example, "2048" would provide for a 2 GB RAM
 allocation.
					</div></li><li class="listitem"><div class="para">
						Network Rate. Allowed data transfer rate in MB per second.
					</div></li><li class="listitem"><div class="para">
						Offer HA. If yes, the administrator can choose to have the system VM be monitored and as highly available as possible.
					</div></li><li class="listitem"><div class="para">
						Storage Tags. The tags that should be associated with the primary storage used by the system VM.
					</div></li><li class="listitem"><div class="para">
						Host Tags. (Optional) Any tags that you use to organize your hosts
					</div></li><li class="listitem"><div class="para">
						CPU cap. Whether to limit the level of CPU usage even if spare capacity is available.
					</div></li><li class="listitem"><div class="para">
						公​有​. 显​示​这​个​磁​盘​方​案​对​所​有​的​域​都​可​见​还​是​部​分​域​可​见​. 
选​择​是​以​便​其​对​所​有​的​域​都​可​见​. 选​择​不​以​限​制​其​只​对​子​域​可​见​; 
CloudStack接​着​会​提​示​子​域​的​名​字​.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​。​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="network-rate" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">8.3.&nbsp;Network Throttling</h2></div></div></div><div class="para">
		Network throttling is the process of controlling the network access 
and bandwidth usage based on certain rules. CloudStack controls this 
behaviour of the guest networks in the cloud by using the network rate 
parameter. This parameter is defined as the default data transfer rate 
in Mbps (Megabits Per Second) allowed in a guest network. It defines the
 upper limits for network utilization. If the current utilization is 
below the allowed upper limits, access is granted, else revoked.
	</div><div class="para">
		You can throttle the network bandwidth either to control the usage 
above a certain limit for some accounts, or to control network 
congestion in a large cloud environment. The network rate for your cloud
 can be configured on the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				ç½ç»æ¹æ¡
			</div></li><li class="listitem"><div class="para">
				æå¡æ¹æ¡
			</div></li><li class="listitem"><div class="para">
				Global parameter
			</div></li></ul></div><div class="para">
		If network rate is set to NULL in service offering, the value provided
 in the vm.network.throttling.rate global parameter is applied. If the 
value is set to NULL for network offering, the value provided in the 
network.throttling.rate global parameter is considered.
	</div><div class="para">
		For the default public, storage, and management networks, network rate
 is set to 0. This implies that the public, storage, and management 
networks will have unlimited bandwidth by default. For default guest 
networks, network rate is set to NULL. In this case, network rate is 
defaulted to the global parameter value.
	</div><div class="para">
		The following table gives you an overview of how network rate is applied on different types of networks in CloudStack.
	</div><div class="informaltable"><table border="1"><colgroup><col class="1" align="left" width="50%"><col class="2" align="left" width="50%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							ç½ç»
						</div>
					</th><th class="" align="left">
						<div class="para">
							Network Rate Is Taken from
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							Guest network of Virtual Router
						</div>
					</td><td class="" align="left">
						<div class="para">
							Guest Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Public network of Virtual Router
						</div>
					</td><td class="" align="left">
						<div class="para">
							Guest Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Storage network of Secondary Storage VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Management network of Secondary Storage VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Storage network of Console Proxy VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Management network of Console Proxy VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Storage network of Virtual Router
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Management network of Virtual Router
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Public network of Secondary Storage VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Public network of Console Proxy VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							System Network Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Default network of a guest VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							Compute Offering
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Additional networks of a guest VM
						</div>
					</td><td class="" align="left">
						<div class="para">
							Corresponding Network Offerings
						</div>
					</td></tr></tbody></table></div><div class="para">
		A guest VM must have a default network, and can also have many 
additional networks. Depending on various parameters, such as the host 
and virtual switch used, you can observe a difference in the network 
rate in your cloud. For example, on a VMware host the actual network 
rate varies based on where they are configured (compute offering, 
network offering, or both); the network type (shared or isolated); and 
traffic direction (ingress or egress).
	</div><div class="para">
		The network rate set for a network offering used by a particular 
network in CloudStack is used for the traffic shaping policy of a port 
group, for example: port group A, for that network: a particular subnet 
or VLAN on the actual network. The virtual routers for that network 
connects to the port group A, and by default instances in that network 
connects to this port group. However, if an instance is deployed with a 
compute offering with the network rate set, and if this rate is used for
 the traffic shaping policy of another port group for the network, for 
example port group B, then instances using this compute offering are 
connected to the port group B, instead of connecting to port group A.
	</div><div class="para">
		The traffic shaping policy on standard port groups in VMware only 
applies to the egress traffic, and the net effect depends on the type of
 network used in CloudStack. In shared networks, ingress traffic is 
unlimited for CloudStack, and egress traffic is limited to the rate that
 applies to the port group used by the instance if any. If the compute 
offering has a network rate configured, this rate applies to the egress 
traffic, otherwise the network rate set for the network offering 
applies. For isolated networks, the network rate set for the network 
offering, if any, effectively applies to the ingress traffic. This is 
mainly because the network rate set for the network offering applies to 
the egress traffic from the virtual router to the instance. The egress 
traffic is limited by the rate that applies to the port group used by 
the instance if any, similar to shared networks.
	</div><div class="para">
		For example:
	</div><div class="para">
		Network rate of network offering = 10 Mbps
	</div><div class="para">
		Network rate of compute offering = 200 Mbps
	</div><div class="para">
		In shared networks, ingress traffic will not be limited for 
CloudStack, while egress traffic will be limited to 200 Mbps. In an 
isolated network, ingress traffic will be limited to 10 Mbps and egress 
to 200 Mbps.
	</div></div><div xml:lang="zh-CN" class="section" id="sys-offering-sysvm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">8.4.&nbsp;Changing the Default System Offering for System VMs</h2></div></div></div><div class="para">
		You can manually change the system offering for a particular System 
VM. Additionally, as a CloudStack administrator, you can also change the
 default system offering used for System VMs.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Create a new system offering.
			</div><div class="para">
				For more information, see  <span class="phrase">Creating a New System Service Offering</span>.
			</div></li><li class="listitem"><div class="para">
				备​份​数​据​库​:
			</div><pre class="programlisting">mysqldump -u root -p cloud | bzip2 &gt; cloud_backup.sql.bz2</pre></li><li class="listitem"><div class="para">
				Open an MySQL prompt:
			</div><pre class="programlisting">mysql -u cloud -p cloud</pre></li><li class="listitem"><div class="para">
				Run the following queries on the cloud database.
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						In the disk_offering table, identify the original default offering and the new offering you want to use by default.
					</div><div class="para">
						Take a note of the ID of the new offering.
					</div><pre class="programlisting">select id,name,unique_name,type from disk_offering;</pre></li><li class="listitem"><div class="para">
						For the original default offering, set the value of unique_name to NULL.
					</div><pre class="programlisting"># update disk_offering set unique_name = NULL where id = 10;</pre><div class="para">
						Ensure that you use the correct value for the ID.
					</div></li><li class="listitem"><div class="para">
						For the new offering that you want to use by default, set the value of unique_name as follows:
					</div><div class="para">
						For the default Console Proxy VM (CPVM) offering,set unique_name 
to 'Cloud.com-ConsoleProxy'. For the default Secondary Storage VM (SSVM)
 offering, set unique_name to 'Cloud.com-SecondaryStorage'. For example:
					</div><pre class="programlisting">update disk_offering set unique_name = 'Cloud.com-ConsoleProxy' where id = 16;</pre></li></ol></div></li><li class="listitem"><div class="para">
				Restart CloudStack Management Server. Restarting is required because
 the default offerings are loaded into the memory at startup.
			</div><pre class="programlisting">service cloudstack-management restart</pre></li><li class="listitem"><div class="para">
				Destroy the existing CPVM or SSVM offerings and wait for them to be 
recreated. The new CPVM or SSVM are configured with the new offering.
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="chapter" id="set-up-network-for-users" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;9&nbsp;章&nbsp;Setting Up Networking for Users</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#networks-for-users-overview">9.1. Overview of Setting Up Networking for Users</a></span></dt><dt><span class="section"><a href="#about-virtual-networks">9.2. 关​于​虚​拟​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#isolated-networks">9.2.1. 隔​离​的​网​络​</a></span></dt><dt><span class="section"><a href="#shared-networks">9.2.2. 共​享​网​络​</a></span></dt><dt><span class="section"><a href="#runtime-allocation-virtual-network-resources">9.2.3. 虚​拟​网​络​资​源​的​运​行​时​分​配​</a></span></dt></dl></dd><dt><span class="section"><a href="#network-service-providers">9.3. 网​络​服​务​提​供​方​案​</a></span></dt><dt><span class="section"><a href="#network-offerings">9.4. ç½ç»æ¹æ¡</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-network-offerings">9.4.1. Creating a New Network Offering</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="networks-for-users-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">9.1.&nbsp;Overview of Setting Up Networking for Users</h2></div></div></div><div class="para">
		People using cloud infrastructure have a variety of needs and 
preferences when it comes to the networking services provided by the 
cloud. As a CloudStack administrator, you can do the following things to
 set up networking for your users:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Set up physical networks in zones
			</div></li><li class="listitem"><div class="para">
				Set up several different providers for the same service on a single 
physical network (for example, both Cisco and Juniper firewalls)
			</div></li><li class="listitem"><div class="para">
				Bundle different types of network services into network offerings, 
so users can choose the desired network services for any given virtual 
machine
			</div></li><li class="listitem"><div class="para">
				Add new network offerings as time goes on so end users can upgrade to a better class of service on their network
			</div></li><li class="listitem"><div class="para">
				Provide more ways for a network to be accessed by a user, such as through a project of which the user is a member
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="about-virtual-networks" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">9.2.&nbsp;关​于​虚​拟​网​络​</h2></div></div></div><div class="para">
		A virtual network is a logical construct that enables multi-tenancy on
 a single physical network. In CloudStack a virtual network can be 
shared or isolated.
	</div><div xml:lang="zh-CN" class="section" id="isolated-networks" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">9.2.1.&nbsp;隔​离​的​网​络​</h3></div></div></div><div class="para">
		一​个​隔​离​的​网​络​可​以​访​问​虚​拟​机​的​单​一​账​户​。​隔​离​的​网​络​具​有​下​列​性​质​。​
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				如​VLAN等​资​源​被​动​态​分​配​和​垃​圾​收​集​
			</div></li><li class="listitem"><div class="para">
				有​一​个​用​于​整​个​网​络​的​网​络​提​供​
			</div></li><li class="listitem"><div class="para">
				网​络​提​供​可​升​级​或​降​级​，但​它​是​用​于​整​个​网​络​的​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="shared-networks" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">9.2.2.&nbsp;共​享​网​络​</h3></div></div></div><div class="para">
		A shared network can be accessed by virtual machines that belong to 
many different accounts. Network Isolation on shared networks is 
accomplished using techniques such as security groups (supported only in
 basic zones).
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				管​理​员​创​建​共​享​网​络​
			</div></li><li class="listitem"><div class="para">
				在​一​个​确​定​的​网​络​中​设​计​共​享​网​络​
			</div></li><li class="listitem"><div class="para">
				共​享​网​络​资​源​如​VLAN和​物​理​网​络​，它​映​射​到​指​定​的​管​理​员​
			</div></li><li class="listitem"><div class="para">
				共​享​网​络​通​过​安​全​组​实​现​隔​离​
			</div></li><li class="listitem"><div class="para">
				公​网​网​络​作​为​一​个​共​享​网​络​不​会​展​示​给​终​端​用​户​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="runtime-allocation-virtual-network-resources" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">9.2.3.&nbsp;虚​拟​网​络​资​源​的​运​行​时​分​配​</h3></div></div></div><div class="para">
		When you define a new virtual network, all your settings for that 
network are stored in CloudStack. The actual network resources are 
activated only when the first virtual machine starts in the network. 
When all virtual machines have left the virtual network, the network 
resources are garbage collected so they can be allocated again. This 
helps to conserve network resources.
	</div></div></div><div xml:lang="zh-CN" class="section" id="network-service-providers" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">9.3.&nbsp;网​络​服​务​提​供​方​案​</h2></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			与​查​看​最​新​的​网​络​服​务​提​供​者​支​持​列​表​请​见​CloudStack用​户​界​面​或​者​条​用​API listNetworkServiceProviders。​
		</div></div></div><div class="para">
		
服​务​提​供​者​（也​称​为​网​络​元​件​）是​指​通​过​硬​件​或​虚​拟​应​用​来​实​现​网​络​应​用​。​比​如​，防​火
​墙​应​用​可​以​安​装​在​云​端​来​提​供​防​火​墙​服​务​。​在​独​立​网​络​中​多​个​提​供​者​能​提​供​相​同​的
​网​络​服​务​。​比​如​，可​以​通​过​思​科​或​者​Juniper的​设​备​在​同​一​个​物​理​网​络​中​提​供​防​火​墙
​服​务​。​
	</div><div class="para">
		在​一​个​网​络​中​你​可​以​多​个​实​例​使​用​相​同​的​服​务​提​供​者​（也​可​以​使​用​多​个​Juniper SRX设​备​）
	</div><div class="para">
		
如​果​不​同​提​供​者​被​设​置​在​网​络​中​提​供​相​同​服​务​，管​理​员​可​以​通​过​创​建​网​络​提​供​方​案​，
因​此​用​户​能​够​自​己​制​定​使​用​哪​个​物​理​网​络​提​供​者​（要​遵​从​网​络​提​供​方​案​中​的​其​他​选​项
​）。​否​则​CloudStack 会​在​服​务​被​需​求​的​时​候​选​择​使​用​哪​个​提​供​者​。​
	</div><div class="formalpara"><h5 class="formalpara" id="idp44038592">支​持​的​网​络​服​务​提​供​者​</h5>
			CloudStack已​经​预​置​了​一​些​内​置​的​服​务​提​供​者​支​持​列​表​。​你​能​在​创​建​网​络​提​供​方​案​的​时​候​你​能​从​这​列​表​中​选​择​。​
		</div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="17%"><col class="c2" align="left" width="17%"><col class="c3" align="left" width="17%"><col class="c4" align="left" width="17%"><col class="c5" align="left" width="17%"><col class="c6" align="left" width="17%"></colgroup><thead><tr><th class="" align="left">
					</th><th class="" align="left">
						<div class="para">
							èæè·¯ç±å¨
						</div>
					</th><th class="" align="left">
						<div class="para">
							Citrix NetScaler
						</div>
					</th><th class="" align="left">
						<div class="para">
							Juniper SRX
						</div>
					</th><th class="" align="left">
						<div class="para">
							F5 BigIP
						</div>
					</th><th class="" align="left">
						<div class="para">
							Host based (KVM/Xen)
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							Remote Access VPN
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							DNS/DHCP/User Data
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							é²ç«å¢
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							è´è½½å¹³è¡¡
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							å¼¹æ§ IP
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							å¼¹æ§è´è½½å¹³è¡¡å¨
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							æº NAT
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							静​态​ NAT
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ç«¯å£è½¬å
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="section" id="network-offerings" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">9.4.&nbsp;ç½ç»æ¹æ¡</h2></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			For the most up-to-date list of supported network services, see the CloudStack UI or call listNetworkServices.
		</div></div></div><div class="para">
		A network offering is a named set of network services, such as:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				DHCP
			</div></li><li class="listitem"><div class="para">
				DNS
			</div></li><li class="listitem"><div class="para">
				æº NAT
			</div></li><li class="listitem"><div class="para">
				éæ NAT
			</div></li><li class="listitem"><div class="para">
				ç«¯å£è½¬å
			</div></li><li class="listitem"><div class="para">
				è´è½½å¹³è¡¡
			</div></li><li class="listitem"><div class="para">
				é²ç«å¢
			</div></li><li class="listitem"><div class="para">
				VPN
			</div></li><li class="listitem"><div class="para">
				Optional) Name one of several available providers to use for a given service, such as Juniper for the firewall
			</div></li><li class="listitem"><div class="para">
				(Optional) Network tag to specify which physical network to use
			</div></li></ul></div><div class="para">
		When creating a new VM, the user chooses one of the available network 
offerings, and that determines which network services the VM can use.
	</div><div class="para">
		The CloudStack administrator can create any number of custom network 
offerings, in addition to the default network offerings provided by 
CloudStack. By creating multiple custom network offerings, you can set 
up your cloud to offer different classes of service on a single 
multi-tenant physical network. For example, while the underlying 
physical wiring may be the same for two tenants, tenant A may only need 
simple firewall protection for their website, while tenant B may be 
running a web server farm and require a scalable firewall solution, load
 balancing solution, and alternate networks for accessing the database 
backend.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			
如​果​你​创​建​的​负​载​均​衡​规​则​同​时​使​用​的​网​络​提​供​方​案​使​用​到​了​外​部​的​负​载​均​衡​器​设​
备​（比​如​NetScaler）,随​后​又​改​变​为​使​用​虚​拟​路​由​器​的​网​络​提​供​方​案​,你​必​须​在​虚​拟​路
​由​器​上​为​每​个​已​存​在​的​负​载​聚​恒​规​则​创​建​一​个​防​火​墙​规​则​以​使​它​们​继​续​生​效​。​
		</div></div></div><div class="para">
		When creating a new virtual network, the CloudStack administrator 
chooses which network offering to enable for that network. Each virtual 
network is associated with one network offering. A virtual network can 
be upgraded or downgraded by changing its associated network offering. 
If you do this, be sure to reprogram the physical network to match.
	</div><div class="para">
		CloudStack also has internal network offerings for use by CloudStack 
system VMs. These network offerings are not visible to users but can be 
modified by administrators.
	</div><div xml:lang="zh-CN" class="section" id="creating-network-offerings" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">9.4.1.&nbsp;Creating a New Network Offering</h3></div></div></div><div class="para">
		To create a network offering:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in with admin privileges to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Service Offerings.
			</div></li><li class="listitem"><div class="para">
				In Select Offering, choose Network Offering.
			</div></li><li class="listitem"><div class="para">
				Click Add Network Offering.
			</div></li><li class="listitem"><div class="para">
				在​对​话​框​中​, 做​出​如​下​选​择​:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>. Any desired name for the network offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>. A short description of the offering that can be displayed to users.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Rate</strong></span>. Allowed data transfer rate in MB per second.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest Type</strong></span>. Choose whether the guest network is isolated or shared.
					</div><div class="para">
						For a description of this term, see <a class="xref" href="#about-virtual-networks">第&nbsp;9.2&nbsp;节 “关​于​虚​拟​网​络​”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Persistent</strong></span>. 
Indicate whether the guest network is persistent or not. The network 
that you can provision without having to deploy a VM on it is termed 
persistent network. For more information, see <a class="xref" href="#persistent-network">第&nbsp;15.20&nbsp;节 “Persistent Networks”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Specify VLAN</strong></span>. (Isolated guest networks only) Indicate whether a VLAN should be specified when this offering is used.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VPC</strong></span>. This option 
indicate whether the guest network is Virtual Private Cloud-enabled. A 
Virtual Private Cloud (VPC) is a private, isolated part of CloudStack. A
 VPC can have its own virtual network topology that resembles a 
traditional physical network. For more information on VPCs, see <a class="xref" href="#vpc">第&nbsp;15.19.1&nbsp;节 “About Virtual Private Clouds”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Supported Services</strong></span>.
 Select one or more of the possible network services. For some services,
 you must also choose the service provider; for example, if you select 
Load Balancer, you can choose the CloudStack virtual router or any other
 load balancers that have been configured in the cloud. Depending on 
which services you choose, additional fields may appear in the rest of 
the dialog box.
					</div><div class="para">
						Based on the guest network type selected, you can see the following supported services:
					</div><div class="informaltable"><table border="1"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr><th class="" align="left">
										<div class="para">
											æ¯æçæå¡
										</div>
									</th><th class="" align="left">
										<div class="para">
											è¯´æ
										</div>
									</th><th class="" align="left">
										<div class="para">
											Isolated
										</div>
									</th><th class="" align="left">
										<div class="para">
											å·²å±äº«
										</div>
									</th></tr></thead><tbody><tr><td class="" align="left">
										<div class="para">
											DHCP
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#dns-dhcp">第&nbsp;15.16&nbsp;节 “DNS和​DHCP”</a>.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											DNS
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#dns-dhcp">第&nbsp;15.16&nbsp;节 “DNS和​DHCP”</a>.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											è´è½½å¹³è¡¡å¨
										</div>
									</td><td class="" align="left">
										<div class="para">
											If you select Load Balancer, you can choose the CloudStack 
virtual router or any other load balancers that have been configured in 
the cloud.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											é²ç«å¢
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see the Administration Guide.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											æº NAT
										</div>
									</td><td class="" align="left">
										<div class="para">
											If you select Source NAT, you can choose the CloudStack 
virtual router or any other Source NAT providers that have been 
configured in the cloud.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											éæ NAT
										</div>
									</td><td class="" align="left">
										<div class="para">
											If you select Static NAT, you can choose the CloudStack 
virtual router or any other Static NAT providers that have been 
configured in the cloud.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											ç«¯å£è½¬å
										</div>
									</td><td class="" align="left">
										<div class="para">
											If you select Port Forwarding, you can choose the CloudStack 
virtual router or any other Port Forwarding providers that have been 
configured in the cloud.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Not Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											VPN
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#vpn">第&nbsp;15.17&nbsp;节 “VPN 虚​拟​专​用​网​”</a>.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Not Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											User Data
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#user-data-and-meta-data">第&nbsp;20.3&nbsp;节 “User Data and Meta Data”</a>.
										</div>

									</td><td class="" align="left">
										<div class="para">
											Not Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											Network ACL
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#configure-acl">第&nbsp;15.19.4&nbsp;节 “Configuring Access Control List”</a>.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Not Supported
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											å®å¨ç»
										</div>
									</td><td class="" align="left">
										<div class="para">
											For more information, see <a class="xref" href="#add-security-group">第&nbsp;15.7.2&nbsp;节 “Adding a Security Group”</a>.
										</div>
									</td><td class="" align="left">
										<div class="para">
											Not Supported
										</div>
									</td><td class="" align="left">
										<div class="para">
											Supported
										</div>
									</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>System Offering</strong></span>. 
If the service provider for any of the services selected in Supported 
Services is a virtual router, the System Offering field appears. Choose 
the system service offering that you want virtual routers to use in this
 network. For example, if you selected Load Balancer in Supported 
Services and selected a virtual router to provide load balancing, the 
System Offering field appears so you can choose between the CloudStack 
default system service offering and any custom system service offerings 
that have been defined by the CloudStack root administrator.
					</div><div class="para">
						For more information, see <a class="xref" href="#system-service-offerings">第&nbsp;8.2&nbsp;节 “系​统​服​务​方​案​”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Redundant router capability</strong></span>.
 Available only when Virtual Router is selected as the Source NAT 
provider. Select this option if you want to use two virtual routers in 
the network for uninterrupted connection: one operating as the master 
virtual router and the other as the backup. The master virtual router 
receives requests from and sends responses to the user’​s VM. The backup
 virtual router is activated only when the master is down. After the 
failover, the backup becomes the master virtual router. CloudStack 
deploys the routers on different hosts to ensure reliability if one host
 is down.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Conserve mode</strong></span>. 
Indicate whether to use conserve mode. In this mode, network resources 
are allocated only when the first virtual machine starts in the network.
 When conservative mode is off, the public IP can only be used for a 
single service. For example, a public IP used for a port forwarding rule
 cannot be used for defining other services, such as StaticNAT or load 
balancing. When the conserve mode is on, you can define more than one 
service on the same public IP.
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							If StaticNAT is enabled, irrespective of the status of the 
conserve mode, no port forwarding or load balancing rule can be created 
for the IP. However, you can add the firewall rules by using the 
createFirewallRule command.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Tags</strong></span>. Network tag to specify which physical network to use.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​.
			</div></li></ol></div></div></div></div><div xml:lang="zh-CN" class="chapter" id="virtual-machines" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;10&nbsp;章&nbsp;使​用​虚​拟​机​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#about-working-with-vms">10.1. 关​于​虚​拟​机​的​使​用​</a></span></dt><dt><span class="section"><a href="#best-practices-vm">10.2. 虚​拟​机​最​佳​实​践​</a></span></dt><dt><span class="section"><a href="#vm-lifecycle">10.3. VM Lifecycle</a></span></dt><dt><span class="section"><a href="#creating-vms">10.4. 创​建​虚​拟​机​实​例​</a></span></dt><dt><span class="section"><a href="#accessing-vms">10.5. Accessing VMs</a></span></dt><dt><span class="section"><a href="#stopping-and-starting-vms">10.6. 停​止​和​启​动​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#changing-vm-name-os-group">10.7. Changing the VM Name, OS, or Group</a></span></dt><dt><span class="section"><a href="#changing-service-offering-for-vm">10.8. Changing the Service Offering for a VM</a></span></dt><dt><span class="section"><a href="#manual-live-migration">10.9. Moving VMs Between Hosts (Manual Live Migration)</a></span></dt><dt><span class="section"><a href="#deleting-vms">10.10. Deleting VMs</a></span></dt><dt><span class="section"><a href="#working-with-iso">10.11. 使​用​iso文​件​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-iso">10.11.1. 添​加​一​个​ISO</a></span></dt><dt><span class="section"><a href="#attach-iso-to-vm">10.11.2. 附​加​ISO到​虚​拟​机​</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="about-working-with-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.1.&nbsp;关​于​虚​拟​机​的​使​用​</h2></div></div></div><div class="para">
		
CloudStack可​以​让​管​理​员​对​运​行​在​云​中​所​有​客​户​虚​拟​机​进​行​完​整​的​生​命​周​期​管​理​。​
CloudStack 
提​供​给​最​终​用​户​和​管​理​员​一​些​客​户​的​管​理​操​作​。​可​以​停​止​，启​动​，重​启​和​删​除​虚​拟​机​
	</div><div class="para">
		客​户​虚​拟​机​可​以​拥​有​名​称​和​组​。​虚​拟​机​的​名​字​和​组​对​于​CloudStack 
是​透​明​的​，方​便​最​终​用​户​识​别​管​理​自​己​的​虚​拟​机​。​每​个​虚​拟​机​可​以​拥​有​不​同​名​称​的​3
个​名​字​。​但​只​有​其​中​的​两​个​名​字​可​以​让​用​户​来​管​理​。​
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Instance name –​ a unique, immutable ID that is generated by 
CloudStack, and can not be modified by the user. This name conforms to 
the requirements in IETF RFC 1123.
			</div></li><li class="listitem"><div class="para">
				Display name –​ the name displayed in the CloudStack web UI. Can be set by the user. Defaults to instance name.
			</div></li><li class="listitem"><div class="para">
				Name –​ host name that the DHCP server assigns to the VM. Can be set by the user. Defaults to instance name
			</div></li></ul></div><div class="para">
		
客​户​虚​拟​机​可​以​设​定​为​高​可​用​性​(HA)。​启​用​HA的​虚​拟​机​会​被​系​统​监​控​。​如​果​系​统​检​
测​到​这​个​虚​拟​机​关​机​了​，会​试​图​重​启​这​个​虚​拟​机​，一​般​会​换​一​台​主​机​。​更​多​信​息​，请​参
​阅​启​用​虚​拟​机​高​可​用​性​一​章​。​
	</div><div class="para">
		每​个​新​虚​拟​机​会​被​分​配​一​个​公​共​IP地​址​。​当​虚​拟​机​启​动​的​时​候​，CloudStack 会​自​动​为​虚​拟​机​的​内​外​网​IP地​址​之​间​创​建​一​个​静​态​NAT。​
	</div><div class="para">
		如​果​使​用​了​动​态​IP 
(配​合​NetScaler负​载​均​衡​设​备​)，新​虚​拟​机​在​最​初​分​配​IP地​址​的​时​候​不​会​标​记​为​动​态​
的​。​用​户​必​须​设​定​为​动​态​IP来​替​代​自​动​配​置​的​IP地​址​，然​后​设​定​静​态​NAT来​映​射​新​IP
和​客​户​虚​拟​机​的​私​有​IP。​虚​拟​机​原​有​的​IP会​被​释​放​然​后​重​新​回​到​可​用​的​公​共​IP地​址​
池​中​。​
	</div><div class="para">
		CloudStack 
不​能​分​辨​客​户​虚​拟​机​关​机​是​由​用​户​操​作​的​(如​在​Linux下​使​用​“​shutdown”​命​令​) 
还​是​非​预​期​的​关​机​。​如​果​开​启​HA功​能​的​虚​拟​机​从​内​部​关​机​， CloudStack 
仍​然​会​重​启​它​。​如​果​想​关​闭​有​HA功​能​的​虚​拟​机​，必​须​要​通​过​ CloudStack 的​UI或​ 
API。​
	</div></div><div xml:lang="zh-CN" class="section" id="best-practices-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.2.&nbsp;虚​拟​机​最​佳​实​践​</h2></div></div></div><div class="para">
		
CloudStack管​理​员​应​该​监​视​每​个​集​群​中​的​虚​拟​机​实​例​的​总​数​，并​禁​止​分​配​给​集​群​接​近
​最​大​的​虚​拟​机​管​理​程​序​可​以​处​理​。​一​定​要​留​一​个​安​全​余​量​，允​许​一​个​或​多​个​主​机​出​
现​故​障​，这​会​增​加​其​他​主​机​上​的​虚​拟​机​负​载​，增​加​自​动​重​新​部​署​的​可​能​性​。​查​询​你​选​
择​虚​拟​机​管​理​程​序​的​文​档​，确​认​每​个​主​机​运​行​的​最​大​虚​拟​机​数​量​。​然​后​使​用​
CloudStack的​全​局​配​置​设​置​为​默​认​的​限​制​。​每​时​每​刻​监​控​集​群​上​的​活​动​虚​拟​机​，保​持
​主​机​故​障​后​，虚​拟​机​的​总​数​仍​旧​属​于​一​个​安​全​的​水​平​。​例​如​，如​果​有​N个​主​机​在​集​群​
中​，你​想​允​许​在​集​群​中​的​一​台​主​机​任​何​时​间​被​关​机​下​线​。​你​被​允​许​在​集​群​中​部​署​的​虚
​拟​机​主​机​的​最​大​数​量​为​(N-1 
)）*(每​个​主​机​的​限​制​)。​集​群​一​旦​达​到​这​个​数​量​的​虚​拟​机​，使​用​CloudStack 
UI禁​用​分​配​更​多​的​虚​拟​机​的​集​群​。​
	</div></div><div xml:lang="zh-CN" class="section" id="vm-lifecycle" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.3.&nbsp;VM Lifecycle</h2></div></div></div><div class="para">
		Virtual machines can be in the following states:
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/vm-lifecycle.png" alt="basic-deployment.png: Basic two-machine CloudStack deployment" width="444"></div><div class="para">
		Once a virtual machine is destroyed, it cannot be recovered. All the 
resources used by the virtual machine will be reclaimed by the system. 
This includes the virtual machine’​s IP address.
	</div><div class="para">
		A stop will attempt to gracefully shut down the operating system, 
which typically involves terminating all the running applications. If 
the operation system cannot be stopped, it will be forcefully 
terminated. This has the same effect as pulling the power cord to a 
physical machine.
	</div><div class="para">
		A reboot is a stop followed by a start.
	</div><div class="para">
		CloudStack preserves the state of the virtual machine hard disk until the machine is destroyed.
	</div><div class="para">
		A running virtual machine may fail because of hardware or network issues. A failed virtual machine is in the down state.
	</div><div class="para">
		The system places the virtual machine into the down state if it does 
not receive the heartbeat from the hypervisor for three minutes.
	</div><div class="para">
		The user can manually restart the virtual machine from the down state.
	</div><div class="para">
		The system will start the virtual machine from the down state automatically if the virtual machine is marked as HA-enabled.
	</div></div><div xml:lang="zh-CN" class="section" id="creating-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.4.&nbsp;创​建​虚​拟​机​实​例​</h2></div></div></div><div class="para">
		
通​常​建​议​使​用​模​板​创​建​虚​拟​机​实​例​。​除​此​以​外​，用​户​也​可​以​不​使​用​模​板​而​创​建​一​个​没
​有​操​作​系​统​的​空​白​虚​拟​机​。​用​户​可​以​为​空​白​虚​拟​机​附​加​ISO文​件​，并​通​过​虚​拟​的​
CD/DVD-ROM设​备​安​装​操​作​系​统​。​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			You can create a VM without starting it. You can determine whether 
the VM needs to be started as part of the VM deployment. A request 
parameter, startVM, in the deployVm API provides this feature. For more 
information, see the Developer's Guide
		</div></div></div><div class="para">
		通​过​模​板​创​建​虚​拟​机​实​例​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				使​用​管​理​员​或​普​通​用​户​，登​陆​到​ CloudStack 。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​任​务​栏​，点​击​ 实​例​ 。​
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​实​例​
			</div></li><li class="listitem"><div class="para">
				Select a zone.
			</div></li><li class="listitem"><div class="para">
				Select a template, then follow the steps in the wizard. For more 
information about how the templates came to be in this list, see <a class="xref" href="#working-with-templates">第&nbsp;12&nbsp;章 <em>使​用​模​板​</em></a>.
			</div></li><li class="listitem"><div class="para">
				请​确​认​你​的​硬​件​设​备​允​许​运​行​所​选​的​服​务​。​
			</div></li><li class="listitem"><div class="para">
				点​击​提​交​，您​的​虚​拟​机​将​会​被​创​建​并​启​动​。​
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					因​为​安​全​的​原​因​， 虚​拟​机​的​网​络​名​称​只​有​root可​以​看​到​ 管​理​。​
				</div></div></div></li></ol></div><div class="para">
		通​过​ISO文​件​创​建​虚​拟​机​实​例​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			(XenServer) 运​行​在​XenServer上​的​Windows虚​拟​机​需​要​安​装​PV驱​动​，PV驱​动​可​以​
 通​过​模​板​安​装​或​在​虚​拟​机​创​建​后​再​安​装​。​主​要​的​管​理​功​能​ 
会​用​到​PV驱​动​，例​如​添​加​额​外​的​磁​盘​和​ISO镜​像​，在​线​迁​移​，和​Graceful 关​机​。​
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				使​用​管​理​员​或​普​通​用​户​，登​陆​到​ CloudStack 。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​任​务​栏​，点​击​ 实​例​ 。​
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​实​例​
			</div></li><li class="listitem"><div class="para">
				Select a zone.
			</div></li><li class="listitem"><div class="para">
				选​择​ISO启​动​，然​后​按​照​向​导​的​步​骤​进​行​操​作​。​
			</div></li><li class="listitem"><div class="para">
				点​击​提​交​，您​的​虚​拟​机​将​会​被​创​建​并​启​动​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="accessing-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.5.&nbsp;Accessing VMs</h2></div></div></div><div class="para">
		任​何​用​户​可​以​访​问​他​们​自​己​的​虚​拟​机​。​管​理​员​能​够​访​问​在​云​中​运​行​的​所​有​虚​拟​机​。​
	</div><div class="para">
		To access a VM through the CloudStack UI:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​用​户​身​份​登​陆​至​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				Click Instances, then click the name of a running VM.
			</div></li><li class="listitem"><div class="para">
				Click the View Console button <img src="CloudStack%20Administrator%27s%20Guide_files/view-console-button.png">.
			</div></li></ol></div><div class="para">
		To access a VM directly over the network:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				The VM must have some port open to incoming traffic. For example, in
 a basic zone, a new VM might be assigned to a security group which 
allows incoming traffic. This depends on what security group you picked 
when creating the VM. In other cases, you can open a port by setting up a
 port forwarding policy. See <a class="xref" href="#ip-forwarding-firewalling">第&nbsp;15.14&nbsp;节 “IP转​发​及​防​火​墙​”</a>.
			</div></li><li class="listitem"><div class="para">
				If a port is open but you can not access the VM using ssh, it’​s 
possible that ssh is not already enabled on the VM. This will depend on 
whether ssh is enabled in the template you picked when creating the VM. 
Access the VM through the CloudStack UI and enable ssh on the machine 
using the commands for the VM’​s operating system.
			</div></li><li class="listitem"><div class="para">
				If the network has an external firewall device, you will need to create a firewall rule to allow access. See <a class="xref" href="#ip-forwarding-firewalling">第&nbsp;15.14&nbsp;节 “IP转​发​及​防​火​墙​”</a>.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="stopping-and-starting-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.6.&nbsp;停​止​和​启​动​虚​拟​机​</h2></div></div></div><div class="para">
		Once a VM instance is created, you can stop, restart, or delete it as 
needed. In the CloudStack UI, click Instances, select the VM, and use 
the Stop, Start, Reboot, and Destroy links.
	</div></div><div xml:lang="zh-CN" class="section" id="changing-vm-name-os-group" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.7.&nbsp;Changing the VM Name, OS, or Group</h2></div></div></div><div class="para">
		After a VM is created, you can modify the display name, operating system, and the group it belongs to.
	</div><div class="para">
		To access a VM through the CloudStack UI:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​用​户​身​份​登​陆​至​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​的​导​航​菜​单​中​，点​击​实​例​。​
			</div></li><li class="listitem"><div class="para">
				Select the VM that you want to modify.
			</div></li><li class="listitem"><div class="para">
				Click the Stop button to stop the VM. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/stop-instance-icon.png" alt="StopButton.png: button to stop a VM"></span>

			</div></li><li class="listitem"><div class="para">
				Click Edit. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="EditButton.png: button to edit the properties of a VM"></span>
			</div></li><li class="listitem"><div class="para">
				Make the desired changes to the following:
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Display name</strong></span>: Enter a new display name if you want to change the name of the VM.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>OS Type</strong></span>: Select the desired operating system.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Group</strong></span>: Enter the group name for the VM.
			</div></li><li class="listitem"><div class="para">
				Click Apply.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="changing-service-offering-for-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.8.&nbsp;Changing the Service Offering for a VM</h2></div></div></div><div class="para">
		To upgrade or downgrade the level of compute resources available to a 
virtual machine, you can change the VM's compute offering.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​用​户​身​份​登​陆​至​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​的​导​航​菜​单​中​，点​击​实​例​。​
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Stop button to stop the VM.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/stop-instance-icon.png" alt="StopButton.png: button to stop a VM"></span>

			</div></li><li class="listitem"><div class="para">
				Click the Change Service button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/change-service-icon.png" alt="ChangeServiceButton.png: button to change the service of a VM"></span>
			</div><div class="para">
				The Change service dialog box is displayed.
			</div></li><li class="listitem"><div class="para">
				Select the offering you want to apply to the selected VM.
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="manual-live-migration" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.9.&nbsp;Moving VMs Between Hosts (Manual Live Migration)</h2></div></div></div><div class="para">
		The CloudStack administrator can move a running VM from one host to 
another without interrupting service to users or going into maintenance 
mode. This is called manual live migration, and can be done under the 
following conditions:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The root administrator is logged in. Domain admins and users can not perform manual live migration of VMs.
			</div></li><li class="listitem"><div class="para">
				The VM is running. Stopped VMs can not be live migrated.
			</div></li><li class="listitem"><div class="para">
				The destination host must be in the same cluster as the original host.
			</div></li><li class="listitem"><div class="para">
				The VM must not be using local disk storage.
			</div></li><li class="listitem"><div class="para">
				The destination host must have enough available capacity. If not, 
the VM will remain in the "migrating" state until memory becomes 
available.
			</div></li></ul></div><div class="para">
		To manually live migrate a virtual machine
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​普​通​用​户​身​份​登​录​进​入​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​的​导​航​菜​单​中​，点​击​实​例​。​
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to migrate.
			</div></li><li class="listitem"><div class="para">
				Click the Migrate Instance button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/migrate-instance.png" alt="Migrateinstance.png: button to migrate an instance"></span>

			</div></li><li class="listitem"><div class="para">
				From the list of hosts, choose the one to which you want to move the VM.
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="deleting-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.10.&nbsp;Deleting VMs</h2></div></div></div><div class="para">
		Users can delete their own virtual machines. A running virtual machine
 will be abruptly stopped before it is deleted. Administrators can 
delete any virtual machines.
	</div><div class="para">
		To delete a virtual machine:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​用​户​身​份​登​陆​至​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​的​导​航​菜​单​中​，点​击​实​例​。​
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to delete.
			</div></li><li class="listitem"><div class="para">
				Click the Destroy Instance button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/destroy-instance.png" alt="Destroyinstance.png: button to destroy an instance"></span>

			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="working-with-iso" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">10.11.&nbsp;使​用​iso文​件​</h2></div></div></div><div class="para">
		CloudStack支​持​iso并​加​载​到​客​户​vm中​。​一​个​iso文​件​是​包​含​iso/cd-rom格​式​文​件​系​统​的​只​读​文​件​。​用​户​可​以​上​传​自​己​的​iso文​件​， 并​挂​载​到​vm中​
	</div><div class="para">
		
iso文​件​通​过​url方​法​上​传​。​HTTP支​持​这​个​这​个​协​议​。​你​可​以​通​过​以​下​方​式​访​问​通​过​
http方​式​发​布​的​iso.比​如​http://my.web.server/filename.iso.
	</div><div class="para">
		iso文​件​就​像​模​板​一​样​可​以​是​共​有​或​者​私​有​. iso不​是​一​个​定​制​的​hypersior,用​户​可​以​在​vSphere和​KVM已​同​样​的​方​式​挂​载​
	</div><div class="para">
		
iso镜​像​存​储​在​系​统​中​，配​置​和​模​板​系​统​的​相​似​的​隐​私​级​别​。​iso镜​像​被​分​为​可​引​导​和
​不​可​引​导​。​一​个​可​引​导​iso镜​像​包​含​一​个​OS镜​像​。​CloudStack允​许​在​不​使​用​iso镜​像
​时​候​启​动​客​户​vm.\n用​户​也​可​以​在​客​户​vm中​挂​载​iso镜​像​。​例​如​，在​windows中​安​装​
pv驱​动​。​iso镜​像​不​是​一​个​定​制​的​hypervisor
	</div><div xml:lang="zh-CN" class="section" id="add-iso" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">10.11.1.&nbsp;添​加​一​个​ISO</h3></div></div></div><div class="para">
		为​了​制​造​额​外​的​操​作​系​统​或​者​其​它​有​效​的​软​件​为​了​guest 
VMs使​用​，你​能​够​添​加​ISO。​最​典​型​的​ISO被​认​为​是​一​个​操​作​系​统​，但​是​你​也​能​添​加​软​件
​类​型​的​ISO，例​如​你​想​作​为​模​板​被​安​装​的​桌​面​应​用​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​到​CloudStack界​面​以​管​理​员​或​者​终​端​用​户​。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​，点​击​模​板​。​
			</div></li><li class="listitem"><div class="para">
				在​选​择​视​图​中​，选​择​ISO。​
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​ISO。​
			</div></li><li class="listitem"><div class="para">
				在​添​加​ISO屏​幕​中​，提​供​下​列​信​息​:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>名​称​</strong></span>:ISO 镜​像​的​简​称​。​例​如​，CentOS6.2 64-bit。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>说​明​</strong></span>:对​于​ISO镜​像​的​说​明​。​例​如​，CentOS6.2 64-bit。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>URL</strong></span>:URL是​ISO镜​像​的​主​机​。​管​理​控​制​服​务​器​必​须​能​够​访​问​这​个​地​址​通​过​HTTP。​如​果​有​需​要​你​可​以​直​接​放​置​ISO镜​像​在​管​理​控​制​服​务​器​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>区​域​</strong></span>:选​择​你​想​让​ISO有​效​的​区​域​，或​者​ALL Zones可​以​让​它​在​整​个​CloudStack可​用​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>可​启​动​</strong></span>:是​否​一​个​guest能​够​引​导​这​个​ISO image。​例​如​，一​个​CentOS ISO 是​可​启​动​的​，一​个​Microsoft Office ISO 是​不​可​启​动​的​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>操​作​系​统​类​型​</strong></span>:这​帮​助​CloudStack和​虚​拟​化​平​台​执​行​正​常​的​操​作​并​且​假​设​能​够​提​高​guest性​能​。​选​择​下​列​中​的​一​个​。​
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								如​果​你​需​要​的​操​作​系​统​在​ISO镜​像​被​列​出​来​，请​选​择​它​。​
							</div></li><li class="listitem"><div class="para">
								如​果​ISO操​作​系​统​类​型​没​有​被​列​出​或​者​ISO是​不​可​引​导​的​，选​择​Other。​
							</div></li><li class="listitem"><div class="para">
								(仅​针​对​XenServer) 如​果​你​想​从​这​个​ISO引​导​以​PV 模​式​，选​择​ Other PV (32-bit) or Other PV(64-bit)
							</div></li><li class="listitem"><div class="para">
								(仅​针​对​KVM) 如​果​你​选​择​一​个​操​作​系​统​是​PV-enabled， 
从​这​个​ISO创​建​的​虚​拟​机​会​有​一​个​SCSI(virtio)引​导​磁​盘​。​如​果​这​个​操​作​系​统​没​有​
PV-enabled,虚​拟​机​将​有​一​个​IDE引​导​磁​盘​。​PV-enabled 类​型​是​:
							</div><div class="informaltable"><table border="1"><colgroup><col width="33%"><col width="33%"><col width="33%"></colgroup><tbody><tr><td class="" align="left">
												<div class="para">
													Fedora 13
												</div>
											</td><td class="" align="left">
												<div class="para">
													Fedora 12
												</div>
											</td><td class="" align="left">
												<div class="para">
													Fedora 11
												</div>
											</td></tr><tr><td class="" align="left">
												<div class="para">
													Fedora 10
												</div>
											</td><td class="" align="left">
												<div class="para">
													Fedora 9
												</div>
											</td><td class="" align="left">
												<div class="para">
													Other PV
												</div>
											</td></tr><tr><td class="" align="left">
												<div class="para">
													Debian GNU/Linux
												</div>
											</td><td class="" align="left">
												<div class="para">
													CentOS 5.3
												</div>
											</td><td class="" align="left">
												<div class="para">
													CentOS 5.4
												</div>
											</td></tr><tr><td class="" align="left">
												<div class="para">
													CentOS 5.5
												</div>
											</td><td class="" align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.3
												</div>
											</td><td class="" align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.4
												</div>
											</td></tr><tr><td class="" align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.5
												</div>
											</td><td class="" align="left">
												<div class="para">
													Red Hat Enterprise Linux 6
												</div>
											</td><td class="" align="left">
											</td></tr></tbody></table></div></li></ul></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							不​建​议​选​择​一​个​比​镜​像​操​作​系​统​老​的​版​本​。​比​如​，选​择​CentOS 5.4 
去​支​持​一​个​CentOS6.2的​镜​像​通​常​会​导​致​不​能​工​作​。​在​这​种​情​况​下​，去​选​择​Other。​
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Extractable</strong></span>: Choose Yes if the ISO should be available for extraction.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>: Choose Yes if this ISO should be available to other users.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>精​选​</strong></span>: 如​果​你​想​让​这​个​ISO更​显​著​为​了​让​用​户​选​择​的​话​，请​选​中​这​个​选​项​。​这​个​ISO将​会​显​示​到​精​选​ISOs列​表​中​。​只​有​管​理​员​可​以​制​作​一​个​ISO精​选​。​
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​确​定​。​
			</div><div class="para">
				
管​理​控​制​服​务​器​将​下​载​那​个​ISO。​依​赖​与​那​个​ISO的​大​小​，下​载​过​程​可​能​会​用​很​长​时​间
​。​ISO 
状​态​栏​将​会​显​示​Ready当​它​已​经​成​功​被​下​载​到​第​二​存​储​上​的​时​候​。​点​击​刷​新​更​新​下​载
​率​。​
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>要​点​</strong></span>: 
等​ISO下​载​完​成​的​过​程​中​。​如​果​你​想​执​行​下​一​个​任​务​并​且​试​着​正​常​使​用​这​个​ISO，这​将
​会​失​败​。​完​整​的​ISO必​须​是​有​效​的​在​CloudStack能​够​使​用​它​之​前​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="attach-iso-to-vm" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">10.11.2.&nbsp;附​加​ISO到​虚​拟​机​</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​左​侧​的​导​航​菜​单​中​，点​击​实​例​。​
			</div></li><li class="listitem"><div class="para">
				选​择​要​使​用​的​虚​拟​机​。​
			</div></li><li class="listitem"><div class="para">
				Click the Attach ISO button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/iso-icon.png" alt="iso.png: depicts adding an iso image"></span>
			</div></li><li class="listitem"><div class="para">
				在​附​加​ISO对​话​框​中​，选​择​所​需​的​ISO。​
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div></div></div><div xml:lang="zh-CN" class="chapter" id="working-with-hosts" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;11&nbsp;章&nbsp;Working With Hosts</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#adding-hosts">11.1. Adding Hosts</a></span></dt><dt><span class="section"><a href="#scheduled-maintenance-maintenance-mode-hosts">11.2. 主​机​定​期​维​护​和​维​护​模​式​</a></span></dt><dd><dl><dt><span class="section"><a href="#vcenter-maintenance-mode">11.2.1. vCenter and Maintenance Mode</a></span></dt><dt><span class="section"><a href="#xenserver-maintenance-mode">11.2.2. XenServer和​维​护​模​式​</a></span></dt></dl></dd><dt><span class="section"><a href="#disable-enable-zones-pods-clusters">11.3. Disabling and Enabling Zones, Pods, and Clusters</a></span></dt><dt><span class="section"><a href="#removing-hosts">11.4. 移​除​主​机​</a></span></dt><dd><dl><dt><span class="section"><a href="#removing-xenserver-kvm-hosts">11.4.1. 移​除​XenServer和​KVM宿​主​机​</a></span></dt><dt><span class="section"><a href="#removing-vsphere-hosts">11.4.2. 移​除​vSphere 主​机​</a></span></dt></dl></dd><dt><span class="section"><a href="#re-install-hosts">11.5. 重​新​安​装​主​机​</a></span></dt><dt><span class="section"><a href="#maintain-hypervisors-on-hosts">11.6. 维​护​主​机​上​的​虚​拟​机​管​理​器​</a></span></dt><dt><span class="section"><a href="#change-host-password">11.7. 更​改​主​机​密​码​</a></span></dt><dt><span class="section"><a href="#host-allocation">11.8. 主​机​分​配​</a></span></dt><dd><dl><dt><span class="section"><a href="#over-provisioning-service-offering-limits">11.8.1. 超​配​和​服​务​提​供​方​案​的​限​制​</a></span></dt></dl></dd><dt><span class="section"><a href="#vlan-provisioning">11.9. vlan 配​置​</a></span></dt></dl></div><div class="section" id="adding-hosts"><div class="titlepage"><div><div><h2 class="title">11.1.&nbsp;Adding Hosts</h2></div></div></div><div class="para">
			Additional hosts can be added at any time to provide more capacity for guest VMs. For requirements and instructions, see <a class="xref" href="#host-add">第&nbsp;7.6&nbsp;节 “Adding a Host”</a>.
		</div></div><div xml:lang="zh-CN" class="section" id="scheduled-maintenance-maintenance-mode-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.2.&nbsp;主​机​定​期​维​护​和​维​护​模​式​</h2></div></div></div><div class="para">
		
您​可​以​将​主​机​置​于​维​护​模​式​。​维​护​模​式​被​激​活​时​，主​机​将​无​法​接​收​新​的​客​户​虚​拟​机​，
并​且​已​经​在​主​机​上​运​行​的​虚​拟​机​被​无​缝​地​迁​移​到​另​一​台​不​在​维​护​模​式​下​的​主​机​上​。​
迁​移​使​用​实​时​迁​移​技​术​和​不​中​断​客​户​的​执​行​。​
	</div><div xml:lang="zh-CN" class="section" id="vcenter-maintenance-mode" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">11.2.1.&nbsp;vCenter and Maintenance Mode</h3></div></div></div><div class="para">
		To enter maintenance mode on a vCenter host, both vCenter and 
CloudStack must be used in concert. CloudStack and vCenter have separate
 maintenance modes that work closely together.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Place the host into CloudStack's "scheduled maintenance" mode. This 
does not invoke the vCenter maintenance mode, but only causes VMs to be 
migrated off the host
			</div><div class="para">
				When the CloudStack maintenance mode is requested, the host first 
moves into the Prepare for Maintenance state. In this state it cannot be
 the target of new guest VM starts. Then all VMs will be migrated off 
the server. Live migration will be used to move VMs off the host. This 
allows the guests to be migrated to other hosts with no disruption to 
the guests. After this migration is completed, the host will enter the 
Ready for Maintenance mode.
			</div></li><li class="listitem"><div class="para">
				Wait for the "Ready for Maintenance" indicator to appear in the UI.
			</div></li><li class="listitem"><div class="para">
				Now use vCenter to perform whatever actions are necessary to 
maintain the host. During this time, the host cannot be the target of 
new VM allocations.
			</div></li><li class="listitem"><div class="para">
				When the maintenance tasks are complete, take the host out of maintenance mode as follows:
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						First use vCenter to exit the vCenter maintenance mode.
					</div><div class="para">
						This makes the host ready for CloudStack to reactivate it.
					</div></li><li class="listitem"><div class="para">
						Then use CloudStack's administrator UI to cancel the CloudStack maintenance mode
					</div><div class="para">
						When the host comes back online, the VMs that were migrated off of
 it may be migrated back to it manually and new VMs can be added.
					</div></li></ol></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="xenserver-maintenance-mode" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">11.2.2.&nbsp;XenServer和​维​护​模​式​</h3></div></div></div><div class="para">
		
使​用​XenServer的​时​候​,可​以​在​xencenter中​对​某​一​台​服​务​器​启​用​维​护​模​式​,将​该​服​务​
器​暂​时​置​于​离​线​状​态​,当​你​对​服​务​器​启​用​维​护​模​式​的​时​候​,所​有​在​该​台​服​务​器​运​行​的​
VM,将​自​动​的​迁​移​到​同​一​个​资​源​池​中​的​其​他​服​务​器​.如​果​原​来​该​服​务​器​是​资​源​池​的​主​
服​务​器​,一​个​新​的​主​服​务​器​将​自​动​产​生​并​履​职​.当​一​台​服​务​器​处​于​维​护​模​式​的​时​候​,不
​能​在​其​上​执​行​创​建​VM等​操​作​.
	</div><div class="para">
		下​面​来​简​单​描​述​如​何​将​一​个​服​务​器​启​用​维​护​模​式​.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​资​源​栏​中​,选​择​一​台​服​务​器​,然​后​选​择​执​行​如​下​某​一​个​操​作​.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						右​键​,在​弹​出​菜​单​选​择​ Enter Maintenance Mode
					</div></li><li class="listitem"><div class="para">
						On the Server menu, click Enter Maintenance Mode.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Enter Maintenance Mode.
			</div></li></ol></div><div class="para">
		资​源​栏​中​的​服​务​器​状​态​将​会​显​示​所​有​正​在​该​服​务​器​上​运​行​的​VM将​会​成​功​从​该​服​务​器​迁​移​至​同​资​源​池​中​的​其​他​服​务​器​.
	</div><div class="para">
		下​面​来​简​单​描​述​如​何​将​一​个​服​务​器​退​出​维​护​模​式​.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​资​源​栏​中​,选​择​一​台​服​务​器​,然​后​选​择​执​行​如​下​某​一​个​操​作​.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						右​键​,在​弹​出​菜​单​选​择​ Exit Maintenance Mode
					</div></li><li class="listitem"><div class="para">
						On the Server menu, click Exit Maintenance Mode.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Exit Maintenance Mode.
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="disable-enable-zones-pods-clusters" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.3.&nbsp;Disabling and Enabling Zones, Pods, and Clusters</h2></div></div></div><div class="para">
		You can enable or disable a zone, pod, or cluster without permanently 
removing it from the cloud. This is useful for maintenance or when there
 are problems that make a portion of the cloud infrastructure 
unreliable. No new allocations will be made to a disabled zone, pod, or 
cluster until its state is returned to Enabled. When a zone, pod, or 
cluster is first added to the cloud, it is Disabled by default.
	</div><div class="para">
		To disable and enable a zone, pod, or cluster:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as administrator
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Infrastructure.
			</div></li><li class="listitem"><div class="para">
				In Zones, click View More.
			</div></li><li class="listitem"><div class="para">
				If you are disabling or enabling a zone, find the name of the zone in the list, and click the Enable/Disable button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable.png" alt="enable-disable.png: button to enable or disable zone, pod, or cluster."></span>

			</div></li><li class="listitem"><div class="para">
				If you are disabling or enabling a pod or cluster, click the name of the zone that contains the pod or cluster.
			</div></li><li class="listitem"><div class="para">
				点​击​计​算​标​签​。​
			</div></li><li class="listitem"><div class="para">
				In the Pods or Clusters node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click the pod or cluster name in the list.
			</div></li><li class="listitem"><div class="para">
				Click the Enable/Disable button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable.png"></span>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="removing-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.4.&nbsp;移​除​主​机​</h2></div></div></div><div class="para">
		主​机​可​以​按​照​需​要​从​云​中​移​除​。​移​除​主​机​的​过​程​取​决​于​hypervisor的​类​型​。​
	</div><div xml:lang="zh-CN" class="section" id="removing-xenserver-kvm-hosts" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">11.4.1.&nbsp;移​除​XenServer和​KVM宿​主​机​</h3></div></div></div><div class="para">
		主​机​进​入​维​护​模​式​才​能​在​集​群​中​移​除​。​该​宿​主​机​上​所​有​的​虚​拟​机​已​经​迁​移​到​其​他​宿​主​机​上​之​后​才​能​进​入​维​护​模​式​。​从​cloud中​移​除​宿​主​机​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				将​节​点​置​于​维​护​模​式​。​
			</div><div class="para">
				详​见​ <a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">第&nbsp;11.2&nbsp;节 “主​机​定​期​维​护​和​维​护​模​式​”</a>.
			</div></li><li class="listitem"><div class="para">
				For KVM, stop the cloudstack-agent service.
			</div></li><li class="listitem"><div class="para">
				点​击​用​户​界​面​中​的​删​除​按​钮​删​除​节​点​。​
			</div><div class="para">
				然​后​你​就​可​以​关​闭​这​台​已​被​移​除​的​宿​主​机​，重​新​使​用​它​的​IP，重​装​它​，等​等​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="removing-vsphere-hosts" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">11.4.2.&nbsp;移​除​vSphere 主​机​</h3></div></div></div><div class="para">
		如​果​要​移​除​这​种​类​型​的​主​机​，首​先​将​其​设​置​为​维​护​模​式​，请​参​照​<a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">第&nbsp;11.2&nbsp;节 “主​机​定​期​维​护​和​维​护​模​式​”</a>。
​然​后​使​用​ CloudStack 删​除​主​机​。​CloudStack 
将​不​会​直​接​管​理​这​台​已​经​被​CloudStack 
删​除​的​主​机​。​然​而​这​台​主​机​可​能​仍​存​在​于​vCenter的​集​群​中​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="re-install-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.5.&nbsp;重​新​安​装​主​机​</h2></div></div></div><div class="para">
		在​主​机​进​入​维​护​模​式​后​，接​着​移​除​它​，你​就​可​以​重​新​安​装​主​机​。​如​果​一​个​主​机​宕​机​或​者​不​能​进​入​维​护​模​式​，在​重​新​安​装​前​仍​旧​应​该​被​移​除​。​
	</div></div><div xml:lang="zh-CN" class="section" id="maintain-hypervisors-on-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.6.&nbsp;维​护​主​机​上​的​虚​拟​机​管​理​器​</h2></div></div></div><div class="para">
		
在​虚​拟​机​管​理​器​软​件​在​主​机​上​执​行​时​，请​确​定​已​应​用​了​由​虚​拟​机​软​件​提​供​商​提​供​的​全
​部​补​丁​。​时​刻​保​持​虚​拟​机​管​理​器​软​件​的​更​新​。​本​产​品​不​会​追​踪​或​提​醒​你​虚​拟​机​管​理
​器​软​件​的​更​新​。​保​持​虚​拟​机​管​理​器​软​件​的​补​丁​最​新​很​重​要​。​虚​拟​机​管​理​器​提​供​商​很
​可​能​对​于​未​更​新​补​丁​的​系​统​不​提​供​支​持​。​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			缺​乏​最​新​补​丁​更​新​可​能​会​导​致​数​据​和​虚​拟​机​丢​失​。​
		</div></div></div><div class="para">
		(XenServer) For more information, see <a href="http://docs.cloudstack.org/Knowledge_Base/Possible_VM_corruption_if_XenServer_Hotfix_is_not_Applied/Highly_Recommended_Hotfixes_for_XenServer_5.6_SP2">Highly Recommended Hotfixes for XenServer in the CloudStack Knowledge Base</a>.
	</div></div><div xml:lang="zh-CN" class="section" id="change-host-password" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.7.&nbsp;更​改​主​机​密​码​</h2></div></div></div><div class="para">
		XenServer主​机​，kvm主​机​或​者​vSphere主​机​的​密​码​可​以​在​数​据​库​中​进​行​修​改​。​需​要​注​意​的​是​在​集​群​中​所​有​节​点​主​机​必​须​拥​有​同​样​的​密​码​。​
	</div><div class="para">
		修​改​节​点​密​码​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				验​证​所​有​集​群​主​机​。​
			</div></li><li class="listitem"><div class="para">
				修​改​集​群​所​有​主​机​密​码​。​现​在​主​机​密​码​和​已​知​的​ CloudStack 密​码​将​不​匹​配​。​在​二​者​密​码​匹​配​前​，所​有​的​对​于​集​群​的​操​作​将​失​败​。​
			</div></li><li class="listitem"><div class="para">
				
得​到​集​群​中​你​打​算​修​改​密​码​主​机​的​主​机​id列​表​。​你​需​要​通​过​访​问​数​据​库​确​定​这​些​主​
机​id。​比​如​打​算​为​主​机​名​包​含​“​h”​(或​者​vSphere 集​群​)的​修​改​密​码​，执​行​：
			</div><pre class="programlisting">mysql&gt; select id from cloud.host where name like '%h%';</pre></li><li class="listitem"><div class="para">
				将​返​回​一​个​单​独​的​id.对​应​这​些​主​机​的​id记​录​集​。​
			</div></li><li class="listitem"><div class="para">
				更​新​数​据​库​中​主​机​的​密​码​。​下​面​这​个​例​子​，我​们​修​改​主​机​id为​5,10和​12的​密​码​为​“​password”​.
			</div><pre class="programlisting">mysql&gt; update cloud.host set password='password' where id=5 or id=10 or id=12;</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="host-allocation" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.8.&nbsp;主​机​分​配​</h2></div></div></div><div class="para">
		系​统​会​选​择​最​合​适​的​宿​主​机​来​运​新​每​一​台​虚​拟​机​。​终​端​用​户​能​指​定​虚​拟​机​创​建​在​哪​个​资​源​域​。​终​端​用​户​无​权​选​择​虚​拟​机​运​行​于​哪​台​宿​主​机​。​
	</div><div class="para">
		
CloudStack管​理​员​能​指​定​特​定​宿​主​机​来​有​限​运​行​莫​特​定​类​型​的​虚​拟​机​实​例​。​比​如​，管
​理​员​能​指​定​某​台​宿​主​机​优​先​运​行​windows的​来​宾​虚​拟​机​。​默​认​的​宿​主​机​分​配​器​会​优​
先​将​该​类​型​的​来​宾​虚​拟​机​分​配​到​这​类​宿​主​机​上​。​如​果​没​有​可​用​的​这​类​宿​主​机​，分​配​器
​将​会​把​来​宾​虚​拟​机​安​排​在​任​意​满​足​该​虚​拟​机​硬​件​要​求​的​宿​主​机​上​。​
	</div><div class="para">
		
垂​直​分​配​和​水​平​分​配​均​被​支​持​。​垂​直​分​配​将​优​先​将​虚​拟​机​分​配​到​一​台​宿​主​机​上​（直​到
​不​能​分​配​为​止​）。​这​能​降​低​电​力​消​耗​。​水​平​分​配​以​一​种​轮​训​的​方​式​将​虚​拟​机​分​配​到​
各​个​宿​主​机​上​。​这​能​在​一​些​情​况​下​带​来​更​好​的​性​。​CloudStack通​过​管​理​员​的​配​置​支​
持​CPU超​限​分​配​，。​超​限​分​配​允​许​管​理​员​配​置​超​过​物​理​CPU能​力​若​干​倍​的​分​配​量​。​
	</div><div class="para">
		CloudStack也​支​持​一​种​插​件​似​的​接​口​添​加​新​的​分​配​器​。​这​些​自​定​义​的​分​配​器​能​提​供​任​意​管​理​员​七​万​个​分​配​策​略​。​
	</div><div xml:lang="zh-CN" class="section" id="over-provisioning-service-offering-limits" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">11.8.1.&nbsp;超​配​和​服​务​提​供​方​案​的​限​制​</h3></div></div></div><div class="para">
		CloudStack 的​CPU资​源​超​配​是​基​于​管​理​员​设​置​的​超​配​比​例​的​。​这​在​全​局​变​量​cpu.overprovisioning.factor中​定​义​。​
	</div><div class="para">
		CloudStack 的​CPU资​源​超​配​是​基​于​管​理​员​设​置​的​超​配​比​例​的​。​这​在​全​局​变​量​cpu.overprovisioning.factor中​定​义​。​
	</div><div class="para">
		
服​务​提​供​方​案​限​制​（比​如​1G主​频​，1核​）严​格​执​行​核​心​数​。​比​如​，一​个​使​用​分​配​有​一​个​核
​心​服​务​方​案​的​来​宾​，会​只​有​一​个​核​心​可​用​，不​管​主​机​上​其​它​的​活​动​。​
	</div><div class="para">
		
服​务​方​案​限​制​为​千​兆​的​，执​行​CPU资​源​争​用​机​制​。​比​如​，假​设​一​个​来​宾​使​用​1GHz的​服​务
​提​供​方​案​，而​它​所​在​的​主​机​有​一​个​2GHz的​核​心​，并​且​该​来​宾​是​此​主​机​上​唯​一​运​行​的​实
​例​。​这​个​来​宾​将​可​以​使​用​2GHz的​cpu资​源​。​当​多​个​来​宾​打​算​使​用​CPU资​源​时​，一​个​权​
衡​机​制​将​用​来​分​配​CPU资​源​。​权​重​值​基​于​来​宾​所​使​用​的​服​务​提​供​方​案​中​指​定​的​时​钟​频
​率​。​来​宾​被​分​配​的​CPU资​源​将​服​务​提​供​方​案​中​相​应​的​频​率​执​行​。​比​如​，一​个​使​用​
2GHz服​务​提​供​方​案​的​来​宾​将​获​得​使​用​1GHz服​务​提​供​方​案​的​来​宾​CPU资​源​的​两​倍​，。​
CloudStack 不​支​持​内​存​超​额​分​配​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="vlan-provisioning" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">11.9.&nbsp;vlan 配​置​</h2></div></div></div><div class="para">
		CloudStack automatically creates and destroys interfaces bridged to 
VLANs on the hosts. In general the administrator does not need to manage
 this process.
	</div><div class="para">
		CloudStack manages VLANs differently based on hypervisor type. For 
XenServer or KVM, the VLANs are created on only the hosts where they 
will be used and then they are destroyed when all guests that require 
them have been terminated or moved to another host.
	</div><div class="para">
		For vSphere the VLANs are provisioned on all hosts in the cluster even
 if there is no guest running on a particular Host that requires the 
VLAN. This allows the administrator to perform live migration and other 
functions in vCenter without having to create the VLAN on the 
destination Host. Additionally, the VLANs are not removed from the Hosts
 when they are no longer needed.
	</div><div class="para">
		You can use the same VLANs on different physical networks provided 
that each physical network has its own underlying layer-2 
infrastructure, such as switches. For example, you can specify VLAN 
range 500 to 1000 while deploying physical networks A and B in an 
Advanced zone setup. This capability allows you to set up an additional 
layer-2 physical infrastructure on a different physical NIC and use the 
same set of VLANs if you run out of VLANs. Another advantage is that you
 can use the same set of IPs for different customers, each one with 
their own routers and the guest networks on different physical NICs.
	</div></div></div><div xml:lang="zh-CN" class="chapter" id="working-with-templates" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;12&nbsp;章&nbsp;使​用​模​板​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#create-templates-overview">12.1. 创​建​模​板​概​览​</a></span></dt><dt><span class="section"><a href="#requirements-templates">12.2. 针​对​模​板​的​需​求​</a></span></dt><dt><span class="section"><a href="#best-practices-templates">12.3. 模​板​最​佳​实​践​</a></span></dt><dt><span class="section"><a href="#default-template">12.4. 默​认​模​版​</a></span></dt><dt><span class="section"><a href="#private-public-template">12.5. 私​有​模​板​和​公​共​模​板​</a></span></dt><dt><span class="section"><a href="#create-template-from-existing-vm">12.6. 通​过​已​存​在​的​虚​拟​机​创​建​模​板​</a></span></dt><dt><span class="section"><a href="#create-template-from-snapshot">12.7. 从​一​个​快​照​创​建​一​个​模​板​</a></span></dt><dt><span class="section"><a href="#upload-template">12.8. Uploading Templates</a></span></dt><dt><span class="section"><a href="#export-template">12.9. 导​出​模​板​</a></span></dt><dt><span class="section"><a href="#create-windows-template">12.10. 创​建​WINdows 模​板​</a></span></dt><dd><dl><dt><span class="section"><a href="#sysprep-windows-server-2008R2">12.10.1. System Preparation for Windows Server 2008 R2</a></span></dt><dt><span class="section"><a href="#sysprep-for-windows-server-2003R2">12.10.2. System Preparation for Windows Server 2003 R2</a></span></dt></dl></dd><dt><span class="section"><a href="#import-ami">12.11. Importing Amazon Machine Images</a></span></dt><dt><span class="section"><a href="#convert-hyperv-vm-to-template">12.12. 转​换​Hyper-v 虚​拟​机​为​模​板​</a></span></dt><dt><span class="section"><a href="#add-password-management-to-templates">12.13. Adding Password Management to Your Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#linux-installation">12.13.1. Linux系​统​安​装​</a></span></dt><dt><span class="section"><a href="#windows-installation">12.13.2. Windows OS 安​装​</a></span></dt></dl></dd><dt><span class="section"><a href="#delete-templates">12.14. 删​除​模​板​</a></span></dt></dl></div><div class="para">
		模​板​相​当​于​虚​拟​机​的​重​用​配​置​。​当​用​户​创​建​虚​拟​机​时​能​从​CloudStack的​模​板​列​表​中​选​择​一​个​。​
	</div><div class="para">
		
特​殊​情​况​下​，模​板​可​以​是​一​个​包​含​一​个​或​多​个​操​作​系​统​的​虚​拟​磁​盘​镜​像​，你​可​以​选​择​
性​的​安​装​另​外​的​软​件​，比​如​office应​用​并​设​置​访​问​控​制​来​君​顶​谁​能​使​用​这​个​模​板​。​每
​个​模​板​对​应​一​个​一​般​类​型​的​hypervisor，这​个​hypervisor是​在​添​加​入​CloudStack时​
指​定​的​。​
	</div><div class="para">
		CloudStack附​带​一​个​默​认​模​板​。​为​了​向​用​户​呈​现​出​更​多​选​择​CloudStack管​理​员​和​用​户​能​创​建​模​板​并​添​加​到​CloudStack中​。​
	</div><div xml:lang="zh-CN" class="section" id="create-templates-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.1.&nbsp;创​建​模​板​概​览​</h2></div></div></div><div class="para">
		CloudStack默​认​已​经​有​了​一​个​CentOS的​默​认​模​板​。​有​许​多​添​加​更​多​模​板​的​方​法​，管​理​员​和​普​通​用​户​均​能​添​加​。​一​般​是​这​样​的​顺​序​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				运​行​一​个​你​想​要​的​操​作​系​统​的​虚​拟​机​实​例​，并​进​行​一​些​你​需​要​的​设​置​。​
			</div></li><li class="listitem"><div class="para">
				关​闭​这​虚​拟​机​。​
			</div></li><li class="listitem"><div class="para">
				将​卷​转​换​为​模​板​。​
			</div></li></ol></div><div class="para">
		There are other ways to add templates to CloudStack. For example, you 
can take a snapshot of the VM's volume and create a template from the 
snapshot, or import a VHD from another system into CloudStack.
	</div><div class="para">
		接​下​来​的​几​节​中​将​继​续​描​述​各​种​创​建​模​板​的​技​术​。​
	</div></div><div xml:lang="zh-CN" class="section" id="requirements-templates" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.2.&nbsp;针​对​模​板​的​需​求​</h2></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				对​于​ XenServer, 在​每​一​个​你​创​建​的​模​板​上​安​装​ PV 驱​动​ / Xen 工​具​。​ 这​将​使​动​态​迁​移​和​干​净​的​宾​客​关​机​成​为​可​能​。​
			</div></li><li class="listitem"><div class="para">
				对​于​ vSphere, 在​每​一​个​你​创​建​的​模​板​上​安​装​VMware 工​具​。​这​将​使​控​制​台​视​图​能​够​正​常​工​作​。​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="best-practices-templates" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.3.&nbsp;模​板​最​佳​实​践​</h2></div></div></div><div class="para">
		如​果​你​计​划​使​用​大​的​模​板​（100 GB 或​更​大​）, 确​保​你​有​10g 
的​网​络​以​支​持​大​的​模​板​。​ 
当​大​的​模​板​被​使​用​时​，较​慢​的​网​络​可​能​导​致​超​时​及​其​它​错​误​。​
	</div></div><div xml:lang="zh-CN" class="section" id="default-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.4.&nbsp;默​认​模​版​</h2></div></div></div><div class="para">
		CloudStack 包​含​一​个​CentOS 
模​版​。​当​主​存​储​和​二​级​存​储​配​置​完​成​后​，这​个​模​版​会​由​二​级​存​储​虚​拟​机​下​载​。​可​以​在
​生​产​部​署​中​使​用​这​个​模​版​，也​可​以​删​除​掉​它​，使​用​自​定​义​的​模​版​。​
	</div><div class="para">
		默​认​模​版​的​root用​户​密​码​是​“​password”​。​
	</div><div class="para">
		默​认​模​版​为​XenServer，KVM和​vSphere各​提​供​了​一​个​。​模​版​的​下​载​依​赖​于​云​中​使​用​了​哪​种​宿​主​机​。​每​个​模​版​大​约​是​2.5GB的​物​理​大​小​。​
	</div><div class="para">
		默​认​模​版​包​括​标​准​的​iptables 规​则​，会​阻​止​除​了​ssh以​外​的​其​他​访​问​。​
	</div><pre class="programlisting"># iptables --list
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain RH-Firewall-1-INPUT (2 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     icmp --  anywhere        anywhere       icmp any
ACCEPT     esp  --  anywhere        anywhere
ACCEPT     ah   --  anywhere        anywhere
ACCEPT     udp  --  anywhere        224.0.0.251    udp dpt:mdns
ACCEPT     udp  --  anywhere        anywhere       udp dpt:ipp
ACCEPT     tcp  --  anywhere        anywhere       tcp dpt:ipp
ACCEPT     all  --  anywhere        anywhere       state RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere        anywhere       state NEW tcp dpt:ssh
REJECT     all  --  anywhere        anywhere       reject-with icmp-host-
</pre></div><div xml:lang="zh-CN" class="section" id="private-public-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.5.&nbsp;私​有​模​板​和​公​共​模​板​</h2></div></div></div><div class="para">
		用​户​创​建​模​板​时​可​选​择​模​板​为​公​有​还​是​私​有​。​
	</div><div class="para">
		私​有​模​板​只​对​创​建​者​可​用​。​默​认​上​传​的​模​板​都​是​私​有​的​。​
	</div><div class="para">
		
当​用​户​将​模​板​标​识​为​“​公​有​”​，该​模​板​将​对​该​用​户​所​处​域​、​能​连​接​至​该​用​户​处​于​区​域
​的​其​他​域​用​户​可​用​。​这​取​决​于​zone是​设​置​成​公​用​还​是​私​有​。​私​有​区​域​被​分​配​到​一​个
​单​一​的​域​，而​公​共​区​域​能​被​任​何​域​访​问​。​
	</div></div><div xml:lang="zh-CN" class="section" id="create-template-from-existing-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.6.&nbsp;通​过​已​存​在​的​虚​拟​机​创​建​模​板​</h2></div></div></div><div class="para">
		当​你​已​经​有​了​一​台​安​妮​想​法​已​经​配​置​好​的​虚​拟​机​，你​就​能​以​他​为​原​型​创​建​别​的​虚​拟​机​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				使​用​<a class="xref" href="#creating-vms">第&nbsp;10.4&nbsp;节 “创​建​虚​拟​机​实​例​”</a>给​出​的​方​法​创​建​并​且​开​启​一​个​虚​拟​机​。​
			</div></li><li class="listitem"><div class="para">
				在​虚​拟​机​中​做​好​需​要​的​配​置​然​后​点​击​按​钮​关​闭​该​虚​拟​机​。​
			</div></li><li class="listitem"><div class="para">
				等​待​虚​拟​机​关​闭​。​当​虚​拟​机​状​态​显​示​为​“​已​停​止​”​，执​行​下​一​步​。​
			</div></li><li class="listitem"><div class="para">
				点​击​创​建​模​板​并​填​写​如​下​内​容​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>名​字​和​显​示​文​本​</strong></span>. 这​些​会​在​网​页​用​户​界​面​显​示​，所​以​建​议​写​一​些​描​述​信​息​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>系​统​类​型​</strong></span>。​这​个​选​项​有​助​于​CloudStack 和​虚​拟​机​软​件​执​行​正​确​的​操​作​和​提​高​来​宾​的​性​能​。​选​择​以​下​其​中​一​个​。​
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								如​果​已​停​止​虚​拟​机​的​系​统​在​列​表​中​就​选​择​。​
							</div></li><li class="listitem"><div class="para">
								如​果​已​停​止​虚​拟​机​系​统​类​型​不​在​列​表​中​就​选​择​其​他​。​
							</div></li><li class="listitem"><div class="para">
								如​果​你​打​算​以​PV模​式​启​动​该​模​板​，请​选​择​其​他​PV（32位​）或​其​他​PV（64位​）。​这​个​选​项​只​对​XenServer有​效​：
							</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
									
注​意​：一​般​情​况​下​你​不​应​该​选​择​一​个​比​你​镜​像​中​系​统​地​的​版​本​。​比​如​选​用​CentOS 
5.4来​支​持​CentOS6.2的​镜​像​会​导​致​启​动​失​败​。​这​种​情​况​下​你​应​该​选​择​其​他​。​
								</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>公​用​</strong></span>.选​择​是​使​模​板​对​CloudStack installation所​有​用​户​可​见​。​该​模​板​会​在​社​区​模​板​中​出​现​。​详​情​请​见​ <a class="xref" href="#private-public-template">第&nbsp;12.5&nbsp;节 “私​有​模​板​和​公​共​模​板​”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password Enabled</strong></span>. Choose Yes if your template has the CloudStack password change script installed. See <a class="xref" href="#add-password-management-to-templates">第&nbsp;12.13&nbsp;节 “Adding Password Management to Your Templates”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​。​
			</div></li></ol></div><div class="para">
		The new template will be visible in the Templates section when the 
template creation process has been completed. The template is then 
available when creating a new VM.
	</div></div><div xml:lang="zh-CN" class="section" id="create-template-from-snapshot" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.7.&nbsp;从​一​个​快​照​创​建​一​个​模​板​</h2></div></div></div><div class="para">
		如​果​你​不​想​为​了​使​用​Create Template 菜​单​项​而​停​止​虚​拟​机​（如​在​<a class="xref" href="#create-template-from-existing-vm">第&nbsp;12.6&nbsp;节 “通​过​已​存​在​的​虚​拟​机​创​建​模​板​”</a>中​描​述​的​）， 你​可​以​通​过​ CloudStack 用​户​界​面​从​任​何​快​照​直​接​创​建​模​板​。​
	</div></div><div xml:lang="zh-CN" class="section" id="upload-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.8.&nbsp;Uploading Templates</h2></div></div></div><div class="warning"><div class="admonition_header"><h2>vSphere Templates and ISOs</h2></div><div class="admonition"><div class="para">
			If you are uploading a template that was created using vSphere 
Client, be sure the OVA file does not contain an ISO. If it does, the 
deployment of VMs from the template will fail.
		</div></div></div><div class="para">
		Templates are uploaded based on a URL. HTTP is the supported access 
protocol. Templates are frequently large files. You can optionally gzip 
them to decrease upload times.
	</div><div class="para">
		To upload a template:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​，点​击​模​板​。​
			</div></li><li class="listitem"><div class="para">
				Click Register Template.
			</div></li><li class="listitem"><div class="para">
				Provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name and Description</strong></span>. These will be shown in the UI, so choose something descriptive.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>URL</strong></span>. The Management Server will download the file from the specified URL, such as http://my.web.server/filename.vhd.gz.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>. Choose the zone where you want the template to be available, or All Zones to make it available throughout CloudStack.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>OS Type</strong></span>: This 
helps CloudStack and the hypervisor perform certain operations and make 
assumptions that improve the performance of the guest. Select one of the
 following:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								If the operating system of the stopped VM is listed, choose it.
							</div></li><li class="listitem"><div class="para">
								If the OS type of the stopped VM is not listed, choose Other.
							</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
									You should not choose an older version of the OS than the 
version in the image. For example, choosing CentOS 5.4 to support a 
CentOS 6.2 image will in general not work. In those cases you should 
choose Other.
								</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor</strong></span>: The supported hypervisors are listed. Select the desired one.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Format</strong></span>. The format of the template upload file, such as VHD or OVA.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password Enabled</strong></span>. 
Choose Yes if your template has the CloudStack password change script 
installed. See Adding Password Management to Your Templates
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Extractable</strong></span>. 
Choose Yes if the template is available for extraction. If this option 
is selected, end users can download a full image of a template.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>公​用​</strong></span>.选​择​是​使​模​板​对​CloudStack installation所​有​用​户​可​见​。​该​模​板​会​在​社​区​模​板​中​出​现​。​详​情​请​见​ <a class="xref" href="#private-public-template">第&nbsp;12.5&nbsp;节 “私​有​模​板​和​公​共​模​板​”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Featured</strong></span>. Choose 
Yes if you would like this template to be more prominent for users to 
select. The template will appear in the Featured Templates list. Only an
 administrator can make a template Featured.
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="export-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.9.&nbsp;导​出​模​板​</h2></div></div></div><div class="para">
		最​终​用​户​和​管​理​员​可​以​从​CloudStack 导​出​模​板​。​导​航​到​用​户​界​面​中​的​模​板​并​选​择​Actions菜​单​中​的​Download功​能​。​
	</div></div><div xml:lang="zh-CN" class="section" id="create-windows-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.10.&nbsp;创​建​WINdows 模​板​</h2></div></div></div><div class="para">
		创​建​Windows模​板​必​须​完​成​公​用​Sysprep（卷​快​照​）创​建​。​Sysprep（卷​快​照​）允​许​你​创​建​一​个​通​用​的​WINdows模​板​并​避​免​任​何​可​能​的​SID冲​突​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			
在​XenServer上​运​行​Windows虚​拟​机​需​要​PV驱​动​支​持​，用​来​在​虚​拟​机​创​建​后​创​建​模​板​。
​PV驱​动​程​序​需​要​基​本​的​管​理​功​能​，以​及​一​些​额​外​的​卷​容​量​、​ISO镜​像​、​实​时​迁​移​功​能
​和​可​以​正​常​关​机​。​
		</div></div></div><div class="para">
	</div><div class="para">
		安​装​步​骤​概​述​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				上​传​WINdows 系​统​安​装​ISO文​件​.
			</div><div class="para">
				For more information, see <a class="xref" href="#add-iso">第&nbsp;10.11.1&nbsp;节 “添​加​一​个​ISO”</a>.
			</div></li><li class="listitem"><div class="para">
				使​用​刚​上​传​的​Windows ISO创​建​一​个​实​例​。​
			</div><div class="para">
				For more information, see <a class="xref" href="#creating-vms">第&nbsp;10.4&nbsp;节 “创​建​虚​拟​机​实​例​”</a>.
			</div></li><li class="listitem"><div class="para">
				按​照​需​求​创​建​WIN 2008 R2或​WIN2003 R2 卷​快​照​。​
			</div></li><li class="listitem"><div class="para">
				准​备​步​骤​完​成​，现​在​可​以​创​建​WINdows模​板​了​。​
			</div></li></ol></div><div xml:lang="zh-CN" class="section" id="sysprep-windows-server-2008R2" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">12.10.1.&nbsp;System Preparation for Windows Server 2008 R2</h3></div></div></div><div class="para">
		For Windows 2008 R2, you run Windows System Image Manager to create a 
custom sysprep response XML file. Windows System Image Manager is 
installed as part of the Windows Automated Installation Kit (AIK). 
Windows AIK can be downloaded from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=9085">Microsoft Download Center</a>.
	</div><div class="para">
		Use the following steps to run sysprep for Windows 2008 R2:
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			The steps outlined here are derived from the excellent guide by Charity Shelbourne, originally published at <a href="http://blogs.technet.com/askcore/archive/2008/10/31/automating-the-oobe-process-during-windows-server-2008-sysprep-mini-setup.aspx">Windows Server 2008 Sysprep Mini-Setup.</a>
		</div></div></div><div class="para">
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Download and install the Windows AIK
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					Windows AIK should not be installed on the Windows 2008 R2 VM you 
just created. Windows AIK should not be part of the template you create.
 It is only used to create the sysprep answer file.
				</div></div></div></li><li class="listitem"><div class="para">
				Copy the install.wim file in the \sources directory of the Windows 
2008 R2 installation DVD to the hard disk. This is a very large file and
 may take a long time to copy. Windows AIK requires the WIM file to be 
writable.
			</div></li><li class="listitem"><div class="para">
				Start the Windows System Image Manager, which is part of the Windows AIK.
			</div></li><li class="listitem"><div class="para">
				In the Windows Image pane, right click the Select a Windows image or
 catalog file option to load the install.wim file you just copied.
			</div></li><li class="listitem"><div class="para">
				Select the Windows 2008 R2 Edition.
			</div><div class="para">
				You may be prompted with a warning that the catalog file cannot be opened. Click Yes to create a new catalog file.
			</div></li><li class="listitem"><div class="para">
				In the Answer File pane, right click to create a new answer file.
			</div></li><li class="listitem"><div class="para">
				Generate the answer file from the Windows System Image Manager using the following steps:
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						The first page you need to automate is the Language and Country or
 Region Selection page. To automate this, expand Components in your 
Windows Image pane, right-click and add the 
Microsoft-Windows-International-Core setting to Pass 7 oobeSystem. In 
your Answer File pane, configure the InputLocale, SystemLocale, 
UILanguage, and UserLocale with the appropriate settings for your 
language and country or region. Should you have a question about any of 
these settings, you can right-click on the specific setting and select 
Help. This will open the appropriate CHM help file with more 
information, including examples on the setting you are attempting to 
configure.
					</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/sysmanager.png" alt="sysmanager.png: System Image Manager" width="444"></div></li><li class="listitem"><div class="para">
						You need to automate the Software License Terms Selection page, 
otherwise known as the End-User License Agreement (EULA). To do this, 
expand the Microsoft-Windows-Shell-Setup component. High-light the OOBE 
setting, and add the setting to the Pass 7 oobeSystem. In Settings, set 
HideEULAPage true.
					</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/software-license.png" alt="software-license.png: Depicts hiding the EULA page." width="444"></div></li><li class="listitem"><div class="para">
						Make sure the license key is properly set. If you use MAK key, you
 can just enter the MAK key on the Windows 2008 R2 VM. You need not 
input the MAK into the Windows System Image Manager. If you use KMS host
 for activation you need not enter the Product Key. Details of Windows 
Volume Activation can be found at <a href="http://technet.microsoft.com/en-us/library/bb892849.aspx">http://technet.microsoft.com/en-us/library/bb892849.aspx</a>
					</div></li><li class="listitem"><div class="para">
						You need to automate is the Change Administrator Password page. 
Expand the Microsoft-Windows-Shell-Setup component (if it is not still 
expanded), expand UserAccounts, right-click on AdministratorPassword, 
and add the setting to the Pass 7 oobeSystem configuration pass of your 
answer file. Under Settings, specify a password next to Value.
					</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/change-admin-password.png" alt="change-admin-password.png: Depicts changing the administrator password" width="444"></div><div class="para">
						You may read the AIK documentation and set many more options that 
suit your deployment. The steps above are the minimum needed to make 
Windows unattended setup work.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Save the answer file as unattend.xml. You can ignore the warning messages that appear in the validation window.
			</div></li><li class="listitem"><div class="para">
				Copy the unattend.xml file into the c:\windows\system32\sysprep directory of the Windows 2008 R2 Virtual Machine
			</div></li><li class="listitem"><div class="para">
				Once you place the unattend.xml file in c:\windows\system32\sysprep directory, you run the sysprep tool as follows:
			</div><pre class="programlisting">cd c:\Windows\System32\sysprep
sysprep.exe /oobe /generalize /shutdown
</pre><div class="para">
				The Windows 2008 R2 VM will automatically shut down after sysprep is complete.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="sysprep-for-windows-server-2003R2" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">12.10.2.&nbsp;System Preparation for Windows Server 2003 R2</h3></div></div></div><div class="para">
		Earlier versions of Windows have a different sysprep tool. Follow these steps for Windows Server 2003 R2.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Extract the content of \support\tools\deploy.cab on the Windows 
installation CD into a directory called c:\sysprep on the Windows 2003 
R2 VM.
			</div></li><li class="listitem"><div class="para">
				Run c:\sysprep\setupmgr.exe to create the sysprep.inf file.
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						Select Create New to create a new Answer File.
					</div></li><li class="listitem"><div class="para">
						Enter “​Sysprep setup”​ for the Type of Setup.
					</div></li><li class="listitem"><div class="para">
						Select the appropriate OS version and edition.
					</div></li><li class="listitem"><div class="para">
						On the License Agreement screen, select “​Yes fully automate the installation”​.
					</div></li><li class="listitem"><div class="para">
						Provide your name and organization.
					</div></li><li class="listitem"><div class="para">
						Leave display settings at default.
					</div></li><li class="listitem"><div class="para">
						Set the appropriate time zone.
					</div></li><li class="listitem"><div class="para">
						Provide your product key.
					</div></li><li class="listitem"><div class="para">
						Select an appropriate license mode for your deployment
					</div></li><li class="listitem"><div class="para">
						Select “​Automatically generate computer name”​.
					</div></li><li class="listitem"><div class="para">
						Type a default administrator password. If you enable the password 
reset feature, the users will not actually use this password. This 
password will be reset by the instance manager after the guest boots up.
					</div></li><li class="listitem"><div class="para">
						Leave Network Components at “​Typical Settings”​.
					</div></li><li class="listitem"><div class="para">
						Select the “​WORKGROUP”​ option.
					</div></li><li class="listitem"><div class="para">
						Leave Telephony options at default.
					</div></li><li class="listitem"><div class="para">
						Select appropriate Regional Settings.
					</div></li><li class="listitem"><div class="para">
						Select appropriate language settings.
					</div></li><li class="listitem"><div class="para">
						Do not install printers.
					</div></li><li class="listitem"><div class="para">
						Do not specify “​Run Once commands”​.
					</div></li><li class="listitem"><div class="para">
						You need not specify an identification string.
					</div></li><li class="listitem"><div class="para">
						Save the Answer File as c:\sysprep\sysprep.inf.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Run the following command to sysprep the image:
			</div><pre class="programlisting">c:\sysprep\sysprep.exe -reseal -mini -activated</pre><div class="para">
				After this step the machine will automatically shut down
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="import-ami" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.11.&nbsp;Importing Amazon Machine Images</h2></div></div></div><div class="para">
		The following procedures describe how to import an Amazon Machine 
Image (AMI) into CloudStack when using the XenServer hypervisor.
	</div><div class="para">
		Assume you have an AMI file and this file is called CentOS_6.2_x64. 
Assume further that you are working on a CentOS host. If the AMI is a 
Fedora image, you need to be working on a Fedora host initially.
	</div><div class="para">
		You need to have a XenServer host with a file-based storage repository
 (either a local ext3 SR or an NFS SR) to convert to a VHD once the 
image file has been customized on the Centos/Fedora host.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			当​拷​贝​粘​贴​一​条​命​令​, 确​保​在​运​行​前​粘​贴​的​命​令​在​一​行​上​. 一​些​文​档​查​看​器​可​能​会​在​拷​贝​时​引​入​不​希​望​的​换​行​符​.
		</div></div></div><div class="para">
	</div><div class="para">
		To import an AMI:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Set up loopback on image file:
			</div><pre class="programlisting"># mkdir -p /mnt/loop/centos62
# mount -o loop  CentOS_6.2_x64 /mnt/loop/centos54
</pre></li><li class="listitem"><div class="para">
				Install the kernel-xen package into the image. This downloads the PV kernel and ramdisk to the image.
			</div><pre class="programlisting"># yum -c /mnt/loop/centos54/etc/yum.conf --installroot=/mnt/loop/centos62/ -y install kernel-xen</pre></li><li class="listitem"><div class="para">
				Create a grub entry in /boot/grub/grub.conf.
			</div><pre class="programlisting"># mkdir -p /mnt/loop/centos62/boot/grub
# touch /mnt/loop/centos62/boot/grub/grub.conf
# echo "" &gt; /mnt/loop/centos62/boot/grub/grub.conf
</pre></li><li class="listitem"><div class="para">
				Determine the name of the PV kernel that has been installed into the image.
			</div><pre class="programlisting"># cd /mnt/loop/centos62
# ls lib/modules/
2.6.16.33-xenU  2.6.16-xenU  2.6.18-164.15.1.el5xen  2.6.18-164.6.1.el5.centos.plus  2.6.18-xenU-ec2-v1.0  2.6.21.7-2.fc8xen  2.6.31-302-ec2
# ls boot/initrd*
boot/initrd-2.6.18-164.6.1.el5.centos.plus.img boot/initrd-2.6.18-164.15.1.el5xen.img
# ls boot/vmlinuz*
boot/vmlinuz-2.6.18-164.15.1.el5xen  boot/vmlinuz-2.6.18-164.6.1.el5.centos.plus  boot/vmlinuz-2.6.18-xenU-ec2-v1.0  boot/vmlinuz-2.6.21-2952.fc8xen
</pre><div class="para">
				Xen kernels/ramdisk always end with "xen". For the kernel version 
you choose, there has to be an entry for that version under lib/modules,
 there has to be an initrd and vmlinuz corresponding to that. Above, the
 only kernel that satisfies this condition is 2.6.18-164.15.1.el5xen.
			</div></li><li class="listitem"><div class="para">
				Based on your findings, create an entry in the grub.conf file. Below is an example entry.
			</div><pre class="programlisting">default=0
timeout=5
hiddenmenu
title CentOS (2.6.18-164.15.1.el5xen)
        root (hd0,0)
        kernel /boot/vmlinuz-2.6.18-164.15.1.el5xen ro root=/dev/xvda 
        initrd /boot/initrd-2.6.18-164.15.1.el5xen.img
</pre></li><li class="listitem"><div class="para">
				Edit etc/fstab, changing “​sda1”​ to “​xvda”​ and changing “​sdb”​ to “​xvdb”​.
			</div><pre class="programlisting"># cat etc/fstab
/dev/xvda  /         ext3    defaults        1 1
/dev/xvdb  /mnt      ext3    defaults        0 0
none       /dev/pts  devpts  gid=5,mode=620  0 0
none       /proc     proc    defaults        0 0
none       /sys      sysfs   defaults        0 0
</pre></li><li class="listitem"><div class="para">
				Enable login via the console. The default console device in a 
XenServer system is xvc0. Ensure that etc/inittab and etc/securetty have
 the following lines respectively:
			</div><pre class="programlisting"># grep xvc0 etc/inittab 
co:2345:respawn:/sbin/agetty xvc0 9600 vt100-nav
# grep xvc0 etc/securetty 
xvc0
</pre></li><li class="listitem"><div class="para">
				Ensure the ramdisk supports PV disk and PV network. Customize this for the kernel version you have determined above.
			</div><pre class="programlisting"># chroot /mnt/loop/centos54
# cd /boot/
# mv initrd-2.6.18-164.15.1.el5xen.img initrd-2.6.18-164.15.1.el5xen.img.bak
# mkinitrd -f /boot/initrd-2.6.18-164.15.1.el5xen.img --with=xennet --preload=xenblk --omit-scsi-modules 2.6.18-164.15.1.el5xen
</pre></li><li class="listitem"><div class="para">
				Change the password.
			</div><pre class="programlisting"># passwd
Changing password for user root.
New UNIX password: 
Retype new UNIX password: 
passwd: all authentication tokens updated successfully.
</pre></li><li class="listitem"><div class="para">
				Exit out of chroot.
			</div><pre class="programlisting"># exit</pre></li><li class="listitem"><div class="para">
				Check etc/ssh/sshd_config for lines allowing ssh login using a password.
			</div><pre class="programlisting"># egrep "PermitRootLogin|PasswordAuthentication" /mnt/loop/centos54/etc/ssh/sshd_config  
PermitRootLogin yes
PasswordAuthentication yes
</pre></li><li class="listitem"><div class="para">
				If you need the template to be enabled to reset passwords from the 
CloudStack UI or API, install the password change script into the image 
at this point. See <a class="xref" href="#add-password-management-to-templates">第&nbsp;12.13&nbsp;节 “Adding Password Management to Your Templates”</a>.
			</div></li><li class="listitem"><div class="para">
				Unmount and delete loopback mount.
			</div><pre class="programlisting"># umount /mnt/loop/centos54
# losetup -d /dev/loop0
</pre></li><li class="listitem"><div class="para">
				Copy the image file to your XenServer host's file-based storage 
repository. In the example below, the Xenserver is "xenhost". This 
XenServer has an NFS repository whose uuid is 
a9c5b8c8-536b-a193-a6dc-51af3e5ff799.
			</div><pre class="programlisting"># scp CentOS_6.2_x64 xenhost:/var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799/</pre></li><li class="listitem"><div class="para">
				Log in to the Xenserver and create a VDI the same size as the image.
			</div><pre class="programlisting">[root@xenhost ~]# cd /var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]#  ls -lh CentOS_6.2_x64
-rw-r--r-- 1 root root 10G Mar 16 16:49 CentOS_6.2_x64
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# xe vdi-create virtual-size=10GiB sr-uuid=a9c5b8c8-536b-a193-a6dc-51af3e5ff799 type=user name-label="Centos 6.2 x86_64"
cad7317c-258b-4ef7-b207-cdf0283a7923
</pre></li><li class="listitem"><div class="para">
				Import the image file into the VDI. This may take 10–​20 minutes.
			</div><pre class="programlisting">[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# xe vdi-import filename=CentOS_6.2_x64 uuid=cad7317c-258b-4ef7-b207-cdf0283a7923</pre></li><li class="listitem"><div class="para">
				Locate a the VHD file. This is the file with the VDI’​s UUID as its name. Compress it and upload it to your web server.
			</div><pre class="programlisting">[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# bzip2 -c cad7317c-258b-4ef7-b207-cdf0283a7923.vhd &gt; CentOS_6.2_x64.vhd.bz2
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# scp CentOS_6.2_x64.vhd.bz2 webserver:/var/www/html/templates/
</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="convert-hyperv-vm-to-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.12.&nbsp;转​换​Hyper-v 虚​拟​机​为​模​板​</h2></div></div></div><div class="para">
		
要​转​换​的​Hyper-V虚​拟​机​到​的​XenServer兼​容​CloudStack模​板​，您​将​需​要​一​个​独​立​的​
XenServer主​机​连​接​的​NFS VHD的​SR。​使​用​任​何​ CloudStack 
支​持​的​XenServer版​本​，单​必​须​是​XenCenter5.6 
FP1或​SP2(它​是​向​后​兼​容​5.6)。​此​外​，它​可​以​帮​助​你​瓜​子​一​个​NFS ISO SR。​
	</div><div class="para">
		
对​于​linux虚​拟​机​，在​你​使​用​XenServer中​虚​拟​机​进​行​工​作​之​前​，需​要​为​虚​拟​化​做​一​些​
准​备​工​作​。​克​隆​虚​拟​机​，并​且​如​果​你​还​打​算​在​hyper-v中​使​用​虚​拟​机​。​需​要​卸​载​
hyper-v集​组​件​，同​时​检​查​在​/etc/fstab中​的​相​关​设​备​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				从​linux_ic/驱​动​器​/ dist目​录​中​，运​行​卸​载​(其​中​的​“​linux_ic”​是​复​制​的​Hyper-V的​集​成​组​件​文​件​的​路​径​)。​
			</div></li><li class="listitem"><div class="para">
				在​/ boot /(备​份​是​名​为​*。​backup0)从​备​份​中​恢​复​原​来​的​initrd。​
			</div></li><li class="listitem"><div class="para">
				从​/boot/grub/menu.lst.中​移​除​存​在​的​"hdX=noprobe"
			</div></li><li class="listitem"><div class="para">
				Check /etc/fstab for any partitions mounted by device name. Change 
those entries (if any) to mount by LABEL or UUID. You can get that 
information with the blkid command.
			</div></li></ol></div><div class="para">
		下​一​步​是​确​保​在​Hyper-V的​虚​拟​机​没​有​运​行​，接​着​应​用​VHD到​XenServer。​这​里​包​含​有​两​个​选​项​。​
	</div><div class="para">
		选​项​1：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				通​过​xencenter导​入​VHD, 工​具​ 虚​拟​应​用​工​具​ 磁​盘​镜​像​导​入​
			</div></li><li class="listitem"><div class="para">
				选​择​ VHD,点​击​ 下​一​步​
			</div></li><li class="listitem"><div class="para">
				为​vm命​名​，选​择​存​储​下​面​的​NFS VHD SR,选​中​ “​运​行​操​作​系​统​修​复​”​，并​且​选​择​NFS ISO SR
			</div></li><li class="listitem"><div class="para">
				点​击​下​一​步​ 完​成​。​完​成​虚​拟​机​创​建​
			</div></li></ol></div><div class="para">
		Option two:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				运​行​ XenConvert ,选​择​ VHD,选​择​ XenServer,点​击​下​一​步​
			</div></li><li class="listitem"><div class="para">
				选​择​ VHD,点​击​ 下​一​步​
			</div></li><li class="listitem"><div class="para">
				输​入​XenServer主​机​信​息​，点​击​下​一​步​
			</div></li><li class="listitem"><div class="para">
				Name the VM, then click Next, then Convert. A VM should be created.
			</div></li></ol></div><div class="para">
		一​旦​你​完​成​从​hyper-v VHD到​虚​拟​机​的​创​建​，准​备​使​用​以​下​步​骤​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				启​动​虚​拟​机​，卸​载​Hyper-V集​成​服​务​，并​重​新​启​动​
			</div></li><li class="listitem"><div class="para">
				安​装​XenServer的​工​具​，然​后​重​新​启​动​。​
			</div></li><li class="listitem"><div class="para">
				Prepare the VM as desired. For example, run sysprep on Windows VMs. See <a class="xref" href="#create-windows-template">第&nbsp;12.10&nbsp;节 “创​建​WINdows 模​板​”</a>.
			</div></li></ol></div><div class="para">
		
以​上​任​一​选​项​将​创​建​一​个​VM在​HVM模​式​。​为​Windows虚​拟​机​这​是​很​好​的​，但​Linux的​虚​
拟​机​可​能​无​法​达​到​最​佳​性​能​。​转​换​的​Linux虚​拟​机​，以​PV模​式​，对​于​不​同​的​发​行​版​本​将
​需​要​额​外​的​步​骤​会​ 。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				
关​闭​虚​拟​机​，从​NFS存​储​拷​贝​虚​拟​到​一​个​web服​务​器​；比​如​，在​web服​务​器​上​挂​载​NFS共​享
​然​后​拷​贝​它​，或​者​是​在​其​他​XenServer逐​渐​向​使​用​sftp或​scp上​传​到​web服​务​器​
			</div></li><li class="listitem"><div class="para">
				在​CloudStack使​用​以​下​值​创​建​模​板​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						URL,提​供​VHD的​url
					</div></li><li class="listitem"><div class="para">
						os 类​型​，使​用​相​应​的​os。​对​于​centos的​pv模​式​，选​择​ 其​他​PV(32-位​)或​者​其​他​PV(64-位​)。​这​个​选​项​只​能​在​Xenserver上​使​用​
					</div></li><li class="listitem"><div class="para">
						Hypervisor. XenServer
					</div></li><li class="listitem"><div class="para">
						格​式​化​，VHD
					</div></li></ul></div></li></ol></div><div class="para">
		这​个​模​板​将​被​创​建​，你​可​以​通​过​它​来​创​建​实​例​
	</div></div><div xml:lang="zh-CN" class="section" id="add-password-management-to-templates" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.13.&nbsp;Adding Password Management to Your Templates</h2></div></div></div><div class="para">
		CloudStack provides an optional password reset feature that allows 
users to set a temporary admin or root password as well as reset the 
existing admin or root password from the CloudStack UI.
	</div><div class="para">
		To enable the Reset Password feature, you will need to download an 
additional script to patch your template. When you later upload the 
template into CloudStack, you can specify whether reset admin/root 
password feature should be enabled for this template.
	</div><div class="para">
		The password management feature works always resets the account 
password on instance boot. The script does an HTTP call to the virtual 
router to retrieve the account password that should be set. As long as 
the virtual router is accessible the guest will have access to the 
account password that should be used. When the user requests a password 
reset the management server generates and sends a new password to the 
virtual router for the account. Thus an instance reboot is necessary to 
effect any password changes.
	</div><div class="para">
		If the script is unable to contact the virtual router during instance 
boot it will not set the password but boot will continue normally.
	</div><div xml:lang="zh-CN" class="section" id="linux-installation" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">12.13.1.&nbsp;Linux系​统​安​装​</h3></div></div></div><div class="para">
		试​用​一​下​步​骤​开​始​Linux系​统​的​安​装​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				下​载​脚​本​文​件​cloud-set-guest-password
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Linux: <a href="http://cloudstack.org/dl/cloud-set-guest-password">     http://cloudstack.org/dl/cloud-set-guest-password     </a>
					</div></li><li class="listitem"><div class="para">
						Windows: <a href="http://sourceforge.net/projects/cloudstack/files/Password%20Management%20Scripts/CloudInstanceManager.msi/download">     http://sourceforge.net/projects/cloudstack/files/Password%20Management%20Scripts/CloudInstanceManager.msi/download     </a>
					</div></li></ul></div></li><li class="listitem"><div class="para">
				拷​贝​本​文​件​到​Copy this file to /etc/init.d
			</div><div class="para">
				在​某​些​linux发​行​版​拷​贝​此​文​件​到​/etc/rc.d/init.d
			</div></li><li class="listitem"><div class="para">
				执​行​以​下​命​令​使​脚​本​可​执​行​
			</div><pre class="programlisting">chmod +x /etc/init.d/cloud-set-guest-password （这里注意文件路径）</pre></li><li class="listitem"><div class="para">
				根​据​不​同​的​Linux发​行​版​，选​择​适​当​的​步​骤​继​续​
			</div><div class="para">
				在​Fedora、​CentOS/RHEL、​ 和​ Debian,执​行​‘​
			</div><pre class="programlisting">chkconfig --add cloud-set-guest-password</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="windows-installation" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">12.13.2.&nbsp;Windows OS 安​装​</h3></div></div></div><div class="para">
		从​ <a href="http://cloudstack.org/download.html">Download page</a> 下​载​安​装​程​序​CloudInstanceManager.msi，并​在​新​创​建​的​Windows 虚​拟​机​中​运​行​安​装​程​序​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="delete-templates" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">12.14.&nbsp;删​除​模​板​</h2></div></div></div><div class="para">
		
模​板​可​以​被​删​除​。​在​一​般​情​况​下​，当​一​个​模​板​跨​越​多​个​区​域​，只​为​删​除​被​选​中​的​副​本​
将​被​删​除​，在​其​他​区​域​相​同​的​模​板​将​不​会​被​删​除​。​CentOS的​模​板​是​一​个​例​外​。​如​果​所
​提​供​的​CentOS的​模​板​被​删​除​，它​从​所​有​区​域​都​将​被​删​除​。​
	</div><div class="para">
		删​除​模​板​时​，从​它​们​中​产​生​的​虚​拟​机​实​例​将​继​续​运​行​。​然​而​，新​的​虚​拟​机​不​能​在​被​删​除​模​板​的​基​础​上​创​建​。​
	</div></div></div><div xml:lang="zh-CN" class="chapter" id="storage" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;13&nbsp;章&nbsp;使​用​存​储​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#storage-overview">13.1. Storage Overview</a></span></dt><dt><span class="section"><a href="#primary-storage">13.2. 主​存​储​</a></span></dt><dd><dl><dt><span class="section"><a href="#best-practices-primary-storage">13.2.1. 对​于​主​存​储​最​好​的​实​践​</a></span></dt><dt><span class="section"><a href="#runtime-behavior-of-primary-storage">13.2.2. Runtime Behavior of Primary Storage</a></span></dt><dt><span class="section"><a href="#hypervisor-support-for-primarystorage">13.2.3. 虚​拟​机​平​台​对​主​存​储​的​支​持​</a></span></dt><dt><span class="section"><a href="#storage-tags">13.2.4. å­å¨æ&nbsp;ç­¾</a></span></dt><dt><span class="section"><a href="#maintenance-mode-for-primary-storage.xml">13.2.5. 主​存​储​的​维​护​模​式​</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage">13.3. 二​级​存​储​</a></span></dt><dt><span class="section"><a href="#working-with-volumes">13.4. Working With Volumes</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-new-volumes">13.4.1. 创​建​新​卷​</a></span></dt><dt><span class="section"><a href="#upload-existing-volume-to-vm">13.4.2. Uploading an Existing Volume to a Virtual Machine</a></span></dt><dt><span class="section"><a href="#attaching-volume">13.4.3. 附​加​卷​</a></span></dt><dt><span class="section"><a href="#detach-move-volumes">13.4.4. Detaching and Moving Volumes</a></span></dt><dt><span class="section"><a href="#vm-storage-migration">13.4.5. 虚​拟​机​存​储​迁​移​</a></span></dt><dt><span class="section"><a href="#resizing-volumes">13.4.6. 调​整​卷​大​小​</a></span></dt><dt><span class="section"><a href="#volume-deletion-garbage-collection">13.4.7. Volume Deletion and Garbage Collection</a></span></dt></dl></dd><dt><span class="section"><a href="#working-with-snapshots">13.5. 使​用​快​照​</a></span></dt><dd><dl><dt><span class="section"><a href="#snapshot-throttling">13.5.1. Snapshot Job Throttling</a></span></dt><dt><span class="section"><a href="#automatic-snapshot-creation-retention">13.5.2. Automatic Snapshot Creation and Retention</a></span></dt><dt><span class="section"><a href="#incremental-snapshots-backup">13.5.3. Incremental Snapshots and Backup </a></span></dt><dt><span class="section"><a href="#volume-status">13.5.4. 卷​状​态​</a></span></dt><dt><span class="section"><a href="#snapshot-restore">13.5.5. 快​照​恢​复​</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="storage-overview" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">13.1.&nbsp;Storage Overview</h2></div></div></div><div class="para">
		CloudStack defines two types of storage: primary and secondary. 
Primary storage can be accessed by either iSCSI or NFS. Additionally, 
direct attached storage may be used for primary storage. Secondary 
storage is always accessed using NFS.
	</div><div class="para">
		There is no ephemeral storage in CloudStack. All volumes on all nodes are persistent.
	</div></div><div xml:lang="zh-CN" class="section" id="primary-storage" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">13.2.&nbsp;主​存​储​</h2></div></div></div><div class="para">
		This section gives concepts and technical details about CloudStack 
primary storage. For information about how to install and configure 
primary storage through the CloudStack UI, see the Installation Guide.
	</div><div class="para">
		<a class="xref" href="#about-primary-storage">第&nbsp;2.6&nbsp;节 “关​于​主​存​储​”</a>
	</div><div xml:lang="zh-CN" class="section" id="best-practices-primary-storage" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.2.1.&nbsp;对​于​主​存​储​最​好​的​实​践​</h3></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				主​存​储​的​速​度​会​影​响​访​问​性​能​。​如​果​可​以​，选​择​较​小​，较​高​RPM驱​动​的​设​备​给​主​存​储​。​
			</div></li><li class="listitem"><div class="para">
				Ensure that nothing is stored on the server. Adding the server to CloudStack will destroy any existing data
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="runtime-behavior-of-primary-storage" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.2.2.&nbsp;Runtime Behavior of Primary Storage</h3></div></div></div><div class="para">
		Root volumes are created automatically when a virtual machine is 
created. Root volumes are deleted when the VM is destroyed. Data volumes
 can be created and dynamically attached to VMs.  Data volumes are not 
deleted when VMs are destroyed.
	</div><div class="para">
		Administrators should monitor the capacity of primary storage devices 
and add additional primary storage as needed. See the Advanced 
Installation Guide.
	</div><div class="para">
		Administrators add primary storage to the system by creating a 
CloudStack storage pool. Each storage pool is associated with a cluster.
	</div></div><div xml:lang="zh-CN" class="section" id="hypervisor-support-for-primarystorage" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.2.3.&nbsp;虚​拟​机​平​台​对​主​存​储​的​支​持​</h3></div></div></div><div class="para">
		下​表​显​示​了​针​对​不​同​虚​拟​机​平​台​的​存​储​选​项​和​参​数​。​
	</div><div class="informaltable"><table border="1"><colgroup><col class="c1" width="34%"><col class="c2" width="16%"><col class="c3" width="16%"><col class="c4" width="17%"><col class="c5" width="17%"></colgroup><thead><tr><th class="">
					</th><th class="">
						<div class="para">
							VMware vSphere
						</div>
					</th><th class="">
						<div class="para">
							Citrix XenServer
						</div>
					</th><th class="">
						<div class="para">
							KVM
						</div>
					</th><td class="auto-generated">&nbsp;</td></tr></thead><tbody><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong><span class="bold bold"><strong>磁​盘​格​式​,模​板​,和​快​照​</strong></span></strong></span>
						</div>
					</td><td class="">
						<div class="para">
							VMDK
						</div>
					</td><td class="">
						<div class="para">
							VHD
						</div>
					</td><td class="">
						<div class="para">
							QCOW2
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong>支​持​ iSCSI</strong></span>
						</div>
					</td><td class="">
						<div class="para">
							VMFS
						</div>
					</td><td class="">
						<div class="para">
							集​群​的​逻​辑​卷​(LVM)
						</div>
					</td><td class="">
						<div class="para">
							可​以​, 通​过​共​享​挂​载​点​
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong>支​持​ Fiber Channel</strong></span>
						</div>
					</td><td class="">
						<div class="para">
							VMFS
						</div>
					</td><td class="">
						<div class="para">
							是​，通​过​现​有​的​存​储​空​间​。​
						</div>
					</td><td class="">
						<div class="para">
							可​以​, 通​过​共​享​挂​载​点​
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong>NFS 支​持​</strong></span>
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong>本​地​存​储​支​持​</strong></span>
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="">
						<div class="para">
							是​
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr><tr><td class="">
						<div class="para">
							<span class="bold bold"><strong>基​于​供​应​的​存​储​</strong></span>
						</div>
					</td><td class="">
						<div class="para">
							NFS 和​ iSCSI
						</div>
					</td><td class="">
						<div class="para">
							NFS
						</div>
					</td><td class="">
						<div class="para">
							NFS
						</div>
					</td><td class="auto-generated">&nbsp;</td></tr></tbody></table></div><div class="para">
		
XenServer在​iSCSI和​光​纤​通​道​存​储​卷​使​用​集​群​的​LVM系​统​，而​不​支​持​预​留​空​间​特​性​。​
但​是​，存​储​服​务​器​本​身​可​以​支​持​自​动​精​简​供​应​（thin-provisioning）。​所​以​，其​结​果​是
​CloudStack在​自​动​精​简​供​应​的​存​储​卷​上​仍​然​可​以​实​现​预​留​空​间​的​特​性​。​
	</div><div class="para">
		
KVM支​持​“​共​享​挂​载​点​”​存​储​。​在​一​个​给​定​的​集​群​里​，共​享​挂​载​点​是​每​个​服​务​器​的​一​
个​文​件​系​统​路​径​。​这​个​路​径​对​所​有​集​群​内​的​主​机​都​必​须​是​一​致​的​，例​如​：/mnt
/primary1。​此​共​享​挂​载​点​假​定​是​一​个​集​群​文​件​系​统​，比​如​OCFS2。​在​此​情​况​下​， 
CloudStack不​会​像​对​待​NFS那​样​挂​载​或​者​卸​载​存​储​。​ 
CloudStack要​求​管​理​员​保​证​存​储​已​经​可​用​。​
	</div><div class="para">
		
CloudStack管​理​NFS存​储​的​预​留​空​间​特​性​。​在​这​种​情​况​下​，有​一​个​全​局​参​数​
storage.overprovisioning.factor来​控​制​预​留​空​间​的​程​度​。​这​与​虚​拟​机​管​理​器​的​类
​型​无​关​。​
	</div><div class="para">
		Local storage is an option for primary storage for vSphere, XenServer,
 and KVM. When the local disk option is enabled, a local disk storage 
pool is automatically created on each host. To use local storage for the
 System Virtual Machines (such as the Virtual Router), set 
system.vm.use.local.storage to true in global configuration.
	</div><div class="para">
		
CloudStack支​持​在​一​个​集​群​中​使​用​多​个​主​存​储​池​。​例​如​，你​能​在​主​存​储​中​准​备​2个​
NFS服​务​器​，或​者​最​初​可​以​准​备​一​个​iSCSI 
LUN，然​后​在​第​一​个​容​量​将​满​时​添​加​第​二​个​iSCSI LUN。​
	</div></div><div xml:lang="zh-CN" class="section" id="storage-tags" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.2.4.&nbsp;å­å¨æ&nbsp;ç­¾</h3></div></div></div><div class="para">
		存​储​可​以​被​打​上​标​签​。​ 
字​符​串​的​标​签​使​得​主​存​储​，磁​盘​服​务​，或​计​算​服​务​相​互​关​联​起​来​。​标​签​使​得​管​理​员​可​
以​添​加​关​于​存​储​的​额​外​信​息​。​例​如​它​是​"SSD" 
或​它​是​"slow"。​标​签​不​会​被​CloudStack 
解​读​。​标​签​是​用​于​在​计​算​服​务​和​磁​盘​服​务​上​相​互​匹​配​使​用​的​。​在​主​存​储​上​分​配​根​和​
数​据​磁​盘​之​前​，CloudStack 
需​要​计​算​和​磁​盘​服​务​上​的​标​签​都​标​记​于​主​存​储​上​。​计​算​和​磁​盘​服​务​的​标​签​用​于​识​别​
 这​些​服​务​拥​有​存​储​的​要​求​。​例​如​高​级​的​计​算​服​务​可​能​需​要​"fast"标​签​ 
给​其​跟​磁​盘​卷​
	</div><div class="para">
		
标​签​，分​配​，跨​集​群​或​机​架​的​卷​复​制​之​间​的​关​系​是​很​复​杂​的​。​简​单​的​环​境​就​是​在​一​个​
机​架​内​所​有​集​群​的​主​存​储​使​用​相​同​的​标​签​。​即​使​用​这​些​标​签​表​示​不​同​设​备​，展​现​出​来
​的​标​签​组​仍​可​以​是​一​样​的​。​
	</div></div><div xml:lang="zh-CN" class="section" id="maintenance-mode-for-primary-storage.xml" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.2.5.&nbsp;主​存​储​的​维​护​模​式​</h3></div></div></div><div class="para">
		
主​存​储​可​以​被​设​置​成​维​护​模​式​。​这​是​有​用​的​，例​如​，替​换​在​存​储​设​备​中​坏​的​RAM。​对​存
​储​设​备​的​维​护​模​式​将​首​先​停​止​任​何​新​的​来​自​预​处​理​的​来​宾​，然​后​停​止​所​有​有​数​据​卷​
的​来​宾​。​当​所​有​来​宾​被​停​止​的​时​候​，这​个​存​储​设​备​就​进​入​维​护​模​式​了​并​且​可​以​关​机​。
​当​存​储​设​备​再​一​次​在​线​的​时​候​，你​可​以​取​消​维​护​模​式​对​这​个​设​备​。​CloudStack将​返​
回​在​线​状​态​并​且​试​着​启​动​所​有​曾​在​这​个​设​备​进​入​维​护​模​式​前​运​行​的​来​宾​机​器​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="secondary-storage" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">13.3.&nbsp;二​级​存​储​</h2></div></div></div><div class="para">
		本​节​给​出​了​关​于​CloudStack 二​级​存​储​的​概​念​和​技​术​细​节​。​关​于​通​过​CloudStack 用​户​界​面​如​何​安​装​和​配​置​二​级​存​储​的​信​息​，见​高​级​安​装​指​南​。​
	</div><div class="para">
		<a class="xref" href="#about-secondary-storage">第&nbsp;2.7&nbsp;节 “关​与​辅​助​存​储​”</a>
	</div></div><div xml:lang="zh-CN" class="section" id="working-with-volumes" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">13.4.&nbsp;Working With Volumes</h2></div></div></div><div class="para">
		卷​为​用​户​虚​拟​机​提​供​存​储​。​卷​可​以​作​为​根​分​区​或​附​加​硬​盘​。​CloudStack 支​持​为​用​户​虚​拟​机​添​加​卷​。​
	</div><div class="para">
		Volumes are created for a specific hypervisor type. A volume that has 
been attached to guest using one hypervisor type (e.g, XenServer) may 
not be attached to a guest that is using another hypervisor type, for 
example:vSphere, KVM. This is because the different hypervisors use 
different disk image formats.
	</div><div class="para">
		CloudStack defines a volume as a unit of storage available to a guest 
VM. Volumes are either root disks or data disks. The root disk has "/" 
in the file system and is usually the boot device. Data disks provide 
for additional storage, for example: "/opt" or "D:". Every guest VM has a
 root disk, and VMs can also optionally have a data disk. End users can 
mount multiple data disks to guest VMs. Users choose data disks from the
 disk offerings created by administrators. The user can create a 
template from a volume as well; this is the standard procedure for 
private template creation. Volumes are hypervisor-specific: a volume 
from one hypervisor type may not be used on a guest of another 
hypervisor type.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			CloudStack supports attaching up to 13 data disks to a VM on 
XenServer hypervisor versions 6.0 and above. For the VMs on other 
hypervisor types, the data disk limit is 6.
		</div></div></div><div xml:lang="zh-CN" class="section" id="creating-new-volumes" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.1.&nbsp;创​建​新​卷​</h3></div></div></div><div class="para">
		
你​可​以​在​符​合​你​存​储​能​力​的​情​况​下​随​时​向​来​宾​虚​拟​机​添​加​多​个​数​据​卷​。​CloudStack
 
的​管​理​员​和​普​通​用​户​都​可​以​向​虚​拟​机​实​例​中​添​加​卷​。​当​你​创​建​了​一​个​新​卷​，他​以​一​个
​实​体​的​形​式​存​在​于​CloudStack但​是​在​你​将​其​附​加​到​实​例​中​之​前​他​并​不​会​被​分​配​实​际
​的​物​理​空​间​。​这​种​优​化​会​使​CloudStack将​磁​盘​空​间​提​供​给​刚​需​的​用​户​。​
	</div><div class="section" id="local-storage-data-volumes"><div class="titlepage"><div><div><h4 class="title">13.4.1.1.&nbsp;Using Local Storage for Data Volumes</h4></div></div></div><div class="para">
			You can create data volumes on local storage (supported with 
XenServer, KVM, and VMware). The data volume is placed on the same host 
as the VM instance that is attached to the data volume. These local data
 volumes can be attached to virtual machines, detached, re-attached, and
 deleted just as with the other types of data volume.
		</div><div class="para">
			Local storage is ideal for scenarios where persistence of data 
volumes and HA is not required.&nbsp;Some of the benefits include 
reduced disk I/O latency and cost reduction from using inexpensive local
 disks.
		</div><div class="para">
			In order for local volumes to be used, the feature must be enabled for the zone.
		</div><div class="para">
			You can create a data disk offering for local storage. When a user 
creates a new VM, they can select this disk offering in order to cause 
the data disk volume to be placed in local storage.
		</div><div class="para">
			You can not migrate a VM that has a volume in local storage to a 
different host, nor migrate the volume itself away to a different host. 
If you want to put a host into maintenance mode, you must first stop any
 VMs with local data volumes on that host.
		</div></div><div class="section" id="creating-new-volume-steps"><div class="titlepage"><div><div><h4 class="title">13.4.1.2.&nbsp;To Create a New Volume</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					以​管​理​员​或​普​通​用​户​身​份​登​录​进​入​CloudStack用​户​界​面​。​
				</div></li><li class="listitem"><div class="para">
					在​左​侧​导​航​栏​点​击​存​储​。​
				</div></li><li class="listitem"><div class="para">
					在​选​择​视​图​选​择​卷​。​
				</div></li><li class="listitem"><div class="para">
					点​击​添​加​卷​来​创​建​一​个​新​卷​，填​写​以​下​信​息​后​点​击​确​定​。​
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							名​字​。​给​卷​取​个​独​特​名​字​以​便​于​你​以​后​找​到​他​。​
						</div></li><li class="listitem"><div class="para">
							
可​用​的​资​源​域​。​你​想​让​这​个​个​存​储​在​哪​个​地​方​有​效​？这​个​应​该​接​近​要​是​用​这​个​卷​的​
VM。​（就​是​说​你​要​ 
在​单​个​资​源​域​内​使​用​这​个​存​储​就​选​择​单​个​资​源​域​，如​果​此​存​储​要​在​多​个​资​源​与​内​共​享
​你​就​选​所​有​资​源​域​）
						</div></li><li class="listitem"><div class="para">
							磁​盘​方​案​。​选​择​存​储​特​性​。​
						</div></li></ul></div><div class="para">
					新​建​的​存​储​会​在​卷​列​表​中​显​示​“​已​分​配​”​状​态​。​卷​数​据​已​经​存​储​到​CloudStack了​但​是​他​还​不​能​使​用​。​
				</div></li><li class="listitem"><div class="para">
					通​过​附​加​卷​来​开​始​使​用​这​个​卷​。​
				</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="upload-existing-volume-to-vm" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.2.&nbsp;Uploading an Existing Volume to a Virtual Machine</h3></div></div></div><div class="para">
		Existing data can be made accessible to a virtual machine. This is 
called uploading a volume to the VM. For example, this is useful to 
upload data from a local file system and attach it to a VM. Root 
administrators, domain administrators, and end users can all upload 
existing volumes to VMs.
	</div><div class="para">
		The upload is performed using HTTP. The uploaded volume is placed in the zone's secondary storage
	</div><div class="para">
		You cannot upload a volume if the preconfigured volume limit has 
already been reached. The default limit for the cloud is set in the 
global configuration parameter max.account.volumes, but administrators 
can also set per-domain limits that are different from the global 
default. See Setting Usage Limits
	</div><div class="para">
		To upload a volume:
	</div><div class="orderedlist"><ol><li class="listitem" id="optional-hash"><div class="para">
				(Optional) Create an MD5 hash (checksum) of the disk image file that
 you are going to upload. After uploading the data disk, CloudStack will
 use this value to verify that no data corruption has occurred.
			</div></li><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or user
			</div></li><li class="listitem"><div class="para">
				在​左​侧​导​航​栏​点​击​存​储​。​
			</div></li><li class="listitem"><div class="para">
				Click Upload Volume.
			</div></li><li class="listitem"><div class="para">
				Provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem" id="volume-name"><div class="para">
						Name and Description. Any desired name and a brief description that can be shown in the UI.
					</div></li><li class="listitem"><div class="para">
						Availability Zone. Choose the zone where you want to store the 
volume. VMs running on hosts in this zone can attach the volume.
					</div></li><li class="listitem"><div class="para">
						Format. Choose one of the following to indicate the disk image format of the volume.
					</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
										<div class="para">
											èææºç®¡çç¨åº
										</div>
									</th><th class="" align="left">
										<div class="para">
											Disk Image Format
										</div>
									</th></tr></thead><tbody><tr><td class="" align="left">
										<div class="para">
											XenServer
										</div>
									</td><td class="" align="left">
										<div class="para">
											VHD
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											VMware
										</div>
									</td><td class="" align="left">
										<div class="para">
											OVA
										</div>
									</td></tr><tr><td class="" align="left">
										<div class="para">
											KVM
										</div>
									</td><td class="" align="left">
										<div class="para">
											QCOW2
										</div>
									</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
						URL. The secure HTTP or HTTPS URL that CloudStack can use to 
access your disk. The type of file at the URL must match the value 
chosen in Format. For example, if Format is VHD, the URL might look like
 the following:
					</div><div class="para">
						http://yourFileServerIP/userdata/myDataDisk.vhd
					</div></li><li class="listitem"><div class="para">
						MD5 checksum. (Optional) Use the hash that you created in step <a class="xref" href="#optional-hash">1</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Wait until the status of the volume shows that the upload is 
complete. Click Instances - Volumes, find the name you specified in step
 <a class="xref" href="#volume-name">???</a>, and make sure the status is Uploaded.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="attaching-volume" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.3.&nbsp;附​加​卷​</h3></div></div></div><div class="para">
		
您​能​通​过​附​加​一​个​卷​来​提​供​虚​拟​机​的​额​外​磁​盘​存​储​。​当​你​第​一​次​创​建​新​卷​，或​移​动​已
​存​在​的​卷​到​另​一​台​虚​拟​机​，或​实​在​从​另​一​个​存​储​池​迁​移​过​来​一​个​卷​的​时​候​你​才​可​以​
附​加​一​个​卷​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​身​份​登​录​进​入​ CloudStack 用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​导​航​栏​点​击​存​储​。​
			</div></li><li class="listitem"><div class="para">
				在​选​择​视​图​选​择​卷​。​
			</div></li><li class="listitem"><div class="para">
				4. Click the volume name in the Volumes list, then click the Attach Disk button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/attach-disk-icon.png" alt="AttachDiskButton.png: button to attach a volume"></span>

			</div></li><li class="listitem"><div class="para">
				
在​弹​出​的​实​例​界​面​，选​择​你​打​算​附​加​卷​到​哪​台​虚​拟​机​。​你​只​能​看​到​允​许​你​附​加​卷​的​实
​例​。​比​如​，普​通​用​户​只​能​看​到​他​自​己​创​建​的​实​例​，而​管​理​员​将​会​有​更​多​的​选​择​。​
			</div></li><li class="listitem"><div class="para">
				当​卷​被​附​加​之​后​你​通​过​点​击​实​例​看​到​实​例​名​和​该​实​例​所​附​加​的​卷​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="detach-move-volumes" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.4.&nbsp;Detaching and Moving Volumes</h3></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			This procedure is different from moving disk volumes from one storage pool to another. See VM Storage Migration
		</div></div></div><div class="para">
		A volume can be detached from a guest VM and attached to another 
guest. Both CloudStack administrators and users can detach volumes from 
VMs and move them to other VMs.
	</div><div class="para">
		If the two VMs are in different clusters, and the volume is large, it 
may take several minutes for the volume to be moved to the new VM.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​普​通​用​户​身​份​登​录​进​入​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Storage, and choose Volumes in 
Select View. Alternatively, if you know which VM the volume is attached 
to, you can click Instances, click the VM name, and click View Volumes.
			</div></li><li class="listitem"><div class="para">
				Click the name of the volume you want to detach, then click the Detach Disk button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/detach-disk-icon.png" alt="DetachDiskButton.png: button to detach a volume"></span>

			</div></li><li class="listitem"><div class="para">
				To move the volume to another VM, follow the steps in <a class="xref" href="#attaching-volume">第&nbsp;13.4.3&nbsp;节 “附​加​卷​”</a>.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="vm-storage-migration" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.5.&nbsp;虚​拟​机​存​储​迁​移​</h3></div></div></div><div class="para">
		支​持​xenserver,kvm,vmware
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			这​个​过​程​有​别​于​移​动​磁​盘​卷​从​一​个​虚​拟​机​到​另​外​的​虚​拟​机​。​查​看​挂​载​和​移​动​卷​
		</div></div></div><div class="para">
		你​可​以​迁​移​一​个​虚​拟​机​的​根​磁​盘​卷​或​者​附​加​数​据​磁​盘​卷​从​同​一​区​域​中​一​个​存​储​池​到​另​外​一​个​存​储​池​。​
	</div><div class="para">
		你​可​以​使​用​磁​盘​迁​移​特​性​完​成​一​些​常​用​的​管​理​目​标​。​如​存​储​池​的​负​载​平​衡​和​增​加​虚​拟​机​的​可​靠​性​，帮​助​他​们​远​离​任​何​存​储​池​常​见​问​题​。​
	</div><div xml:lang="zh-CN" class="section" id="migrate-datadisk-volume-new-storage-pool" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">13.4.5.1.&nbsp;Migrating a Data Disk Volume to a New Storage Pool</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​普​通​用​户​身​份​登​录​进​入​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				Detach the data disk from the VM. See Detaching and Moving Volumes <a class="xref" href="#detach-move-volumes">第&nbsp;13.4.4&nbsp;节 “Detaching and Moving Volumes”</a> (but skip the “​reattach”​ step at the end. You will do that after migrating to new storage).
			</div></li><li class="listitem"><div class="para">
				Call the CloudStack API command migrateVolume and pass in the volume ID and the ID of any storage pool in the zone.
			</div></li><li class="listitem"><div class="para">
				Watch for the volume status to change to Migrating, then back to Ready.
			</div></li><li class="listitem"><div class="para">
				Attach the volume to any desired VM running in the same cluster as the new storage server. See Attaching a Volume <a class="xref" href="#attaching-volume">第&nbsp;13.4.3&nbsp;节 “附​加​卷​”</a>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="migrate-vm-rootvolume-volume-new-storage-pool" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">13.4.5.2.&nbsp;迁​移​虚​拟​机​根​卷​到​新​的​存​储​池​</h4></div></div></div><div class="para">
		迁​移​根​卷​的​时​候​虚​拟​机​要​先​停​止​，此​时​用​户​将​不​能​访​问​该​虚​拟​机​。​迁​移​结​束​方​可​重​启​虚​拟​机​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​用​户​身​份​登​陆​至​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				取​消​附​加​在​该​虚​拟​机​上​的​数​据​磁​盘​。​详​见​ 取​消​附​加​并​移​除​卷​<a class="xref" href="#detach-move-volumes">第&nbsp;13.4.4&nbsp;节 “Detaching and Moving Volumes”</a>（但​是​跳​过​最​后​的​“​重​新​附​加​”​步​骤​你​会​在​前​几​结​束​之​后​做​这​步​）。​
			</div></li><li class="listitem"><div class="para">
				停​止​虚​拟​机​。​
			</div></li><li class="listitem"><div class="para">
				Use the CloudStack API command, migrateVirtualMachine, with the ID 
of the VM to migrate and the IDs of a destination host and destination 
storage pool in the same zone.
			</div></li><li class="listitem"><div class="para">
				看​着​虚​拟​机​状​态​由​“​迁​移​中​”​恢​复​为​“​已​停​止​”​。​
			</div></li><li class="listitem"><div class="para">
				重​新​启​动​该​虚​拟​机​。​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="resizing-volumes" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.6.&nbsp;调​整​卷​大​小​</h3></div></div></div><div class="para">
		CloudStack provides the ability to resize data disks; CloudStack 
controls volume size by using disk offerings. This provides CloudStack 
administrators with the flexibility to choose how much space they want 
to make available to the end users. Volumes within the disk offerings 
with the same storage tag can be resized. For example, if you only want 
to offer 10, 50, and 100 GB offerings, the allowed resize should stay 
within those limits. That implies if you define a 10 GB, a 50 GB and a 
100 GB disk offerings, a user can upgrade from 10 GB to 50 GB, or 50 GB 
to 100 GB. If you create a custom-sized disk offering, then you have the
 option to resize the volume by specifying a new, larger size.
	</div><div class="para">
		Additionally, using the resizeVolume API, a data volume can be moved 
from a static disk offering to a custom disk offering with the size 
specified. This functionality allows those who might be billing by 
certain volume sizes or disk offerings to stick to that model, while 
providing the flexibility to migrate to whatever custom size necessary.
	</div><div class="para">
		This feature is supported on KVM, XenServer, and VMware hosts. However, shrinking volumes is not supported on VMware hosts.
	</div><div class="para">
		Before you try to resize a volume, consider the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The VMs associated with the volume are stopped.
			</div></li><li class="listitem"><div class="para">
				The data disks associated with the volume are removed.
			</div></li><li class="listitem"><div class="para">
				When a volume is shrunk, the disk associated with it is simply 
truncated, and doing so would put its content at risk of data loss. 
Therefore, resize any partitions or file systems before you shrink a 
data disk so that all the data is moved off from that disk.
			</div></li></ul></div><div class="para">
		To resize a volume:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​管​理​员​或​普​通​用​户​身​份​登​录​进​入​CloudStack用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				在​左​侧​导​航​栏​点​击​存​储​。​
			</div></li><li class="listitem"><div class="para">
				在​选​择​视​图​选​择​卷​。​
			</div></li><li class="listitem"><div class="para">
				Select the volume name in the Volumes list, then click the Resize Volume button 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/resize-volume-icon.png" alt="resize-volume-icon.png: button to display the resize volume option."></span>
			</div></li><li class="listitem"><div class="para">
				In the Resize Volume pop-up, choose desired characteristics for the storage.
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/resize-volume.png" alt="resize-volume.png: option to resize a volume."></div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						If you select Custom Disk, specify a custom size.
					</div></li><li class="listitem"><div class="para">
						Click Shrink OK to confirm that you are reducing the size of a volume.
					</div><div class="para">
						This parameter protects against inadvertent shrinking of a disk, 
which might lead to the risk of data loss. You must sign off that you 
know what you are doing.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="volume-deletion-garbage-collection" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.4.7.&nbsp;Volume Deletion and Garbage Collection</h3></div></div></div><div class="para">
		The deletion of a volume does not delete the snapshots that have been created from the volume
	</div><div class="para">
		When a VM is destroyed, data disk volumes that are attached to the VM are not deleted.
	</div><div class="para">
		Volumes are permanently destroyed using a garbage collection process. 
The global configuration variables expunge.delay and expunge.interval 
determine when the physical deletion of volumes will occur.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				expunge.delay: determines how old the volume must be before it is destroyed, in seconds
			</div></li><li class="listitem"><div class="para">
				expunge.interval: determines how often to run the garbage collection check
			</div></li></ul></div><div class="para">
		Administrators should adjust these values depending on site policies around data retention.
	</div></div></div><div xml:lang="zh-CN" class="section" id="working-with-snapshots" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">13.5.&nbsp;使​用​快​照​</h2></div></div></div><div class="para">
		（支​持​以​下​Hypervisor。​ <span class="bold bold"><strong>XenServer</strong></span>, <span class="bold bold"><strong>VMware vSphere</strong></span>, 和​ <span class="bold bold"><strong>KVM</strong></span>）
	</div><div class="para">
		CloudStack supports snapshots of disk volumes. Snapshots are a 
point-in-time capture of virtual machine disks. Memory and CPU states 
are not captured.
	</div><div class="para">
		Snapshots may be taken for volumes, including both root and data 
disks. The administrator places a limit on the number of stored 
snapshots per user. Users can create new volumes from the snapshot for 
recovery of particular files and they can create templates from 
snapshots to boot from a restored disk.
	</div><div class="para">
		
用​户​能​手​动​或​设​置​自​动​循​环​创​建​快​照​策​略​。​用​户​也​能​通​过​快​照​创​建​磁​盘​卷​，并​向​其​他
​盘​一​样​附​加​到​虚​拟​机​中​。​支​持​对​root和​data盘​做​快​照​。​然​而​CloudStack当​前​不​支​持
​通​过​恢​复​的​root盘​启​动​。​通​过​快​照​恢​复​的​root盘​会​被​当​作​data盘​对​待​，但​是​恢​复​的​
到​的​盘​能​够​挂​载​到​虚​拟​机​中​。​
	</div><div class="para">
		完​整​快​照​会​从​主​存​储​拷​贝​到​二​级​存​储​直​到​被​删​除​或​被​新​的​快​照​覆​盖​。​
	</div><div xml:lang="zh-CN" class="section" id="snapshot-throttling" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.5.1.&nbsp;Snapshot Job Throttling</h3></div></div></div><div class="para">
		When a snapshot of a virtual machine is requested, the snapshot job 
runs on the same host where the VM is running or, in the case of a 
stopped VM, the host where it ran last. If many snapshots are requested 
for VMs on a single host, this can lead to problems with too many 
snapshot jobs overwhelming the resources of the host.
	</div><div class="para">
		To address this situation, the cloud's root administrator can throttle
 how many snapshot jobs are executed simultaneously on the hosts in the 
cloud by using the global configuration setting 
concurrent.snapshots.threshold.perhost. By using this setting, the 
administrator can better ensure that snapshot jobs do not time out and 
hypervisor hosts do not experience performance issues due to hosts being
 overloaded with too many snapshot requests.
	</div><div class="para">
		Set concurrent.snapshots.threshold.perhost to a value that represents a
 best guess about how many snapshot jobs the hypervisor hosts can 
execute at one time, given the current resources of the hosts and the 
number of VMs running on the hosts. If a given host has more snapshot 
requests, the additional requests are placed in a waiting queue. No new 
snapshot jobs will start until the number of currently executing 
snapshot jobs falls below the configured limit.
	</div><div class="para">
		The admin can also set job.expire.minutes to place a maximum on how 
long a snapshot request will wait in the queue. If this limit is 
reached, the snapshot request fails and returns an error message.
	</div></div><div xml:lang="zh-CN" class="section" id="automatic-snapshot-creation-retention" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.5.2.&nbsp;Automatic Snapshot Creation and Retention</h3></div></div></div><div class="para">
		（支​持​以​下​Hypervisor。​ <span class="bold bold"><strong>XenServer</strong></span>, <span class="bold bold"><strong>VMware vSphere</strong></span>, 和​ <span class="bold bold"><strong>KVM</strong></span>）
	</div><div class="para">
		Users can set up a recurring snapshot policy to automatically create 
multiple snapshots of a disk at regular intervals. Snapshots can be 
created on an hourly, daily, weekly, or monthly interval. One snapshot 
policy can be set up per disk volume. For example, a user can set up a 
daily snapshot at 02:30.
	</div><div class="para">
		With each snapshot schedule, users can also specify the number of 
scheduled snapshots to be retained. Older snapshots that exceed the 
retention limit are automatically deleted. This user-defined limit must 
be equal to or lower than the global limit set by the CloudStack 
administrator. See <a class="xref" href="#globally-configured-limits">第&nbsp;14.3&nbsp;节 “Globally Configured Limits”</a>.
 The limit applies only to those snapshots that are taken as part of an 
automatic recurring snapshot policy. Additional manual snapshots can be 
created and retained.
	</div></div><div xml:lang="zh-CN" class="section" id="incremental-snapshots-backup" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.5.3.&nbsp;Incremental Snapshots and Backup </h3></div></div></div><div class="para">
		Snapshots are created on primary storage where a disk resides. After a
 snapshot is created, it is immediately backed up to secondary storage 
and removed from primary storage for optimal utilization of space on 
primary storage.
	</div><div class="para">
		CloudStack does incremental backups for some hypervisors. When 
incremental backups are supported, every N backup is a full backup.
	</div><div class="informaltable"><table border="1"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr><th class="" align="left">
					</th><th class="" align="left">
						<div class="para">
							VMware vSphere
						</div>
					</th><th class="" align="left">
						<div class="para">
							Citrix XenServer
						</div>
					</th><th class="" align="left">
						<div class="para">
							KVM
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							Support incremental backup
						</div>
					</td><td class="" align="left">
						<div class="para">
							N
						</div>
					</td><td class="" align="left">
						<div class="para">
							Y
						</div>
					</td><td class="" align="left">
						<div class="para">
							N
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="section" id="volume-status" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.5.4.&nbsp;卷​状​态​</h3></div></div></div><div class="para">
		
快​照​操​作​时​由​一​个​经​常​性​的​快​照​策​略​所​引​发​，如​果​从​其​上​次​创​建​快​照​后​，卷​一​直​处​于​
非​活​跃​状​态​，快​照​被​跳​过​。​卷​被​认​为​是​非​活​跃​的​，如​果​它​被​分​离​或​附​加​的​虚​拟​机​没​有​
运​行​。​CloudStack确​保​从​卷​上​一​次​变​得​不​活​跃​后​，至​少​有​一​个​快​照​创​建​。​
	</div><div class="para">
		手​动​创​建​快​照​时​，快​照​总​是​创​建​，无​论​卷​活​跃​与​否​。​
	</div></div><div xml:lang="zh-CN" class="section" id="snapshot-restore" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">13.5.5.&nbsp;快​照​恢​复​</h3></div></div></div><div class="para">
		
有​两​种​方​式​恢​复​快​照​。​用​户​能​够​从​快​照​中​创​建​一​个​卷​。​卷​可​以​随​后​被​装​载​到​虚​拟​机​
上​并​且​文​件​根​据​需​要​被​复​原​。​另​一​种​方​式​是​，模​板​可​以​从​一​个​root 
盘​的​快​照​创​建​。​用​户​能​够​从​这​个​模​板​启​动​虚​拟​机​从​而​实​际​上​复​原​root盘​。​
	</div></div></div></div><div xml:lang="zh-CN" class="chapter" id="work-with-usage" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;14&nbsp;章&nbsp;Working with Usage</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configure-usage-server">14.1. 配​置​使​用​服​务​器​</a></span></dt><dt><span class="section"><a href="#set-usage-limit">14.2. Setting Usage Limits</a></span></dt><dt><span class="section"><a href="#globally-configured-limits">14.3. Globally Configured Limits</a></span></dt><dt><span class="section"><a href="#default-account-resource-limit">14.4. Default Account Resource Limits</a></span></dt><dt><span class="section"><a href="#per-domain-limits">14.5. Per-Domain Limits</a></span></dt></dl></div><div class="para">
		The Usage Server is an optional, separately-installed part of 
CloudStack that provides aggregated usage records which you can use to 
create billing integration for CloudStack. The Usage Server works by 
taking data from the events log and creating summary usage records that 
you can access using the listUsageRecords API call.
	</div><div class="para">
		The usage records show the amount of resources, such as VM run time or template storage space, consumed by guest instances.
	</div><div class="para">
		The Usage Server runs at least once per day. It can be configured to run multiple times per day.
	</div><div xml:lang="zh-CN" class="section" id="configure-usage-server" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">14.1.&nbsp;配​置​使​用​服​务​器​</h2></div></div></div><div class="para">
		配​置​使​用​服​务​器​之​前​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				确​定​你​已​经​安​装​了​使​用​服​务​器​。​这​需​要​你​在​CloudStack 软​件​之​外​的​其​他​步​骤​。​详​情​请​见​高​级​安​装​指​南​中​的​ 安​装​使​用​服​务​器​（可​选​）部​分​。​
			</div></li><li class="listitem"><div class="para">
				以​管​理​员​身​份​登​录​进​入​CloudStack 用​户​界​面​。​
			</div></li><li class="listitem"><div class="para">
				点​击​ 全​局​设​置​。​
			</div></li><li class="listitem"><div class="para">
				在​搜​索​栏​输​入​ usage。​找​到​no需​要​改​变​的​配​置​参​数​。​下​表​是​这​些​参​数​的​详​细​描​述​。​
			</div></li><li class="listitem"><div class="para">
				在​操​作​栏​点​击​编​辑​图​标​。​
			</div></li><li class="listitem"><div class="para">
				输​入​数​值​点​击​保​存​图​标​。​
			</div></li><li class="listitem"><div class="para">
				重​新​启​动​管​理​服​务​器​（通​常​在​改​变​了​全​局​配​置​之​后​都​要​进​行​这​步​）并​重​启​使​用​服​务​器​。​
			</div><pre class="programlisting"><span class="perl_Comment"># service cloudstack-management restart</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span><span class="perl_Comment"># service cloudstack-usage restart</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span></pre></li></ol></div><div class="para">
		下​表​流​出​了​全​局​配​置​中​控​制​使​用​服​务​器​的​配​置​项​。​
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							变​量​名​
						</div>
					</th><th class="" align="left">
						<div class="para">
							è¯´æ
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							enable.usage.server
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​否​开​启​使​用​服​务​器​。​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							usage.aggregation.timezone
						</div>
					</td><td class="" align="left">
						<div class="para">
							
记​录​使​用​信​息​所​用​的​时​区​。​如​果​使​用​记​录​和​每​日​的​任​务​执​行​在​不​同​时​区​的​话​需​要​设​
置​本​参​数​。​例​如​,使​用​以​下​设​置​会​使​使​用​作​业​在​PST 
00:15运​行​并​生​成​从​GMT时​间​0点​到​23:59:59 的​二​十​四​小​时​使​用​记​录​。​
						</div>
						 
<pre class="programlisting">usage.stats.job.exec.time = 00:15	
usage.execution.timezone = PST
usage.aggregation.timezone = GMT
</pre>
						 <div class="para">
							Valid values for the time zone are specified in <a class="xref" href="#time-zones">附录&nbsp;A, <em>时​区​</em></a>
						</div>
						 <div class="para">
							默​认​：GMT
						</div>

					</td></tr><tr><td class="" align="left">
						<div class="para">
							usage.execution.timezone
						</div>
					</td><td class="" align="left">
						<div class="para">
							The time zone of usage.stats.job.exec.time. Valid values for the time zone are specified in <a class="xref" href="#time-zones">附录&nbsp;A, <em>时​区​</em></a>
						</div>
						 <div class="para">
							默​认​时​区​是​管​理​服​务​器​的​时​区​。​
						</div>

					</td></tr><tr><td class="" align="left">
						<div class="para">
							usage.sanity.check.interval
						</div>
					</td><td class="" align="left">
						<div class="para">
							
完​整​性​检​查​时​间​间​隔​。​设​置​此​值​来​定​期​在​生​成​用​户​账​单​之​前​检​查​出​错​误​的​数​据​。​比​
如​，他​能​检​查​虚​拟​机​被​销​毁​之​后​的​使​用​记​录​和​模​板​，卷​等​的​类​似​记​录​。​还​会​检​查​超​过​
聚​合​时​间​的​使​用​时​间​。​如​果​发​生​了​错​误​就​会​发​送​ALERT_TYPE_USAGE_SANITY_RESULT
 = 21 警​告​。​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							usage.stats.job.aggregation.range
						</div>
					</td><td class="" align="left">
						<div class="para">
							
使​用​服​务​器​执​行​任​务​时​间​间​隔​（分​钟​为​单​位​）。​比​如​，如​果​你​将​此​值​设​为​1440，使​用​服​
务​器​将​每​天​执​行​一​次​。​如​果​你​将​此​值​设​为​600，则​会​10小​时​执​行​一​次​。​一​般​情​况​下​使​
用​服​务​器​执​行​任​务​时​会​继​续​在​上​次​的​使​用​统​计​基​础​上​处​理​所​有​事​件​。​
						</div>
						 <div class="para">
							There is special handling for the case of 1440 (once per day). In
 this case the Usage Server does not necessarily process all records 
since Usage was last run. CloudStack assumes that you require processing
 once per day for the previous, complete day’​s records. For example, if
 the current day is October 7, then it is assumed you would like to 
process records for October 6, from midnight to midnight. CloudStack 
assumes this “​midnight to midnight”​ is relative to the 
usage.execution.timezone.
						</div>
						 <div class="para">
							默​认​：1440
						</div>

					</td></tr><tr><td class="" align="left">
						<div class="para">
							usage.stats.job.exec.time
						</div>
					</td><td class="" align="left">
						<div class="para">
							The time when the Usage Server processing will start. It is 
specified in 24-hour format (HH:MM) in the time zone of the server, 
which should be GMT. For example, to start the Usage job at 10:30 GMT, 
enter “​10:30”​.
						</div>
						 <div class="para">
							
如​果​同​时​设​置​了​usage.stats.job.aggregation.range参​数​，并​且​该​参​数​值​不​是​
1440，这​个​值​将​被​添​加​到​usage.stats.job.exec.time到​时​再​次​运​行​使​用​服​务​器​任​务​
。​重​复​此​过​程​,直​到​24小​时​已​经​过​去​,第​二​天​到​达​ 
usage.stats.job.exec.time处​理​任​务​开​始​。​
						</div>
						 <div class="para">
							默​认​值​：00:15
						</div>

					</td></tr></tbody></table></div><div class="para">
		比​如​,假​设​你​服​务​器​时​区​是​GMT，你​的​用​户​主​要​在​美​国​东​海​岸​，而​你​有​打​算​在​当​地​时​间​（EST）每​天​凌​晨​两​点​执​行​使​用​记​录​统​计​。​选​择​这​些​选​项​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				enable.usage.server = true
			</div></li><li class="listitem"><div class="para">
				usage.execution.timezone = America/New_York
			</div></li><li class="listitem"><div class="para">
				usage.stats.job.exec.time = 07:00。​这​将​会​在​东​部​时​间​2：00执​行​使​用​任​务​。​注​意​，这​会​由​于​东​部​时​间​进​入​退​出​夏​令​时​间​而​改​变​一​小​时​。​
			</div></li><li class="listitem"><div class="para">
				usage.stats.job.aggregation.range = 1440
			</div></li></ul></div><div class="para">
		在​这​种​配​置​下​，使​用​任​务​ 会​在​东​部​时​间​每​天​凌​晨​两​点​执​行​，同​时​会​如​定​义​的​一​样​以​东​部​时​间​统​计​前​一​天​的​“​午​夜​到​午​夜​使​用​记​录​。​”​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			Because the special value 1440 has been used for 
usage.stats.job.aggregation.range, the Usage Server will ignore the data
 between midnight and 2 AM. That data will be included in the next day's
 run.
		</div></div></div><div class="para">
	</div></div><div xml:lang="zh-CN" class="section" id="set-usage-limit" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">14.2.&nbsp;Setting Usage Limits</h2></div></div></div><div class="para">
		CloudStack provides several administrator control points for capping 
resource usage by users. Some of these limits are global configuration 
parameters. Others are applied at the ROOT domain and may be overridden 
on a per-account basis.
	</div><div class="para">
		Aggregate limits may be set on a per-domain basis. For example, you 
may limit a domain and all subdomains to the creation of 100 VMs.
	</div><div class="para">
		This section covers the following topics:
	</div></div><div xml:lang="zh-CN" class="section" id="globally-configured-limits" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">14.3.&nbsp;Globally Configured Limits</h2></div></div></div><div class="para">
		In a zone, the guest virtual network has a 24 bit CIDR by default. 
This limits the guest virtual network to 254 running instances. It can 
be adjusted as needed, but this must be done before any instances are 
created in the zone. For example, 10.1.1.0/22 would provide for ~1000 
addresses.
	</div><div class="para">
		The following table lists limits set in the Global Configuration:
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th class="">
						<div class="para">
							Parameter Name
						</div>
					</th><th class="">
						<div class="para">
							Definition
						</div>
					</th></tr></thead><tbody><tr><td class="">
						<div class="para">
							max.account.public.ips
						</div>
					</td><td class="">
						<div class="para">
							Number of public IP addresses that can be owned by an account
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.account.snapshots
						</div>
					</td><td class="">
						<div class="para">
							Number of snapshots that can exist for an account
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.account.templates
						</div>
					</td><td class="">
						<div class="para">
							Number of templates that can exist for an account
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.account.user.vms
						</div>
					</td><td class="">
						<div class="para">
							Number of virtual machine instances that can exist for an account
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.account.volumes
						</div>
					</td><td class="">
						<div class="para">
							Number of disk volumes that can exist for an account
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.template.iso.size
						</div>
					</td><td class="">
						<div class="para">
							Maximum size for a downloaded template or ISO in GB
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							max.volume.size.gb
						</div>
					</td><td class="">
						<div class="para">
							Maximum size for a volume in GB
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							network.throttling.rate
						</div>
					</td><td class="">
						<div class="para">
							Default data transfer rate in megabits per second allowed per user (supported on XenServer)
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							snapshot.max.hourly
						</div>
					</td><td class="">
						<div class="para">
							Maximum recurring hourly snapshots to be retained for a volume. 
If the limit is reached, early snapshots from the start of the hour are 
deleted so that newer ones can be saved. This limit does not apply to 
manual snapshots. If set to 0, recurring hourly snapshots can not be 
scheduled
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							snapshot.max.daily
						</div>
					</td><td class="">
						<div class="para">
							Maximum recurring daily snapshots to be retained for a volume. If
 the limit is reached, snapshots from the start of the day are deleted 
so that newer ones can be saved. This limit does not apply to manual 
snapshots. If set to 0, recurring daily snapshots can not be scheduled
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							snapshot.max.weekly
						</div>
					</td><td class="">
						<div class="para">
							Maximum recurring weekly snapshots to be retained for a volume. 
If the limit is reached, snapshots from the beginning of the week are 
deleted so that newer ones can be saved. This limit does not apply to 
manual snapshots. If set to 0, recurring weekly snapshots can not be 
scheduled
						</div>
					</td></tr><tr><td class="">
						<div class="para">
							snapshot.max.monthly
						</div>
					</td><td class="">
						<div class="para">
							Maximum recurring monthly snapshots to be retained for a volume. 
If the limit is reached, snapshots from the beginning of the month are 
deleted so that newer ones can be saved. This limit does not apply to 
manual snapshots. If set to 0, recurring monthly snapshots can not be 
scheduled.
						</div>
					</td></tr></tbody></table></div><div class="para">
		To modify global configuration parameters, use the global 
configuration screen in the CloudStack UI. See Setting Global 
Configuration Parameters
	</div></div><div xml:lang="zh-CN" class="section" id="default-account-resource-limit" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">14.4.&nbsp;Default Account Resource Limits</h2></div></div></div><div class="para">
		You can limit resource use by accounts. The default limits are set by 
using global configuration parameters, and they affect all accounts 
within a cloud. The relevant parameters are those beginning with 
max.account, for example: max.account.snapshots.
	</div><div class="para">
		To override a default limit for a particular account, set a per-account resource limit.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation tree, click Accounts.
			</div></li><li class="listitem"><div class="para">
				Select the account you want to modify. The current limits are 
displayed. A value of -1 shows that there is no limit in place.
			</div></li><li class="listitem"><div class="para">
				Click the Edit button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="editbutton.png: edits the settings"></span>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="per-domain-limits" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">14.5.&nbsp;Per-Domain Limits</h2></div></div></div><div class="para">
		CloudStack allows the configuration of limits on a domain basis. With a
 domain limit in place, all users still have their account limits. They 
are additionally limited, as a group, to not exceed the resource limits 
set on their domain. Domain limits aggregate the usage of all accounts 
in the domain as well as all accounts in all subdomains of that domain. 
Limits set at the root domain level apply to the sum of resource usage 
by the accounts in all domains and sub-domains below that root domain.
	</div><div class="para">
		To set a domain limit:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​ CloudStack 用​户​界​面​
			</div></li><li class="listitem"><div class="para">
				In the left navigation tree, click Domains.
			</div></li><li class="listitem"><div class="para">
				Select the domain you want to modify. The current domain limits are 
displayed. A value of -1 shows that there is no limit in place.
			</div></li><li class="listitem"><div class="para">
				Click the Edit button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="editbutton.png: edits the settings."></span>
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="chapter" id="networks" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;15&nbsp;章&nbsp;管​理​网​络​和​流​量​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#guest-traffic">15.1. æ¥å®¾æµé</a></span></dt><dt><span class="section"><a href="#networking-in-a-pod">15.2. 一​个​POD内​的​网​络​</a></span></dt><dt><span class="section"><a href="#networking-in-a-zone">15.3. 在​区​域​内​的​联​网​</a></span></dt><dt><span class="section"><a href="#basic-zone-physical-network-configuration">15.4. 基​本​区​域​物​理​网​络​配​置​</a></span></dt><dt><span class="section"><a href="#advanced-zone-physical-network-configuration">15.5. 高​级​区​物​理​网​络​配​置​</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-guest-traffic-in-advanced-zone">15.5.1. 在​高​级​资​源​域​中​设​置​来​宾​流​量​</a></span></dt><dt><span class="section"><a href="#configure-public-traffic-in-an-advanced-zone">15.5.2. 在​高​级​区​中​配​置​公​用​通​信​</a></span></dt></dl></dd><dt><span class="section"><a href="#using-multiple-guest-networks">15.6. 使​用​多​个​来​宾​网​络​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-additional-guest-network">15.6.1. 添​加​另​一​个​虚​拟​机​的​网​络​</a></span></dt><dt><span class="section"><a href="#change-network-offering-on-guest-network">15.6.2. Changing the Network Offering on a Guest Network</a></span></dt></dl></dd><dt><span class="section"><a href="#security-groups">15.7. 安​全​分​组​</a></span></dt><dd><dl><dt><span class="section"><a href="#about-security-groups">15.7.1. About Security Groups</a></span></dt><dt><span class="section"><a href="#add-security-group">15.7.2. Adding a Security Group</a></span></dt><dt><span class="section"><a href="#security-groups-advanced-zones">15.7.3. Security Groups in Advanced Zones (KVM Only)</a></span></dt><dt><span class="section"><a href="#enable-security-groups">15.7.4. 启​用​安​全​组​</a></span></dt><dt><span class="section"><a href="#add-ingress-egress-rules">15.7.5. Adding Ingress and Egress Rules to a Security Group</a></span></dt></dl></dd><dt><span class="section"><a href="#external-firewalls-and-load-balancers">15.8. 外​部​防​火​墙​和​负​载​均​衡​器​</a></span></dt><dd><dl><dt><span class="section"><a href="#using-netscaler-load-balancers">15.8.1. About Using a NetScaler Load Balancer</a></span></dt><dt><span class="section"><a href="#configure-snmp-rhel">15.8.2. 配​置​RHEL服​务​器​上​的​snmp通​信​组​</a></span></dt><dt><span class="section"><a href="#initial-setup-of-external-firewalls-loadbalancer">15.8.3. Initial Setup of External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#ongoing-config-of-external-firewalls-ld">15.8.4. Ongoing Configuration of External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#autoscale">15.8.5. Configuring AutoScale</a></span></dt></dl></dd><dt><span class="section"><a href="#load-balancer-rules">15.9. 负​载​均​衡​规​则​</a></span></dt><dd><dl><dt><span class="section"><a href="#add-load-balancer-rule">15.9.1. Adding a Load Balancer Rule</a></span></dt><dt><span class="section"><a href="#sticky-session-policies-for-lb-rules">15.9.2. Sticky Session Policies for Load Balancer Rules</a></span></dt></dl></dd><dt><span class="section"><a href="#guest-ip-ranges">15.10. 宾​客​IP范​围​</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-address">15.11. 获​得​一​个​新​的​IP地​址​</a></span></dt><dt><span class="section"><a href="#release-ip-address">15.12. Releasing an IP Address</a></span></dt><dt><span class="section"><a href="#static-nat">15.13. 静​态​ NAT</a></span></dt><dd><dl><dt><span class="section"><a href="#enable-disable-static-nat">15.13.1. Enabling or Disabling Static NAT</a></span></dt></dl></dd><dt><span class="section"><a href="#ip-forwarding-firewalling">15.14. IP转​发​及​防​火​墙​</a></span></dt><dd><dl><dt><span class="section"><a href="#egress-firewall-rule">15.14.1. Creating Egress Firewall Rules in an Advanced Zone</a></span></dt><dt><span class="section"><a href="#firewall-rules">15.14.2. 防​火​墙​规​则​</a></span></dt><dt><span class="section"><a href="#port-forwarding">15.14.3. ç«¯å£è½¬å</a></span></dt></dl></dd><dt><span class="section"><a href="#ip-load-balancing">15.15. IP负​载​均​衡​</a></span></dt><dt><span class="section"><a href="#dns-dhcp">15.16. DNS和​DHCP</a></span></dt><dt><span class="section"><a href="#vpn">15.17. VPN 虚​拟​专​用​网​</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-vpn">15.17.1. Configuring VPN</a></span></dt><dt><span class="section"><a href="#using-vpn-with-windows">15.17.2. Using VPN with Windows</a></span></dt><dt><span class="section"><a href="#using-vpn-with-mac">15.17.3. 在​Mac OS X上​使​用​VPN</a></span></dt><dt><span class="section"><a href="#site-to-site-vpn">15.17.4. 配​置​站​点​到​站​点​的​VPN连​接​</a></span></dt></dl></dd><dt><span class="section"><a href="#inter-vlan-routing">15.18. About Inter-VLAN Routing</a></span></dt><dt><span class="section"><a href="#configure-vpc">15.19. Configuring a Virtual Private Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#vpc">15.19.1. About Virtual Private Clouds</a></span></dt><dt><span class="section"><a href="#add-vpc">15.19.2. Adding a Virtual Private Cloud</a></span></dt><dt><span class="section"><a href="#add-tier">15.19.3. Adding Tiers</a></span></dt><dt><span class="section"><a href="#configure-acl">15.19.4. Configuring Access Control List</a></span></dt><dt><span class="section"><a href="#add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</a></span></dt><dt><span class="section"><a href="#add-vm-to-tier">15.19.6. Deploying VMs to the Tier</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</a></span></dt><dt><span class="section"><a href="#release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</a></span></dt><dt><span class="section"><a href="#enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</a></span></dt><dt><span class="section"><a href="#add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</a></span></dt><dt><span class="section"><a href="#add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</a></span></dt><dt><span class="section"><a href="#remove-tier">15.19.12. Removing Tiers</a></span></dt><dt><span class="section"><a href="#remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</a></span></dt></dl></dd><dt><span class="section"><a href="#persistent-network">15.20. Persistent Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#persistent-network-consideration">15.20.1. Persistent Network Considerations</a></span></dt><dt><span class="section"><a href="#set-up-persistent-network">15.20.2. Creating a Persistent Guest Network</a></span></dt></dl></dd></dl></div><div class="para">
		在​CloudStack 
；来​宾​vms可​以​通​过​安​全​共​享​架​构​和​其​他​人​通​讯​，用​户​感​觉​像​拥​有​自​己​的​私​有​网​络​一​样
​。​CloudStack虚​拟​路​由​器​是​为​用​户​提​供​网​络​通​讯​流​量​的​主​要​组​件​
	</div><div xml:lang="zh-CN" class="section" id="guest-traffic" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.1.&nbsp;æ¥å®¾æµé</h2></div></div></div><div class="para">
		
一​个​网​络​只​能​为​在​一​个​zone中​的​虚​拟​机​之​间​传​输​流​量​。​不​同​zone中​的​虚​拟​机​不​能​使​
用​它​们​自​己​的​ip地​址​和​对​方​通​信​；它​们​必​须​通​过​公​共​ip地​址​以​路​由​的​方​式​和​对​方​通​信
​。​
	</div><div class="para">
		This figure illustrates a typical guest traffic setup:
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/guest-traffic-setup.png" alt="Depicts a guest traffic setup." width="444"></div><div class="para">
		
管​理​服​务​器​自​动​的​为​每​个​网​络​创​建​一​个​虚​拟​路​由​器​。​虚​拟​路​由​器​是​运​行​在​主​机​上​的​
特​殊​虚​拟​机​，它​拥​有​3个​网​络​接​口​。​eth0接​口​作​为​来​宾​网​络​的​网​关​，ip地​址​为​
10.1.1.1；eth1接​口​用​于​系​统​配​置​虚​拟​路​由​器​；eth2接​口​指​定​一​个​公​共​ip地​址​传​输​公​
共​流​量​。​
	</div><div class="para">
		虚​拟​路​由​器​提​供​dhcp服​务​并​且​自​动​将​网​络​保​留​的​ip地​址​分​配​一​个​给​虚​拟​机​。​用​户​可​以​人​工​的​重​新​配​置​ip地​址​
	</div><div class="para">
		虚​拟​路​由​器​自​动​的​配​置​源​nat为​来​宾​vm转​发​外​部​流​量​
	</div></div><div xml:lang="zh-CN" class="section" id="networking-in-a-pod" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.2.&nbsp;一​个​POD内​的​网​络​</h2></div></div></div><div class="para">
		The figure below illustrates network setup within a single pod. The 
hosts are connected to a pod-level switch. At a minimum, the hosts 
should have one physical uplink to each switch. Bonded NICs are 
supported as well. The pod-level switch is a pair of redundant gigabit 
switches with 10 G uplinks.
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/network-singlepod.png" alt="networksinglepod.png: diagram showing logical view of network in a pod" width="444"></div><div class="para">
		服​务​器​像​如​下​连​接​:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				存​储​设​备​只​连​接​到​携​带​管​理​流​量​的​网​络​.
			</div></li><li class="listitem"><div class="para">
				主​机​连​接​到​管​理​流​量​及​公​共​流​量​的​网​络​.
			</div></li><li class="listitem"><div class="para">
				主​机​也​连​接​到​一​个​或​多​个​携​带​客​户​流​量​的​网​络​.
			</div></li></ul></div><div class="para">
		我​们​建​议​使​用​多​个​物​理​网​卡​来​实​现​每​个​网​络​接​口​, 就​像​冗​余​的​交​换​机​一​样​, 以​此​来​保​证​最​大​的​吞​吐​并​且​改​善​可​靠​性​.
	</div></div><div xml:lang="zh-CN" class="section" id="networking-in-a-zone" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.3.&nbsp;在​区​域​内​的​联​网​</h2></div></div></div><div class="para">
		The following figure illustrates the network setup within a single zone.
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/network-setup-zone.png" alt="networksetupzone.png: Depicts network setup in a single zone" width="444"></div><div class="para">
		
用​于​管​理​流​量​的​防​火​墙​工​作​在​NAT模​式​。​通​常​是​分​配​给​网​络​中​的​IP地​址​
192.168.0.0/16 B类​私​有​地​址​空​间​。​每​个​POD分​配​的​IP地​址​192.168.*.0/24 
C类​私​有​地​址​空​间​。​
	</div><div class="para">
		每​个​区​域​都​有​自​己​的​一​套​公​网​IP地​址​。​来​自​不​同​区​域​的​公​网​IP地​址​不​重​叠​。​
	</div></div><div xml:lang="zh-CN" class="section" id="basic-zone-physical-network-configuration" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.4.&nbsp;基​本​区​域​物​理​网​络​配​置​</h2></div></div></div><div class="para">
		
在​一​个​基​本​网​络​中​，配​置​物​理​网​络​相​当​直​接​明​了​。​你​只​需​要​配​置​一​个​宾​客​网​络​以​承​载
​由​宾​客​虚​拟​机​产​生​的​流​量​。​当​你​首​次​增​加​一​个​区​域​到​CloudStack中​， 你​通​过​Add 
Zone 屏​设​置​宾​客​网​络​。​
	</div></div><div xml:lang="zh-CN" class="section" id="advanced-zone-physical-network-configuration" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.5.&nbsp;高​级​区​物​理​网​络​配​置​</h2></div></div></div><div class="para">
		在​使​用​高​级​联​网​的​区​中​，你​需​要​告​诉​管​理​服​务​器​物​理​网​络​是​如​何​安​装​的​以​独​立​地​传​输​不​同​种​类​的​网​络​流​量​。​
	</div><div xml:lang="zh-CN" class="section" id="configure-guest-traffic-in-advanced-zone" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.5.1.&nbsp;在​高​级​资​源​域​中​设​置​来​宾​流​量​</h3></div></div></div><div class="para">
		以​下​步​骤​假​定​你​已​经​登​录​进​入​ CloudStack 界​面​。​设​置​基​本​的​来​宾​网​络​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​，选​择​基​础​架​构​。​在​区​域​数​量​界​面​点​击​查​看​全​部​，然​后​点​击​你​要​添​加​网​络​的​区​域​名​。​
			</div></li><li class="listitem"><div class="para">
				点​击​网​络​标​签​。​
			</div></li><li class="listitem"><div class="para">
				点​击​ 添​加​客​户​网​络​。​
			</div><div class="para">
				添​加​来​宾​网​络​窗​口​显​示​：
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-guest-network.png" alt="networksetupzone.png: Depicts network setup in a single zone"></div></li><li class="listitem"><div class="para">
				提​供​以​下​信​息​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>名​称​</strong></span>。​网​络​名​称​。​这​是​对​用​户​可​见​的​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>显​示​文​本​</strong></span>:
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>区​域​</strong></span>: 这​里​的​区​域​是​指​你​要​配​置​来​宾​网​络​的​区​域​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>网​络​提​供​方​案​</strong></span>: 如​果​管​理​员​已​经​配​置​了​多​个​网​络​i共​方​案​，选​择​你​需​要​的​那​个​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>来​宾​网​络​网​关​</strong></span>: 来​宾​网​络​使​用​的​网​关​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>来​宾​网​络​子​网​掩​码​</strong></span>: 来​宾​网​络​使​用​的​子​网​掩​码​
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="configure-public-traffic-in-an-advanced-zone" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.5.2.&nbsp;在​高​级​区​中​配​置​公​用​通​信​</h3></div></div></div><div class="para">
		在​一​个​使​用​高​级​网​络​配​置​的​区​中​，你​需​要​配​置​至​少​一​个​用​于​Internet通​信​的​IP地​址​范​围​。​
	</div></div></div><div xml:lang="zh-CN" class="section" id="using-multiple-guest-networks" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.6.&nbsp;使​用​多​个​来​宾​网​络​</h2></div></div></div><div class="para">
		在​使​用​高​级​网​络​的​资​源​域​里​, 附​加​的​来​宾​网​络​可​以​在​初​始​安​装​后​任​何​时​间​添​加​. 你​还​可​以​通​过​指​定​DNS后​缀​为​每​个​网​络​自​定​义​关​联​的​域​名​.
	</div><div class="para">
		一​个​虚​机​的​网​络​在​其​创​建​时​定​义​. 当​一​个​虚​机​创​建​以​后​, 就​不​能​对​其​网​络​添​加​删​除​, 即​便​用​户​可​以​进​入​客​户​虚​机​删​除​指​定​网​卡​的​IP地​址​.
	</div><div class="para">
		每​一​个​虚​机​只​有​一​个​默​认​的​网​络​. 在​这​个​默​认​网​络​里​, 
虚​拟​路​由​器​的​DHCP响​应​将​设​置​客​户​的​默​认​网​关​. 除​了​单​一​,必​须​的​默​认​网​络​, 
多​个​非​默​认​的​网​络​也​可​以​添​加​到​客​户​虚​机​里​. 
管​理​员​可​以​控​制​哪​个​网​络​作​为​默​认​的​网​络​.
	</div><div class="para">
		附​加​的​网​络​可​以​给​所​有​账​户​使​用​或​者​分​配​给​特​定​的​账​户​. 
对​所​有​账​户​都​可​用​的​网​络​在​整​个​资​源​域​有​效​. 
任​何​可​以​访​问​这​个​资​源​域​的​用​户​都​可​以​使​用​这​个​网​络​创​建​虚​机​. 
这​些​资​源​域​一​级​的​网​络​基​本​不​提​供​客​户​之​间​的​隔​离​. 
分​配​给​特​定​帐​户​的​网​络​提​供​强​制​隔​离​的​功​能​.
	</div><div xml:lang="zh-CN" class="section" id="add-additional-guest-network" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.6.1.&nbsp;添​加​另​一​个​虚​拟​机​的​网​络​</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				点​击​添​加​虚​拟​机​网​络​。​系​统​给​出​如​下​信​息​：
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>名​称​</strong></span>: 网​络​名​称​。​用​户​可​见​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>显​示​文​本​</strong></span>: 网​络​描​述​。​用​户​可​见​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>区​域​</strong></span>. 
此​网​络​所​应​用​的​区​域​名​。​每​个​区​域​都​是​一​个​广​播​范​围​，因​此​对​虚​拟​机​网​络​来​说​，每​个​
区​域​都​有​一​个​不​同​的​IP范​围​。​管​理​员​必​须​为​每​个​区​域​配​置​IP范​围​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>网​络​提​议​</strong></span>: 如​果​管​理​员​已​经​配​置​了​多​个​网​络​提​议​，为​此​网​络​从​中​选​择​一​个​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>虚​拟​机​网​关​</strong></span>: 虚​拟​机​应​该​使​用​的​网​关​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>虚​拟​机​掩​码​</strong></span>: 虚​拟​机​子​网​说​使​用​的​掩​码​。​
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​创​建​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="change-network-offering-on-guest-network" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.6.2.&nbsp;Changing the Network Offering on a Guest Network</h3></div></div></div><div class="para">
		A user or administrator can change the network offering that is associated with an existing guest network.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				If you are changing from a network offering that uses the CloudStack
 virtual router to one that uses external devices as network service 
providers, you must first stop all the VMs on the network.  <span class="phrase">See <a class="xref" href="#stopping-and-starting-vms">第&nbsp;10.6&nbsp;节 “停​止​和​启​动​虚​拟​机​”</a>.</span>
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network you want to modify.
			</div></li><li class="listitem"><div class="para">
				In the Details tab, click Edit.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="EditButton.png: button to edit a network"></span>
			</div></li><li class="listitem"><div class="para">
				In Network Offering, choose the new network offering, then click Apply.
			</div></li><li class="listitem"><div class="para">
				A prompt is displayed asking whether you want to keep the existing 
CIDR. This is to let you know that if you change the network offering, 
the CIDR will be affected. Choose No to proceed with the change.
			</div></li><li class="listitem"><div class="para">
				Wait for the update to complete. Don’​t try to restart VMs until the network change is complete.
			</div></li><li class="listitem"><div class="para">
				If you stopped any VMs, restart them.
			</div></li></ul></div></div></div><div xml:lang="zh-CN" class="section" id="security-groups" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.7.&nbsp;安​全​分​组​</h2></div></div></div><div xml:lang="zh-CN" class="section" id="about-security-groups" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.7.1.&nbsp;About Security Groups</h3></div></div></div><div class="para">
		Security groups provide a way to isolate traffic to VMs. A security 
group is a group of VMs that filter their incoming and outgoing traffic 
according to a set of rules, called ingress and egress rules. These 
rules filter network traffic according to the IP address that is 
attempting to communicate with the VM. Security groups are particularly 
useful in zones that use basic networking, because there is a single 
guest network for all guest VMs. In advanced zones, security groups are 
supported only on the KVM hypervisor.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			In a zone that uses advanced networking, you can instead define multiple guest networks to isolate traffic to VMs.
		</div></div></div><div class="para">
	</div><div class="para">
		Each CloudStack account comes with a default security group that 
denies all inbound traffic and allows all outbound traffic. The default 
security group can be modified so that all new VMs inherit some other 
desired set of rules.
	</div><div class="para">
		Any CloudStack user can set up any number of additional security 
groups. When a new VM is launched, it is assigned to the default 
security group unless another user-defined security group is specified. A
 VM can be a member of any number of security groups. Once a VM is 
assigned to a security group, it remains in that group for its entire 
lifetime; you can not move a running VM from one security group to 
another.
	</div><div class="para">
		You can modify a security group by deleting or adding any number of 
ingress and egress rules. When you do, the new rules apply to all VMs in
 the group, whether running or stopped.
	</div><div class="para">
		If no ingress rules are specified, then no traffic will be allowed in,
 except for responses to any traffic that has been allowed out through 
an egress rule.
	</div></div><div xml:lang="zh-CN" class="section" id="add-security-group" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.7.2.&nbsp;Adding a Security Group</h3></div></div></div><div class="para">
		A user or administrator can define a new security group.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network
			</div></li><li class="listitem"><div class="para">
				In Select view, choose Security Groups.
			</div></li><li class="listitem"><div class="para">
				Click Add Security Group.
			</div></li><li class="listitem"><div class="para">
				Provide a name and description.
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div><div class="para">
				The new security group appears in the Security Groups Details tab.
			</div></li><li class="listitem"><div class="para">
				To make the security group useful, continue to Adding Ingress and Egress Rules to a Security Group.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="security-groups-advanced-zones" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.7.3.&nbsp;Security Groups in Advanced Zones (KVM Only)</h3></div></div></div><div class="para">
		CloudStack provides the ability to use security groups to provide 
isolation between guests on a single shared, zone-wide network in an 
advanced zone where KVM is the hypervisor. Using security groups in 
advanced zones rather than multiple VLANs allows a greater range of 
options for setting up guest isolation in a cloud.
	</div><div class="formalpara"><h5 class="formalpara" id="idp14972704">Limitations</h5>
			The following are not supported for this feature:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Two IP ranges with the same VLAN and different gateway or netmask in security group-enabled shared network.
			</div></li><li class="listitem"><div class="para">
				Two IP ranges with the same VLAN and different gateway or netmask in account-specific shared networks.
			</div></li><li class="listitem"><div class="para">
				Multiple VLAN ranges in security group-enabled shared network.
			</div></li><li class="listitem"><div class="para">
				Multiple VLAN ranges in account-specific shared networks.
			</div></li></ul></div><div class="para">
		Security groups must be enabled in the zone in order for this feature to be used.
	</div></div><div xml:lang="zh-CN" class="section" id="enable-security-groups" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.7.4.&nbsp;启​用​安​全​组​</h3></div></div></div><div class="para">
		In order for security groups to function in a zone, the security 
groups feature must first be enabled for the zone. The administrator can
 do this when creating a new zone, by selecting a network offering that 
includes security groups. The procedure is described in Basic Zone 
Configuration in the Advanced Installation Guide. The administrator can 
not enable security groups for an existing zone, only when creating a 
new zone.
	</div></div><div xml:lang="zh-CN" class="section" id="add-ingress-egress-rules" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.7.5.&nbsp;Adding Ingress and Egress Rules to a Security Group</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network
			</div></li><li class="listitem"><div class="para">
				In Select view, choose Security Groups, then click the security group you want .
			</div></li><li class="listitem"><div class="para">
				To add an ingress rule, click the Ingress Rules tab and fill out the
 following fields to specify what network traffic is allowed into VM 
instances in this security group. If no ingress rules are specified, 
then no traffic will be allowed in, except for responses to any traffic 
that has been allowed out through an egress rule.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add by CIDR/Account</strong></span>.
 Indicate whether the source of the traffic will be defined by IP 
address (CIDR) or an existing security group in a CloudStack account 
(Account). Choose Account if you want to allow incoming traffic from all
 VMs in another security group
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>. The 
networking protocol that sources will use to send traffic to the 
security group. TCP and UDP are typically used for data exchange and 
end-user communications. ICMP is typically used to send error messages 
or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port, End Port</strong></span>.
 (TCP, UDP only) A range of listening ports that are the destination for
 the incoming traffic. If you are opening a single port, use the same 
number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type, ICMP Code</strong></span>. (ICMP only) The type of message and error code that will be accepted.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>. (Add by CIDR
 only) To accept only traffic from IP addresses within a particular 
address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR
 is the base IP address of the incoming traffic. For example, 
192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account, Security Group</strong></span>.
 (Add by Account only) To accept only traffic from another security 
group, enter the CloudStack account and name of a security group that 
has already been defined in that account. To allow traffic between VMs 
within the security group you are editing now, enter the same name you 
used in step 7.
					</div></li></ul></div><div class="para">
				The following example allows inbound HTTP access from anywhere:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/http-access.png" alt="httpaccess.png: allows inbound HTTP access from anywhere" width="444"></div></li><li class="listitem"><div class="para">
				To add an egress rule, click the Egress Rules tab and fill out the 
following fields to specify what type of traffic is allowed to be sent 
out of VM instances in this security group. If no egress rules are 
specified, then all traffic will be allowed out. Once egress rules are 
specified, the following types of traffic are allowed out: traffic 
specified in egress rules; queries to DNS and DHCP servers; and 
responses to any traffic that has been allowed in through an ingress 
rule
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add by CIDR/Account</strong></span>.
 Indicate whether the destination of the traffic will be defined by IP 
address (CIDR) or an existing security group in a CloudStack account 
(Account). Choose Account if you want to allow outgoing traffic to all 
VMs in another security group.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>. The 
networking protocol that VMs will use to send outgoing traffic. TCP and 
UDP are typically used for data exchange and end-user communications. 
ICMP is typically used to send error messages or network monitoring 
data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port, End Port</strong></span>.
 (TCP, UDP only) A range of listening ports that are the destination for
 the outgoing traffic. If you are opening a single port, use the same 
number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type, ICMP Code</strong></span>. (ICMP only) The type of message and error code that will be sent
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>. (Add by CIDR
 only) To send traffic only to IP addresses within a particular address 
block, enter a CIDR or a comma-separated list of CIDRs. The CIDR is the 
base IP address of the destination. For example, 192.168.0.0/22. To 
allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account, Security Group</strong></span>.
 (Add by Account only) To allow traffic to be sent to another security 
group, enter the CloudStack account and name of a security group that 
has already been defined in that account. To allow traffic between VMs 
within the security group you are editing now, enter its name.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​。​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="external-firewalls-and-load-balancers" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.8.&nbsp;外​部​防​火​墙​和​负​载​均​衡​器​</h2></div></div></div><div class="para">
		CloudStack 能​够​用​外​部​的​Juniper SRX设​备​和​可​选​的​外​部​NetScaler 或​ F5 
负​载​均​衡​器​替​换​它​的​虚​拟​路​由​器​，用​于​网​管​和​负​载​均​衡​服​务​。​在​这​种​情​况​下​，虚​拟​机​
使​用​， 虚​拟​机​使​用​SRX 作​为​它​们​的​网​关​。​
	</div><div xml:lang="zh-CN" class="section" id="using-netscaler-load-balancers" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.8.1.&nbsp;About Using a NetScaler Load Balancer</h3></div></div></div><div class="para">
		Citrix NetScaler is supported as an external network element for load 
balancing in zones that use advanced networking (also called advanced 
zones). Set up an external load balancer when you want to provide load 
balancing through means other than CloudStack’​s provided virtual 
router.
	</div><div class="para">
		The NetScaler can be set up in direct (outside the firewall) mode. It 
must be added before any load balancing rules are deployed on guest VMs 
in the zone.
	</div><div class="para">
		The functional behavior of the NetScaler with CloudStack is the same 
as described in the CloudStack documentation for using an F5 external 
load balancer. The only exception is that the F5 supports routing 
domains, and NetScaler does not. NetScaler can not yet be used as a 
firewall.
	</div><div class="para">
		The Citrix NetScaler comes in three varieties. The following table summarizes how these variants are treated in CloudStack.
	</div><div class="informaltable"><table border="1"><colgroup><col width="33%"><col width="33%"><col width="33%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							NetScaler ADC Type
						</div>
					</th><th class="" align="left">
						<div class="para">
							Description of Capabilities
						</div>
					</th><th class="" align="left">
						<div class="para">
							CloudStack Supported Features
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							MPX
						</div>
					</td><td class="" align="left">
						<div class="para">
							Physical appliance. Capable of deep packet inspection. Can act as application firewall and load balancer
						</div>
					</td><td class="" align="left">
						<div class="para">
							In advanced zones, load balancer functionality fully supported 
without limitation. In basic zones, static NAT, elastic IP (EIP), and 
elastic load balancing (ELB) are also provided
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VPX
						</div>
					</td><td class="" align="left">
						<div class="para">
							Virtual appliance. Can run as VM on XenServer, ESXi, and Hyper-V hypervisors. Same functionality as MPX
						</div>
					</td><td class="" align="left">
						<div class="para">
							Supported only on ESXi. Same functional support as for MPX. CloudStack will treat VPX and MPX as the same device type
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							SDX
						</div>
					</td><td class="" align="left">
						<div class="para">
							Physical appliance. Can create multiple fully isolated VPX instances on a single appliance to support multi-tenant usage
						</div>
					</td><td class="" align="left">
						<div class="para">
							CloudStack will dynamically provision, configure, and manage the 
lifecycle of VPX instances on the SDX. Provisioned instances are added 
into CloudStack automatically –​ no manual configuration by the 
administrator is required. Once a VPX instance is added into CloudStack,
 it is treated the same as a VPX on an ESXi host.
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="section" id="configure-snmp-rhel" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.8.2.&nbsp;配​置​RHEL服​务​器​上​的​snmp通​信​组​</h3></div></div></div><div class="para">
		
SNMP团​体​字​符​串​是​类​似​的​用​户​ID或​密​码​，提​供​了​访​问​网​络​设​备​，如​路​由​器​。​此​字​符​串​
的​所​有​SNMP请​求​一​起​发​送​。​如​果​团​体​字​符​串​是​正​确​的​，设​备​响​应​请​求​的​信​息​。​如​果​团
​体​字​符​串​是​不​正​确​的​，则​丢​弃​请​求​没​有​回​应​。​
	</div><div class="para">
		NetScaler设​备​使​用​SNMP和​虚​拟​机​通​信​。​你​必​须​安​装​SNMP，并​且​配​置​SNMP通​信​组​用​于​netscaler和​RHEL机​器​之​间​的​安​全​通​信​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				确​保​你​的​RedHat上​安​装​了​SNMP,如​果​没​有​执​行​以​下​命​令​：
			</div><pre class="screen">yum install net-snmp-utils</pre></li><li class="listitem"><div class="para">
				编​辑​ /etc/snmp/snmpd.conf 允​许​SNMP测​试​netscaler 设​备​
			</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						映​射​团​体​名​到​一​个​安​全​组​(本​地​和​网​络​，依​赖​从​哪​里​发​来​请​求​):
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							当​你​编​辑​以​下​表​格​，使​用​强​壮​密​码​替​换​public
						</div></div></div><pre class="screen"># sec.name source community com2sec local localhost 
public com2sec mynetwork 0.0.0.0 public</pre><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							设​置​0.0.0.0 允​许​所​有​ip查​询​netscaler服​务​器​
						</div></div></div></li><li class="listitem"><div class="para">
						映​射​安​全​名​到​组​名​
					</div><pre class="screen"># group.name sec.model sec.name
group MyRWGroup v1 local
group MyRWGroup v2c local
group MyROGroup v1 mynetwork
group MyROGroup v2c mynetwork</pre></li><li class="listitem"><div class="para">
						创​建​视​图​授​予​组​以​下​权​限​：
					</div><pre class="screen">incl/excl subtree mask view all included .1</pre></li><li class="listitem"><div class="para">
						Grant access with different write permissions to the two groups to the view you created.
					</div><pre class="screen"># context sec.model sec.level prefix read write notif
access MyROGroup "" any noauth exact all none none
access MyRWGroup "" any noauth exact all all all</pre></li></ol></div></li><li class="listitem"><div class="para">
				iptalbes 中​放​行​SNMP
			</div><pre class="screen">iptables -A INPUT -p udp --dport 161 -j ACCEPT</pre></li><li class="listitem"><div class="para">
				启​动​SNMP服​务​
			</div><pre class="screen">service snmpd start</pre></li><li class="listitem"><div class="para">
				确​保​snmp服​务​随​系​统​自​动​启​动​
			</div><pre class="screen">chkconfig snmpd on</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="initial-setup-of-external-firewalls-loadbalancer" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.8.3.&nbsp;Initial Setup of External Firewalls and Load Balancers</h3></div></div></div><div class="para">
		When the first VM is created for a new account, CloudStack programs 
the external firewall and load balancer to work with the VM. The 
following objects are created on the firewall:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A new logical interface to connect to the account's private VLAN. 
The interface IP is always the first IP of the account's private subnet 
(e.g. 10.1.1.1).
			</div></li><li class="listitem"><div class="para">
				A source NAT rule that forwards all outgoing traffic from the 
account's private VLAN to the public Internet, using the account's 
public IP address as the source address
			</div></li><li class="listitem"><div class="para">
				A firewall filter counter that measures the number of bytes of outgoing traffic for the account
			</div></li></ul></div><div class="para">
		The following objects are created on the load balancer:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A new VLAN that matches the account's provisioned Zone VLAN
			</div></li><li class="listitem"><div class="para">
				A self IP for the VLAN. This is always the second IP of the account's private subnet (e.g. 10.1.1.2).
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="ongoing-config-of-external-firewalls-ld" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.8.4.&nbsp;Ongoing Configuration of External Firewalls and Load Balancers</h3></div></div></div><div class="para">
		Additional user actions (e.g. setting a port forward) will cause 
further programming of the firewall and load balancer. A user may 
request additional public IP addresses and forward traffic received at 
these IPs to specific VMs. This is accomplished by enabling static NAT 
for a public IP address, assigning the IP to a VM, and specifying a set 
of protocols and port ranges to open. When a static NAT rule is created,
 CloudStack programs the zone's external firewall with the following 
objects:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A static NAT rule that maps the public IP address to the private IP address of a VM.
			</div></li><li class="listitem"><div class="para">
				A security policy that allows traffic within the set of protocols and port ranges that are specified.
			</div></li><li class="listitem"><div class="para">
				A firewall filter counter that measures the number of bytes of incoming traffic to the public IP.
			</div></li></ul></div><div class="para">
		The number of incoming and outgoing bytes through source NAT, static 
NAT, and load balancing rules is measured and saved on each external 
element. This data is collected on a regular basis and stored in the 
CloudStack database.
	</div></div><div xml:lang="zh-CN" class="section" id="autoscale" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.8.5.&nbsp;Configuring AutoScale</h3></div></div></div><div class="para">
		AutoScaling allows you to scale your back-end services or application 
VMs up or down seamlessly and automatically according to the conditions 
you define. With AutoScaling enabled, you can ensure that the number of 
VMs you are using seamlessly scale up when demand increases, and 
automatically decreases when demand subsides. Using AutoScaling, you can
 automatically shut down instances you don't need, or launch new 
instances, depending on demand.
	</div><div class="para">
		NetScaler AutoScaling is designed to seamlessly launch or terminate 
VMs based on user-defined conditions. Conditions for triggering a 
scaleup or scaledown action can vary from a simple use case like 
monitoring the CPU usage of a server to a complex use case of monitoring
 a combination of server's responsiveness and its CPU usage. For 
example, you can configure AutoScaling to launch an additional VM 
whenever CPU usage exceeds 80 percent for 15 minutes, or to remove a VM 
whenever CPU usage is less than 20 percent for 30 minutes.
	</div><div class="para">
		CloudStack uses the NetScaler load balancer to monitor all aspects of a
 system's health and work in unison with CloudStack to initiate scale-up
 or scale-down actions.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			AutoScale is supported on NetScaler Release 10 Build 73.e and beyond.
		</div></div></div><div class="formalpara"><h5 class="formalpara" id="idp51877696">先​决​条​件​</h5>
			Before you configure an AutoScale rule, consider the following:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Ensure that the necessary template is prepared before configuring 
AutoScale. When a VM is deployed by using a template and when it comes 
up, the application should be up and running.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					If the application is not running, the NetScaler device considers 
the VM as ineffective and continues provisioning the VMs unconditionally
 until the resource limit is exhausted.
				</div></div></div></li><li class="listitem"><div class="para">
				Deploy the templates you prepared. Ensure that the applications come
 up on the first boot and is ready to take the traffic. Observe the time
 requires to deploy the template. Consider this time when you specify 
the quiet time while configuring AutoScale.
			</div></li><li class="listitem"><div class="para">
				The AutoScale feature supports the SNMP counters that can be used to
 define conditions for taking scale up or scale down actions. To monitor
 the SNMP-based counter, ensure that the SNMP agent is installed in the 
template used for creating the AutoScale VMs, and the SNMP operations 
work with the configured SNMP community and port by using standard SNMP 
managers. For example, see <a class="xref" href="#configure-snmp-rhel">第&nbsp;15.8.2&nbsp;节 “配​置​RHEL服​务​器​上​的​snmp通​信​组​”</a> to configure SNMP on a RHEL machine.
			</div></li><li class="listitem"><div class="para">
				Ensure that the endpointe.url parameter present in the Global 
Settings is set to the Management Server API URL. For example, 
http://10.102.102.22:8080/client/api. In a multi-node Management Server 
deployment, use the virtual IP address configured in the load balancer 
for the management server’​s cluster. Additionally, ensure that the 
NetScaler device has access to this IP address to provide AutoScale 
support.
			</div><div class="para">
				If you update the endpointe.url, disable the AutoScale functionality
 of the load balancer rules in the system, then enable them back to 
reflect the changes. For more information see <a class="xref" href="#update-autoscale">Updating an AutoScale Configuration</a>
			</div></li><li class="listitem"><div class="para">
				If the API Key and Secret Key are regenerated for an AutoScale user,
 ensure that the AutoScale functionality of the load balancers that the 
user participates in are disabled and then enabled to reflect the 
configuration changes in the NetScaler.
			</div></li><li class="listitem"><div class="para">
				In an advanced Zone, ensure that at least one VM should be present 
before configuring a load balancer rule with AutoScale. Having one VM in
 the network ensures that the network is in implemented state for 
configuring AutoScale.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp48349344">云​平​台​配​置​</h5>
			Specify the following:
		</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/autoscale-config.png" alt="autoscaleateconfig.png: Configuring AutoScale" width="444"></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Template</strong></span>: A template
 consists of a base OS image and application. A template is used to 
provision the new instance of an application on a scaleup action. When a
 VM is deployed from a template, the VM can start taking the traffic 
from the load balancer without any admin intervention. For example, if 
the VM is deployed for a Web service, it should have the Web server 
running, the database connected, and so on.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Compute offering</strong></span>: A 
predefined set of virtual hardware attributes, including CPU speed, 
number of CPUs, and RAM size, that the user can select when creating a 
new virtual machine instance. Choose one of the compute offerings to be 
used while provisioning a VM instance as part of scaleup action.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Min Instance</strong></span>: The 
minimum number of active VM instances that is assigned to a load 
balancing rule. The active VM instances are the application instances 
that are up and serving the traffic, and are being load balanced. This 
parameter ensures that a load balancing rule has at least the configured
 number of active VM instances are available to serve the traffic.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					If an application, such as SAP, running on a VM instance is down 
for some reason, the VM is then not counted as part of Min Instance 
parameter, and the AutoScale feature initiates a scaleup action if the 
number of active VM instances is below the configured value. Similarly, 
when an application instance comes up from its earlier down state, this 
application instance is counted as part of the active instance count and
 the AutoScale process initiates a scaledown action when the active 
instance count breaches the Max instance value.
				</div></div></div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Max Instance</strong></span>: Maximum number of active VM instances that <span class="bold bold"><strong>should be assigned to </strong></span>a
 load balancing rule. This parameter defines the upper limit of active 
VM instances that can be assigned to a load balancing rule.
			</div><div class="para">
				Specifying a large value for the maximum instance parameter might 
result in provisioning large number of VM instances, which in turn leads
 to a single load balancing rule exhausting the VM instances limit 
specified at the account or domain level.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					If an application, such as SAP, running on a VM instance is down 
for some reason, the VM is not counted as part of Max Instance 
parameter. So there may be scenarios where the number of VMs provisioned
 for a scaleup action might be more than the configured Max Instance 
value. Once the application instances in the VMs are up from an earlier 
down state, the AutoScale feature starts aligning to the configured Max 
Instance value.
				</div></div></div></li></ul></div><div class="para">
		Specify the following scale-up and scale-down policies:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Duration</strong></span>: The 
duration, in seconds, for which the conditions you specify must be true 
to trigger a scaleup action. The conditions defined should hold true for
 the entire duration you specify for an AutoScale action to be invoked.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Counter</strong></span>: The 
performance counters expose the state of the monitored instances. By 
default, CloudStack offers four performance counters: Three SNMP 
counters and one NetScaler counter. The SNMP counters are Linux User 
CPU, Linux System CPU, and Linux CPU Idle. The NetScaler counter is 
ResponseTime. The root administrator can add additional counters into 
CloudStack by using the CloudStack API.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Operator</strong></span>: The 
following five relational operators are supported in AutoScale feature: 
Greater than, Less than, Less than or equal to, Greater than or equal 
to, and Equal to.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Threshold</strong></span>: Threshold
 value to be used for the counter. Once the counter defined above 
breaches the threshold value, the AutoScale feature initiates a scaleup 
or scaledown action.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Add</strong></span>: Click Add to add the condition.
			</div></li></ul></div><div class="para">
		Additionally, if you want to configure the advanced settings, click Show advanced settings, and specify the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Polling interval</strong></span>: 
Frequency in which the conditions, combination of counter, operator and 
threshold, are to be evaluated before taking a scale up or down action. 
The default polling interval is 30 seconds.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Quiet Time</strong></span>: This is 
the cool down period after an AutoScale action is initiated. The time 
includes the time taken to complete provisioning a VM instance from its 
template and the time taken by an application to be ready to serve 
traffic. This quiet time allows the fleet to come up to a stable state 
before any action can take place. The default is 300 seconds.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Destroy VM Grace Period</strong></span>:
 The duration in seconds, after a scaledown action is initiated, to wait
 before the VM is destroyed as part of scaledown action. This is to 
ensure graceful close of any pending sessions or transactions being 
served by the VM marked for destroy. The default is 120 seconds.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Security Groups</strong></span>: 
Security groups provide a way to isolate traffic to the VM instances. A 
security group is a group of VMs that filter their incoming and outgoing
 traffic according to a set of rules, called ingress and egress rules. 
These rules filter network traffic according to the IP address that is 
attempting to communicate with the VM.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Disk Offerings</strong></span>: A predefined set of disk size for primary data storage.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>SNMP Community</strong></span>: The 
SNMP community string to be used by the NetScaler device to query the 
configured counter value from the provisioned VM instances. Default is 
public.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>SNMP Port</strong></span>: The port number on which the SNMP agent that run on the provisioned VMs is listening. Default port is 161.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>User</strong></span>: This is the 
user that the NetScaler device use to invoke scaleup and scaledown API 
calls to the cloud. If no option is specified, the user who configures 
AutoScaling is applied. Specify another user name to override.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Apply</strong></span>: Click Apply to create the AutoScale configuration.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp6321008">Disabling and Enabling an AutoScale Configuration</h5>
			If you want to perform any maintenance operation on the AutoScale VM 
instances, disable the AutoScale configuration. When the AutoScale 
configuration is disabled, no scaleup or scaledown action is performed. 
You can use this downtime for the maintenance activities. To disable the
 AutoScale configuration, click the Disable AutoScale
			<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable-autoscale.png" alt="EnableDisable.png: button to enable or disable AutoScale."></span>
			button.
		</div><div class="para">
		The button toggles between enable and disable, depending on whether 
AutoScale is currently enabled or not. After the maintenance operations 
are done, you can enable the AutoScale configuration back. To enable, 
open the AutoScale configuration page again, then click the Enable 
AutoScale
		<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable-autoscale.png" alt="EnableDisable.png: button to enable or disable AutoScale."></span>
		button.
	</div><div class="formalpara" id="update-autoscale"><h5 class="formalpara">Updating an AutoScale Configuration</h5>
			You can update the various parameters and add or delete the 
conditions in a scaleup or scaledown rule. Before you update an 
AutoScale configuration, ensure that you disable the AutoScale load 
balancer rule by clicking the Disable AutoScale button.
		</div><div class="para">
		After you modify the required AutoScale parameters, click Apply. To 
apply the new AutoScale policies, open the AutoScale configuration page 
again, then click the Enable AutoScale button.
	</div><div class="formalpara"><h5 class="formalpara" id="idm1928336">Runtime Considerations</h5>
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				An administrator should not assign a VM to a load balancing rule which is configured for AutoScale.
			</div></li><li class="listitem"><div class="para">
				Before a VM provisioning is completed if NetScaler is shutdown or 
restarted, the provisioned VM cannot be a part of the load balancing 
rule though the intent was to assign it to a load balancing rule. To 
workaround, rename the AutoScale provisioned VMs based on the rule name 
or ID so at any point of time the VMs can be reconciled to its load 
balancing rule.
			</div></li><li class="listitem"><div class="para">
				Making API calls outside the context of AutoScale, such as 
destroyVM, on an autoscaled VM leaves the load balancing configuration 
in an inconsistent state. Though VM is destroyed from the load balancer 
rule, NetScaler continues to show the VM as a service assigned to a 
rule.
			</div></li></ul></div></div></div><div xml:lang="zh-CN" class="section" id="load-balancer-rules" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.9.&nbsp;负​载​均​衡​规​则​</h2></div></div></div><div class="para">
		
本​产​品​用​户​或​管​理​员​能​创​建​来​自​于​公​共​IP到​一​个​或​多​个​虚​拟​机​之​间​流​量​的​负​载​均​衡​
规​则​。​用​户​创​建​规​则​指​定​算​法​，然​后​将​规​则​分​配​给​一​个​虚​拟​机​集​合​。​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			
如​果​你​创​建​的​负​载​均​衡​规​则​同​时​使​用​的​网​络​提​供​方​案​使​用​到​了​外​部​的​负​载​均​衡​器​设​
备​（比​如​NetScaler）,随​后​又​改​变​为​使​用​虚​拟​路​由​器​的​网​络​提​供​方​案​,你​必​须​在​虚​拟​路
​由​器​上​为​每​个​已​存​在​的​负​载​聚​恒​规​则​创​建​一​个​防​火​墙​规​则​以​使​它​们​继​续​生​效​。​
		</div></div></div><div class="para">
	</div><div xml:lang="zh-CN" class="section" id="add-load-balancer-rule" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.9.1.&nbsp;Adding a Load Balancer Rule</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network where you want to load balance the traffic.
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​IP地​址​.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Load Balancing node of the diagram, click View All.
			</div><div class="para">
				In a Basic zone, you can also create a load balancing rule without 
acquiring or selecting an IP address. CloudStack internally assign an IP
 when you create the load balancing rule, which is listed in the IP 
Addresses page when the rule is created.
			</div><div class="para">
				To do that, select the name of the network, then click Add Load Balancer tab. Continue with <a class="xref" href="#config-lb">7</a>.
			</div></li><li class="listitem" id="config-lb"><div class="para">
				Fill in the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A name for the load balancer rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port receiving incoming traffic to be balanced.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port that the VMs will use to receive the traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Algorithm</strong></span>: Choose 
the load balancing algorithm you want CloudStack to use. CloudStack 
supports a variety of well-known algorithms. If you are not familiar 
with these choices, you will find plenty of information about them on 
the Internet.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Stickiness</strong></span>: 
(Optional) Click Configure and choose the algorithm for the stickiness 
policy. See Sticky Session Policies for Load Balancer Rules.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>AutoScale</strong></span>: Click Configure and complete the AutoScale configuration as explained in <a class="xref" href="#autoscale">第&nbsp;15.8.5&nbsp;节 “Configuring AutoScale”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add VMs, then select two or more VMs that will divide the load of incoming traffic, and click Apply.
			</div><div class="para">
				The new load balancer rule appears in the list. You can repeat these
 steps to add more load balancer rules for this IP address.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="sticky-session-policies-for-lb-rules" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.9.2.&nbsp;Sticky Session Policies for Load Balancer Rules</h3></div></div></div><div class="para">
		Sticky sessions are used in Web-based applications to ensure continued
 availability of information across the multiple requests in a user's 
session. For example, if a shopper is filling a cart, you need to 
remember what has been purchased so far. The concept of "stickiness" is 
also referred to as persistence or maintaining state.
	</div><div class="para">
		Any load balancer rule defined in CloudStack can have a stickiness 
policy. The policy consists of a name, stickiness method, and 
parameters. The parameters are name-value pairs or flags, which are 
defined by the load balancer vendor. The stickiness method could be load
 balancer-generated cookie, application-generated cookie, or 
source-based. In the source-based method, the source IP address is used 
to identify the user and locate the user’​s stored data. In the other 
methods, cookies are used. The cookie generated by the load balancer or 
application is included in request and response URLs to create 
persistence. The cookie name can be specified by the administrator or 
automatically generated. A variety of options are provided to control 
the exact behavior of cookies, such as how they are generated and 
whether they are cached.
	</div><div class="para">
		For the most up to date list of available stickiness methods, see the 
CloudStack UI or call listNetworks and check the 
SupportedStickinessMethods capability.
	</div></div></div><div xml:lang="zh-CN" class="section" id="guest-ip-ranges" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.10.&nbsp;宾​客​IP范​围​</h2></div></div></div><div class="para">
		宾​客​网​络​流​量​的​IP是​由​用​户​以​帐​号​为​基​础​设​置​的​。​这​允​许​用​户​以​在​他​们​的​宾​客​网​络​和​他​们​的​客​户​端​之​间​开​通​VPN连​接​的​方​式​配​置​他​们​的​网​络​。​
	</div></div><div xml:lang="zh-CN" class="section" id="acquire-new-ip-address" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.11.&nbsp;获​得​一​个​新​的​IP地​址​</h2></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				点​击​你​想​要​与​之​工​作​的​网​络​名​称​.
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​IP地​址​.
			</div></li><li class="listitem"><div class="para">
				点​击​获​得​一​个​新​IP, 并​且​在​确​认​的​对​话​框​中​点​击​确​定​.
			</div><div class="para">
				你​被​要​求​点​击​确​认​是​因​为​, 通​常​IP地​址​是​有​限​的​资​源​. 在​稍​等​片​刻​之​后​, 
新​的​IP地​址​将​会​出​现​并​且​状​态​是​已​分​配​. 
你​现​在​可​以​使​用​这​个​IP地​址​进​行​端​口​转​发​或​静​态​NAT规​则​.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="release-ip-address" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.12.&nbsp;Releasing an IP Address</h2></div></div></div><div class="para">
		When the last rule for an IP address is removed, you can release that 
IP address. The IP address still belongs to the VPC; however, it can be 
picked up for any guest network again.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				点​击​你​想​要​与​之​工​作​的​网​络​名​称​.
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​IP地​址​.
			</div></li><li class="listitem"><div class="para">
				Click the IP address you want to release.
			</div></li><li class="listitem"><div class="para">
				Click the Release IP button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/release-ip-icon.png" alt="ReleaseIPButton.png: button to release an IP"></span>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="static-nat" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.13.&nbsp;静​态​ NAT</h2></div></div></div><div class="para">
		A static NAT rule maps a public IP address to the private IP address 
of a VM in order to allow Internet traffic into the VM. The public IP 
address always remains the same, which is why it is called “​static”​ 
NAT. This section tells how to enable or disable static NAT for a 
particular IP address.
	</div><div xml:lang="zh-CN" class="section" id="enable-disable-static-nat" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.13.1.&nbsp;Enabling or Disabling Static NAT</h3></div></div></div><div class="para">
		If port forwarding rules are already in effect for an IP address, you cannot enable static NAT to that IP.
	</div><div class="para">
		If a guest VM is part of more than one network, static NAT rules will 
function only if they are defined on the default network.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				点​击​你​想​要​与​之​工​作​的​网​络​名​称​.
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​IP地​址​.
			</div></li><li class="listitem"><div class="para">
				Click the IP address you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Static NAT 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable.png" alt="ReleaseIPButton.png: button to release an IP"></span>
				button.
			</div><div class="para">
				The button toggles between Enable and Disable, depending on whether static NAT is currently enabled for the IP address.
			</div></li><li class="listitem"><div class="para">
				If you are enabling static NAT, a dialog appears where you can choose the destination VM and click Apply.
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="ip-forwarding-firewalling" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.14.&nbsp;IP转​发​及​防​火​墙​</h2></div></div></div><div class="para">
		By default, all incoming traffic to the public IP address is rejected.
 All outgoing traffic from the guests is also blocked by default.
	</div><div class="para">
		To allow outgoing traffic, follow the procedure in <a class="xref" href="#egress-firewall-rule">第&nbsp;15.14.1&nbsp;节 “Creating Egress Firewall Rules in an Advanced Zone”</a>.
	</div><div class="para">
		To allow incoming traffic, users may set up firewall rules and/or port
 forwarding rules. For example, you can use a firewall rule to open a 
range of ports on the public IP address, such as 33 through 44. Then use
 port forwarding rules to direct traffic from individual ports within 
that range to specific ports on user VMs. For example, one port 
forwarding rule could route incoming traffic on the public IP's port 33 
to port 100 on one user VM's private IP. For more information, see <a class="xref" href="#firewall-rules">第&nbsp;15.14.2&nbsp;节 “防​火​墙​规​则​”</a> and <a class="xref" href="#port-forwarding">第&nbsp;15.14.3&nbsp;节 “ç«¯å£è½¬å”</a>.
	</div><div xml:lang="zh-CN" class="section" id="egress-firewall-rule" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.14.1.&nbsp;Creating Egress Firewall Rules in an Advanced Zone</h3></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			The egress firewall rules are supported only on virtual routers.
		</div></div></div><div class="para">
	</div><div class="para">
		The egress traffic originates from a private network to a public 
network, such as the Internet. By default, the egress traffic is 
blocked, so no outgoing traffic is allowed from a guest network to the 
Internet. However, you can control the egress traffic in an Advanced 
zone by creating egress firewall rules. When an egress firewall rule is 
applied, the traffic specific to the rule is allowed and the remaining 
traffic is blocked. When all the firewall rules are removed the default 
policy, Block, is applied.
	</div><div class="para">
		Consider the following scenarios to apply egress firewall rules:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Allow the egress traffic from specified source CIDR. The Source CIDR is part of guest network CIDR.
			</div></li><li class="listitem"><div class="para">
				Allow the egress traffic with destination protocol TCP,UDP,ICMP, or ALL.
			</div></li><li class="listitem"><div class="para">
				Allow the egress traffic with destination protocol and port range. 
The port range is specified for TCP, UDP or for ICMP type and code.
			</div></li></ul></div><div class="para">
		To configure an egress firewall rule:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				In Select view, choose Guest networks, then click the Guest network you want.
			</div></li><li class="listitem"><div class="para">
				To add an egress rule, click the Egress rules tab and fill out the 
following fields to specify what type of traffic is allowed to be sent 
out of VM instances in this guest network:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/egress-firewall-rule.png" alt="egress-firewall-rule.png: adding an egress firewall rule" width="444"></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>: (Add by CIDR
 only) To send traffic only to the IP addresses within a particular 
address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR
 is the base IP address of the destination. For example, 192.168.0.0/22.
 To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The 
networking protocol that VMs uses to send outgoing traffic. The TCP and 
UDP protocols are typically used for data exchange and end-user 
communications. The ICMP protocol is typically used to send error 
messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port, End Port</strong></span>:
 (TCP, UDP only) A range of listening ports that are the destination for
 the outgoing traffic. If you are opening a single port, use the same 
number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type, ICMP Code</strong></span>: (ICMP only) The type of message and error code that are sent.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="firewall-rules" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.14.2.&nbsp;防​火​墙​规​则​</h3></div></div></div><div class="para">
		
默​认​情​况​下​，防​火​墙​拒​绝​所​有​流​入​公​共​IP的​流​量​。​要​是​需​要​允​许​外​部​流​量​，你​需​要​通​
过​制​定​防​火​墙​规​则​打​开​防​火​墙​端​口​。​你​可​以​选​择​性​的​制​定​一​个​或​多​个​CIDR（无​类​别​域
​际​路​由​选​择​，这​个​说​法​太​晦​涩​，你​可​以​理​解​为​一​个​IP网​络​）来​过​滤​来​源​IP。​这​在​当​你​
只​需​要​允​许​特​定​IP请​求​时​会​很​有​用​。​
	</div><div class="para">
		你​不​能​使​用​防​火​墙​规​则​打​开​弹​性​IP端​口​。​当​弹​性​IP处​在​使​用​状​态​时​，外​部​的​通​过​请​求​将​被​安​全​组​管​理​。​详​情​查​看​<a class="xref" href="#add-security-group">第&nbsp;15.7.2&nbsp;节 “Adding a Security Group”</a>。​
	</div><div class="para">
		In an advanced zone, you can also create egress firewall rules by using the virtual router. For more information, see <a class="xref" href="#egress-firewall-rule">第&nbsp;15.14.1&nbsp;节 “Creating Egress Firewall Rules in an Advanced Zone”</a>.
	</div><div class="para">
		防​火​墙​规​则​能​在​管​理​服​务​器​的​web 
UI的​防​火​墙​表​里​创​建​，这​个​规​则​表​默​认​不​显​示​，你​需​要​以​管​理​员​身​份​修​改​全​局​变​量​ 
firewall.rule.ui.enabled为​ "true"才​能​显​示​。​
	</div><div class="para">
		如​果​你​想​创​建​防​火​墙​规​则​：
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				以​用​户​或​管​理​员​身​份​登​录​进​入​WebUI。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​，选​择​网​络​
			</div></li><li class="listitem"><div class="para">
				选​择​你​要​修​改​的​网​络​名​称​
			</div></li><li class="listitem"><div class="para">
				点​击​ 查​看​IP地​址​
			</div></li><li class="listitem"><div class="para">
				点​击​你​要​修​改​的​IP地​址​
			</div></li><li class="listitem"><div class="para">
				点​击​设​置​标​签​ 填​入​以​下​值​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>来​源​CIDR</strong></span>。​（可​选​）只​
允​许​在​某​个​特​定​地​址​块​的​IP流​量​的​话​，输​入​一​个​CIDR或​者​一​个​逗​号​隔​开​的​CIDR列​表​。
​例​如​：192.168.0.0/22或​者​192.168.0.0/24,192.168.1.0/24,192.168.2.0/24。​留​
空​则​为​允​许​所​有​的​CIDR。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>协​议​</strong></span>. 你​所​要​开​反​复​端​口​所​使​用​的​网​络​协​议​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>起​始​端​口​和​结​束​端​口​</strong></span>. 你​想​要​在​防​火​墙​开​放​的​端​口​。​如​果​你​只​打​开​单​个​端​口​，在​两​个​空​格​中​填​入​相​同​的​端​口​号​。​
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP 类​型​和​编​号​</strong></span>.。​
只​有​在​设​置​ICMP协​议​时​才​会​用​到​。​提​供​需​要​填​写​的​ICMP协​议​，ICMP头​的​类​型​和​代​码​。
​如​果​你​不​知​道​天​什​么​请​参​看​ICMP文​档​。​（这​里​推​荐​一​个​ 
http://wenku.baidu.com/view/e235e8ecaeaad1f346933fed.html）
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="port-forwarding" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.14.3.&nbsp;ç«¯å£è½¬å</h3></div></div></div><div class="para">
		A port forward service is a set of port forwarding rules that define a
 policy. A port forward service is then applied to one or more guest 
VMs. The guest VM then has its inbound network access managed according 
to the policy defined by the port forwarding service. You can optionally
 specify one or more CIDRs to filter the source IPs. This is useful when
 you want to allow only incoming requests from certain IP addresses to 
be forwarded.
	</div><div class="para">
		A guest VM can be in any number of port forward services. Port forward
 services can be defined but have no members. If a guest VM is part of 
more than one network, port forwarding rules will function only if they 
are defined on the default network
	</div><div class="para">
		You cannot use port forwarding to open ports for an elastic IP 
address. When elastic IP is used, outside access is instead controlled 
through the use of security groups. See Security Groups.
	</div><div class="para">
		To set up port forwarding:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​到​CloudStack界​面​以​管​理​员​或​者​终​端​用​户​。​
			</div></li><li class="listitem"><div class="para">
				If you have not already done so, add a public IP address range to a 
zone in CloudStack. See Adding a Zone and Pod in the Installation Guide.
			</div></li><li class="listitem"><div class="para">
				Add one or more VM instances to CloudStack.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Network.
			</div></li><li class="listitem"><div class="para">
				Click the name of the guest network where the VMs are running.
			</div></li><li class="listitem"><div class="para">
				Choose an existing IP address or acquire a new IP address. See <a class="xref" href="#acquire-new-ip-address">第&nbsp;15.11&nbsp;节 “获​得​一​个​新​的​IP地​址​”</a>. Click the name of the IP address in the list.
			</div></li><li class="listitem"><div class="para">
				Click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Port Forwarding node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Fill in the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>. The port to which public traffic will be addressed on the IP address you acquired in the previous step.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>. The port on which the instance is listening for forwarded public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>. The communication protocol in use between the two ports
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​添​加​。​
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="ip-load-balancing" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.15.&nbsp;IP负​载​均​衡​</h2></div></div></div><div class="para">
		用​户​可​以​选​择​关​联​到​同​一​个​公​网​IP的​多​个​宾​客​虚​拟​机​。​CloudStack实​现​了​TCP级​别​的​负​载​平​衡​器​，有​一​下​策​略​。​
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				轮​询​
			</div></li><li class="listitem"><div class="para">
				最​少​连​接​
			</div></li><li class="listitem"><div class="para">
				源​IP
			</div></li></ul></div><div class="para">
		这​类​似​于​端​口​转​发​，但​目​标​可​能​会​有​多​个​IP地​址​。​
	</div></div><div xml:lang="zh-CN" class="section" id="dns-dhcp" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.16.&nbsp;DNS和​DHCP</h2></div></div></div><div class="para">
		虚​拟​路​由​器​为​客​户​机​提​供​DNS和​DHCP服​服​务​。​它​将​DNS请​求​代​理​到​在​可​用​性​区​中​配​置​的​DNS服​务​器​。​
	</div></div><div xml:lang="zh-CN" class="section" id="vpn" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.17.&nbsp;VPN 虚​拟​专​用​网​</h2></div></div></div><div class="para">
		CloudStack account拥​有​者​可​以​建​立​ VPN 
以​便​访​问​他​们​的​虚​拟​机​。​如​果​来​宾​网​络​ 从​一​个​提​供​ 
远​程​VPN访​问​服​务​的​网​络​实​例​化​，虚​拟​路​由​(在​ System 
VM上​的​)将​被​用​于​提​供​服​务​。​\nCloudStack 提​供​了​一​个​ 基​于​ 
L2TP-over-IPsec-based 协​议​的​远​程​VPN访​问​服​务​ 给​ guest虚​拟​网​络​。​ 
因​为​每​个​网​络​有​它​自​己​的​ 虚​拟​路​由​， VPNs 没​有​在​这​些​网​络​中​被​共​享​。​Windows, 
Mac OS X和​iOS的​原​生​(自​带​) VPN客​户​端​ 可​以​用​于​访​问​ 
来​宾​网​络​。​account拥​有​者​可​以​建​立​并​管​理​他​们​的​VPN用​户​。​CloudStack 
不​使​用​自​己​账​户​数​据​库​，而​是​用​了​另​外​一​个​独​立​的​表​。​VPN用​户​数​据​库​在​同​一​个​
account拥​有​者​建​立​的​VPN网​络​中​被​共​享​。​ 
也​就​是​说​，同​一​个​account拥​有​者​建​立​里​的​全​部​VPN可​以​被​它​的​全​部​VPN用​户​访​问​。​
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			确​保​不​是​所​有​的​网​络​流​量​走​VPN。​也​就​是​说​，用​于​配​置​VPN的​route不​是​唯​一​用​于​该​guest network，也​不​承​担​全​部​的​网​络​流​量​。​
		</div></div></div><div class="para">
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Road Warrior / Remote Access 公​路​勇​士​/远​程​访​问​</strong></span>.
用​户​希​望​可​以​安​全​地​从​家​里​或​者​办​公​室​连​接​到​云​上​的​一​个​ 
私​有​网​络​。​特​别​是​连​接​的​客​户​端​的​IP地​址​是​动​态​决​定​的​，不​能​预​先​配​置​到​VPN 
服​务​器​上​。​
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Site to Site</strong></span>. In 
this scenario, two private subnets are connected over the public 
Internet with a secure VPN tunnel. The cloud user’​s subnet (for 
example, an office network) is connected through a gateway to the 
network in the cloud. The address of the user’​s gateway must be 
preconfigured on the VPN server in the cloud. Note that although 
L2TP-over-IPsec can be used to set up Site-to-Site VPNs, this is not the
 primary intent of this feature. For more information, see <a class="xref" href="#site-to-site-vpn">第&nbsp;15.17.4&nbsp;节 “配​置​站​点​到​站​点​的​VPN连​接​”</a>
			</div></li></ul></div><div xml:lang="zh-CN" class="section" id="configure-vpn" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.17.1.&nbsp;Configuring VPN</h3></div></div></div><div class="para">
		To set up VPN for the cloud:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				Set the following global configuration parameters.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						remote.access.vpn.client.ip.range –​ The range of IP addresses to 
be allocated to remote access VPN clients. The first IP in the range is 
used by the VPN server.
					</div></li><li class="listitem"><div class="para">
						remote.access.vpn.psk.length –​ Length of the IPSec key.
					</div></li><li class="listitem"><div class="para">
						remote.access.vpn.user.limit –​ Maximum number of VPN users per account.
					</div></li></ul></div></li></ol></div><div class="para">
		To enable VPN for a particular network:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as a user or administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Network.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network you want to work with.
			</div></li><li class="listitem"><div class="para">
				点​击​查​看​IP地​址​.
			</div></li><li class="listitem"><div class="para">
				Click one of the displayed IP address names.
			</div></li><li class="listitem"><div class="para">
				Click the Enable VPN button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/vpn-icon.png" alt="AttachDiskButton.png: button to attach a volume"></span>
			</div><div class="para">
				The IPsec key is displayed in a popup window.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="using-vpn-with-windows" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.17.2.&nbsp;Using VPN with Windows</h3></div></div></div><div class="para">
		The procedure to use VPN varies by Windows version. Generally, the 
user must edit the VPN properties and make sure that the default route 
is not the VPN. The following steps are for Windows L2TP clients on 
Windows Vista. The commands should be similar for other Windows 
versions.
	</div><div class="orderedlist"><ol><li class="listitem" id="source-nat"><div class="para">
				Log in to the CloudStack UI and click on the source NAT IP for the 
account. The VPN tab should display the IPsec preshared key. Make a note
 of this and the source NAT IP. The UI also lists one or more users and 
their passwords. Choose one of these users, or, if none exists, add a 
user and password.
			</div></li><li class="listitem"><div class="para">
				On the Windows box, go to Control Panel, then select Network and Sharing center. Click Setup a connection or network.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, select No, create a new connection.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, select Use my Internet Connection (VPN).
			</div></li><li class="listitem"><div class="para">
				In the next dialog, enter the source NAT IP from step <a class="xref" href="#source-nat">1</a> and give the connection a name. Check Don't connect now.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, enter the user name and password selected in step <a class="xref" href="#source-nat">1</a>.
			</div></li><li class="listitem"><div class="para">
				Click Create.
			</div></li><li class="listitem"><div class="para">
				Go back to the Control Panel and click Network Connections to see the new connection. The connection is not active yet.
			</div></li><li class="listitem"><div class="para">
				Right-click the new connection and select Properties. In the Properties dialog, select the Networking tab.
			</div></li><li class="listitem"><div class="para">
				In Type of VPN, choose L2TP IPsec VPN, then click IPsec settings. 
Select Use preshared key. Enter the preshared key from Step <a class="xref" href="#source-nat">1</a>.
			</div></li><li class="listitem"><div class="para">
				The connection is ready for activation. Go back to Control Panel 
-&gt; Network Connections and double-click the created connection.
			</div></li><li class="listitem"><div class="para">
				Enter the user name and password from Step <a class="xref" href="#source-nat">1</a>.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="using-vpn-with-mac" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.17.3.&nbsp;在​Mac OS X上​使​用​VPN</h3></div></div></div><div class="para">
		First, be sure you've configured the VPN settings in your CloudStack 
install. This section is only concerned with connecting via Mac OS X to 
your VPN.
	</div><div class="para">
		Note, these instructions were written on Mac OS X 10.7.5. They may differ slightly in older or newer releases of Mac OS X.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				On your Mac, open System Preferences and click Network.
			</div></li><li class="listitem"><div class="para">
				Make sure Send all traffic over VPN connection is not checked.
			</div></li><li class="listitem"><div class="para">
				If your preferences are locked, you'll need to click the lock in the
 bottom left-hand corner to make any changes and provide your 
administrator credentials.
			</div></li><li class="listitem"><div class="para">
				You will need to create a new network entry. Click the plus icon on 
the bottom left-hand side and you'll see a dialog that says "Select the 
interface and enter a name for the new service." Select VPN from the 
Interface drop-down menu, and "L2TP over IPSec" for the VPN Type. Enter 
whatever you like within the "Service Name" field.
			</div></li><li class="listitem"><div class="para">
				You'll now have a new network interface with the name of whatever 
you put in the "Service Name" field. For the purposes of this example, 
we'll assume you've named it "CloudStack." Click on that interface and 
provide the IP address of the interface for your VPN under the Server 
Address field, and the user name for your VPN under Account Name.
			</div></li><li class="listitem"><div class="para">
				Click Authentication Settings, and add the user's password under 
User Authentication and enter the pre-shared IPSec key in the Shared 
Secret field under Machine Authentication. Click OK.
			</div></li><li class="listitem"><div class="para">
				You may also want to click the "Show VPN status in menu bar" but that's entirely optional.
			</div></li><li class="listitem"><div class="para">
				Now click "Connect" and you will be connected to the CloudStack VPN.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="site-to-site-vpn" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.17.4.&nbsp;配​置​站​点​到​站​点​的​VPN连​接​</h3></div></div></div><div class="para">
		
一​个​站​点​到​站​点​的​VPN连​接​可​以​帮​助​你​建​立​从​云​基​础​架​构​到​企​业​内​部​数​据​中​心​的​安​全
​连​接​.这​就​允​许​一​个​账​户​从​企​业​内​部​数​据​中​心​的​设​备​连​接​到​此​账​户​启​用​VPN连​接​的​虚
​拟​路​由​器​上​, 从​而​通​过​VPN连​接​到​该​账​户​的​虚​拟​机​.
	</div><div class="para">
		目​前​支​持​的​数​据​中​心​的​终​端​设​备​是​:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Cisco ISR IOS 12.4或​更​新​
			</div></li><li class="listitem"><div class="para">
				Juniper J-系​统​ 路​由​器​ JunOS 9.5 或​更​新​版​本​
			</div></li></ul></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			除​了​上​述​指​定​的​Cisco和​Juniper设​备​, 所​期​望​的​是​任​何​Cisco或​Juniper的​设​备​在​支​持​的​操​作​系​统​上​都​可​以​建​立​VPN连​接​.
		</div></div></div><div class="para">
		为​了​建​立​站​点​到​站​点​的​VPN连​接​, 需​要​执​行​以​下​步​骤​:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				创​建​一​个​虚​拟​私​有​云​(VPC).
			</div><div class="para">
				参​见​<a class="xref" href="#configure-vpc">第&nbsp;15.19&nbsp;节 “Configuring a Virtual Private Cloud”</a>.
			</div></li><li class="listitem"><div class="para">
				创​建​一​个​VPN客​户​网​关​.
			</div></li><li class="listitem"><div class="para">
				为​你​创​建​的​VPC设​定​一​个​VPN网​关​.
			</div></li><li class="listitem"><div class="para">
				从​VPC的​VPN网​关​到​客​户​的​VPN网​关​建​立​VPN连​接​.
			</div></li></ol></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			Appropriate events are generated on the CloudStack UI when status of a
 Site-to-Site VPN connection changes from connected to disconnected, or 
vice versa. Currently no events are generated when establishing a VPN 
connection fails or pending.
		</div></div></div><div xml:lang="zh-CN" class="section" id="create-vpn-customer-gateway" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">15.17.4.1.&nbsp;Creating and Updating a VPN Customer Gateway</h4></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			A VPN customer gateway can be connected to only one VPN gateway at a time.
		</div></div></div><div class="para">
		To add a VPN Customer Gateway:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPN Customer Gateway.
			</div></li><li class="listitem"><div class="para">
				Click Add site-to-site VPN.
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-vpn-customer-gateway.png" alt="addvpncustomergateway.png: adding a customer gateway."></div><div class="para">
				填​写​以​下​内​容​。​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A unique name for the VPN customer gateway you create.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The IP address for the remote gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR list</strong></span>: The 
guest CIDR list of the remote subnets. Enter a CIDR or a comma-separated
 list of CIDRs. Ensure that a guest CIDR list is not overlapped with the
 VPC’​s CIDR, or another guest CIDR. The CIDR must be RFC1918-compliant.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IPsec Preshared Key</strong></span>:
 Preshared keying is a method where the endpoints of the VPN share a 
secret key. This key value is used to authenticate the customer gateway 
and the VPC VPN gateway to each other.
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							The IKE peers (VPN end points) authenticate each other by 
computing and sending a keyed hash of data that includes the Preshared 
key. If the receiving peer is able to create the same hash independently
 by using its Preshared key, it knows that both peers must share the 
same secret, thus authenticating the customer gateway.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Encryption</strong></span>: 
The Internet Key Exchange (IKE) policy for phase-1. The supported 
encryption algorithms are AES128, AES192, AES256, and 3DES. 
Authentication is accomplished through the Preshared Keys.
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							The phase-1 is the first phase in the IKE process. In this 
initial negotiation phase, the two VPN endpoints agree on the methods to
 be used to provide security for the underlying IP traffic. The phase-1 
authenticates the two VPN gateways to each other, by confirming that the
 remote gateway has a matching Preshared Key.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Hash</strong></span>: The IKE hash for phase-1. The supported hash algorithms are SHA1 and MD5.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE DH</strong></span>: A 
public-key cryptography protocol which allows two parties to establish a
 shared secret over an insecure communications channel. The 1536-bit 
Diffie-Hellman group is used within IKE to establish session keys. The 
supported options are None, Group-5 (1536-bit) and Group-2 (1024-bit).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Encryption</strong></span>: 
Encapsulating Security Payload (ESP) algorithm within phase-2. The 
supported encryption algorithms are AES128, AES192, AES256, and 3DES.
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							The phase-2 is the second phase in the IKE process. The purpose 
of IKE phase-2 is to negotiate IPSec security associations (SA) to set 
up the IPSec tunnel. In phase-2, new keying material is extracted from 
the Diffie-Hellman key exchange in phase-1, to provide session keys to 
use in protecting the VPN data flow.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Hash</strong></span>: Encapsulating Security Payload (ESP) hash for phase-2. Supported hash algorithms are SHA1 and MD5.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Perfect Forward Secrecy</strong></span>:
 Perfect Forward Secrecy (or PFS) is the property that ensures that a 
session key derived from a set of long-term public and private keys will
 not be compromised. This property enforces a new Diffie-Hellman key 
exchange. It provides the keying material that has greater key material 
life and thereby greater resistance to cryptographic attacks. The 
available options are None, Group-5 (1536-bit) and Group-2 (1024-bit). 
The security of the key exchanges increase as the DH groups grow larger,
 as does the time of the exchanges.
					</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							When PFS is turned on, for every negotiation of a new phase-2 SA 
the two gateways must generate a new set of phase-1 keys. This adds an 
extra layer of protection that PFS adds, which ensures if the phase-2 
SA’​s have expired, the keys used for new phase-2 SA’​s have not been 
generated from the current phase-1 keying material.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Lifetime (seconds)</strong></span>:
 The phase-1 lifetime of the security association in seconds. Default is
 86400 seconds (1 day). Whenever the time expires, a new phase-1 
exchange is performed.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Lifetime (seconds)</strong></span>:
 The phase-2 lifetime of the security association in seconds. Default is
 3600 seconds (1 hour). Whenever the value is exceeded, a re-key is 
initiated to provide a new IPsec encryption and authentication session 
keys.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Dead Peer Detection</strong></span>:
 A method to detect an unavailable Internet Key Exchange (IKE) peer. 
Select this option if you want the virtual router to query the 
liveliness of its IKE peer at regular intervals. It’​s recommended to 
have the same configuration of DPD on both side of VPN connection.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div><div class="formalpara"><h5 class="formalpara" id="idp8968192">Updating and Removing a VPN Customer Gateway</h5>
			You can update a customer gateway either with no VPN connection, or related VPN connection is in error state.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPN Customer Gateway.
			</div></li><li class="listitem"><div class="para">
				Select the VPN customer gateway you want to work with.
			</div></li><li class="listitem"><div class="para">
				To modify the required parameters, click the Edit VPN Customer Gateway button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="edit.png: button to edit a VPN customer gateway"></span>
			</div></li><li class="listitem"><div class="para">
				To remove the VPN customer gateway, click the Delete VPN Customer Gateway button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/delete-button.png" alt="delete.png: button to remove a VPN customer gateway"></span>
			</div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="create-vpn-gateway-for-vpc" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">15.17.4.2.&nbsp;Creating a VPN gateway for the VPC</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP å°å
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				选​择​点​对​点​VPN
			</div><div class="para">
				If you are creating the VPN gateway for the first time, selecting Site-to-Site VPN prompts you to create a VPN gateway.
			</div></li><li class="listitem"><div class="para">
				In the confirmation dialog, click Yes to confirm.
			</div><div class="para">
				Within a few moments, the VPN gateway is created. You will be 
prompted to view the details of the VPN gateway you have created. Click 
Yes to confirm.
			</div><div class="para">
				The following details are displayed in the VPN Gateway page:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP å°å
					</div></li><li class="listitem"><div class="para">
						å¸æ·
					</div></li><li class="listitem"><div class="para">
						å
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="create-vpn-connection-vpc" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">15.17.4.3.&nbsp;新​建​vpn连​接​</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you create for the account are listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ASLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				选​择​点​对​点​VPN
			</div><div class="para">
				The Site-to-Site VPN page is displayed.
			</div></li><li class="listitem"><div class="para">
				From the Select View drop-down, ensure that VPN Connection is selected.
			</div></li><li class="listitem"><div class="para">
				选​择​创​建​vpn连​接​按​钮​
			</div><div class="para">
				The Create VPN Connection dialog is displayed:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/create-vpn-connection.png" alt="createvpnconnection.png: creating a vpn connection to the customer gateway."></div></li><li class="listitem"><div class="para">
				Select the desired customer gateway, then click OK to confirm.
			</div><div class="para">
				Within a few moments, the VPN Connection is displayed.
			</div><div class="para">
				VPN连​接​信​息​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP å°å
					</div></li><li class="listitem"><div class="para">
						ç½å³
					</div></li><li class="listitem"><div class="para">
						ç¶æ
					</div></li><li class="listitem"><div class="para">
						IPSec共​享​密​钥​
					</div></li><li class="listitem"><div class="para">
						IKE密​钥​
					</div></li><li class="listitem"><div class="para">
						ESP密​钥​
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="delete-reset-vpn" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title">15.17.4.4.&nbsp;Restarting and Removing a VPN Connection</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​到​CloudStack界​面​以​管​理​员​或​者​终​端​用​户​。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​，选​择​网​络​
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP å°å
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ASLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Site-to-Site VPN.
			</div><div class="para">
				The Site-to-Site VPN page is displayed.
			</div></li><li class="listitem"><div class="para">
				From the Select View drop-down, ensure that VPN Connection is selected.
			</div><div class="para">
				All the VPN connections you created are displayed.
			</div></li><li class="listitem"><div class="para">
				Select the VPN connection you want to work with.
			</div><div class="para">
				The Details tab is displayed.
			</div></li><li class="listitem"><div class="para">
				To remove a VPN connection, click the Delete VPN connection button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/remove-vpn.png" alt="remove-vpn.png: button to remove a VPN connection"></span>
			</div><div class="para">
				To restart a VPN connection, click the Reset VPN connection button present in the Details tab.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/reset-vpn.png" alt="reset-vpn.png: button to reset a VPN connection"></span>
			</div></li></ol></div></div></div></div><div xml:lang="zh-CN" class="section" id="inter-vlan-routing" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.18.&nbsp;About Inter-VLAN Routing</h2></div></div></div><div class="para">
		Inter-VLAN Routing is the capability to route network traffic between 
VLANs. This feature enables you to build Virtual Private Clouds (VPC), 
an isolated segment of your cloud, that can hold multi-tier 
applications. These tiers are deployed on different VLANs that can 
communicate with each other. You provision VLANs to the tiers your 
create, and VMs can be deployed on different tiers. The VLANs are 
connected to a virtual router, which facilitates communication between 
the VMs. In effect, you can segment VMs by means of VLANs into different
 networks that can host multi-tier applications, such as Web, 
Application, or Database. Such segmentation by means of VLANs logically 
separate application VMs for higher security and lower broadcasts, while
 remaining physically connected to the same device.
	</div><div class="para">
		This feature is supported on XenServer and VMware hypervisors.
	</div><div class="para">
		The major advantages are:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The administrator can deploy a set of VLANs and allow users to 
deploy VMs on these VLANs. A guest VLAN is randomly alloted to an 
account from a pre-specified set of guest VLANs. All the VMs of a 
certain tier of an account reside on the guest VLAN allotted to that 
account.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					A VLAN allocated for an account cannot be shared between multiple accounts.
				</div></div></div></li><li class="listitem"><div class="para">
				The administrator can allow users create their own VPC and deploy 
the application. In this scenario, the VMs that belong to the account 
are deployed on the VLANs allotted to that account.
			</div></li><li class="listitem"><div class="para">
				Both administrators and users can create multiple VPCs. The guest 
network NIC is plugged to the VPC virtual router when the first VM is 
deployed in a tier.
			</div></li><li class="listitem"><div class="para">
				The administrator can create the following gateways to send to or receive traffic from the VMs:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VPN Gateway</strong></span>: For more information, see <a class="xref" href="#create-vpn-gateway-for-vpc">第&nbsp;15.17.4.2&nbsp;节 “Creating a VPN gateway for the VPC”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Gateway</strong></span>: 
The public gateway for a VPC is added to the virtual router when the 
virtual router is created for VPC. The public gateway is not exposed to 
the end users. You are not allowed to list it, nor allowed to create any
 static routes.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Gateway</strong></span>: For more information, see <a class="xref" href="#add-gateway-vpc">第&nbsp;15.19.5&nbsp;节 “Adding a Private Gateway to a VPC”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Both administrators and users can create various possible 
destinations-gateway combinations. However, only one gateway of each 
type can be used in a deployment.
			</div><div class="para">
				For example:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLANs and Public Gateway</strong></span>: For example, an application is deployed in the cloud, and the Web application VMs communicate with the Internet.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLANs, VPN Gateway, and Public Gateway</strong></span>:
 For example, an application is deployed in the cloud; the Web 
application VMs communicate with the Internet; and the database VMs 
communicate with the on-premise devices.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				The administrator can define Access Control List (ACL) on the 
virtual router to filter the traffic among the VLANs or between the 
Internet and a VLAN. You can define ACL based on CIDR, port range, 
protocol, type code (if ICMP protocol is selected) and Ingress/Egress 
type.
			</div></li></ul></div><div class="para">
		The following figure shows the possible deployment scenarios of a Inter-VLAN setup:
	</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/multi-tier-app.png" alt="mutltier.png: a multi-tier setup." width="444"></div><div class="para">
		To set up a multi-tier Inter-VLAN deployment, see <a class="xref" href="#configure-vpc">第&nbsp;15.19&nbsp;节 “Configuring a Virtual Private Cloud”</a>.
	</div></div><div xml:lang="zh-CN" class="section" id="configure-vpc" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.19.&nbsp;Configuring a Virtual Private Cloud</h2></div></div></div><div xml:lang="zh-CN" class="section" id="vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.1.&nbsp;About Virtual Private Clouds</h3></div></div></div><div class="para">
		CloudStack Virtual Private Cloud is a private, isolated part of 
CloudStack. A VPC can have its own virtual network topology that 
resembles a traditional physical network. You can launch VMs in the 
virtual network that can have private addresses in the range of your 
choice, for example: 10.0.0.0/16. You can define network tiers within 
your VPC network range, which in turn enables you to group similar kinds
 of instances based on IP address range.
	</div><div class="para">
		For example, if a VPC has the private range 10.0.0.0/16, its guest 
networks can have the network ranges 10.0.1.0/24, 10.0.2.0/24, 
10.0.3.0/24, and so on.
	</div><div class="formalpara"><h5 class="formalpara" id="idp15405680">Major Components of a VPC:</h5>
			A VPC is comprised of the following network components:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPC</strong></span>: A VPC acts as a container for multiple isolated networks that can communicate with each other via its virtual router.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Network Tiers</strong></span>: Each 
tier acts as an isolated network with its own VLANs and CIDR list, where
 you can place groups of resources, such as VMs. The tiers are segmented
 by means of VLANs. The NIC of each tier acts as its gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Virtual Router</strong></span>: A 
virtual router is automatically created and started when you create a 
VPC. The virtual router connect the tiers and direct traffic among the 
public gateway, the VPN gateways, and the NAT instances. For each tier, a
 corresponding NIC and IP exist in the virtual router. The virtual 
router provides DNS and DHCP services through its IP.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Public Gateway</strong></span>: The 
traffic to and from the Internet routed to the VPC through the public 
gateway. In a VPC, the public gateway is not exposed to the end user; 
therefore, static routes are not support for the public gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Private Gateway</strong></span>: All the traffic to and from a private network routed to the VPC through the private gateway. For more information, see <a class="xref" href="#add-gateway-vpc">第&nbsp;15.19.5&nbsp;节 “Adding a Private Gateway to a VPC”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPN Gateway</strong></span>: The VPC side of a VPN connection.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Site-to-Site VPN Connection</strong></span>:
 A hardware-based VPN connection between your VPC and your datacenter, 
home network, or co-location facility. For more information, see <a class="xref" href="#site-to-site-vpn">第&nbsp;15.17.4&nbsp;节 “配​置​站​点​到​站​点​的​VPN连​接​”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Customer Gateway</strong></span>: The customer side of a VPN Connection. For more information, see <a class="xref" href="#create-vpn-customer-gateway">第&nbsp;15.17.4.1&nbsp;节 “Creating and Updating a VPN Customer Gateway”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>NAT Instance</strong></span>: An 
instance that provides Port Address Translation for instances to access 
the Internet via the public gateway. For more information, see <a class="xref" href="#enable-disable-static-nat-vpc">第&nbsp;15.19.9&nbsp;节 “Enabling or Disabling Static NAT on a VPC”</a>.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp14490176">Network Architecture in a VPC</h5>
			In a VPC, the following four basic options of network architectures are present:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				VPC with a public gateway only
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways and site-to-site VPN access
			</div></li><li class="listitem"><div class="para">
				VPC with a private gateway only and site-to-site VPN access
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idm58740000">Connectivity Options for a VPC</h5>
			You can connect your VPC to:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The Internet through the public gateway.
			</div></li><li class="listitem"><div class="para">
				The corporate datacenter by using a site-to-site VPN connection through the VPN gateway.
			</div></li><li class="listitem"><div class="para">
				Both the Internet and your corporate datacenter by using both the public gateway and a VPN gateway.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp7922816">VPC Network Considerations</h5>
			Consider the following before you create a VPC:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A VPC, by default, is created in the enabled state.
			</div></li><li class="listitem"><div class="para">
				A VPC can be created in Advance zone only, and can't belong to more than one zone at a time.
			</div></li><li class="listitem"><div class="para">
				The default number of VPCs an account can create is 20. However, you
 can change it by using the max.account.vpcs global parameter, which 
controls the maximum number of VPCs an account is allowed to create.
			</div></li><li class="listitem"><div class="para">
				The default number of tiers an account can create within a VPC is 3.
 You can configure this number by using the vpc.max.networks parameter.
			</div></li><li class="listitem"><div class="para">
				Each tier should have an unique CIDR in the VPC. Ensure that the tier's CIDR should be within the VPC CIDR range.
			</div></li><li class="listitem"><div class="para">
				A tier belongs to only one VPC.
			</div></li><li class="listitem"><div class="para">
				All network tiers inside the VPC should belong to the same account.
			</div></li><li class="listitem"><div class="para">
				When a VPC is created, by default, a SourceNAT IP is allocated to 
it. The Source NAT IP is released only when the VPC is removed.
			</div></li><li class="listitem"><div class="para">
				A public IP can be used for only one purpose at a time. If the IP is
 a sourceNAT, it cannot be used for StaticNAT or port forwarding.
			</div></li><li class="listitem"><div class="para">
				The instances only have a private IP address that you provision. To 
communicate with the Internet, enable NAT to an instance that you launch
 in your VPC.
			</div></li><li class="listitem"><div class="para">
				Only new networks can be added to a VPC. The maximum number of 
networks per VPC is limited by the value you specify in the 
vpc.max.networks parameter. The default value is three.
			</div></li><li class="listitem"><div class="para">
				The load balancing service can be supported by only one tier inside the VPC.
			</div></li><li class="listitem"><div class="para">
				If an IP address is assigned to a tier:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						That IP can't be used by more than one tier at a time in the VPC. 
For example, if you have tiers A and B, and a public IP1, you can create
 a port forwarding rule by using the IP either for A or B, but not for 
both.
					</div></li><li class="listitem"><div class="para">
						That IP can't be used for StaticNAT, load balancing, or port forwarding rules for another guest network inside the VPC.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Remote access VPN is not supported in VPC networks.
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="add-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.2.&nbsp;Adding a Virtual Private Cloud</h3></div></div></div><div class="para">
		When creating the VPC, you simply provide the zone and a set of IP 
addresses for the VPC network address space. You specify this set of 
addresses in the form of a Classless Inter-Domain Routing (CIDR) block.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div></li><li class="listitem"><div class="para">
				Click Add VPC. The Add VPC page is displayed as follows:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-vpc.png" alt="add-vpc.png: adding a vpc."></div><div class="para">
				填​写​以​下​内​容​。​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A short name for the VPC that you are creating.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: A brief description of the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>: Choose the zone where you want the VPC to be available.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Super CIDR for Guest Networks</strong></span>:
 Defines the CIDR range for all the tiers (guest networks) within a VPC.
 When you create a tier, ensure that its CIDR is within the Super CIDR 
value you enter. The CIDR must be RFC1918 compliant.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS domain for Guest Networks</strong></span>:
 If you want to assign a special domain name, specify the DNS suffix. 
This parameter is applied to all the tiers within the VPC. That implies,
 all the tiers you create in the VPC belong to the same DNS domain. If 
the parameter is not specified, a DNS domain name is generated 
automatically.
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-tier" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.3.&nbsp;Adding Tiers</h3></div></div></div><div class="para">
		Tiers are distinct locations within a VPC that act as isolated 
networks, which do not have access to other tiers by default. Tiers are 
set up on different VLANs that can communicate with each other by using a
 virtual router. Tiers provide inexpensive, low latency network 
connectivity to other tiers within the VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​到​CloudStack界​面​以​管​理​员​或​者​终​端​用​户​。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​，选​择​网​络​
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					The end users can see their own VPCs, while root and domain admin can see any VPC they are authorized to see.
				</div></div></div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Add new tier dialog is displayed, as follows:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-tier.png" alt="add-tier.png: adding a tier to a vpc."></div><div class="para">
				If you have already created tiers, the VPC diagram is displayed. Click Create Tier to add a new tier.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="para">
				All the fields are mandatory.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A unique name for the tier you create.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Offering</strong></span>: 
The following default network offerings are listed: 
DefaultIsolatedNetworkOfferingForVpcNetworksNoLB, 
DefaultIsolatedNetworkOfferingForVpcNetworks
					</div><div class="para">
						In a VPC, only one tier can be created by using LB-enabled network offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The 
gateway for the tier you create. Ensure that the gateway is within the 
Super CIDR range that you specified while creating the VPC, and is not 
overlapped with the CIDR of any existing tier within the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask for the tier you create.
					</div><div class="para">
						For example, if the VPC CIDR is 10.0.0.0/16 and the network tier 
CIDR is 10.0.1.0/24, the gateway of the tier is 10.0.1.1, and the 
netmask of the tier is 255.255.255.0.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				点​击​ 确​定​。​
			</div></li><li class="listitem"><div class="para">
				Continue with configuring access control list for the tier.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="configure-acl" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.4.&nbsp;Configuring Access Control List</h3></div></div></div><div class="para">
		Define Network Access Control List (ACL) on the VPC virtual router to 
control incoming (ingress) and outgoing (egress) traffic between the VPC
 tiers, and the tiers and Internet. By default, all incoming and 
outgoing traffic to the guest networks is blocked. To open the ports, 
you must create a new network ACL. The network ACLs can be created for 
the tiers only if the NetworkACL service is supported.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Network ACLs.
			</div><div class="para">
				The Network ACLs page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add Network ACLs.
			</div><div class="para">
				To add an ACL rule, fill in the following fields to specify what kind of network traffic is allowed in this tier.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>: The CIDR 
acts as the Source CIDR for the Ingress rules, and Destination CIDR for 
the Egress rules. To accept traffic only from or to the IP addresses 
within a particular address block, enter a CIDR or a comma-separated 
list of CIDRs. The CIDR is the base IP address of the incoming traffic. 
For example, 192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The 
networking protocol that sources use to send traffic to the tier. The 
TCP and UDP protocols are typically used for data exchange and end-user 
communications. The ICMP protocol is typically used to send error 
messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port</strong></span>, <span class="bold bold"><strong>End Port</strong></span>
 (TCP, UDP only): A range of listening ports that are the destination 
for the incoming traffic. If you are opening a single port, use the same
 number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Select Tier</strong></span>: Select the tier for which you want to add this ACL rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type</strong></span>, <span class="bold bold"><strong>ICMP Code</strong></span> (ICMP only): The type of message and error code that will be sent.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Traffic Type</strong></span>: Select the traffic type you want to apply.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Egress</strong></span>: To add 
an egress rule, select Egress from the Traffic type drop-down box and 
click Add. This specifies what type of traffic is allowed to be sent out
 of VM instances in this tier. If no egress rules are specified, all 
traffic from the tier is allowed out at the VPC virtual router. Once 
egress rules are specified, only the traffic specified in egress rules 
and the responses to any traffic that has been allowed in through an 
ingress rule are allowed out. No egress rule is required for the VMs in a
 tier to communicate with each other.
							</div></li><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Ingress</strong></span>: To add 
an ingress rule, select Ingress from the Traffic type drop-down box and 
click Add. This specifies what network traffic is allowed into the VM 
instances in this tier. If no ingress rules are specified, then no 
traffic will be allowed in, except for responses to any traffic that has
 been allowed out through an egress rule.
							</div></li></ul></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
							By default, all incoming and outgoing traffic to the guest 
networks is blocked. To open the ports, create a new network ACL.
						</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add. The ACL rule is added.
			</div><div class="para">
				To view the list of ACL rules you have added, click the desired tier
 from the Network ACLs page, then select the Network ACL tab.
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/network-acl.png" alt="network-acl.png: adding, editing, deleting an ACL rule." width="444"></div><div class="para">
				You can edit the tags assigned to the ACL rules and delete the ACL 
rules you have created. Click the appropriate button in the Actions 
column.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-gateway-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.5.&nbsp;Adding a Private Gateway to a VPC</h3></div></div></div><div class="para">
		A private gateway can be added by the root admin only. The VPC private
 network has 1:1 relationship with the NIC of the physical network. No 
gateways with duplicated VLAN and IP are allowed in the same data 
center.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				登​陆​到​CloudStack界​面​以​管​理​员​或​者​终​端​用​户​。​
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​，选​择​网​络​
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP å°å
					</div></li><li class="listitem"><div class="para">
						Private Gateways
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Private Gateways.
			</div><div class="para">
				The Gateways page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add new gateway:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/add-new-gateway-vpc.png" alt="add-new-gateway-vpc.png: adding a private gateway for the VPC."></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Physical Network</strong></span>: The physical network you have created in the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IP Address</strong></span>: The IP address associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The gateway through which the traffic is routed to and from the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN</strong></span>: The VLAN associated with the VPC gateway.
					</div></li></ul></div><div class="para">
				The new gateway appears in the list. You can repeat these steps to add more gateway for this VPC.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-vm-to-tier" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.6.&nbsp;Deploying VMs to the Tier</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed.
			</div></li><li class="listitem"><div class="para">
				Click the Add VM button of the tier for which you want to add a VM.
			</div><div class="para">
				The Add Instance page is displayed.
			</div><div class="para">
				Follow the on-screen instruction to add an instance. For information
 on adding an instance, see Adding Instances section in the Installation
 Guide.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="acquire-new-ip-for-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.7.&nbsp;Acquiring a New IP Address for a VPC</h3></div></div></div><div class="para">
		When you acquire an IP address, all IP addresses are allocated to VPC,
 not to the guest networks within the VPC. The IPs are associated to the
 guest network only when the first port-forwarding, load balancing, or 
Static NAT rule is created for the IP or the network. IP can't be 
associated to more than one network at a time.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				点​击​获​得​一​个​新​IP, 并​且​在​确​认​的​对​话​框​中​点​击​确​定​.
			</div><div class="para">
				You are prompted for confirmation because, typically, IP addresses 
are a limited resource. Within a few moments, the new IP address should 
appear with the state Allocated. You can now use the IP address in port 
forwarding, load balancing, and static NAT rules.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="release-ip-for-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.8.&nbsp;Releasing an IP Address Alloted to a VPC</h3></div></div></div><div class="para">
		The IP address is a limited resource. If you no longer need a 
particular IP, you can disassociate it from its VPC and return it to the
 pool of available addresses. An IP address can be released from its 
tier, only when all the networking ( port forwarding, load balancing, or
 StaticNAT ) rules are removed for this IP address. The released IP 
address will still belongs to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC whose IP you want to release.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to release.
			</div></li><li class="listitem"><div class="para">
				In the Details tab, click the Release IP button 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/release-ip-icon.png" alt="release-ip-icon.png: button to release an IP."></span>
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="enable-disable-static-nat-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.9.&nbsp;Enabling or Disabling Static NAT on a VPC</h3></div></div></div><div class="para">
		A static NAT rule maps a public IP address to the private IP address 
of a VM in a VPC to allow Internet traffic to it. This section tells how
 to enable or disable static NAT for a particular IP address in a VPC.
	</div><div class="para">
		If port forwarding rules are already in effect for an IP address, you cannot enable static NAT to that IP.
	</div><div class="para">
		If a guest VM is part of more than one network, static NAT rules will 
function only if they are defined on the default network.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to work with.
			</div></li><li class="listitem"><div class="para">
				In the Details tab,click the Static NAT button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/enable-disable.png" alt="enable-disable.png: button to enable Statid NAT."></span>
				The button toggles between Enable and Disable, depending on whether static NAT is currently enabled for the IP address.
			</div></li><li class="listitem"><div class="para">
				If you are enabling static NAT, a dialog appears as follows:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/select-vm-staticnat-vpc.png" alt="select-vmstatic-nat.png: selecting a tier to apply staticNAT." width="444"></div></li><li class="listitem"><div class="para">
				Select the tier and the destination VM, then click Apply.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="add-loadbalancer-rule-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.10.&nbsp;Adding Load Balancing Rules on a VPC</h3></div></div></div><div class="para">
		A CloudStack user or administrator may create load balancing rules 
that balance traffic received at a public IP to one or more VMs that 
belong to a network tier that provides load balancing service in a VPC. A
 user creates a rule, specifies an algorithm, and assigns the rule to a 
set of VMs within a VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Load Balancing node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
					In a VPC, the load balancing service is supported only on a single tier.
				</div></div></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A name for the load balancer rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port that receives the incoming traffic to be balanced.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port that the VMs will use to receive the traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Algorithm</strong></span>. Choose the load balancing algorithm you want CloudStack to use. CloudStack supports the following well-known algorithms:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								轮​询​
							</div></li><li class="listitem"><div class="para">
								æå°è¿æ¥ç®æ³
							</div></li><li class="listitem"><div class="para">
								æºç®æ³
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Stickiness</strong></span>. 
(Optional) Click Configure and choose the algorithm for the stickiness 
policy. See Sticky Session Policies for Load Balancer Rules.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VMs</strong></span>: Click Add VMs, then select two or more VMs that will divide the load of incoming traffic, and click Apply.
					</div></li></ul></div></li></ol></div><div class="para">
		The new load balancing rule appears in the list. You can repeat these 
steps to add more load balancing rules for this IP address.
	</div></div><div xml:lang="zh-CN" class="section" id="add-portforward-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.11.&nbsp;Adding a Port Forwarding Rule on a VPC</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP地​址​
					</div></li><li class="listitem"><div class="para">
						网​关​
					</div></li><li class="listitem"><div class="para">
						点​对​点​VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose an existing IP address or acquire a new IP address. Click the name of the IP address in the list.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Port Forwarding node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port to which public traffic will be addressed on the IP address you acquired in the previous step.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port on which the instance is listening for forwarded public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The communication protocol in use between the two ports.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								TCP
							</div></li><li class="listitem"><div class="para">
								UDP
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VM</strong></span>: Click Add VM. Select the name of the instance to which this rule applies, and click Apply.
					</div><div class="para">
						You can test the rule by opening an ssh session to the instance.
					</div></li></ul></div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="remove-tier" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.12.&nbsp;Removing Tiers</h3></div></div></div><div class="para">
		You can remove a tier from a VPC. A removed tier cannot be revoked. 
When a tier is removed, only the resources of the tier are expunged. All
 the network rules (port forwarding, load balancing and staticNAT) and 
the IP addresses associated to the tier are removed. The IP address 
still be belonging to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Configure VPC page is displayed. Locate the tier you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Remove VPC button:
			</div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/remove-tier.png" alt="remove-tier.png: removing a tier from a vpc."></div><div class="para">
				Wait for some time for the tier to be removed.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="remove-vpc" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">15.19.13.&nbsp;Editing, Restarting, and Removing a Virtual Private Cloud</h3></div></div></div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			Ensure that all the tiers are removed before you remove a VPC.
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				作​为​管​理​员​或​最​终​用​户​登​入​到​CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				在​左​边​的​导​航​栏​里​选​择​网​络​.
			</div></li><li class="listitem"><div class="para">
				vpn连​接​列​表​
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Select the VPC you want to work with.
			</div></li><li class="listitem"><div class="para">
				To remove, click the Remove VPC button
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/remove-vpc.png" alt="remove-vpc.png: button to remove a VPC"></span>

			</div><div class="para">
				You can edit the name and description of a VPC. To do that, select the VPC, then click the Edit button. 
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/edit-icon.png" alt="edit-icon.png: button to edit a VPC"></span>

			</div><div class="para">
				To restart a VPC, select the VPC, then click the Restart button.
				<span class="inlinemediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/restart-vpc.png" alt="restart-vpc.png: button to restart a VPC"></span>
				i
			</div></li></ol></div></div></div><div xml:lang="zh-CN" class="section" id="persistent-network" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">15.20.&nbsp;Persistent Networks</h2></div></div></div><div class="para">
		The network that you can provision without having to deploy any VMs on
 it is called a persistent network. A persistent network can be part of a
 VPC or a non-VPC environment.
	</div><div class="para">
		When you create other types of network, a network is only a database 
entry until the first VM is created on that network. When the first VM 
is created, a VLAN ID is assigned and the network is provisioned. Also, 
when the last VM is destroyed, the VLAN ID is released and the network 
is no longer available. With the addition of persistent network, you 
will have the ability to create a network in CloudStack in which 
physical devices can be deployed without having to run any VMs. 
Additionally, you can deploy physical devices on that network.
	</div><div class="para">
		One of the advantages of having a persistent network is that you can 
create a VPC with a tier consisting of only physical devices. For 
example, you might create a VPC for a three-tier application, deploy VMs
 for Web and Application tier, and use physical machines for the 
Database tier. Another use case is that if you are providing services by
 using physical hardware, you can define the network as persistent and 
therefore even if all its VMs are destroyed the services will not be 
discontinued.
	</div><div class="section" id="persistent-network-consideration"><div class="titlepage"><div><div><h3 class="title">15.20.1.&nbsp;Persistent Network Considerations</h3></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Persistent network is designed for isolated networks.
				</div></li><li class="listitem"><div class="para">
					All default network offerings are non-persistent.
				</div></li><li class="listitem"><div class="para">
					A network offering cannot be editable because changing it affects 
the behavior of the existing networks that were created using this 
network offering.
				</div></li><li class="listitem"><div class="para">
					When you create a guest network, the network offering that you 
select defines the network persistence. This in turn depends on whether 
persistent network is enabled in the selected network offering.
				</div></li><li class="listitem"><div class="para">
					An existing network can be made persistent by changing its network 
offering to an offering that has the Persistent option enabled. While 
setting this property, even if the network has no running VMs, the 
network is provisioned.
				</div></li><li class="listitem"><div class="para">
					An existing network can be made non-persistent by changing its 
network offering to an offering that has the Persistent option disabled.
 If the network has no running VMs, during the next network garbage 
collection run the network is shut down.
				</div></li><li class="listitem"><div class="para">
					When the last VM on a network is destroyed, the network garbage 
collector checks if the network offering associated with the network is 
persistent, and shuts down the network only if it is non-persistent.
				</div></li></ul></div></div><div class="section" id="set-up-persistent-network"><div class="titlepage"><div><div><h3 class="title">15.20.2.&nbsp;Creating a Persistent Guest Network</h3></div></div></div><div class="para">
			To create a persistent network, perform the following:
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Create a network offering with the Persistent option enabled.
				</div><div class="para">
					See <a class="xref" href="#creating-network-offerings">第&nbsp;9.4.1&nbsp;节 “Creating a New Network Offering”</a>.
				</div></li><li class="listitem"><div class="para">
					Select Network from the left navigation pane.
				</div></li><li class="listitem"><div class="para">
					Select the guest network that you want to offer this network service to.
				</div></li><li class="listitem"><div class="para">
					Click the Edit button.
				</div></li><li class="listitem"><div class="para">
					From the Network Offering drop-down, select the persistent network offering you have just created.
				</div></li><li class="listitem"><div class="para">
					点​击​ 确​定​。​
				</div></li></ol></div></div></div></div><div xml:lang="zh-CN" class="chapter" id="working-with-system-vm" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;16&nbsp;章&nbsp;Working with System Virtual Machines</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#system-vm-template">16.1. 系​统​VM模​板​</a></span></dt><dt><span class="section"><a href="#multiple-system-vm-vmware">16.2. 支​持​VMware的​多​种​系​统​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#console-proxy">16.3. 控​制​台​代​理​（控​制​台​虚​拟​机​）</a></span></dt><dd><dl><dt><span class="section"><a href="#use-cert">16.3.1. Using a SSL Certificate for the Console Proxy</a></span></dt><dt><span class="section"><a href="#change-console-proxy-ssl-certificate-domain">16.3.2. Changing the Console Proxy SSL Certificate and Domain</a></span></dt></dl></dd><dt><span class="section"><a href="#virtual-router">16.4. èæè·¯ç±å¨</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-virtual-router">16.4.1. 配​置​虚​拟​路​由​器​</a></span></dt><dt><span class="section"><a href="#upgrade-virtual-router-with-service-offering">16.4.2. 使​用​系​统​计​算​服​务​方​案​升​级​虚​拟​路​由​器​</a></span></dt><dt><span class="section"><a href="#best-practices-virtual-router">16.4.3. 虚​拟​路​由​器​的​最​佳​实​践​</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-vm">16.5. 二​级​存​储​虚​拟​机​</a></span></dt></dl></div><div class="para">
		CloudStack uses several types of system virtual machines to perform 
tasks in the cloud. In general CloudStack manages these system VMs and 
creates, starts, and stops them as needed based on scale and immediate 
needs. However, the administrator should be aware of them and their 
roles to assist in debugging issues.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			You can configure the system.vm.random.password parameter to create a
 random system VM password to ensure higher security. If you reset the 
value for system.vm.random.password to true and restart the Management 
Server, a random password is generated and stored encrypted in the 
database. You can view the decrypted password under the 
system.vm.password global parameter on the CloudStack UI or by calling 
the listConfigurations API.
		</div></div></div><div xml:lang="zh-CN" class="section" id="system-vm-template" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">16.1.&nbsp;系​统​VM模​板​</h2></div></div></div><div class="para">
		系​统​VMs来​自​单​个​模​板​。​该​系​统​VM都​具​有​以​下​特​点​:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Debian 6.0(“​Squeeze”​),从​Debian安​全​APT存​储​库​安​装​2.6.32以​上​内​核​并​安​装​最​新​的​安​全​补​丁​。​
			</div></li><li class="listitem"><div class="para">
				建​议​最​小​化​安​装​，以​降​低​安​全​攻​击​漏​洞​。​
			</div></li><li class="listitem"><div class="para">
				基​于​ Xen/VMWare 32位​增​强​性​能​版​
			</div></li><li class="listitem"><div class="para">
				所​有​虚​拟​管​理​程​序​ Xen PV 驱​动​，KVM virtio 驱​动​和​VMware tools 在​pvops 内​核​中​得​到​最​佳​性​能​
			</div></li><li class="listitem"><div class="para">
				Xen tools 包​含​性​能​监​控​
			</div></li><li class="listitem"><div class="para">
				从​Debian 资​源​库​安​装​最​新​版​的​HAProxy、​iptables、​IPsec和​Apache可​以​有​效​改​善​安​全​与​速​度​
			</div></li><li class="listitem"><div class="para">
				从​ Sun/Oracle 安​装​最​新​版​本​的​JRE也​可​以​有​效​改​善​安​全​性​与​速​度​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="multiple-system-vm-vmware" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">16.2.&nbsp;支​持​VMware的​多​种​系​统​虚​拟​机​</h2></div></div></div><div class="para">
		每​个​CloudStack 
资​源​域​都​有​单​独​的​系​统​虚​拟​机​用​于​处​理​关​于​模​版​的​各​种​任​务​，如​下​载​模​版​，上​传​模​版​
，上​传​ISO。​在​使​用​VMware的​资​源​域​中​，会​启​动​额​外​的​系​统​虚​拟​机​用​于​执​行​VMware的​特
​殊​任​务​，如​做​快​照​和​创​建​私​有​模​版​。​当​VMware特​殊​任​务​压​力​增​加​时​，CloudStack 
管​理​服​务​器​会​启​动​额​外​的​系​统​虚​拟​机​。​管​理​服​务​器​会​监​控​并​权​衡​所​有​发​往​这​些​系​统​
虚​拟​机​的​命​令​，并​执​行​动​态​负​载​均​衡​和​扩​展​更​多​的​系​统​虚​拟​机​。​
	</div></div><div xml:lang="zh-CN" class="section" id="console-proxy" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">16.3.&nbsp;控​制​台​代​理​（控​制​台​虚​拟​机​）</h2></div></div></div><div class="para">
		
控​制​台​代​理​作​为​系​统​虚​拟​机​的​一​种​通​过​网​页​用​户​接​口​为​用​户​呈​现​一​个​控​制​台​视​图​。​
它​通​过​虚​拟​机​软​件​为​来​宾​提​供​的​控​制​台​将​用​户​浏​览​器​与​vnc端​口​相​连​。​管​理​员​和​终​端
​用​户​动​能​通​过​网​页​用​户​接​口​获​得​一​个​控​制​台​连​接​。​
	</div><div class="para">
		Clicking a console icon brings up a new window. The AJAX code 
downloaded into that window refers to the public IP address of a console
 proxy VM. There is exactly one public IP address allocated per console 
proxy VM. The AJAX application connects to this IP. The console proxy 
then proxies the connection to the VNC port for the requested VM on the 
Host hosting the guest.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			虚​拟​机​软​件​会​分​配​多​个​vnc端​口​供​vnc会​话​使​用​。​
		</div></div></div><div class="para">
		不​会​有​任​何​流​量​是​刘​翔​来​宾​虚​拟​IP的​，并​且​不​需​要​在​来​宾​虚​拟​机​打​开​vnc。​
	</div><div class="para">
		
控​制​台​虚​拟​机​会​定​时​的​向​管​理​服​务​器​回​报​当​前​活​动​的​会​话​数​。​默​认​报​告​间​隔​是​五​秒​
钟​。​可​以​通​过​管​理​服​务​器​的​配​置​参​数​ consoleproxy.loadscan.interval.更​改​。​
	</div><div class="para">
		
如​果​来​宾​虚​拟​机​之​前​有​已​经​分​配​的​关​联​控​制​台​代​理​的​会​话​，控​制​台​代​理​的​分​配​会​由​第
​一​次​分​配​的​控​制​台​代​理​决​定​。​如​果​该​来​宾​虚​拟​级​之​前​存​在​已​分​配​的​控​制​台​代​理​，则​
不​论​该​控​制​台​代​理​目​前​负​载​如​何​管​理​服​务​器​都​会​将​该​来​宾​虚​拟​机​分​配​到​目​标​控​制​台​
代​理​虚​拟​机​。​如​果​失​败​则​会​将​来​宾​虚​拟​机​分​配​到​第​一​个​拥​有​足​够​资​源​处​理​新​会​话​的​
控​制​台​代​理​上​。​
	</div><div class="para">
		管​理​员​能​重​启​控​制​台​代​理​，但​是​这​回​是​已​经​存​在​的​用​户​的​控​制​台​会​话​中​断​。​
	</div><div class="section" id="use-cert"><div class="titlepage"><div><div><h3 class="title">16.3.1.&nbsp;Using a SSL Certificate for the Console Proxy</h3></div></div></div><div class="para">
			The console viewing functionality uses a dynamic DNS service under 
the domain name realhostip.com to assist in providing SSL security to 
console sessions. The console proxy is assigned a public IP address. In 
order to avoid browser warnings for mismatched SSL certificates, the URL
 for the new console window is set to the form of 
https://aaa-bbb-ccc-ddd.realhostip.com. You will see this URL during 
console session creation. CloudStack includes the realhostip.com SSL 
certificate in the console proxy VM. Of course, CloudStack cannot know 
about the DNS A records for our customers' public IPs prior to shipping 
the software. CloudStack therefore runs a dynamic DNS server that is 
authoritative for the realhostip.com domain. It maps the aaa-bbb-ccc-ddd
 part of the DNS name to the IP address aaa.bbb.ccc.ddd on lookups. This
 allows the browser to correctly connect to the console proxy's public 
IP, where it then expects and receives a SSL certificate for 
realhostip.com, and SSL is set up without browser warnings.
		</div></div><div class="section" id="change-console-proxy-ssl-certificate-domain"><div class="titlepage"><div><div><h3 class="title">16.3.2.&nbsp;Changing the Console Proxy SSL Certificate and Domain</h3></div></div></div><div class="para">
			If the administrator prefers, it is possible for the URL of the 
customer's console session to show a domain other than realhostip.com. 
The administrator can customize the displayed domain by selecting a 
different domain and uploading a new SSL certificate and private key. 
The domain must run a DNS service that is capable of resolving queries 
for addresses of the form aaa-bbb-ccc-ddd.your.domain to an IPv4 IP 
address in the form aaa.bbb.ccc.ddd, for example, 202.8.44.1. To change 
the console proxy domain, SSL certificate, and private key:
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Set up dynamic name resolution or populate all possible DNS names 
in your public IP range into your existing DNS server with the format 
aaa-bbb-ccc-ddd.company.com -&gt; aaa.bbb.ccc.ddd.
				</div></li><li class="listitem"><div class="para">
					Generate the private key and certificate signing request (CSR). 
When you are using openssl to generate private/public key pairs and 
CSRs, for the private key that you are going to paste into the 
CloudStack UI, be sure to convert it into PKCS#8 format.
				</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
							Generate a new 2048-bit private key
						</div><pre class="programlisting">openssl genrsa -des3 -out yourprivate.key 2048</pre></li><li class="listitem"><div class="para">
							Generate a new certificate CSR
						</div><pre class="programlisting">openssl req -new -key yourprivate.key -out yourcertificate.csr</pre></li><li class="listitem"><div class="para">
							Head to the website of your favorite trusted Certificate 
Authority, purchase an SSL certificate, and submit the CSR. You should 
receive a valid certificate in return
						</div></li><li class="listitem"><div class="para">
							Convert your private key format into PKCS#8 encrypted format.
						</div><pre class="programlisting">openssl pkcs8 -topk8 -in yourprivate.key -out yourprivate.pkcs8.encrypted.key</pre></li><li class="listitem"><div class="para">
							Convert your PKCS#8 encrypted private key into the PKCS#8 format that is compliant with CloudStack
						</div><pre class="programlisting">openssl pkcs8 -in yourprivate.pkcs8.encrypted.key -out yourprivate.pkcs8.key</pre></li></ol></div></li><li class="listitem"><div class="para">
					In the Update SSL Certificate screen of the CloudStack UI, paste the following:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							The certificate you've just generated.
						</div></li><li class="listitem"><div class="para">
							The private key you've just generated.
						</div></li><li class="listitem"><div class="para">
							The desired new domain name; for example, company.com
						</div></li></ul></div><div class="mediaobject"><img src="CloudStack%20Administrator%27s%20Guide_files/update-ssl.htm" alt="updatessl.png: Updating Console Proxy SSL Certificate"></div></li><li class="listitem"><div class="para">
					The desired new domain name; for example, company.com
				</div><div class="para">
					This stops all currently running console proxy VMs, then restarts 
them with the new certificate and key. Users might notice a brief 
interruption in console availability.
				</div></li></ol></div><div class="para">
			The Management Server generates URLs of the form 
"aaa-bbb-ccc-ddd.company.com" after this change is made. The new console
 requests will be served with the new DNS domain name, certificate, and 
key.
		</div></div></div><div xml:lang="zh-CN" class="section" id="virtual-router" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">16.4.&nbsp;èæè·¯ç±å¨</h2></div></div></div><div class="para">
		虚​拟​路​由​器​是​一​个​系​统​虚​拟​机​。​它​经​常​在​ CloudStack 
服​务​方​案​中​被​使​用​；终​端​用​户​不​能​够​直​接​访​问​虚​拟​路​由​器​。​用​户​可​ping和​影​响​它​(比​
如​设​置​端​口​转​发​)但​是​不​能​通​过​ssh访​问​
	</div><div class="para">
		There is no mechanism for the administrator to log in to the virtual 
router. Virtual routers can be restarted by administrators, but this 
will interrupt public network access and other services for end users. A
 basic test in debugging networking issues is to attempt to ping the 
virtual router from a guest VM. Some of the characteristics of the 
virtual router are determined by its associated system service 
offering..
	</div><div xml:lang="zh-CN" class="section" id="configure-virtual-router" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">16.4.1.&nbsp;配​置​虚​拟​路​由​器​</h3></div></div></div><div class="para">
		你​可​以​设​置​一​下​内​容​
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				IP地​址​范​围​
			</div></li><li class="listitem"><div class="para">
				支​持​的​网​络​服​务​
			</div></li><li class="listitem"><div class="para">
				由​虚​拟​路​由​网​络​服​务​提​供​的​默​认​域​名​
			</div></li><li class="listitem"><div class="para">
				网​关​IP地​址​
			</div></li><li class="listitem"><div class="para">
				
本​产​品​多​久​从​虚​拟​路​由​器​获​取​一​次​网​络​使​用​数​据​。​如​果​你​打​算​手​机​虚​拟​路​由​器​的​流​
量​计​量​数​据​，设​置​全​局​变​量​router.stats.interval。​如​果​你​不​使​用​虚​拟​路​怄​气​收​集​
网​络​使​用​数​据​，设​置​该​值​为​0
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="upgrade-virtual-router-with-service-offering" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">16.4.2.&nbsp;使​用​系​统​计​算​服​务​方​案​升​级​虚​拟​路​由​器​</h3></div></div></div><div class="para">
		当​ CloudStack 创​建​一​个​虚​拟​路​由​器​，它​是​按​照​默​认​的​系​统​计​算​服​务​方​案​进​行​的​设​置​。​参​见​ <a class="xref" href="#system-service-offerings">第&nbsp;8.2&nbsp;节 “系​统​服​务​方​案​”</a>。
​所​有​在​单​独​客​户​网​络​中​的​虚​拟​路​由​器​都​使​用​相​同​的​系​统​计​算​服​务​方​案​。​可​以​通​过​新
​建​和​使​用​自​定​义​的​系​统​计​算​服​务​方​案​来​提​高​虚​拟​路​由​器​的​性​能​。​
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				定​义​定​制​的​系​统​计​算​服​务​方​案​，参​见​<a class="xref" href="#creating-system-service-offerings">第&nbsp;8.2.1&nbsp;节 “Creating a New System Service Offering”</a>。​在​系​统​虚​拟​机​类​型​中​，选​择​域​路​由​器​。​
			</div></li><li class="listitem"><div class="para">
				Associate the system service offering with a network offering.  <span class="phrase">See <a class="xref" href="#creating-network-offerings">第&nbsp;9.4.1&nbsp;节 “Creating a New Network Offering”</a>.</span>
			</div></li><li class="listitem"><div class="para">
				
将​网​络​服​务​方​案​应​用​到​使​用​新​系​统​计​算​服​务​方​案​的​虚​拟​路​由​器​的​网​络​上​。​如​果​这​是​
一​个​新​的​网​络​，请​根​据​66页​的​添​加​额​外​客​户​网​络​的​步​骤​操​作​。​想​要​改​变​已​生​成​的​虚​拟
​路​由​器​的​计​算​服​务​方​案​，请​根​据​以​下​步​骤​操​作​<a class="xref" href="#change-network-offering-on-guest-network">第&nbsp;15.6.2&nbsp;节 “Changing the Network Offering on a Guest Network”</a>。​
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="best-practices-virtual-router" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">16.4.3.&nbsp;虚​拟​路​由​器​的​最​佳​实​践​</h3></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				
警​告​：从​一​个​虚​拟​机​管​理​程​序​控​制​台​重​新​启​动​一​台​虚​拟​路​由​器​，将​删​除​所​有​iptables
规​则​。​要​解​决​这​个​问​题​，从​CloudStack UI停​止​虚​拟​路​由​器​和​启​动​。​
			</div></li><li class="listitem"><div class="para">
				警​告​：在​网​络​中​只​有​一​个​路​由​器​可​用​时​，不​要​使​用​destroyRouter 
API，因​为​restartNetwork API 
带​cleanup=false参​数​不​能​随​后​重​新​创​建​它​。​如​果​你​想​销​毁​并​重​新​创​建​网​络​中​的​单​一
​路​由​器​，使​用​restartNetwork API 带​cleanup=true参​数​。​
			</div></li></ul></div></div></div><div xml:lang="zh-CN" class="section" id="secondary-storage-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">16.5.&nbsp;二​级​存​储​虚​拟​机​</h2></div></div></div><div class="para">
		除​了​主​机​CloudStack的​二​级​存​储​虚​拟​机​会​挂​载​和​往​二​级​存​储​中​写​入​内​容​。​
	</div><div class="para">
		通​过​二​级​存​储​虚​拟​机​来​提​交​信​息​到​二​级​存​储​。​二​级​存​储​虚​拟​机​会​使​用​多​种​协​议​通​过​URL来​获​取​模​版​和​ISO镜​像​文​件​。​
	</div><div class="para">
		二​级​存​储​虚​拟​机​会​提​供​后​台​任​务​来​负​责​各​种​二​级​存​储​的​活​动​：将​新​模​版​的​下​载​到​资​源​域​中​，多​个​资​源​域​之​间​的​模​版​复​制​，和​快​照​备​份​。​
	</div><div class="para">
		管​理​员​如​果​有​需​要​，可​以​登​录​到​二​级​存​储​虚​拟​机​上​。​
	</div></div></div><div xml:lang="zh-CN" class="chapter" id="sys-reliability-and-ha" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;17&nbsp;章&nbsp;System Reliability and High Availability</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#ha-management-server">17.1. HA for Management Server</a></span></dt><dt><span class="section"><a href="#management-server-lb">17.2. Management Server Load Balancing</a></span></dt><dt><span class="section"><a href="#ha-enabled-vm">17.3. 开​启​了​高​可​用​特​性​的​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#ha-for-hosts">17.4. HA for Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#dedicated-ha-hosts">17.4.1. Dedicated HA Hosts</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-outage-and-data-loss">17.5. 主​存​储​故​障​和​数​据​丢​失​</a></span></dt><dt><span class="section"><a href="#secondary-storage-outage-and-data-loss">17.6. 二​级​存​储​的​中​断​和​数​据​丢​失​</a></span></dt><dt><span class="section"><a href="#api-throttling">17.7. Limiting the Rate of API Requests</a></span></dt><dd><dl><dt><span class="section"><a href="#api-throttling-configure">17.7.1. Configuring the API Request Rate</a></span></dt><dt><span class="section"><a href="#api-throttling-limitations">17.7.2. Limitations on API Throttling</a></span></dt></dl></dd></dl></div><div xml:lang="zh-CN" class="section" id="ha-management-server" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.1.&nbsp;HA for Management Server</h2></div></div></div><div class="para">
		The CloudStack Management Server should be deployed in a multi-node 
configuration such that it is not susceptible to individual server 
failures. The Management Server itself (as distinct from the MySQL 
database) is stateless and may be placed behind a load balancer.
	</div><div class="para">
		Normal operation of Hosts is not impacted by an outage of all Management Serves. All guest VMs will continue to work.
	</div><div class="para">
		When the Management Server is down, no new VMs can be created, and the
 end user and admin UI, API, dynamic load distribution, and HA will 
cease to work.
	</div></div><div xml:lang="zh-CN" class="section" id="management-server-lb" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.2.&nbsp;Management Server Load Balancing</h2></div></div></div><div class="para">
		CloudStack can use a load balancer to provide a virtual IP for 
multiple Management Servers. The administrator is responsible for 
creating the load balancer rules for the Management Servers. The 
application requires persistence or stickiness across multiple sessions.
 The following chart lists the ports that should be load balanced and 
whether or not persistence is required.
	</div><div class="para">
		Even if persistence is not required, enabling it is permitted.
	</div><div class="informaltable"><table border="1"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr><th class="" align="left">
						<div class="para">
							Source Port
						</div>
					</th><th class="" align="left">
						<div class="para">
							Destination Port
						</div>
					</th><th class="" align="left">
						<div class="para">
							åè®®
						</div>
					</th><th class="" align="left">
						<div class="para">
							Persistence Required?
						</div>
					</th></tr></thead><tbody><tr><td class="" align="left">
						<div class="para">
							80 or 443
						</div>
					</td><td class="" align="left">
						<div class="para">
							8080 (or 20400 with AJP)
						</div>
					</td><td class="" align="left">
						<div class="para">
							HTTP (or AJP)
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							8250
						</div>
					</td><td class="" align="left">
						<div class="para">
							8250
						</div>
					</td><td class="" align="left">
						<div class="para">
							TCP
						</div>
					</td><td class="" align="left">
						<div class="para">
							是​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							8096
						</div>
					</td><td class="" align="left">
						<div class="para">
							8096
						</div>
					</td><td class="" align="left">
						<div class="para">
							HTTP
						</div>
					</td><td class="" align="left">
						<div class="para">
							否​
						</div>
					</td></tr></tbody></table></div><div class="para">
		In addition to above settings, the administrator is responsible for 
setting the 'host' global config value from the management server IP to 
load balancer virtual IP address. If the 'host' value is not set to the 
VIP for Port 8250 and one of your management servers crashes, the UI is 
still available but the system VMs will not be able to contact the 
management server.
	</div></div><div xml:lang="zh-CN" class="section" id="ha-enabled-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.3.&nbsp;开​启​了​高​可​用​特​性​的​虚​拟​机​</h2></div></div></div><div class="para">
		
用​户​可​以​给​虚​拟​机​制​定​开​启​高​可​用​特​性​。​默​认​情​况​下​所​有​的​虚​拟​路​由​虚​拟​机​负​载​均​
衡​虚​拟​机​自​动​开​启​了​高​可​用​特​性​。​当​CloudStack检​测​到​开​启​了​高​可​用​特​性​的​虚​拟​机​
崩​溃​时​将​会​在​相​同​的​可​用​资​源​与​中​自​动​重​新​启​动​该​虚​拟​机​。​高​可​用​特​性​不​会​跨​资​源​
域​执​行​。​CloudStack 
采​用​比​较​保​守​的​方​式​重​启​虚​拟​机​，以​确​使​不​会​同​时​运​行​两​个​相​同​的​实​例​。​管​理​服​务​器
​会​尝​试​在​本​季​群​的​另​一​台​主​机​上​开​启​该​虚​拟​机​。​
	</div><div class="para">
		高​可​用​特​性​只​在​使​用​iSCSI和​NFS做​主​存​储​的​才​可​以​使​用​。​不​支​持​使​用​本​地​存​储​作​为​主​存​储​的​高​可​用​。​
	</div></div><div xml:lang="zh-CN" class="section" id="ha-for-hosts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.4.&nbsp;HA for Hosts</h2></div></div></div><div class="para">
		
用​户​可​以​给​虚​拟​机​制​定​开​启​高​可​用​特​性​。​默​认​情​况​下​所​有​的​虚​拟​路​由​虚​拟​机​负​载​均​
衡​虚​拟​机​自​动​开​启​了​高​可​用​特​性​。​当​CloudStack检​测​到​开​启​了​高​可​用​特​性​的​虚​拟​机​
崩​溃​时​将​会​在​相​同​的​可​用​资​源​与​中​自​动​重​新​启​动​该​虚​拟​机​。​高​可​用​特​性​不​会​跨​资​源​
域​执​行​。​CloudStack 
采​用​比​较​保​守​的​方​式​重​启​虚​拟​机​，以​确​使​不​会​同​时​运​行​两​个​相​同​的​实​例​。​管​理​服​务​器
​会​尝​试​在​本​季​群​的​另​一​台​主​机​上​开​启​该​虚​拟​机​。​
	</div><div class="para">
		高​可​用​特​性​只​在​使​用​iSCSI和​NFS做​主​存​储​的​才​可​以​使​用​。​不​支​持​使​用​本​地​存​储​作​为​主​存​储​的​高​可​用​。​
	</div><div xml:lang="zh-CN" class="section" id="dedicated-ha-hosts" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">17.4.1.&nbsp;Dedicated HA Hosts</h3></div></div></div><div class="para">
		One or more hosts can be designated for use only by HA-enabled VMs 
that are restarting due to a host failure. Setting up a pool of such 
dedicated HA hosts as the recovery destination for all HA-enabled VMs is
 useful to:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Make it easier to determine which VMs have been restarted as part of
 the CloudStack high-availability function. If a VM is running on a 
dedicated HA host, then it must be an HA-enabled VM whose original host 
failed. (With one exception: It is possible for an administrator to 
manually migrate any VM to a dedicated HA host.).
			</div></li><li class="listitem"><div class="para">
				Keep HA-enabled VMs from restarting on hosts which may be reserved for other purposes.
			</div></li></ul></div><div class="para">
		The dedicated HA option is set through a special host tag when the 
host is created. To allow the administrator to dedicate hosts to only 
HA-enabled VMs, set the global configuration variable ha.tag to the 
desired tag (for example, "ha_host"), and restart the Management Server.
 Enter the value in the Host Tags field when adding the host(s) that you
 want to dedicate to HA-enabled VMs.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			If you set ha.tag, be sure to actually use that tag on at least one 
host in your cloud. If the tag specified in ha.tag is not set for any 
host in the cloud, the HA-enabled VMs will fail to restart after a 
crash.
		</div></div></div></div></div><div xml:lang="zh-CN" class="section" id="primary-storage-outage-and-data-loss" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.5.&nbsp;主​存​储​故​障​和​数​据​丢​失​</h2></div></div></div><div class="para">
		
当​主​存​储​发​生​故​障​，中​断​虚​拟​机​管​理​程​序​立​即​停​止​该​存​储​设​备​上​存​储​的​所​有​虚​拟​机​。
​客​户​机​被​标​记​为​，当​主​存​储​重​新​上​线​时​，HA根​据​实​际​情​况​尽​快​将​重​新​启​动​。​使​用​NFS
时​，虚​拟​机​管​理​程​序​可​能​允​许​虚​拟​机​继​续​运​行​，这​取​决​于​问​题​的​性​质​。​例​如​，NFS挂​起​
将​导​致​客​户​虚​拟​机​暂​停​，直​至​恢​复​存​储​连​接​。​主​存​储​没​有​被​设​计​进​行​备​份​。​在​主​存​储
​中​的​单​个​卷​，可​以​使​用​快​照​备​份​。​
	</div></div><div xml:lang="zh-CN" class="section" id="secondary-storage-outage-and-data-loss" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.6.&nbsp;二​级​存​储​的​中​断​和​数​据​丢​失​</h2></div></div></div><div class="para">
		
由​于​一​个​资​源​域​只​有​一​个​二​级​存​储​服​务​器​，二​级​存​储​的​中​断​将​会​对​系​统​的​一​些​功​能​产
​生​影​响​，但​不​能​影​响​正​在​运​行​的​客​户​虚​拟​机​。​可​能​会​让​用​户​无​法​选​择​模​版​来​创​建​虚​
拟​机​。​用​户​也​可​能​无​法​保​存​快​照​，检​查​或​恢​复​已​保​存​的​快​照​。​当​二​级​存​储​恢​复​连​接​后
​，这​些​功​能​也​就​可​以​自​动​恢​复​。​
	</div><div class="para">
		
二​级​存​储​的​数​据​丢​失​将​会​影​响​最​近​添​加​的​用​户​数​据​，包​括​模​版​、​快​照​、​和​ISO镜​像​。​
二​级​存​储​应​该​进​行​定​期​备​份​。​为​每​个​资​源​域​提​供​多​个​二​级​存​储​服​务​器​能​够​增​强​系​统​
的​可​扩​展​性​。​
	</div></div><div xml:lang="zh-CN" class="section" id="api-throttling" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">17.7.&nbsp;Limiting the Rate of API Requests</h2></div></div></div><div class="para">
		You can limit the rate at which API requests can be placed for each 
account. This is useful to avoid malicious attacks on the Management 
Server, prevent performance degradation, and provide fairness to all 
accounts.
	</div><div class="para">
		If the number of API calls exceeds the threshold, an error message is 
returned for any additional API calls. The caller will have to retry 
these API calls at another time.
	</div><div class="section" id="api-throttling-configure"><div class="titlepage"><div><div><h3 class="title">17.7.1.&nbsp;Configuring the API Request Rate</h3></div></div></div><div class="para">
			To control the API request rate, use the following global configuration settings:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					api.throttling.enabled - Enable/Disable API throttling. By default,
 this setting is false, so API throttling is not enabled.
				</div></li><li class="listitem"><div class="para">
					api.throttling.interval (in seconds) - Time interval during which 
the number of API requests is to be counted. When the interval has 
passed, the API count is reset to 0.
				</div></li><li class="listitem"><div class="para">
					api.throttling.max - Maximum number of APIs that can be placed within the api.throttling.interval period.
				</div></li><li class="listitem"><div class="para">
					api.throttling.cachesize - Cache size for storing API counters. Use
 a value higher than the total number of accounts managed by the cloud. 
One cache entry is needed for each account, to store the running API 
total for that account.
				</div></li></ul></div></div><div class="section" id="api-throttling-limitations"><div class="titlepage"><div><div><h3 class="title">17.7.2.&nbsp;Limitations on API Throttling</h3></div></div></div><div class="para">
			The following limitations exist in the current implementation of this feature.
		</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
				Even with these limitations, CloudStack is still able to effectively
 use API throttling to avoid malicious attacks causing denial of 
service.
			</div></div></div><div class="para">
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					In a deployment with multiple Management Servers, the cache is not 
synchronized across them. In this case, CloudStack might not be able to 
ensure that only the exact desired number of API requests are allowed. 
In the worst case, the number of API calls that might be allowed is 
(number of Management Servers) * (api.throttling.max).
				</div></li><li class="listitem"><div class="para">
					The API commands resetApiLimit and getApiLimit are limited to the Management Server where the API is invoked.
				</div></li></ul></div></div></div></div><div xml:lang="zh-CN" class="chapter" id="manage-cloud" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;18&nbsp;章&nbsp;管​理​云​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#tagging-resources">18.1. Using Tags to Organize Resources in the Cloud</a></span></dt><dt><span class="section"><a href="#change-database-config">18.2. 改​变​数​据​库​配​置​</a></span></dt><dt><span class="section"><a href="#change-database-password">18.3. Changing the Database Password</a></span></dt><dt><span class="section"><a href="#admin-alerts">18.4. 管​理​员​告​警​</a></span></dt><dt><span class="section"><a href="#customizing-dns">18.5. 自​定​义​网​络​域​名​</a></span></dt><dt><span class="section"><a href="#stop-restart-management-server">18.6. 停​止​重​启​管​理​服​务​器​</a></span></dt></dl></div><div xml:lang="zh-CN" class="section" id="tagging-resources" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.1.&nbsp;Using Tags to Organize Resources in the Cloud</h2></div></div></div><div class="para">
		A tag is a key-value pair that stores metadata about a resource in the
 cloud. Tags are useful for categorizing resources. For example, you can
 tag a user VM with a value that indicates the user's city of residence.
 In this case, the key would be "city" and the value might be "Toronto" 
or "Tokyo." You can then request CloudStack to find all resources that 
have a given tag; for example, VMs for users in a given city.
	</div><div class="para">
		You can tag a user virtual machine, volume, snapshot, guest network, 
template, ISO, firewall rule, port forwarding rule, public IP address, 
security group, load balancer rule, project, VPC, network ACL, or static
 route. You can not tag a remote access VPN.
	</div><div class="para">
		You can work with tags through the UI or through the API commands 
createTags, deleteTags, and listTags. You can define multiple tags for 
each resource. There is no limit on the number of tags you can define. 
Each tag can be up to 255 characters long. Users can define tags on the 
resources they own, and administrators can define tags on any resources 
in the cloud.
	</div><div class="para">
		An optional input parameter, "tags," exists on many of the list* API 
commands. The following example shows how to use this new parameter to 
find all the volumes having tag region=canada OR tag city=Toronto:
	</div><pre class="programlisting">command=listVolumes
				&amp;listAll=true
				&amp;tags[0].key=region
				&amp;tags[0].value=canada
				&amp;tags[1].key=city
				&amp;tags[1].value=Toronto</pre><div class="para">
		The following API commands have the "tags" input parameter:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				listVirtualMachines
			</div></li><li class="listitem"><div class="para">
				listVolumes
			</div></li><li class="listitem"><div class="para">
				listSnapshots
			</div></li><li class="listitem"><div class="para">
				listNetworks
			</div></li><li class="listitem"><div class="para">
				listTemplates
			</div></li><li class="listitem"><div class="para">
				listIsos
			</div></li><li class="listitem"><div class="para">
				listFirewallRules
			</div></li><li class="listitem"><div class="para">
				listPortForwardingRules
			</div></li><li class="listitem"><div class="para">
				listPublicIpAddresses
			</div></li><li class="listitem"><div class="para">
				listSecurityGroups
			</div></li><li class="listitem"><div class="para">
				listLoadBalancerRules
			</div></li><li class="listitem"><div class="para">
				listProjects
			</div></li><li class="listitem"><div class="para">
				listVPCs
			</div></li><li class="listitem"><div class="para">
				listNetworkACLs
			</div></li><li class="listitem"><div class="para">
				listStaticRoutes
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="change-database-config" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.2.&nbsp;改​变​数​据​库​配​置​</h2></div></div></div><div class="para">
		The CloudStack Management Server stores database configuration information (e.g., hostname, port, credentials) in the file <code class="filename">/etc/cloudstack/management/db.properties</code>. To effect a change, edit this file on each Management Server, then restart the Management Server.
	</div></div><div xml:lang="zh-CN" class="section" id="change-database-password" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.3.&nbsp;Changing the Database Password</h2></div></div></div><div class="para">
		You may need to change the password for the MySQL account used by 
CloudStack. If so, you'll need to change the password in MySQL, and then
 add the encrypted password to <code class="filename">/etc/cloudstack/management/db.properties</code>.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Before changing the password, you'll need to stop CloudStack's 
management server and the usage engine if you've deployed that 
component.
			</div><pre class="screen"><code class="command"># service cloudstack-management stop</code>
<code class="command"># service cloudstack-usage stop</code></pre></li><li class="listitem"><div class="para">
				Next, you'll update the password for the CloudStack user on the MySQL server.
			</div><pre class="screen"><code class="command"># mysql -u root -p</code></pre><div class="para">
				At the MySQL shell, you'll change the password and flush privileges:
			</div><pre class="screen"><code class="command">update mysql.user set password=PASSWORD("newpassword123") where User='cloud';</code>
<code class="command">flush privileges;</code>
<code class="command">quit;</code></pre></li><li class="listitem"><div class="para">
				The next step is to encrypt the password and copy the encrypted password to CloudStack's database configuration (<code class="filename">/etc/cloudstack/management/db.properties</code>).
			</div><pre class="screen">    <code class="command"># java -classpath /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar \ org.jasypt.intf.cli.JasyptPBEStringEncryptionCLI encrypt.sh \ input="newpassword123" password="`cat /etc/cloudstack/management/key`" \ verbose=false </code></pre><div class="note"><div class="admonition_header"><h2>File encryption type</h2></div><div class="admonition"><div class="para">
					Note that this is for the file encryption type. If you're using the
 web encryption type then you'll use 
password="management_server_secret_key"
				</div></div></div></li><li class="listitem"><div class="para">
				Now, you'll update <code class="filename">/etc/cloudstack/management/db.properties</code> with the new ciphertext. Open <code class="filename">/etc/cloudstack/management/db.properties</code> in a text editor, and update these parameters:
			</div><pre class="programlisting">db.cloud.password=ENC(encrypted_password_from_above) 
db.usage.password=ENC(encrypted_password_from_above)
</pre></li><li class="listitem"><div class="para">
				After copying the new password over, you can now start CloudStack (and the usage engine, if necessary).
			</div><pre class="screen">        <code class="command"># service cloudstack-management start</code>
        <code class="command"># service cloudstack-usage start</code>
</pre></li></ol></div></div><div xml:lang="zh-CN" class="section" id="admin-alerts" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.4.&nbsp;管​理​员​告​警​</h2></div></div></div><div class="para">
		系​统​提​供​告​警​和​事​件​用​以​帮​助​云​的​管​理​。​告​警​通​知​管​理​员​，一​般​用​邮​件​发​送​，提​醒​管​理​员​云​中​有​错​误​发​生​。​告​警​的​行​为​可​以​进​行​配​置​。​
	</div><div class="para">
		会​追​踪​云​中​所​有​用​户​和​管​理​员​的​操​作​事​件​。​如​，每​个​客​户​虚​拟​机​的​启​动​会​建​立​一​个​对​应​的​事​件​。​每​个​时​间​都​存​储​在​管​理​节​点​的​数​据​库​中​。​
	</div><div class="para">
		在​以​下​情​况​，会​发​送​邮​件​给​管​理​员​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				管​理​节​点​集​群​中​CPU，内​存​或​者​存​储​资​源​的​可​用​量​低​。​
			</div></li><li class="listitem"><div class="para">
				管​理​节​点​和​主​机​之​间​的​心​跳​检​查​丢​失​超​过​3分​钟​。​
			</div></li><li class="listitem"><div class="para">
				主​机​集​群​中​CPU，内​存​或​者​存​储​资​源​的​可​用​量​低​。​
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="customizing-dns" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.5.&nbsp;自​定​义​网​络​域​名​</h2></div></div></div><div class="para">
		根​管​理​员​在​网​络​, 帐​户​, 域​, 
资​源​域​以​及​整​个​CloudStack安​装​级​别​可​选​择​的​设​置​DNS后​缀​, 
一​个​域​管​理​员​可​以​在​自​己​的​域​做​这​样​的​设​置​. 要​自​定​义​域​名​并​使​其​有​效​, 
请​跟​随​下​面​的​步​骤​.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				在​希​望​的​范​围​内​设​置​DNS后​缀​
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						在​网​络​级​别​, DNS后​缀​可​以​通​过​UI在​创​建​一​个​新​的​网​络​时​设​置​, 这​些​在​ <a class="xref" href="#add-additional-guest-network">第&nbsp;15.6.1&nbsp;节 “添​加​另​一​个​虚​拟​机​的​网​络​”</a> 和​CloudStack API的​updateNetwork命​令​都​有​描​述​.
					</div></li><li class="listitem"><div class="para">
						在​账​户​, 域​或​资​源​域​级​别​, DNS后​缀​可​以​指​派​给​合​适​的​CloudStack API命​令​:
 createAccount, editAccount, createDomain, editDomain, 
createZone或​editZone.
					</div></li><li class="listitem"><div class="para">
						在​全​局​范​围​内​, 使​用​配​置​参​数​guest.domain.suffix. 
你​也​可​以​使​用​CloudStack API命​令​updateConfiguration. 
当​更​改​了​这​个​全​局​配​置​后​, 重​启​管​理​服​务​器​的​服​务​以​便​新​的​设​置​有​效​.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				为​了​使​你​的​新​DNS后​缀​对​已​经​存​在​的​网​络​有​效​, 你​需​要​调​用​CloudStack 
API命​令​updateNetwork. 对​于​DNS后​缀​已​经​更​改​后​新​建​的​网​络​这​一​步​不​是​必​需​的​.
			</div></li></ol></div><div class="para">
		你​使​用​的​网​域​的​源​取​决​于​下​面​的​一​些​规​则​.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				对​于​所​有​的​网​络​,如​果​网​域​作​为​这​个​网​络​自​己​配​置​的​一​部​分​, 那​这​个​网​域​的​值​会​被​使​用​.
			</div></li><li class="listitem"><div class="para">
				对​于​账​户​指​定​的​网​络​, 为​这​个​账​户​指​定​的​网​域​会​被​使​用​. 如​果​没​有​指​定​, 系​统​会​按​照​域​, 资​源​域​, 全​局​配​置​的​顺​序​查​找​网​域​的​值​.
			</div></li><li class="listitem"><div class="para">
				对​于​域​指​定​的​网​络​, 为​这​个​域​指​定​的​网​域​会​被​使​用​. 如​果​没​有​指​定​, 系​统​会​按​照​ 资​源​域​, 全​局​配​置​的​顺​序​查​找​网​域​的​值​.
			</div></li><li class="listitem"><div class="para">
				对​于​资​源​域​指​定​的​网​络​, 为​这​个​资​源​域​指​定​的​网​域​会​被​使​用​. 如​果​没​有​指​定​, 系​统​会​在​全​局​配​置​里​查​找​网​域​的​值​.
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="stop-restart-management-server" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">18.6.&nbsp;停​止​重​启​管​理​服​务​器​</h2></div></div></div><div class="para">
		超​级​管​理​需​要​经​常​性​的​关​闭​和​重​启​管​理​服​务​器​
	</div><div class="para">
		For example, after changing a global configuration parameter, a 
restart is required. If you have multiple Management Server nodes, 
restart all of them to put the new parameter value into effect 
consistently throughout the cloud..
	</div><div class="para">
		停​止​管​理​服​务​器​，在​操​作​系​统​提​示​符​下​管​理​服​务​器​节​执​行​以​下​命​令​：
	</div><pre class="programlisting"># service cloudstack-management stop</pre><div class="para">
		启​动​管​理​服​务​器​：
	</div><pre class="programlisting"># service cloudstack-management start</pre><div class="para">
		停​止​管​理​服​务​器​：
	</div><pre class="programlisting"># service cloudstack-management stop</pre></div></div><div xml:lang="zh-CN" class="chapter" id="global-config" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;19&nbsp;章&nbsp;Global Configuration Parameters</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#setting-global-config-parameters">19.1. 设​置​全​局​配​置​参​数​</a></span></dt><dt><span class="section"><a href="#about-global-config-parameters">19.2. About Global Configuration Parameters</a></span></dt></dl></div><div class="section" id="setting-global-config-parameters"><div class="titlepage"><div><div><h2 class="title">19.1.&nbsp;设​置​全​局​配​置​参​数​</h2></div></div></div><div class="para">
			你​可​以​通​过​设​置​CloudStack提​供​的​参​数​控​制​云​的​多​个​方​面​.CloudStack首​次​安​装​后​,在​此​后​定​期​,您​可​能​需​要​修​改​这​些​设​置​。​
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					使​用​管​理​员​账​号​登​陆​
				</div></li><li class="listitem"><div class="para">
					在​左​侧​导​航​栏​，点​击​ 全​局​设​置​
				</div></li><li class="listitem"><div class="para">
					在​选​择​视​图​中​，选​择​下​列​操​作​之​一​：
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							全​局​设​置​
						</div></li><li class="listitem"><div class="para">
							hypervsior 容​量​。​这​里​显​示​列​出​了​不​同​hypervsior版​本​所​支​持​的​最​大​虚​拟​机​数​量​。​
						</div></li></ul></div></li><li class="listitem"><div class="para">
					使​用​搜​索​框​来​缩​小​列​表​中​你​所​感​兴​趣​的​那​些​
				</div></li><li class="listitem"><div class="para">
					单​击​“​编​辑​”​图​标​修​改​一​个​值​。​如​果​您​正​在​查​看​的​hypervsior容​量​，您​必​须​单​击​hypervsior第​一​次​显​示​编​辑​屏​幕​的​名​称​。​
				</div></li></ol></div></div><div class="section" id="about-global-config-parameters"><div class="titlepage"><div><div><h2 class="title">19.2.&nbsp;About Global Configuration Parameters</h2></div></div></div><div class="para">
			CloudStack provides a variety of settings you can use to set limits, 
configure features, and enable or disable features in the cloud. Once 
your Management Server is running, you might need to set some of these 
global configuration parameters, depending on what optional features you
 are setting up.
		</div><div class="para">
			To modify global configuration parameters, use the steps in "Setting Global Configuration Parameters."
		</div><div class="para">
			The documentation for each CloudStack feature should direct you to 
the names of the applicable parameters. Many of them are discussed in 
the CloudStack Administration Guide. The following table shows a few of 
the more useful parameters.
		</div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="67%"><col class="c2" align="left" width="33%"></colgroup><thead><tr><th class="" align="left">
							<div class="para">
								Field
							</div>
						</th><th class="" align="left">
							<div class="para">
								å¼
							</div>
						</th></tr></thead><tbody><tr><td class="" align="left">
							<div class="para">
								management.network.cidr
							</div>
						</td><td class="" align="left">
							<div class="para">
								A CIDR that describes the network that the management CIDRs 
reside on. This variable must be set for deployments that use vSphere. 
It is recommended to be set for other deployments as well. Example: 
192.168.3.0/24.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								xen.setup.multipath
							</div>
						</td><td class="" align="left">
							<div class="para">
								For XenServer nodes, this is a true/false variable that 
instructs CloudStack to enable iSCSI multipath on the XenServer Hosts 
when they are added. This defaults to false. Set it to true if you would
 like CloudStack to enable multipath.
							</div>
							 <div class="para">
								If this is true for a NFS-based deployment multipath will still 
be enabled on the XenServer host. However, this does not impact NFS 
operation and is harmless.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								secstorage.allowed.internal.sites
							</div>
						</td><td class="" align="left">
							<div class="para">
								This is used to protect your internal network from rogue 
attempts to download arbitrary files using the template download 
feature. This is a comma-separated list of CIDRs. If a requested URL 
matches any of these CIDRs the Secondary Storage VM will use the private
 network interface to fetch the URL. Other URLs will go through the 
public interface. We suggest you set this to 1 or 2 hardened internal 
machines where you keep your templates. For example, set it to 
192.168.1.66/32.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								use.local.storage
							</div>
						</td><td class="" align="left">
							<div class="para">
								Determines whether CloudStack will use storage that is local to 
the Host for data disks, templates, and snapshots. By default CloudStack
 will not use this storage. You should change this to true if you want 
to use local storage and you understand the reliability and feature 
drawbacks to choosing local storage.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								host
							</div>
						</td><td class="" align="left">
							<div class="para">
								This is the IP address of the Management Server. If you are 
using multiple Management Servers you should enter a load balanced IP 
address that is reachable via the private network.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								default.page.size
							</div>
						</td><td class="" align="left">
							<div class="para">
								Maximum number of items per page that can be returned by a 
CloudStack API command. The limit applies at the cloud level and can 
vary from cloud to cloud. You can override this with a lower value on a 
particular API call by using the page and pagesize API command 
parameters. For more information, see the Developer's Guide. Default: 
500.
							</div>
						</td></tr><tr><td class="" align="left">
							<div class="para">
								ha.tag
							</div>
						</td><td class="" align="left">
							<div class="para">
								The label you want to use throughout the cloud to designate 
certain hosts as dedicated HA hosts. These hosts will be used only for 
HA-enabled VMs that are restarting due to the failure of another host. 
For example, you could set this to ha_host. Specify the ha.tag value as a
 host tag when you add a new host to the cloud.
							</div>
						</td></tr></tbody></table></div></div></div><div xml:lang="zh-CN" class="chapter" id="api-overview" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;20&nbsp;章&nbsp;CloudStack API</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#provisioning-auth-api">20.1. 自​服​务​和​验​证​API</a></span></dt><dt><span class="section"><a href="#allocators">20.2. 分​配​器​</a></span></dt><dt><span class="section"><a href="#user-data-and-meta-data">20.3. User Data and Meta Data</a></span></dt></dl></div><div class="para">
		CloudStack API是​用​来​实​现​ CloudStack 的​一​个​低​层​次​API；
	</div><div class="para">
		Many CloudStack API calls are asynchronous. These will return a Job ID
 immediately when called. This Job ID can be used to query the status of
 the job later. Also, status calls on impacted resources will provide 
some indication of their state.
	</div><div class="para">
		The API has a REST-like query basis and returns results in XML or JSON.
	</div><div class="para">
		See <a href="http://docs.cloudstack.org/CloudStack_Documentation/Developer%27s_Guide%3A_CloudStack">the Developer’​s Guide</a> and <a href="http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack">the API Reference</a>.
	</div><div xml:lang="zh-CN" class="section" id="provisioning-auth-api" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">20.1.&nbsp;自​服​务​和​验​证​API</h2></div></div></div><div class="para">
		CloudStack期​望​客​户​有​他​自​己​用​户​的​自​服​务​基​础​架​构​. 它​提​供​与​已​有​的​这​些​系​统​集​成​的​API, 通​过​调​用​CloudStack的​这​些​API来​添​加​/删​除​用​户​.
	</div><div class="para">
		CloudStack 支​持​插​件​类​型​的​验​证​组​件​. 默​认​情​况​下​, CloudStack 
假​定​通​过​提​供​用​户​的​密​码​,作​为​本​地​的​验​证​方​式​. 但​外​部​的​验​证​也​是​可​能​的​. 例​如​,
 参​考​使​用​LDAP服​务​器​来​进​行​用​户​的​验​证​.
	</div></div><div xml:lang="zh-CN" class="section" id="allocators" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">20.2.&nbsp;分​配​器​</h2></div></div></div><div class="para">
		CloudStack 是​管​理​员​能​够​写​定​制​的​分​配​器​，用​于​选​择​放​置​新​的​客​户​机​的​主​机​和​分​配​客​户​机​虚​拟​磁​盘​镜​像​的​存​储​主​机​。​
	</div></div><div xml:lang="zh-CN" class="section" id="user-data-and-meta-data" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">20.3.&nbsp;User Data and Meta Data</h2></div></div></div><div class="para">
		CloudStack provides API access to attach user data to a deployed VM. 
Deployed VMs also have access to instance metadata via the virtual 
router.
	</div><div class="para">
		User data can be accessed once the IP address of the virtual router is
 known. Once the IP address is known, use the following steps to access 
the user data:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Run the following command to find the virtual router.
			</div><pre class="programlisting"># cat /var/lib/dhclient/dhclient-eth0.leases | grep dhcp-server-identifier | tail -1</pre></li><li class="listitem"><div class="para">
				Access user data by running the following command using the result of the above command
			</div><pre class="programlisting"># curl http://10.1.1.1/latest/user-data</pre></li></ol></div><div class="para">
		Meta Data can be accessed similarly, using a URL of the form 
http://10.1.1.1/latest/meta-data/{metadata type}. (For backwards 
compatibility, the previous URL http://10.1.1.1/latest/{metadata type} 
is also supported.) For metadata type, use one of the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				service-offering. A description of the VMs service offering
			</div></li><li class="listitem"><div class="para">
				availability-zone. The Zone name
			</div></li><li class="listitem"><div class="para">
				local-ipv4. The guest IP of the VM
			</div></li><li class="listitem"><div class="para">
				local-hostname. The hostname of the VM
			</div></li><li class="listitem"><div class="para">
				public-ipv4. The first public IP for the router. (E.g. the first IP of eth2)
			</div></li><li class="listitem"><div class="para">
				public-hostname. This is the same as public-ipv4
			</div></li><li class="listitem"><div class="para">
				instance-id. The instance name of the VM
			</div></li></ul></div></div></div><div xml:lang="zh-CN" class="chapter" id="tuning" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;21&nbsp;章&nbsp;性​能​调​优​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#performance-monitoring">21.1. 性​能​监​控​</a></span></dt><dt><span class="section"><a href="#increase-management-server-max-memory">21.2. Increase Management Server Maximum Memory</a></span></dt><dt><span class="section"><a href="#set-database-buffer-pool-size">21.3. Set Database Buffer Pool Size</a></span></dt><dt><span class="section"><a href="#set-monitor-total-vm-limits-per-host">21.4. Set and Monitor Total VM Limits per Host</a></span></dt><dt><span class="section"><a href="#configure-xenserver-dom0-memory">21.5. 配​置​XenServer的​dom0的​内​存​</a></span></dt></dl></div><div class="para">
		本​节​提​供​了​如​何​提​高​你​的​云​性​能​的​提​示​。​
	</div><div xml:lang="zh-CN" class="section" id="performance-monitoring" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">21.1.&nbsp;性​能​监​控​</h2></div></div></div><div class="para">
		
终​端​用​户​和​管​理​员​都​能​使​用​宿​主​机​和​虚​拟​机​的​性​能​监​控​。​性​能​监​控​将​允​许​用​户​监​控​
他​们​的​资​源​利​用​和​帮​助​决​定​何​时​将​需​要​选​择​一​个​更​高​的​系​统​性​能​或​者​更​大​的​硬​盘​。​
	</div></div><div xml:lang="zh-CN" class="section" id="increase-management-server-max-memory" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">21.2.&nbsp;Increase Management Server Maximum Memory</h2></div></div></div><div class="para">
		If the Management Server is subject to high demand, the default 
maximum JVM memory allocation can be insufficient. To increase the 
memory:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Edit the Tomcat configuration file:
			</div><pre class="programlisting">/etc/cloudstack/management/tomcat6.conf</pre></li><li class="listitem"><div class="para">
				Change the command-line parameter -XmxNNNm to a higher value of N.
			</div><div class="para">
				For example, if the current value is -Xmx128m, change it to -Xmx1024m or higher.
			</div></li><li class="listitem"><div class="para">
				To put the new setting into effect, restart the Management Server.
			</div><pre class="programlisting"># service cloudstack-management restart</pre></li></ol></div><div class="para">
		For more information about memory issues, see "FAQ: Memory" at <a href="http://wiki.apache.org/tomcat/FAQ/Memory">Tomcat Wiki.</a>
	</div></div><div xml:lang="zh-CN" class="section" id="set-database-buffer-pool-size" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">21.3.&nbsp;Set Database Buffer Pool Size</h2></div></div></div><div class="para">
		It is important to provide enough memory space for the MySQL database to cache data and indexes:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Edit the MySQL configuration file:
			</div><pre class="programlisting">/etc/my.cnf</pre></li><li class="listitem"><div class="para">
				Insert the following line in the [mysqld] section, below the datadir
 line. Use a value that is appropriate for your situation. We recommend 
setting the buffer pool at 40% of RAM if MySQL is on the same server as 
the management server or 70% of RAM if MySQL has a dedicated server. The
 following example assumes a dedicated server with 1024M of RAM.
			</div><pre class="programlisting">innodb_buffer_pool_size=700M</pre></li><li class="listitem"><div class="para">
				重​启​MySQL服​务​.
			</div><pre class="programlisting"># service mysqld restart</pre></li></ol></div><div class="para">
		For more information about the buffer pool, see "The InnoDB Buffer Pool" at <a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-buffer-pool.html">MySQL Reference Manual</a>.
	</div></div><div xml:lang="zh-CN" class="section" id="set-monitor-total-vm-limits-per-host" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">21.4.&nbsp;Set and Monitor Total VM Limits per Host</h2></div></div></div><div class="para">
		
CloudStack管​理​员​应​该​监​视​每​个​集​群​中​的​虚​拟​机​实​例​的​总​数​，并​禁​止​分​配​给​集​群​接​近
​最​大​的​虚​拟​机​管​理​程​序​可​以​处​理​。​一​定​要​留​一​个​安​全​余​量​，允​许​一​个​或​多​个​主​机​出​
现​故​障​，这​会​增​加​其​他​主​机​上​的​虚​拟​机​负​载​，增​加​自​动​重​新​部​署​的​可​能​性​。​查​询​你​选​
择​虚​拟​机​管​理​程​序​的​文​档​，来​发​现​的​最​大​许​可​数​量​每​台​主​机​上​的​虚​拟​机​，然​后​使​用​
CloudStack的​全​局​配​置​设​置​设​置​为​默​认​的​限​制​。​在​每​个​群​集​在​任​何​时​候​都​监​控​虚​拟​
机​的​活​动​。​保​持​总​的​虚​拟​机​数​量​低​于​安​全​水​平​，允​许​偶​尔​主​机​发​生​故​障​。​例​如​，如​果​
有​N个​集​群​中​的​主​机​，你​想​允​许​在​集​群​中​的​一​台​主​机​是​在​任​何​给​定​的​时​间​内​，总​数​量​的
​虚​拟​机​实​例​，你​可​以​允​许​集​群​中​最​多​（N-1 
）*（每​个​主​机​的​限​制​）。​集​群​一​旦​达​到​这​个​数​字​的​虚​拟​机​，使​用​CloudStack 
UI禁​用​分​配​更​多​的​虚​拟​机​的​集​群​。​
	</div></div><div xml:lang="zh-CN" class="section" id="configure-xenserver-dom0-memory" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">21.5.&nbsp;配​置​XenServer的​dom0的​内​存​</h2></div></div></div><div class="para">
		配​置​XenServer 
dom0的​设​置​，分​配​更​多​的​内​存​给​dom0。​这​可​以​使​XenServer能​处​理​大​量​的​虚​拟​机​。​我​
们​建​议​2940 MB RAM给​XenServer dom0。​对​于​如​何​做​到​这​一​点​的​说​明​，请​参​阅​：<a href="http://support.citrix.com/article/CTX126531">思​杰​知​识​库​文​章​</a>。​文​章​指​的​是​XenServer 5.6，但​相​同​的​信​息​适​用​于​XenServer 6。​
	</div></div></div><div xml:lang="zh-CN" class="chapter" id="troubleshooting" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">第&nbsp;22&nbsp;章&nbsp;故​障​排​查​</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#events">22.1. 事​件​</a></span></dt><dd><dl><dt><span class="section"><a href="#events-log">22.1.1. Event Logs</a></span></dt><dt><span class="section"><a href="#event-framework">22.1.2. Event Notification</a></span></dt><dt><span class="section"><a href="#standard-events">22.1.3. Standard Events</a></span></dt><dt><span class="section"><a href="#long-running-job-events">22.1.4. 长​时​间​运​行​的​任​务​事​件​</a></span></dt><dt><span class="section"><a href="#event-log-queries">22.1.5. 事​件​日​志​查​询​</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting-working-with-server-logs">22.2. Working with Server Logs</a></span></dt><dt><span class="section"><a href="#troubleshooting-dataloss-on-exported-primary-storage">22.3. Data Loss on Exported Primary Storage</a></span></dt><dt><span class="section"><a href="#troubleshooting-recover-lost-virtual-router">22.4. Recovering a Lost Virtual Router </a></span></dt><dt><span class="section"><a href="#troubleshooting-maintenance-mode-not-working-on-vCenter">22.5. Maintenance mode not working on vCenter</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-deploy-vms">22.6. 无​法​从​上​传​的​vSphere模​板​部​署​虚​拟​机​</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-power-on-vm">22.7. Unable to power on virtual machine on VMware</a></span></dt><dt><span class="section"><a href="#troubleshooting-lb-rules-fails">22.8. Load balancer rules fail after changing network offering</a></span></dt></dl></div><div xml:lang="zh-CN" class="section" id="events" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.1.&nbsp;事​件​</h2></div></div></div><div class="para">
		An event is essentially a significant or meaningful change in the 
state of both virtual and physical resources associated with a cloud 
environment. Events are used by monitoring systems, usage and billing 
systems, or any other event-driven workflow systems to discern a pattern
 and make the right business decision. In CloudStack an event could be a
 state change of virtual or psychical resources, an action performed by 
an user (action events), or policy based events (alerts).
	</div><div xml:lang="zh-CN" class="section" id="events-log" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">22.1.1.&nbsp;Event Logs</h3></div></div></div><div class="para">
		There are two types of events logged in the CloudStack Event Log. 
Standard events log the success or failure of an event and can be used 
to identify jobs or processes that have failed. There are also long 
running job events. Events for asynchronous jobs log when a job is 
scheduled, when it starts, and when it completes. Other long running 
synchronous jobs log when a job starts, and when it completes. Long 
running synchronous and asynchronous event logs can be used to gain more
 information on the status of a pending job or can be used to identify a
 job that is hanging or has not started. The following sections provide 
more information on these events..
	</div></div><div xml:lang="zh-CN" class="section" id="event-framework" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">22.1.2.&nbsp;Event Notification</h3></div></div></div><div class="para">
		Event notification framework provides a means for the Management 
Server components to publish and subscribe to CloudStack events. Event 
notification is achieved by implementing the concept of event bus 
abstraction in the Management Server. An event bus is introduced in the 
Management Server that allows the CloudStackcomponents and extension 
plug-ins to subscribe to the events by using the Advanced Message 
Queuing Protocol (AMQP) client. In CloudStack, a default implementation 
of event bus is provided as a plug-in that uses the RabbitMQ AMQP 
client. The AMQP client pushes the published events to a compatible AMQP
 server. Therefore all the CloudStack events are published to an 
exchange in the AMQP server.
	</div><div class="para">
		A new event for state change, resource state change, is introduced as 
part of Event notification framework. Every resource, such as user VM, 
volume, NIC, network, public IP, snapshot, and template, is associated 
with a state machine and generates events as part of the state change. 
That implies that a change in the state of a resource results in a state
 change event, and the event is published in the corresponding state 
machine on the event bus. All the CloudStack events (alerts, action 
events, usage events) and the additional category of resource state 
change events, are published on to the events bus.
	</div><div class="formalpara"><h5 class="formalpara" id="idm14501264">Use Cases</h5>
			The following are some of the use cases:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Usage or Billing Engines: A third-party cloud usage solution can 
implement a plug-in that can connects to CloudStack to subscribe to 
CloudStack events and generate usage data. The usage data is consumed by
 their usage software.
			</div></li><li class="listitem"><div class="para">
				AMQP plug-in can place all the events on the a message queue, then a
 AMQP message broker can provide topic-based notification to the 
subscribers.
			</div></li><li class="listitem"><div class="para">
				Publish and Subscribe notification service can be implemented as a 
pluggable service in CloudStack that can provide rich set of APIs for 
event notification, such as topics-based subscription and notification. 
Additionally, the pluggable service can deal with multi-tenancy, 
authentication, and authorization issues.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp11710192">云​平​台​配​置​</h5>
			As a CloudStack administrator, perform the following one-time 
configuration to enable event notification framework. At run time no 
changes can control the behaviour.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Open <code class="filename">'componentContext.xml</code>.
			</div></li><li class="listitem"><div class="para">
				Define a bean named <code class="filename">eventNotificationBus</code> as follows:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						name : Specify a name for the bean.
					</div></li><li class="listitem"><div class="para">
						server : The name or the IP address of the RabbitMQ AMQP server.
					</div></li><li class="listitem"><div class="para">
						port : The port on which RabbitMQ server is running.
					</div></li><li class="listitem"><div class="para">
						username : The username associated with the account to access the RabbitMQ server.
					</div></li><li class="listitem"><div class="para">
						password : The password associated with the username of the account to access the RabbitMQ server.
					</div></li><li class="listitem"><div class="para">
						exchange : The exchange name on the RabbitMQ server where CloudStack events are published.
					</div><div class="para">
						A sample bean is given below:
					</div><pre class="programlisting">&lt;bean id="eventNotificationBus" class="org.apache.cloudstack.mom.rabbitmq.RabbitMQEventBus"&gt;
    &lt;property name="name" value="eventNotificationBus"/&gt;
    &lt;property name="server" value="127.0.0.1"/&gt;
    &lt;property name="port" value="5672"/&gt;
    &lt;property name="username" value="guest"/&gt;
    &lt;property name="password" value="guest"/&gt;
   &lt;property name="exchange" value="cloudstack-events"/&gt;
   &lt;/bean&gt;</pre><div class="para">
						The <code class="filename">eventNotificationBus</code> bean represents the <code class="filename">org.apache.cloudstack.mom.rabbitmq.RabbitMQEventBus</code> class.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				重​启​管​理​服​务​器​.
			</div></li></ol></div></div><div xml:lang="zh-CN" class="section" id="standard-events" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">22.1.3.&nbsp;Standard Events</h3></div></div></div><div class="para">
		The events log records three types of standard events.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				INFO. This event is generated when an operation has been successfully performed.
			</div></li><li class="listitem"><div class="para">
				WARN. This event is generated in the following circumstances.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						When a network is disconnected while monitoring a template download.
					</div></li><li class="listitem"><div class="para">
						When a template download is abandoned.
					</div></li><li class="listitem"><div class="para">
						When an issue on the storage server causes the volumes to fail over to the mirror storage server.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				ERROR. This event is generated when an operation has not been successfully performed
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="long-running-job-events" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">22.1.4.&nbsp;长​时​间​运​行​的​任​务​事​件​</h3></div></div></div><div class="para">
		事​件​日​志​记​录​了​三​种​类​型​的​标​志​事​件​.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				INFO. 当​一​个​操​作​成​功​执​行​时​会​产​生​这​样​的​事​件​.
			</div></li><li class="listitem"><div class="para">
				WARN. 这​个​事​件​在​以​下​情​况​下​产​生​.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						当​一​个​模​板​正​在​下​载​时​检​测​到​网​络​断​开​.
					</div></li><li class="listitem"><div class="para">
						当​放​弃​一​个​模​板​的​下​载​.
					</div></li><li class="listitem"><div class="para">
						一​个​存​储​服​务​器​上​的​错​误​导​致​卷​故​障​无​法​转​移​到​另​一​个​镜​像​的​存​储​服​务​器​.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				ERROR. 当​一​个​操​作​没​有​被​成​功​执​行​时​会​产​生​这​个​事​件​.
			</div></li></ul></div></div><div xml:lang="zh-CN" class="section" id="event-log-queries" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title">22.1.5.&nbsp;事​件​日​志​查​询​</h3></div></div></div><div class="para">
		数​据​库​日​志​可​以​从​用​户​界​面​查​询​。​系​统​所​捕​获​的​事​件​的​列​表​包​括​：
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				虚​拟​机​的​创​建​，删​除​和​持​续​的​管​理​操​作​
			</div></li><li class="listitem"><div class="para">
				虚​拟​路​由​器​创​建​，删​除​和​持​续​的​管​理​操​作​
			</div></li><li class="listitem"><div class="para">
				模​板​的​创​建​和​删​除​
			</div></li><li class="listitem"><div class="para">
				网​络​/负​载​均​衡​器​规​则​的​创​建​和​删​除​
			</div></li><li class="listitem"><div class="para">
				存​储​卷​的​创​建​和​删​除​
			</div></li><li class="listitem"><div class="para">
				用​户​登​录​和​注​销​
			</div></li></ul></div></div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-working-with-server-logs" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.2.&nbsp;Working with Server Logs</h2></div></div></div><div class="para">
		The CloudStack Management Server logs all web site, middle tier, and 
database activities for diagnostics purposes in 
/var/log/cloudstack/management/. The CloudStack logs a variety of error 
messages. We recommend this command to find the problematic output in 
the Management Server log:.
	</div><div class="note"><div class="admonition_header"><h2>注意</h2></div><div class="admonition"><div class="para">
			当​拷​贝​粘​贴​一​条​命​令​, 确​保​在​运​行​前​粘​贴​的​命​令​在​一​行​上​. 一​些​文​档​查​看​器​可​能​会​在​拷​贝​时​引​入​不​希​望​的​换​行​符​.
		</div></div></div><pre class="programlisting">        grep -i -E 'exception|unable|fail|invalid|leak|warn|error' /var/log/cloudstack/management/management-server.log
</pre><div class="para">
		The CloudStack processes requests with a Job ID. If you find an error 
in the logs and you are interested in debugging the issue you can grep 
for this job ID in the management server log. For example, suppose that 
you find the following ERROR message:
	</div><pre class="programlisting">        2010-10-04 13:49:32,595 ERROR [cloud.vm.UserVmManagerImpl] (Job-Executor-11:job-1076) Unable to find any host for [User|i-8-42-VM-untagged]
</pre><div class="para">
		Note that the job ID is 1076. You can track back the events relating to job 1076 with the following grep:
	</div><pre class="programlisting">        grep "job-1076)" management-server.log
</pre><div class="para">
		The CloudStack Agent Server logs its activities in /var/log/cloudstack/agent/.
	</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-dataloss-on-exported-primary-storage" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.3.&nbsp;Data Loss on Exported Primary Storage</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm13939536">症​状​</h5>
			Loss of existing data on primary storage which has been exposed as a Linux NFS server export on an iSCSI volume.
		</div><div class="formalpara"><h5 class="formalpara" id="idp22405040">原​因​</h5>
			It is possible that a client from outside the intended pool has 
mounted the storage. When this occurs, the LVM is wiped and all data in 
the volume is lost
		</div><div class="formalpara"><h5 class="formalpara" id="idm1340656">解​决​方​案​</h5>
			When setting up LUN exports, restrict the range of IP addresses that 
are allowed access by specifying a subnet mask. For example:
		</div><pre class="programlisting">echo “/export 192.168.1.0/24(rw,async,no_root_squash)” &gt; /etc/exports</pre><div class="para">
		Adjust the above command to suit your deployment needs.
	</div><div class="formalpara"><h5 class="formalpara" id="idp16078768">More Information</h5>
			See the export procedure in the "Secondary Storage" section of the CloudStack Installation Guide
		</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-recover-lost-virtual-router" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.4.&nbsp;Recovering a Lost Virtual Router </h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm408304">症​状​</h5>
			A virtual router is running, but the host is disconnected. A virtual router no longer functions as expected.
		</div><div class="formalpara"><h5 class="formalpara" id="idp49462832">原​因​</h5>
			The Virtual router is lost or down.
		</div><div class="formalpara"><h5 class="formalpara" id="idm11807264">解​决​方​案​</h5>
			If you are sure that a virtual router is down forever, or no longer 
functions as expected, destroy it. You must create one afresh while 
keeping the backup router up and running (it is assumed this is in a 
redundant router setup):
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Force stop the router. Use the stopRouter API with forced=true parameter to do so.
			</div></li><li class="listitem"><div class="para">
				Before you continue with destroying this router, ensure that the 
backup router is running. Otherwise the network connection will be lost.
			</div></li><li class="listitem"><div class="para">
				Destroy the router by using the destroyRouter API.
			</div></li></ul></div><div class="para">
		Recreate the missing router by using the restartNetwork API with 
cleanup=false parameter. For more information about redundant router 
setup, see Creating a New Network Offering.
	</div><div class="para">
		For more information about the API syntax, see the API Reference at <a href="http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack">http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack</a>API Reference.
	</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-maintenance-mode-not-working-on-vCenter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.5.&nbsp;Maintenance mode not working on vCenter</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm6180096">症​状​</h5>
			Host was placed in maintenance mode, but still appears live in vCenter.
		</div><div class="formalpara"><h5 class="formalpara" id="idm375504">原​因​</h5>
			The CloudStack administrator UI was used to place the host in 
scheduled maintenance mode. This mode is separate from vCenter's 
maintenance mode.
		</div><div class="formalpara"><h5 class="formalpara" id="idp14458784">解​决​方​案​</h5>
			Use vCenter to place the host in maintenance mode.
		</div><div class="formalpara"><h5 class="formalpara" id="idp14796832">More Information</h5>
			See <a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">第&nbsp;11.2&nbsp;节 “主​机​定​期​维​护​和​维​护​模​式​”</a>
		</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-unable-to-deploy-vms" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.6.&nbsp;无​法​从​上​传​的​vSphere模​板​部​署​虚​拟​机​</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm6106128">症​状​</h5>
			当​试​图​创​建​一​个​虚​拟​机​，虚​拟​机​将​无​法​部​署​。​
		</div><div class="formalpara"><h5 class="formalpara" id="idp4710352">原​因​</h5>
			如​果​模​板​通​过​上​传​OVA文​件​创​建​，而​OVA文​件​是​使​用​vSphere Client创​建​的​，可​能​OVA中​包​含​ISO镜​像​。​如​果​是​的​话​，从​模​板​部​署​虚​拟​机​将​失​败​。​
		</div><div class="formalpara"><h5 class="formalpara" id="idp52570496">解​决​方​案​</h5>
			移​除​ISO并​重​新​上​传​模​板​。​
		</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-unable-to-power-on-vm" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.7.&nbsp;Unable to power on virtual machine on VMware</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm2111824">症​状​</h5>
			Virtual machine does not power on. You might see errors like:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Unable to open Swap File
			</div></li><li class="listitem"><div class="para">
				Unable to access a file since it is locked
			</div></li><li class="listitem"><div class="para">
				Unable to access Virtual machine configuration
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp46920272">原​因​</h5>
			A known issue on VMware machines. ESX hosts lock certain critical 
virtual machine files and file systems to prevent concurrent changes. 
Sometimes the files are not unlocked when the virtual machine is powered
 off. When a virtual machine attempts to power on, it can not access 
these critical files, and the virtual machine is unable to power on.
		</div><div class="formalpara"><h5 class="formalpara" id="idm5600048">解​决​方​案​</h5>
			See the following:
		</div><div class="para">
		<a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=10051/">VMware Knowledge Base Article</a>
	</div></div><div xml:lang="zh-CN" class="section" id="troubleshooting-lb-rules-fails" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title">22.8.&nbsp;Load balancer rules fail after changing network offering</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idp15189104">症​状​</h5>
			After changing the network offering on a network, load balancer rules stop working.
		</div><div class="formalpara"><h5 class="formalpara" id="idm11329328">原​因​</h5>
			Load balancing rules were created while using a network service 
offering that includes an external load balancer device such as 
NetScaler, and later the network service offering changed to one that 
uses the CloudStack virtual router.
		</div><div class="formalpara"><h5 class="formalpara" id="idp651952">解​决​方​案​</h5>
			Create a firewall rule on the virtual router for each of your 
existing load balancing rules so that they continue to function.
		</div></div></div><div xml:lang="zh-CN" class="appendix" id="time-zones" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">时​区​</h1></div></div></div><div class="para">
		The following time zone identifiers are accepted by CloudStack. There 
are several places that have a time zone as a required or optional 
parameter. These include scheduling recurring snapshots, creating a 
user, and specifying the usage time zone in the Configuration table.
	</div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="33%"><col class="c2" align="left" width="33%"><col class="c3" align="left" width="33%"></colgroup><tbody><tr><td class="" align="left">
						<div class="para">
							Etc/GMT+12
						</div>
					</td><td class="" align="left">
						<div class="para">
							Etc/GMT+11Etc/GMT+11
						</div>
					</td><td class="" align="left">
						<div class="para">
							Pacific/Samoa
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Pacific/Honolulu
						</div>
					</td><td class="" align="left">
						<div class="para">
							US/Alaska
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Los_Angeles
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Mexico/BajaNorte
						</div>
					</td><td class="" align="left">
						<div class="para">
							US/Arizona
						</div>
					</td><td class="" align="left">
						<div class="para">
							US/Mountain
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Chihuahua
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Chicago
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Costa_Rica
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Mexico_City
						</div>
					</td><td class="" align="left">
						<div class="para">
							Canada/Saskatchewan
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Bogota
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/New_York
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Caracas
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Asuncion
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Cuiaba
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Halifax
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/La_Paz
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Santiago
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/St_Johns
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Araguaina
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Argentina/Buenos_Aires
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Cayenne
						</div>
					</td><td class="" align="left">
						<div class="para">
							America/Godthab
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							America/Montevideo
						</div>
					</td><td class="" align="left">
						<div class="para">
							Etc/GMT+2
						</div>
					</td><td class="" align="left">
						<div class="para">
							Atlantic/Azores
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Atlantic/Cape_Verde
						</div>
					</td><td class="" align="left">
						<div class="para">
							Africa/Casablanca
						</div>
					</td><td class="" align="left">
						<div class="para">
							Etc/UTC
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Atlantic/Reykjavik
						</div>
					</td><td class="" align="left">
						<div class="para">
							Europe/London
						</div>
					</td><td class="" align="left">
						<div class="para">
							CET
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Europe/Bucharest
						</div>
					</td><td class="" align="left">
						<div class="para">
							Africa/Johannesburg
						</div>
					</td><td class="" align="left">
						<div class="para">
							Asia/Beirut
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Africa/Cairo
						</div>
					</td><td class="" align="left">
						<div class="para">
							Asia/Jerusalem
						</div>
					</td><td class="" align="left">
						<div class="para">
							Europe/Minsk
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Europe/Moscow
						</div>
					</td><td class="" align="left">
						<div class="para">
							Africa/Nairobi
						</div>
					</td><td class="" align="left">
						<div class="para">
							Asia/Karachi
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							Asia/Kolkata
						</div>
					</td><td class="" align="left">
						<div class="para">
							Asia/Bangkok
						</div>
					</td><td class="" align="left">
						<div class="para">
							Asia/Shanghai
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							亚​洲​/吉​隆​坡​
						</div>
					</td><td class="" align="left">
						<div class="para">
							澳​大​利​亚​/珀​斯​
						</div>
					</td><td class="" align="left">
						<div class="para">
							亚​洲​/台​北​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							亚​洲​/东​京​
						</div>
					</td><td class="" align="left">
						<div class="para">
							亚​洲​/首​尔​
						</div>
					</td><td class="" align="left">
						<div class="para">
							澳​大​利​亚​/阿​德​莱​德​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							澳​大​利​亚​/达​尔​文​
						</div>
					</td><td class="" align="left">
						<div class="para">
							澳​大​利​亚​/布​里​斯​班​
						</div>
					</td><td class="" align="left">
						<div class="para">
							澳​大​利​亚​/堪​培​拉​
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							太​平​洋​/关​岛​
						</div>
					</td><td class="" align="left">
						<div class="para">
							太​平​洋​/奥​克​兰​
						</div>
					</td><td class="" align="left">
						<div class="para">
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="appendix" id="event-types" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">Event Types</h1></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1" align="left" width="33%"><col class="c2" align="left" width="33%"><col width="33%"></colgroup><tbody><tr><td class="" align="left">
						<div class="para">
							VM.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.EXTRACT
						</div>
					</td><td class="" align="left">
						<div class="para">
							SG.REVOKE.INGRESS
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.DESTROY
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.UPLOAD
						</div>
					</td><td class="" align="left">
						<div class="para">
							HOST.RECONNECT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.START
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.CLEANUP
						</div>
					</td><td class="" align="left">
						<div class="para">
							MAINT.CANCEL
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.STOP
						</div>
					</td><td class="" align="left">
						<div class="para">
							VOLUME.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							MAINT.CANCEL.PS
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.REBOOT
						</div>
					</td><td class="" align="left">
						<div class="para">
							VOLUME.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							MAINT.PREPARE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.UPGRADE
						</div>
					</td><td class="" align="left">
						<div class="para">
							VOLUME.ATTACH
						</div>
					</td><td class="" align="left">
						<div class="para">
							MAINT.PREPARE.PS
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VM.RESETPASSWORD
						</div>
					</td><td class="" align="left">
						<div class="para">
							VOLUME.DETACH
						</div>
					</td><td class="" align="left">
						<div class="para">
							VPN.REMOTE.ACCESS.CREATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							VOLUME.UPLOAD
						</div>
					</td><td class="" align="left">
						<div class="para">
							VPN.USER.ADD
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.DESTROY
						</div>
					</td><td class="" align="left">
						<div class="para">
							SERVICEOFFERING.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							VPN.USER.REMOVE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.START
						</div>
					</td><td class="" align="left">
						<div class="para">
							SERVICEOFFERING.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							NETWORK.RESTART
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.STOP
						</div>
					</td><td class="" align="left">
						<div class="para">
							SERVICEOFFERING.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							UPLOAD.CUSTOM.CERTIFICATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.REBOOT
						</div>
					</td><td class="" align="left">
						<div class="para">
							DOMAIN.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							UPLOAD.CUSTOM.CERTIFICATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ROUTER.HA
						</div>
					</td><td class="" align="left">
						<div class="para">
							DOMAIN.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							STATICNAT.DISABLE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							DOMAIN.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.CREATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.DESTROY
						</div>
					</td><td class="" align="left">
						<div class="para">
							SNAPSHOT.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.DESTROY
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.START
						</div>
					</td><td class="" align="left">
						<div class="para">
							SNAPSHOT.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.START
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.STOP
						</div>
					</td><td class="" align="left">
						<div class="para">
							SNAPSHOTPOLICY.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.STOP
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.REBOOT
						</div>
					</td><td class="" align="left">
						<div class="para">
							SNAPSHOTPOLICY.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.REBOOT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							PROXY.HA
						</div>
					</td><td class="" align="left">
						<div class="para">
							SNAPSHOTPOLICY.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SSVM.H
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							VNC.CONNECT
						</div>
					</td><td class="" align="left">
						<div class="para">
							VNC.DISCONNECT
						</div>
					</td><td class="" align="left">
						<div class="para">
							NET.IPASSIGN
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							NET.IPRELEASE
						</div>
					</td><td class="" align="left">
						<div class="para">
							NET.RULEADD
						</div>
					</td><td class="" align="left">
						<div class="para">
							NET.RULEDELETE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							NET.RULEMODIFY
						</div>
					</td><td class="" align="left">
						<div class="para">
							NETWORK.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							NETWORK.DELETE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							LB.ASSIGN.TO.RULE
						</div>
					</td><td class="" align="left">
						<div class="para">
							LB.REMOVE.FROM.RULE
						</div>
					</td><td class="" align="left">
						<div class="para">
							LB.CREATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							LB.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							LB.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							USER.LOGIN
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							USER.LOGOUT
						</div>
					</td><td class="" align="left">
						<div class="para">
							USER.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							USER.DELETE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							USER.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							USER.DISABLE
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.CREATE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							TEMPLATE.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.UPDATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.COPY
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.START
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.SUCCESS
						</div>
					</td><td class="" align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.FAILED
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ISO.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							ISO.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							ISO.COPY
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ISO.ATTACH
						</div>
					</td><td class="" align="left">
						<div class="para">
							ISO.DETACH
						</div>
					</td><td class="" align="left">
						<div class="para">
							ISO.EXTRACT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ISO.UPLOAD
						</div>
					</td><td class="" align="left">
						<div class="para">
							SERVICE.OFFERING.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							SERVICE.OFFERING.EDIT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							SERVICE.OFFERING.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							DISK.OFFERING.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							DISK.OFFERING.EDIT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							DISK.OFFERING.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							NETWORK.OFFERING.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							NETWORK.OFFERING.EDIT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							NETWORK.OFFERING.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							POD.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							POD.EDIT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							POD.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							ZONE.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							ZONE.EDIT
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							ZONE.DELETE
						</div>
					</td><td class="" align="left">
						<div class="para">
							VLAN.IP.RANGE.CREATE
						</div>
					</td><td class="" align="left">
						<div class="para">
							VLAN.IP.RANGE.DELETE
						</div>
					</td></tr><tr><td class="" align="left">
						<div class="para">
							CONFIGURATION.VALUE.EDIT
						</div>
					</td><td class="" align="left">
						<div class="para">
							SG.AUTH.INGRESS
						</div>
					</td><td class="" align="left">
						<div class="para">
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="zh-CN" class="appendix" id="alerts" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">Alerts</h1></div></div></div><div class="para">
		The following is the list of alert type numbers. The current alerts can be found by calling listAlerts.
	</div><pre class="programlisting">MEMORY = 0</pre><pre class="programlisting">CPU = 1</pre><pre class="programlisting">STORAGE =2</pre><pre class="programlisting">STORAGE_ALLOCATED = 3</pre><pre class="programlisting">PUBLIC_IP = 4</pre><pre class="programlisting">PRIVATE_IP = 5</pre><pre class="programlisting">HOST = 6</pre><pre class="programlisting">USERVM = 7</pre><pre class="programlisting">DOMAIN_ROUTER = 8</pre><pre class="programlisting">CONSOLE_PROXY = 9</pre><pre class="programlisting">ROUTING = 10// lost connection to default route (to the gateway)</pre><pre class="programlisting">STORAGE_MISC = 11 // lost connection to default route (to the gateway)</pre><pre class="programlisting">USAGE_SERVER = 12 // lost connection to default route (to the gateway)</pre><pre class="programlisting">MANAGMENT_NODE = 13 // lost connection to default route (to the gateway)</pre><pre class="programlisting">DOMAIN_ROUTER_MIGRATE = 14</pre><pre class="programlisting">CONSOLE_PROXY_MIGRATE = 15</pre><pre class="programlisting">USERVM_MIGRATE = 16</pre><pre class="programlisting">VLAN = 17</pre><pre class="programlisting">SSVM = 18</pre><pre class="programlisting">USAGE_SERVER_RESULT = 19</pre><pre class="programlisting">STORAGE_DELETE = 20;</pre><pre class="programlisting">UPDATE_RESOURCE_COUNT = 21; //Generated when we fail to update the resource count</pre><pre class="programlisting">USAGE_SANITY_RESULT = 22;</pre><pre class="programlisting">DIRECT_ATTACHED_PUBLIC_IP = 23;</pre><pre class="programlisting">LOCAL_STORAGE = 24;</pre><pre class="programlisting">RESOURCE_LIMIT_EXCEEDED = 25; //Generated when the resource limit exceeds the limit. Currently used for recurring snapshots only</pre></div><div xml:lang="zh-CN" class="appendix" id="appe-cloudstack-Revision_History" lang="zh-CN"><div class="titlepage"><div><div><h1 class="title">更​新​记​录​</h1></div></div></div><div class="para">
		<div class="revhistory"><table summary="修订历史"><tbody><tr><th colspan="3" align="left" valign="top"><strong>修订历史</strong></th></tr><tr><td align="left">修订 0-0</td><td align="left">Tue May 29 2012</td><td align="left"><span class="author"><span class="firstname">Jessica</span> <span class="surname">Tomechak</span></span></td></tr><tr><td colspan="3" align="left">
					<table summary="Simple list" class="simplelist" border="0"><tbody><tr><td>由​publican生​成​的​最​初​版​本​</td></tr></tbody></table>

				</td></tr></tbody></table></div>

	</div></div></div>
</body></html>